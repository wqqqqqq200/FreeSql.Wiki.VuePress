<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <atom:link href="http://freesql.net/rss.xml" rel="self" type="application/rss+xml"/>
    <title>FreeSql Documents</title>
    <link>http://freesql.net/en/</link>
    <description>FreeSql Documents</description>
    <language>en-US</language>
    <pubDate>Mon, 15 Aug 2022 03:11:26 GMT</pubDate>
    <lastBuildDate>Mon, 15 Aug 2022 03:11:26 GMT</lastBuildDate>
    <generator>vuepress-plugin-feed2</generator>
    <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
    <item>
      <title>Entity-Relationship</title>
      <link>http://freesql.net/en/guide/Entity-Relationship.html</link>
      <guid>http://freesql.net/en/guide/Entity-Relationship.html</guid>
      <source url="http://freesql.net/rss.xml">Entity-Relationship</source>
      <pubDate>Tue, 07 Jun 2022 13:45:28 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="entity-relationship" tabindex="-1"> Entity-Relationship</h1>
<p>Navigation properties are one of FreeSql's characteristic functions, which can be configured by agreement or customized configuration of the relationship between objects.</p>
<p>Navigation properties have six configuration relationships: OneToMany, ManyToOne, ManyToMany, OneToOne, Parent, And <a href="https://www.cnblogs.com/FreeSql/p/16351417.html" target="_blank" rel="noopener noreferrer">PgArrayToMany</a>.</p>
<p>With navigation properties, multi-table query is very convenient. Directly using navigation objects in lambda expressions can get the IDE's BUFF blessing.</p>
<ul>
<li>Naming convention,or not (need to specify Navigate attribute association);</li>
<li>If there is no association relationship, you can specify the <code>On</code> condition when querying, <code>LeftJoin(a =&gt; a.Parent.Id == a.ParentId)</code>;</li>
<li>If there is an association relationship, just use the navigation object directly, and the <code>On</code> condition will be automatically attached;</li>
</ul>
<p><a href="https://www.cnblogs.com/kellynic/p/13575053.html" target="_blank" rel="noopener noreferrer">《What problems can navigation properties solve?》</a></p>
<blockquote>
<p>Warm up note: to load navigation attributes, you need to solve the problem of dead cycle reference. When the reference relationship is very complex, it may lead to the failure of using navigation attributes for the first time. The second time is enough. The solution is to preheat all entity classes when the program starts, and while execute fsql.Select&lt;object&gt;().Astype (entity type);</p>
</blockquote>
<p>OneToMany/ManyToMany supported by collection navigation properties: ICollection&lt;T&gt;、List&lt;T&gt;、ObservableCollection&lt;T&gt;</p>
<h2 id="custom-navigation-relationship" tabindex="-1"> Custom Navigation Relationship</h2>
<div><pre><code><span>//Navigation properties, OneToMany</span>
<span>[</span><span>Navigate</span><span>(</span><span>nameof</span><span>(</span>song_tag<span>.</span>song_id<span>)</span><span>)</span><span>]</span>
<span>public</span> <span>virtual</span> <span>List<span>&lt;</span>song_tag<span>></span></span> Obj_song_tag <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>//Find the song_id property in song_tag and associate it with this ENTITY.PrimaryKey</span>

<span>//Navigation properties, ManyToOne/OneToOne</span>
<span>[</span><span>Navigate</span><span>(</span><span>nameof</span><span>(</span>song_id<span>)</span><span>)</span><span>]</span>
<span>public</span> <span>virtual</span> <span>Song</span> Obj_song <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>//Find the song_id property in THIS ENTITY and associate it with the Song.PrimaryKey</span>

<span>//Navigation properties, ManyToMany</span>
<span>[</span><span>Navigate</span><span>(</span>ManyToMany <span>=</span> <span>typeof</span><span>(</span><span>tag_song</span><span>)</span><span>)</span><span>]</span>
<span>public</span> <span>virtual</span> <span>List<span>&lt;</span>tag<span>></span></span> tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><hr>
<p>You can also use FluentApi to set the navigation relationship externally:</p>
<div><pre><code>fsql<span>.</span>CodeFirst<span>.</span><span><span>ConfigEntity</span><span><span>&lt;</span>YOUR_ENTITY<span>></span></span></span><span>(</span>a <span>=></span> a
    <span>.</span><span>Navigate</span><span>(</span>b <span>=></span> b<span>.</span>roles<span>,</span> <span>null</span><span>,</span> <span>typeof</span><span>(</span><span>MANY_TO_MANY_MID_ENTITY</span><span>)</span><span>)</span>
    <span>.</span><span>Navigate</span><span>(</span>b <span>=></span> b<span>.</span>users<span>,</span> <span>"uid"</span><span>)</span>
<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>Priority: Attribute&gt; FluentApi</p>
<blockquote>
<p>Note:</p>
</blockquote>
<ol>
<li>
<p>Set <code>Column(IsIgnore = true)</code> on Property, then the navigation property will be invalid</p>
</li>
<li>
<p>The string set by Navigate is the property name of the type, NOT THE TABLE IR FIELD NAME.</p>
</li>
</ol>
<h2 id="detect-navigation-properties" tabindex="-1"> Detect Navigation Properties</h2>
<p>How to detect whether a navigation property is configured to take effect:</p>
<div><pre><code><span><span>var</span></span> tbref <span>=</span> fsql<span>.</span>CodeFirst
    <span>.</span><span>GetTableByEntity</span><span>(</span><span>typeof</span><span>(</span><span>T</span><span>)</span><span>)</span>
    <span>.</span><span>GetTableRef</span><span>(</span><span>"Children"</span><span>,</span> <span>true</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>Method signature:</p>
<div><pre><code>GetTableRef(string propertyName, bool isThrow);
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="naming-convention-no-need-to-specify-navigate" tabindex="-1"> Naming convention (no need to specify Navigate)</h2>
<h3 id="one-to-one" tabindex="-1"> One-to-One</h3>
<div><pre><code><span>class</span> <span>User</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Id、UserId、User_id</span>

    <span>public</span> <span>UserExt</span> UserExt <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>class</span> <span>UserExt</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Id、UserId、User_id、UserExtId、UserExt_id</span>

    <span>public</span> <span>User</span> User <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p><a href="https://github.com/dotnetcore/FreeSql/issues/45" target="_blank" rel="noopener noreferrer">《How to add data in one-to-one mode?》</a></p>
<h3 id="many-to-one" tabindex="-1"> Many-to-One</h3>
<div><pre><code><span>class</span> <span>Group</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Id、GroupId、Group_id</span>
<span>}</span>

<span>class</span> <span>User</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Id、UserId、User_id</span>


    <span>public</span> <span><span>int</span></span> AGroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Group</span> AGroup <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> BGroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Group</span> BGroup <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><h3 id="one-to-many" tabindex="-1"> One-to-Many</h3>
<div><pre><code><span>class</span> <span>Group</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Id、GroupId、Group_id</span>

    <span>public</span> <span>ICollection<span>&lt;</span>User<span>></span></span> AUsers <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>ICollection<span>&lt;</span>User<span>></span></span> BUsers <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>class</span> <span>User</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Id、UserId、User_id</span>


    <span>public</span> <span><span>int</span></span> AGroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Group</span> AGroup <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> BGroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Group</span> BGroup <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><p><a href="https://github.com/dotnetcore/FreeSql/issues/46" target="_blank" rel="noopener noreferrer">《How to add data in one-to-many mode?》</a></p>
<h3 id="parent-and-children" tabindex="-1"> Parent and Children</h3>
<div><pre><code><span>class</span> <span>Group</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Id、GroupId、Group_id</span>

    <span>public</span> <span><span>int</span></span> ParentId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//ParentId、Parent_id</span>
    <span>public</span> <span>Group</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>ICollection<span>&lt;</span>Group<span>></span></span> Childs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>The parent-children relationship is similar to One-to-Many mode. You can also refer to this link:</p>
<p><a href="https://github.com/dotnetcore/FreeSql/issues/46" target="_blank" rel="noopener noreferrer">《How to add data in one-to-many mode?》</a></p>
<h3 id="many-to-many" tabindex="-1"> Many-to-Many</h3>
<div><pre><code><span>class</span> <span>Song</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>Song_tag</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Song_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Song</span> Song <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> Tag_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Tag</span> Tag <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>Tag</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span><span>?</span></span> Parent_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Tag</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div><p>Song, Tag, Song_tag, these three entities use the four relationships: OneToMany, ManyToOne, Parent, and ManyToMany.</p>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Entity-Attributes">《CodeFirst Mode, Part 1: Entity Attributes》</a></li>
<li><a href="FluentApi-Mode">《CodeFirst Mode, Part 2: FluentApi》</a></li>
<li><a href="Custom-Attributes">《CodeFirst Mode, Part 3: Custom Attributes》</a></li>
<li><a href="Type-Mapping">《CodeFirst Mode, Part 4: Type Mapping》</a></li>
<li><a href="Import-Entity-Configuration-from-Database">《Import Entity Configuration from Database》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Cascade Saving</title>
      <link>http://freesql.net/en/guide/Cascade-Saving.html</link>
      <guid>http://freesql.net/en/guide/Cascade-Saving.html</guid>
      <source url="http://freesql.net/rss.xml">Cascade Saving</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="cascade-saving" tabindex="-1"> Cascade Saving</h1>
<p>It is found that n to 1 is not suitable for cascade preservation. Save the type information when saving the topic? Personally, I think the bottom-up saving function is too uncontrollable. FreeSQL does not support bottom-up saving at present. Therefore, we will only talk about OneToOne/OneToMany/ManyToMany cascade save. As for manytoone cascade storage, manual processing is used, which is more safe and controllable.</p>
<h2 id="savemany-save-manually" tabindex="-1"> Savemany save manually</h2>
<p>Save completely, compare the existing data in the table, and calculate the execution of addition, modification and deletion.</p>
<p>Recursive saving of navigation attributes is unsafe and uncontrollable. It is not a technical problem, but for security reasons. It provides a way to save navigation attributes manually and completely.</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Type<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> type <span>=</span> <span>new</span> <span>Type</span>
<span>{</span>
    name <span>=</span> <span>"c#"</span><span>,</span>
    Topics <span>=</span> <span>new</span> <span>List<span>&lt;</span>Topic<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
    <span>{</span>
        <span>new</span> <span>Topic</span> <span>{</span> <span>..</span><span>.</span> <span>}</span>
    <span>}</span><span>)</span>
<span>}</span><span>;</span>
repo<span>.</span><span>Insert</span><span>(</span>type<span>)</span><span>;</span>
repo<span>.</span><span>SaveMany</span><span>(</span>type<span>,</span> <span>"Topics"</span><span>)</span><span>;</span> <span>////Manually and completely save topics</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>-SaveMany only supports onetomany and manytomany navigation properties
-Save only topics, not downward recursive tracing
-When topics is empty, delete all table data of topics existing in type, and confirm?
-The manytomany mechanism is to completely compare and save the intermediate table, and only append the external table without updating</p>
<p>For example:</p>
<p>-This table song
-External table tag
-Intermediate table Songtag</p>
<h2 id="enablecascadesave-warehouse-cascade-save" tabindex="-1"> EnableCascadeSave warehouse cascade save</h2>
<p>Dbcontext / repository EnableCascadeSave can realize recursive tracing and save the OneToOne/OneToMany/ManyToMany navigation attributes when saving objects. This document describes the mechanism to prevent misuse.</p>
<ol>
<li>Onetoone cascade save</li>
</ol>
<blockquote>
<p>v3. 2.606 + support, and support <a href="https://github.com/dotnetcore/FreeSql/wiki/%e5%88%a0%e9%99%a4#ibaserepository-%E7%BA%A7%E8%81%94%E5%88%A0%E9%99%A4" target="_blank" rel="noopener noreferrer">cascade deletion function</a></p>
</blockquote>
<ol start="2">
<li>Onetomany appends or updates the sub table without deleting the existing data of the sub table</li>
</ol>
<div><pre><code>repo<span>.</span> DbContextOptions<span>.</span> EnableCascadeSave <span>=</span> <span>true</span><span>;</span> <span>// Manual opening required</span>
repo<span>.</span> <span>Insert</span><span>(</span>type<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>-Do not delete the existing data in the topics sub table. Are you sure?
-When the topics attribute is empty, do not do anything. Confirm?
-When you save topics, you will also save the subordinate collection properties of topics \ [0 -.. ]. Go down to 18 layers and confirm?</p>
<blockquote>
<p>For example, in the [type] table, there is set attribute [article] below and set attribute [comment] below [article].</p>
</blockquote>
<blockquote>
<p>When saving the [type] table object, it will retrieve the set attribute [article], and then if the [article] is saved, it will continue to retrieve the set attribute [comment]. Do insertorupdate operation together.</p>
</blockquote>
<ol start="3">
<li>Manytomany completely compares and saves the intermediate table and appends the external table</li>
</ol>
<p>Compare and save the intermediate table completely, compare the existing data of the [many to many] intermediate table, and calculate the execution of addition, modification and deletion.</p>
<p>Append external tables, only append without updating.</p>
<p>-This table song
-External table tag
-Intermediate table Songtag</p>
<hr>
<p>Test 1: append and save OneToMany</p>
<div><pre><code><span>class</span> <span>Cagetory</span>
<span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>Guid</span> ParentId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>ParentId<span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>List<span>&lt;</span>Cagetory<span>></span></span> Childs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span><span>void</span></span> <span>TestOneToManyParent</span><span>(</span><span>)</span>
<span>{</span>
    <span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Cagetory<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>true</span><span>;</span>
    <span><span>var</span></span> cts <span>=</span> <span>new</span><span>[</span><span>]</span>
    <span>{</span>
        <span>new</span> <span>Cagetory</span>
        <span>{</span>
            Name <span>=</span> <span>"class1"</span><span>,</span>
            Childs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Cagetory<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"class1_1"</span> <span>}</span><span>,</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"class1_2"</span> <span>}</span><span>,</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"class1_3"</span> <span>}</span>
            <span>}</span><span>)</span>
        <span>}</span><span>,</span>
        <span>new</span> <span>Cagetory</span>
        <span>{</span>
            Name <span>=</span> <span>"class2"</span><span>,</span>
            Childs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Cagetory<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"class2_1"</span> <span>}</span><span>,</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"class2_2"</span> <span>}</span>
            <span>}</span><span>)</span>
        <span>}</span>
    <span>}</span><span>;</span>
    repo<span>.</span><span>Insert</span><span>(</span>cts<span>)</span><span>;</span>
    <span>//To create a table and insert data:</span>
    <span>//INSERT INTO "Cagetory"("Id", "Name", "ParentId") VALUES('5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f', 'class1', '00000000-0000-0000-0000-000000000000'), ('5d90afcb-ed57-f6f4-0082-cb6c5b531b3e', 'class2', '00000000-0000-0000-0000-000000000000')</span>
    <span>//INSERT INTO "Cagetory"("Id", "Name", "ParentId") VALUES('5d90afcb-ed57-f6f4-0082-cb6d0c1c5f1a', 'class1_1', '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f'), ('5d90afcb-ed57-f6f4-0082-cb6e74bd8eef', 'class1_2', '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f'), ('5d90afcb-ed57-f6f4-0082-cb6f6267cc5f', 'class1_3', '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f'), ('5d90afcb-ed57-f6f4-0082-cb7057c41d46', 'class2_1', '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e'), ('5d90afcb-ed57-f6f4-0082-cb7156e0375e', 'class2_2', '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e')</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"class11"</span><span>;</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Name <span>=</span> <span>"class22"</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Childs<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span><span>Update</span><span>(</span>cts<span>)</span><span>;</span>
    <span>//UPDATE "Cagetory" SET "Name" = CASE "Id"</span>
    <span>//WHEN '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f' THEN 'class11'</span>
    <span>//WHEN '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e' THEN 'class22' END</span>
    <span>//WHERE ("Id" IN ('5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f','5d90afcb-ed57-f6f4-0082-cb6c5b531b3e'))</span>
    <span>//Childs.Clear After that, the operation of deleting subsets was not performed, indicating that no complete comparison was made</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"class111"</span><span>;</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"class1_33"</span> <span>}</span><span>)</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Name <span>=</span> <span>"class222"</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Childs<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Childs<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"class2_22"</span> <span>}</span><span>)</span><span>;</span>
    repo<span>.</span><span>Update</span><span>(</span>cts<span>)</span><span>;</span>
    <span>//UPDATE "Cagetory" SET "Name" = CASE "Id"</span>
    <span>//WHEN '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f' THEN 'class111'</span>
    <span>//WHEN '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e' THEN 'class222' END</span>
    <span>//WHERE ("Id" IN ('5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f','5d90afcb-ed57-f6f4-0082-cb6c5b531b3e'))</span>
    <span>//INSERT INTO "Cagetory"("Id", "Name", "ParentId") VALUES('5d90afe8-ed57-f6f4-0082-cb725df546ea', 'class1_33', '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f'), ('5d90afe8-ed57-f6f4-0082-cb7338a6214c', 'class2_22', '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e')</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br></div></div><hr>
<p>Test 2: Full save ManyToMany</p>
<div><pre><code><span>class</span> <span>Song</span>
<span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>List<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>Tag</span>
<span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> TagName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>List<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>SongTag</span>
<span>{</span>
    <span>public</span> <span>Guid</span> SongId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Song</span> Song <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Guid</span> TagId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Tag</span> Tag <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>[</span><span><span>Fact</span></span><span>]</span>
<span>public</span> <span><span>void</span></span> <span>TestManyToMany</span><span>(</span><span>)</span>
<span>{</span>
    <span><span>var</span></span> tags <span>=</span> <span>new</span><span>[</span><span>]</span>
    <span>{</span>
        <span>new</span> <span>Tag</span> <span>{</span> TagName <span>=</span> <span>"pop music"</span> <span>}</span><span>,</span>
        <span>new</span> <span>Tag</span> <span>{</span> TagName <span>=</span> <span>"the post-80s generation"</span> <span>}</span><span>,</span>
        <span>new</span> <span>Tag</span> <span>{</span> TagName <span>=</span> <span>"the post-00s generation"</span> <span>}</span><span>,</span>
        <span>new</span> <span>Tag</span> <span>{</span> TagName <span>=</span> <span>"Rock music"</span> <span>}</span>
    <span>}</span><span>;</span>
    <span><span>var</span></span> ss <span>=</span> <span>new</span><span>[</span><span>]</span>
    <span>{</span>
        <span>new</span> <span>Song</span>
        <span>{</span>
            Name <span>=</span> <span>"love you forever.mp3"</span><span>,</span>
            Tags <span>=</span> <span>new</span> <span>List<span>&lt;</span>Tag<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                tags<span>[</span><span>0</span><span>]</span><span>,</span> tags<span>[</span><span>1</span><span>]</span>
            <span>}</span><span>)</span>
        <span>}</span><span>,</span>
        <span>new</span> <span>Song</span>
        <span>{</span>
            Name <span>=</span> <span>"Li Bai.mp3"</span><span>,</span>
            Tags <span>=</span> <span>new</span> <span>List<span>&lt;</span>Tag<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                tags<span>[</span><span>0</span><span>]</span><span>,</span> tags<span>[</span><span>2</span><span>]</span>
            <span>}</span><span>)</span>
        <span>}</span>
    <span>}</span><span>;</span>
    <span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>true</span><span>;</span>
    repo<span>.</span><span>Insert</span><span>(</span>ss<span>)</span><span>;</span>
    <span>//INSERT INTO "Song"("Id", "Name") VALUES('5d90fdb3-6a6b-2c58-00c8-37974177440d', 'love you forever.mp3'), ('5d90fdb3-6a6b-2c58-00c8-37987f29b197', 'Li Bai.mp3')</span>
    <span>//INSERT INTO "Tag"("Id", "TagName") VALUES('5d90fdb7-6a6b-2c58-00c8-37991ead4f05', 'pop music'), ('5d90fdbd-6a6b-2c58-00c8-379a0432a09c', 'the post-80s generation')</span>
    <span>//INSERT INTO "SongTag"("SongId", "TagId") VALUES('5d90fdb3-6a6b-2c58-00c8-37974177440d', '5d90fdb7-6a6b-2c58-00c8-37991ead4f05'), ('5d90fdb3-6a6b-2c58-00c8-37974177440d', '5d90fdbd-6a6b-2c58-00c8-379a0432a09c')</span>
    <span>//INSERT INTO "Tag"("Id", "TagName") VALUES('5d90fdcc-6a6b-2c58-00c8-379b5af59d25', 'the post-00s generation')</span>
    <span>//INSERT INTO "SongTag"("SongId", "TagId") VALUES('5d90fdb3-6a6b-2c58-00c8-37987f29b197', '5d90fdb7-6a6b-2c58-00c8-37991ead4f05'), ('5d90fdb3-6a6b-2c58-00c8-37987f29b197', '5d90fdcc-6a6b-2c58-00c8-379b5af59d25')</span>

    ss<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"love you forever.mp5"</span><span>;</span>
    ss<span>[</span><span>0</span><span>]</span><span>.</span>Tags<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    ss<span>[</span><span>0</span><span>]</span><span>.</span>Tags<span>.</span><span>Add</span><span>(</span>tags<span>[</span><span>0</span><span>]</span><span>)</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Name <span>=</span> <span>"Li Bai.mp5"</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Tags<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Tags<span>.</span><span>Add</span><span>(</span>tags<span>[</span><span>3</span><span>]</span><span>)</span><span>;</span>
    repo<span>.</span><span>Update</span><span>(</span>ss<span>)</span><span>;</span>
    <span>//UPDATE "Song" SET "Name" = CASE "Id"</span>
    <span>//WHEN '5d90fdb3-6a6b-2c58-00c8-37974177440d' THEN 'love you forever.mp5'</span>
    <span>//WHEN '5d90fdb3-6a6b-2c58-00c8-37987f29b197' THEN 'Li Bai.mp5' END</span>
    <span>//WHERE ("Id" IN ('5d90fdb3-6a6b-2c58-00c8-37974177440d','5d90fdb3-6a6b-2c58-00c8-37987f29b197'))</span>

    <span>//SELECT a."SongId", a."TagId"</span>
    <span>//FROM "SongTag" a</span>
    <span>//WHERE (a."SongId" = '5d90fdb3-6a6b-2c58-00c8-37974177440d')</span>

    <span>//DELETE FROM "SongTag" WHERE ("SongId" = '5d90fdb3-6a6b-2c58-00c8-37974177440d' AND "TagId" = '5d90fdbd-6a6b-2c58-00c8-379a0432a09c')</span>
    <span>//INSERT INTO "Tag"("Id", "TagName") VALUES('5d90febd-6a6b-2c58-00c8-379c21acfc72', 'Rock music')</span>

    <span>//SELECT a."SongId", a."TagId"</span>
    <span>//FROM "SongTag" a</span>
    <span>//WHERE (a."SongId" = '5d90fdb3-6a6b-2c58-00c8-37987f29b197')</span>

    <span>//DELETE FROM "SongTag" WHERE ("SongId" = '5d90fdb3-6a6b-2c58-00c8-37987f29b197' AND "TagId" = '5d90fdb7-6a6b-2c58-00c8-37991ead4f05' OR "SongId" = '5d90fdb3-6a6b-2c58-00c8-37987f29b197' AND "TagId" = '5d90fdcc-6a6b-2c58-00c8-379b5af59d25')</span>
    <span>//INSERT INTO "SongTag"("SongId", "TagId") VALUES('5d90fdb3-6a6b-2c58-00c8-37987f29b197', '5d90febd-6a6b-2c58-00c8-379c21acfc72')</span>

    ss<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"love you forever.mp4"</span><span>;</span>
    ss<span>[</span><span>0</span><span>]</span><span>.</span>Tags<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Name <span>=</span> <span>"Li Bai.mp4"</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Tags<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span><span>Update</span><span>(</span>ss<span>)</span><span>;</span>
    <span>//DELETE FROM "SongTag" WHERE ("SongId" = '5d90fdb3-6a6b-2c58-00c8-37974177440d')</span>
    <span>//DELETE FROM "SongTag" WHERE ("SongId" = '5d90fdb3-6a6b-2c58-00c8-37987f29b197')</span>

    <span>//UPDATE "Song" SET "Name" = CASE "Id"</span>
    <span>//WHEN '5d90fdb3-6a6b-2c58-00c8-37974177440d' THEN 'love you forever.mp4'</span>
    <span>//WHEN '5d90fdb3-6a6b-2c58-00c8-37987f29b197' THEN 'Li Bai.mp4' END</span>
    <span>//WHERE ("Id" IN ('5d90fdb3-6a6b-2c58-00c8-37974177440d','5d90fdb3-6a6b-2c58-00c8-37987f29b197'))</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br><span>76</span><br><span>77</span><br><span>78</span><br><span>79</span><br><span>80</span><br><span>81</span><br><span>82</span><br><span>83</span><br><span>84</span><br><span>85</span><br><span>86</span><br><span>87</span><br><span>88</span><br><span>89</span><br><span>90</span><br><span>91</span><br><span>92</span><br><span>93</span><br><span>94</span><br><span>95</span><br><span>96</span><br><span>97</span><br></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Delete</title>
      <link>http://freesql.net/en/guide/Delete-Data.html</link>
      <guid>http://freesql.net/en/guide/Delete-Data.html</guid>
      <source url="http://freesql.net/rss.xml">Delete</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="delete" tabindex="-1"> Delete</h1>
<p>Deleting data is a very dangerous operation. FreeSql does not support deletion very powerfully. By default, it only supports single-table and conditional deletion methods.</p>
<p>If it is executed when the <code>Where</code> condition is empty, only <code>0</code> or the <code>default</code> value is returned, and no real SQL delete operation is performed.</p>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//Automatically synchronize the entity structure to the database</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//Be sure to define as singleton mode</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><h2 id="dynamic-conditions" tabindex="-1"> Dynamic Conditions</h2>
<div><pre><code>fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span><span>object</span></span> dywhere<span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p><code>dywhere</code> supports:</p>
<ul>
<li>Primary key value</li>
<li><code>new[] { PrimaryKey1, PrimaryKey2 }</code></li>
<li>Topic Object</li>
<li><code>new[] { TopicObject1, TopicObject2 }</code></li>
<li><code>new { id = 1 }</code></li>
</ul>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span> <span>1</span><span>,</span> <span>2</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1 OR `Id` = 2)</span>

<span><span>var</span></span> t2 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span><span>,</span> Title <span>=</span> <span>"test"</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1)</span>

<span><span>var</span></span> t3 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span><span>,</span> Title <span>=</span> <span>"test"</span> <span>}</span><span>,</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>2</span><span>,</span> Title <span>=</span> <span>"test"</span> <span>}</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1 OR `Id` = 2)</span>

<span><span>var</span></span> t4 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>new</span> <span>{</span> id <span>=</span> <span>1</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="delete-conditions" tabindex="-1"> Delete Conditions</h2>
<blockquote>
<p>For safety reasons, when there are no conditions, the delete action will not be executed to avoid deleting the entire table data by mistake. Delete the entire table data: <code>fsql.Delete&lt;T&gt;().Where(&quot;1=1&quot;).ExecuteAffrows()</code></p>
</blockquote>
<div><pre><code><span><span>var</span></span> t5 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1)</span>

<span><span>var</span></span> t6 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>"id = @id"</span><span>,</span> <span>new</span> <span>{</span> id <span>=</span> <span>1</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (id = @id)</span>

<span><span>var</span></span> item <span>=</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span><span>,</span> Title <span>=</span> <span>"newtitle"</span> <span>}</span><span>;</span>
<span><span>var</span></span> t7 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>item<span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1)</span>

<span><span>var</span></span> items <span>=</span> <span>new</span> <span>List<span>&lt;</span>Topic<span>></span></span><span>(</span><span>)</span><span>;</span>
<span>for</span> <span>(</span><span><span>var</span></span> a <span>=</span> <span>0</span><span>;</span> a <span>&lt;</span> <span>10</span><span>;</span> a<span>++</span><span>)</span> items<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> a <span>+</span> <span>1</span><span>,</span> Title <span>=</span> <span><span>$"newtitle</span><span><span>{</span><span>a</span><span>}</span></span><span>"</span></span><span>,</span> Clicks <span>=</span> a <span>*</span> <span>100</span> <span>}</span><span>)</span><span>;</span>
<span><span>var</span></span> t8 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>items<span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` IN (1,2,3,4,5,6,7,8,9,10))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><h2 id="dictionary-delete" tabindex="-1"> Dictionary Delete</h2>
<div><pre><code><span><span>var</span></span> dic <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"id"</span><span>,</span> <span>1</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"name"</span><span>,</span> <span>"xxxx"</span><span>)</span><span>;</span>

fsql<span>.</span><span>DeleteDict</span><span>(</span>dic<span>)</span><span>.</span><span>AsTable</span><span>(</span><span>"table1"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="iselect-todelete-advanced-delete" tabindex="-1"> <code>ISelect.ToDelete</code> Advanced Delete</h2>
<p><code>IDelete</code> does not support navigation objects, multi-table association, etc. By default, <code>ISelect.ToDelete</code> can convert the query to <code>IDelete</code> so that the navigation object can be used to delete data:</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T1<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Options<span>.</span>xxx <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToDelete</span><span>(</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>Note: This method is not to query the data to the memory and delete it cyclically. The above code generates and executes the following SQL:</p>
<div><pre><code><span>DELETE</span> <span>FROM</span> <span><span>`</span>T1<span>`</span></span> <span>WHERE</span> id <span>in</span> <span>(</span><span>select</span> a<span>.</span>id <span>from</span> T1 a <span>left</span> <span>join</span> Options b <span>on</span> b<span>.</span>t1id <span>=</span> a<span>.</span>id <span>where</span> b<span>.</span>xxx <span>=</span> <span>1</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>The benefits of using this method for complex deletion:</p>
<ul>
<li>Preview data before deleting to prevent mistaken deletion operations;</li>
<li>Support complex deletion operations, for example: Use <code>Limit(10)</code> on <code>ISelect</code> to delete the first 10 records that meet the conditions;</li>
</ul>
<h2 id="cascade-deletion-of-ibaserepository" tabindex="-1"> Cascade deletion of IBaseRepository</h2>
<p>1、Cascade deletion based on [object]</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Group<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>true</span><span>;</span> <span>//Key settings</span>
repo<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>UserGroup</span>
<span>{</span>
    GroupName <span>=</span> <span>"group01"</span><span>,</span>
    Users <span>=</span> <span>new</span> <span>List<span>&lt;</span>User<span>></span></span>
    <span>{</span>
        <span>new</span> <span>User</span> <span>{</span> Username <span>=</span> <span>"admin01"</span><span>,</span> Password <span>=</span> <span>"pwd01"</span><span>,</span> UserExt <span>=</span> <span>new</span> <span>UserExt</span> <span>{</span> Remark <span>=</span> <span>"user remark01"</span> <span>}</span> <span>}</span><span>,</span>
        <span>new</span> <span>User</span> <span>{</span> Username <span>=</span> <span>"admin02"</span><span>,</span> Password <span>=</span> <span>"pwd02"</span><span>,</span> UserExt <span>=</span> <span>new</span> <span>UserExt</span> <span>{</span> Remark <span>=</span> <span>"user remark02"</span> <span>}</span> <span>}</span><span>,</span>
        <span>new</span> <span>User</span> <span>{</span> Username <span>=</span> <span>"admin03"</span><span>,</span> Password <span>=</span> <span>"pwd03"</span><span>,</span> UserExt <span>=</span> <span>new</span> <span>UserExt</span> <span>{</span> Remark <span>=</span> <span>"user remark03"</span> <span>}</span> <span>}</span><span>,</span>
    <span>}</span>
<span>}</span><span>)</span><span>;</span> <span>//Cascade addition test data</span>
<span>//INSERT INTO "usergroup"("groupname") VALUES('group01') RETURNING "id"</span>
<span>//INSERT INTO "user"("username", "password", "groupid") VALUES('admin01', 'pwd01', 1), ('admin02', 'pwd02', 1), ('admin03', 'pwd03', 1) RETURNING "id" as "Id", "username" as "Username", "password" as "Password", "groupid" as "GroupId"</span>
<span>//INSERT INTO "userext"("userid", "remark") VALUES(3, 'user remark01'), (4, 'user remark02'), (5, 'user remark03')</span>

<span><span>var</span></span> groups <span>=</span> repo<span>.</span>Select
    <span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Users<span>,</span> 
        then <span>=></span> then<span>.</span><span>Include</span><span>(</span>b <span>=></span> b<span>.</span>UserExt<span>)</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
repo<span>.</span><span>Delete</span><span>(</span>groups<span>)</span><span>;</span> <span>//Cascade deletion, recursively traversing the navigation properties of group OneToOne/OneToMany/ManyToMany</span>
<span>//DELETE FROM "userext" WHERE ("userid" IN (3,4,5))</span>
<span>//DELETE FROM "user" WHERE ("id" IN (3,4,5))</span>
<span>//DELETE FROM "usergroup" WHERE ("id" = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br></div></div><ol start="2">
<li>Cascade deletion based on [database]</li>
</ol>
<blockquote>
<p>According to the set navigation properties, recursively delete the corresponding data of OneToOne/OneToMany/ManyToMany, and return the deleted data. This feature does not rely on database foreign keys</p>
</blockquote>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Group<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> ret <span>=</span> repo<span>.</span><span>DeleteCascadeByDatabase</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>;</span>
<span>//SELECT a."id", a."username", a."password", a."groupid" FROM "user" a WHERE (a."groupid" = 1)</span>
<span>//SELECT a."userid", a."remark" FROM "userext" a WHERE (a."userid" IN (3,4,5))</span>
<span>//DELETE FROM "userext" WHERE ("userid" IN (3,4,5))</span>
<span>//DELETE FROM "user" WHERE ("id" IN (3,4,5))</span>
<span>//DELETE FROM "usergroup" WHERE ("id" = 1)</span>

<span>//ret   Count = 7	System.Collections.Generic.List&lt;object></span>
<span>//  [0]	{UserExt}	object {UserExt}</span>
<span>//  [1]	{UserExt}	object {UserExt}</span>
<span>//  [2]	{UserExt}	object {UserExt}</span>
<span>//  [3]	{User}	    object {User}</span>
<span>//  [4]	{User}	    object {User}</span>
<span>//  [5]	{User}  	object {User}</span>
<span>//  [6]	{UserGroup}	object {UserGroup}</span>

<span>public</span> <span>class</span> <span>Group</span>
<span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> GroupName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>User<span>.</span>GroupId<span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>List<span>&lt;</span>User<span>></span></span> Users <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>User</span>
<span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Username <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Password <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> GroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>Id<span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>UserExt</span> UserExt <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>UserExt</span>
<span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> UserId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Remark <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>UserId<span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>User</span> User <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br></div></div><h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Database-Transaction">《Database Transaction》</a></li>
<li><a href="Insert-Data">《FreeSql 101, Part 1: Insert Data》</a></li>
<li><a href="Update-Data">《FreeSql 101, Part 3: Update Data》</a></li>
<li><a href="Query-Data">《FreeSql 101, Part 4: Query Data》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
</ul>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>Methods</th>
<th>Return</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Expression conditions, only support entity basic members (not including navigation objects)</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Raw SQL syntax conditions, <code>Where(&quot;id = @id&quot;, new { id = 1 })</code></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>Pass in the entity or collection, and use its primary key as the condition</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>Command timeout setting (seconds)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>Set transaction object</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>Set the connection object</td>
</tr>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>Returns the SQL statement to be executed.</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>long</td>
<td></td>
<td>Execute SQL and return the number of rows affected.</td>
</tr>
<tr>
<td>ExecuteDeleted</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>Execute SQL and return the deleted records.</td>
</tr>
</tbody>
</table>
]]></content:encoded>
    </item>
    <item>
      <title>Greed-Loading</title>
      <link>http://freesql.net/en/guide/Greed-Loading.html</link>
      <guid>http://freesql.net/en/guide/Greed-Loading.html</guid>
      <source url="http://freesql.net/rss.xml">Greed-Loading</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="greed-loading" tabindex="-1"> Greed-Loading</h1>
<h2 id="navigation-properties-manytoone" tabindex="-1"> Navigation Properties - ManyToOne</h2>
<p>ManyToOne navigation properties are loaded by <code>ToList(includeNestedMembers: false)</code>, parameter description:</p>
<p><code>false</code>: Return the navigation data of Level 2 Join (default);</p>
<p><code>true</code>: Return the navigation data of all levels of depth Join (unused navigation data will not be returned).</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Include</span><span>(</span>a <span>=></span> a<span>.</span>Parent<span>.</span>Parent<span>)</span><span>.</span><span>ToList</span><span>(</span><span>true</span><span>)</span><span>;</span>

<span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Parent<span>.</span>Parent<span>.</span>Name <span>==</span> <span>"1"</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>true</span><span>)</span><span>;</span>
<span>//Write in this way, no need to mark Join, </span>
<span>//it will be automatically processed into LeftJoin when parsing the expression</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="navigation-properties-onetomany-manytomany" tabindex="-1"> Navigation Properties - OneToMany/ManyToMany</h2>
<p>IncludeMany greedily loads the navigation properties of the collection. In fact, it is queried twice, and data is assembled after <code>ToList</code>.</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>IncludeMany has a second parameter, which can be modified before the second query.</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>,</span> 
    then <span>=></span> then<span>.</span><span>Where</span><span>(</span>song <span>=></span> song<span>.</span>User <span>==</span> <span>"admin"</span><span>)</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>In fact, in <code>Then</code>, you can continue to use <code>Include</code>/<code>IncludeMany</code>. As long as you like it, it’s okay to go down 100 levels.</p>
<h2 id="mutations" tabindex="-1"> Mutations</h2>
<p>It can also be greedily loaded without configuring the navigation relationship.</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>TestManys<span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>TagId <span>==</span> a<span>.</span>Id<span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>Only query the first few pieces of data in each sub-collection to avoid poor IO performance caused by loading all data like EfCore (for example, there are 2000 comments under a product).</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>TestManys<span>.</span><span>Take</span><span>(</span><span>10</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>The sub-collection returns a part of the fields to avoid the problem of too many fields.</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>TestManys<span>.</span><span>Select</span><span>(</span>b <span>=></span> <span>new</span> <span>TestMany</span> <span>{</span> Title <span>=</span> b<span>.</span>Title <span>..</span><span>.</span> <span>}</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="includemany-extensions" tabindex="-1"> IncludeMany Extensions</h2>
<p>When the main data already exists in the memory, how to load the sub-data? So we added the List&lt;T&gt; extension method, the example is as follows:</p>
<div><pre><code><span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span> song1<span>,</span> song2<span>,</span> song3 <span>}</span><span>)</span>
    <span>.</span><span>IncludeMany</span><span>(</span>fsql<span>,</span> a <span>=></span> a<span>.</span>Tags<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><div><pre><code><span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span> song1<span>,</span> song2<span>,</span> song3 <span>}</span><span>)</span>
    <span>.</span><span>IncludeByPropertyName</span><span>(</span>
        <span>orm</span><span>:</span> fsql<span>,</span> 
        <span>property</span><span>:</span> <span>"Tags"</span><span>,</span> 
        <span>where</span><span>:</span> <span>"ParentId=Code"</span><span>,</span> 
        <span>take</span><span>:</span> <span>5</span><span>,</span> 
        <span>select</span><span>:</span> <span>"id,name"</span>
    <span>)</span><span>;</span>
<span>//v3.2.605+</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="comparison-of-the-two-ways-of-includemany" tabindex="-1"> Comparison of the Two Ways of IncludeMany</h2>
<p><strong>Way 1: IncludeMany extensions</strong></p>
<div><pre><code><span><span>var</span></span> list111 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>SysModule<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> Id <span>=</span> a<span>.</span>Id <span>}</span><span>)</span> <span>//Query data id</span>
    <span>.</span><span>Select</span><span>(</span>a <span>=></span> <span>new</span> <span>SysModule</span> <span>{</span> Id <span>=</span> a<span>.</span>Id <span>}</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span> <span>//Memory operation</span>
    <span>.</span><span>IncludeMany</span><span>(</span>fsql<span>,</span> a <span>=></span> a<span>.</span>Permissions<span>,</span> then <span>=></span> then<span>.</span><span>Include</span><span>(</span>a <span>=></span> a<span>.</span>Button<span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><div><pre><code><span>SELECT</span> a<span>.</span><span>"Id"</span> as1 
<span>FROM</span> <span>"SysModule"</span> a 
<span>limit</span> <span>0</span><span>,</span><span>10</span>

<span>SELECT</span> a<span>.</span><span>"Id"</span><span>,</span> a<span>.</span><span>"SysModuleId"</span><span>,</span> a<span>.</span><span>"SysModuleButtonId"</span><span>,</span> a<span>.</span><span>"Status"</span><span>,</span> 
a__Button<span>.</span><span>"Id"</span> as5<span>,</span> a__Button<span>.</span><span>"Name"</span><span>,</span> a__Button<span>.</span><span>"EventName"</span><span>,</span> a__Button<span>.</span><span>"EnCode"</span><span>,</span> a__Button<span>.</span><span>"Icon"</span><span>,</span> a__Button<span>.</span><span>"Sort"</span><span>,</span> a__Button<span>.</span><span>"CreateTime"</span> 
<span>FROM</span> <span>"SysModulePermission"</span> a 
<span>LEFT</span> <span>JOIN</span> <span>"SysModuleButton"</span> a__Button <span>ON</span> a__Button<span>.</span><span>"Id"</span> <span>=</span> a<span>.</span><span>"SysModuleButtonId"</span> 
<span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span>"SysModuleId"</span><span>)</span> <span>in</span> <span>(</span><span>'menu1'</span><span>,</span><span>'menu2'</span><span>)</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><hr>
<p><strong>Way 2: Directly IncludeMany + ToList</strong></p>
<div><pre><code><span><span>var</span></span> list222 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>SysModule<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>IncludeMany</span><span>(</span>m <span>=></span> m<span>.</span>Permissions<span>,</span> then <span>=></span> then<span>.</span><span>Include</span><span>(</span>a <span>=></span> a<span>.</span>Button<span>)</span><span>)</span>
    <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span>SELECT</span> a<span>.</span><span>"Id"</span><span>,</span> a<span>.</span><span>"ParentId"</span><span>,</span> a<span>.</span><span>"Name"</span><span>,</span> a<span>.</span><span>"Icon"</span><span>,</span> a<span>.</span><span>"UrlAddress"</span><span>,</span> a<span>.</span><span>"IsShow"</span><span>,</span> a<span>.</span><span>"Sort"</span><span>,</span> a<span>.</span><span>"Description"</span><span>,</span> a<span>.</span><span>"CreateTime"</span> 
<span>FROM</span> <span>"SysModule"</span> a 
<span>limit</span> <span>0</span><span>,</span><span>10</span>

<span>SELECT</span> a<span>.</span><span>"Id"</span><span>,</span> a<span>.</span><span>"SysModuleId"</span><span>,</span> a<span>.</span><span>"SysModuleButtonId"</span><span>,</span> a<span>.</span><span>"Status"</span><span>,</span> 
a__Button<span>.</span><span>"Id"</span> as5<span>,</span> a__Button<span>.</span><span>"Name"</span><span>,</span> a__Button<span>.</span><span>"EventName"</span><span>,</span> a__Button<span>.</span><span>"EnCode"</span><span>,</span> a__Button<span>.</span><span>"Icon"</span><span>,</span> a__Button<span>.</span><span>"Sort"</span><span>,</span> a__Button<span>.</span><span>"CreateTime"</span> 
<span>FROM</span> <span>"SysModulePermission"</span> a 
<span>LEFT</span> <span>JOIN</span> <span>"SysModuleButton"</span> a__Button <span>ON</span> a__Button<span>.</span><span>"Id"</span> <span>=</span> a<span>.</span><span>"SysModuleButtonId"</span> 
<span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span>"SysModuleId"</span><span>)</span> <span>in</span> <span>(</span><span>'menu1'</span><span>,</span><span>'menu2'</span><span>)</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><p>Case: Query Vod table, 10 data for each of category 1, category 2, and category 3</p>
<div><pre><code><span>class</span> <span>Vod</span> <span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> TypeId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>//Define a temporary class, it can also be a DTO</span>
<span>class</span> <span>Dto</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> TypeId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>List<span>&lt;</span>Vod<span>></span></span> Vods <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span><span>var</span></span> dto <span>=</span> <span>new</span> <span>[</span><span>]</span> <span>{</span> <span>1</span><span>,</span><span>2</span><span>,</span><span>3</span> <span>}</span><span>.</span><span>Select</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span> <span>{</span> TypeId <span>=</span> a <span>}</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
dto<span>.</span><span>IncludeMany</span><span>(</span>fsql<span>,</span> d <span>=></span> d<span>.</span>Vods<span>.</span><span>Take</span><span>(</span><span>10</span><span>)</span><span>.</span><span>Where</span><span>(</span>vod <span>=></span> vod<span>.</span>TypeId <span>==</span> d<span>.</span>TypeId<span>)</span><span>)</span><span>;</span>

<span>//After execution, each element.Vods of DTO will only have 10 records</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Query-from-Multi-Tablea">《Query from Multi Tables》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Linq-to-Sql">《LinqToSql》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Group Aggregation Query</title>
      <link>http://freesql.net/en/guide/Group-Aggregation-Query.html</link>
      <guid>http://freesql.net/en/guide/Group-Aggregation-Query.html</guid>
      <source url="http://freesql.net/rss.xml">Group Aggregation Query</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="group-aggregation-query" tabindex="-1"> Group Aggregation Query</h1>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
     <span>//Be sure to define as singleton mode</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> 

<span>class</span> <span>Topic</span> 
<span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h2 id="group-aggregation" tabindex="-1"> Group Aggregation</h2>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>GroupBy</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> tt2 <span>=</span> a<span>.</span>Title<span>.</span><span>Substring</span><span>(</span><span>0</span><span>,</span> <span>2</span><span>)</span><span>,</span> mod4 <span>=</span> a<span>.</span>Id <span>%</span> <span>4</span> <span>}</span><span>)</span>
    <span>.</span><span>Having</span><span>(</span>a <span>=></span> a<span>.</span><span>Count</span><span>(</span><span>)</span> <span>></span> <span>0</span> <span>&amp;&amp;</span> a<span>.</span><span>Avg</span><span>(</span>a<span>.</span>Key<span>.</span>mod4<span>)</span> <span>></span> <span>0</span> <span>&amp;&amp;</span> a<span>.</span><span>Max</span><span>(</span>a<span>.</span>Key<span>.</span>mod4<span>)</span> <span>></span> <span>0</span><span>)</span>
    <span>.</span><span>Having</span><span>(</span>a <span>=></span> a<span>.</span><span>Count</span><span>(</span><span>)</span> <span>&lt;</span> <span>300</span> <span>||</span> a<span>.</span><span>Avg</span><span>(</span>a<span>.</span>Key<span>.</span>mod4<span>)</span> <span>&lt;</span> <span>100</span><span>)</span>
    <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Key<span>.</span>tt2<span>)</span>
    <span>.</span><span>OrderByDescending</span><span>(</span>a <span>=></span> a<span>.</span><span>Count</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Key<span>,</span> cou1 <span>=</span> a<span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span> arg1 <span>=</span> a<span>.</span><span>Avg</span><span>(</span>a<span>.</span>Value<span>.</span>Clicks<span>)</span> <span>}</span><span>)</span><span>;</span>

<span>//SELECT substr(a.`Title`, 1, 2) as1, count(1) as2, avg(a.`Id`) as3 </span>
<span>//FROM `Topic` a </span>
<span>//GROUP BY substr(a.`Title`, 1, 2), (a.`Id` % 4) </span>
<span>//HAVING (count(1) > 0 AND avg((a.`Id` % 4)) > 0 AND max((a.`Id` % 4)) > 0) AND (count(1) &lt; 300 OR avg((a.`Id` % 4)) &lt; 100) </span>
<span>//ORDER BY substr(a.`Title`, 1, 2), count(1) DESC</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><blockquote>
<p>To find the aggregate value without grouping, please use <code>ToAggregate</code> instead of <code>ToList</code></p>
</blockquote>
<h2 id="navigation-property-grouping" tabindex="-1"> Navigation Property Grouping</h2>
<p>If <code>Topic</code> has the navigation property <code>Category</code>, and <code>Category</code> has the navigation property <code>Area</code>, the navigation property grouping code is as follows:</p>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>GroupBy</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Clicks<span>,</span> a<span>.</span>Category <span>}</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Key<span>.</span>Category<span>.</span>Area<span>.</span>Name <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>Note: Write as above, an error will be reported and cannot be resolved <code>a.Key.Category.Area.Name</code>. The solution is to use <code>Include</code>:</p>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Include</span><span>(</span>a <span>=></span> a<span>.</span>Category<span>.</span>Area<span>)</span>
    <span>//This line must be added, </span>
    <span>//otherwise only the Category will be grouped without its sub-navigation property Area</span>

    <span>.</span><span>GroupBy</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Clicks<span>,</span> a<span>.</span>Category <span>}</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Key<span>.</span>Category<span>.</span>Area<span>.</span>Name <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>However, you can also solve it like this:</p>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>GroupBy</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Clicks<span>,</span> a<span>.</span>Category<span>,</span> a<span>.</span>Category<span>.</span>Area <span>}</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Key<span>.</span>Area<span>.</span>Name <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h2 id="multi-table-grouping" tabindex="-1"> Multi-table Grouping</h2>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>,</span> Category<span>,</span> Area<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>GroupBy</span><span>(</span><span>(</span>a<span>,</span> b<span>,</span> c<span>)</span> <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Title<span>,</span> c<span>.</span>Name <span>}</span><span>)</span>
    <span>.</span><span>Having</span><span>(</span>g <span>=></span> g<span>.</span><span>Count</span><span>(</span><span>)</span> <span>&lt;</span> <span>300</span> <span>||</span> g<span>.</span><span>Avg</span><span>(</span>g<span>.</span>Value<span>.</span>Item1<span>.</span>Clicks<span>)</span> <span>&lt;</span> <span>100</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span>g <span>=></span> <span>new</span> <span>{</span> count <span>=</span> g<span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span> Name <span>=</span> g<span>.</span>Key<span>.</span>Name <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><ul>
<li><code>g.Value.Item1</code> corresponds to <code>Topic</code></li>
<li><code>g.Value.Item2</code> corresponds to <code>Category</code></li>
<li><code>g.Value.Item3</code> corresponds to <code>Area</code></li>
</ul>
<h2 id="aggregate" tabindex="-1"> Aggregate</h2>
<ul>
<li>distinct</li>
</ul>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Aggregate</span><span>(</span>a <span>=></span> Convert<span>.</span><span>ToInt32</span><span>(</span><span>"count(distinct title)"</span><span>)</span><span>,</span> <span>out</span> <span><span>var</span></span> count<span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><ul>
<li>SqlExt.DistinctCount</li>
</ul>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Aggregate</span><span>(</span>a <span>=></span> SqlExt<span>.</span><span>DistinctCount</span><span>(</span>a<span>.</span>Key<span>.</span>Title<span>)</span><span>,</span> <span>out</span> <span><span>var</span></span> count<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><blockquote>
<p>SELECT count(distinct a.&quot;title&quot;) as1 FROM &quot;Topic&quot; a</p>
</blockquote>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Return</th>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>Return the SQL statement to be executed</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>Execute SQL query and return the records of the specified field. When the record does not exist, return a list with Count of 0.</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>string field</td>
<td>Execute SQL query, and return the record of the field specified by field, and receive it as a tuple or basic type (int, string, long). If the record does not exist, return a list with Count of 0.</td>
</tr>
<tr>
<td>ToAggregate&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>Execute SQL query and return the aggregate result of the specified field. (Suitable for scenarios where GroupBy is not required)</td>
</tr>
<tr>
<td>Sum</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column to sum.</td>
</tr>
<tr>
<td>Min</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column to find the minimum.</td>
</tr>
<tr>
<td>Max</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column to find the maximum.</td>
</tr>
<tr>
<td>Avg</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column to average.</td>
</tr>
<tr>
<td>【Grouping】</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Group by the selected column, GroupBy(a =&gt; a.Name)</td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Group by raw sql statement, GroupBy(&quot;concat(name, @cc)&quot;, new { cc = 1 })</td>
</tr>
<tr>
<td>Having</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Filter by raw SQL statement aggregation conditions, Having(&quot;count(name) = @cc&quot;, new { cc = 1 })</td>
</tr>
<tr>
<td>【Members】</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Key</td>
<td></td>
<td></td>
<td>Returns the object selected by GroupBy</td>
</tr>
<tr>
<td>Value</td>
<td></td>
<td></td>
<td>Return to the main table or the field selector of From&lt;T2,T3....&gt;</td>
</tr>
</tbody>
</table>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Query-from-Multi-Tablea">《Query from Multi Tables》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Linq-to-Sql">《LinqToSql》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
<li><a href="Performance">《Performance》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Insert Data</title>
      <link>http://freesql.net/en/guide/Insert-Data.html</link>
      <guid>http://freesql.net/en/guide/Insert-Data.html</guid>
      <source url="http://freesql.net/rss.xml">Insert Data</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="insert-data" tabindex="-1"> Insert Data</h1>
<p>FreeSql provides methods for inserting data in single and batches, and it can also return the inserted records when executed in a specific database.</p>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//Automatically synchronize the entity structure to the database</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//Be sure to define as singleton mode</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span><span>var</span></span> items <span>=</span> <span>new</span> <span>List<span>&lt;</span>Topic<span>></span></span><span>(</span><span>)</span><span>;</span>
<span>for</span> <span>(</span><span><span>var</span></span> a <span>=</span> <span>0</span><span>;</span> a <span>&lt;</span> <span>10</span><span>;</span> a<span>++</span><span>)</span> items<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> a <span>+</span> <span>1</span><span>,</span> Title <span>=</span> <span><span>$"newtitle</span><span><span>{</span><span>a</span><span>}</span></span><span>"</span></span><span>,</span> Clicks <span>=</span> a <span>*</span> <span>100</span> <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><h2 id="_1-single-insert" tabindex="-1"> 1. Single Insert</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>.</span><span>First</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Clicks`, `Title`, `CreateTime`) </span>
<span>//VALUES(@Clicks0, @Title0, @CreateTime0)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>If the table has auto-increment columns, <code>id</code> will be returned after inserting data.</p>
<p>Method 1: (Original)</p>
<div><pre><code><span><span>long</span></span> id <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>blog<span>)</span><span>.</span><span>ExecuteIdentity</span><span>(</span><span>)</span><span>;</span>
blog<span>.</span>Id <span>=</span> id<span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>Method 2: (depends on FreeSql.Repository)</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span><span>Insert</span><span>(</span>blog<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><blockquote>
<p>In the internal implementation, after inserting the data, the self-incremental value will be assigned to <code>blog.Id</code></p>
</blockquote>
<h2 id="_2-batch-insert" tabindex="-1"> 2. Batch Insert</h2>
<div><pre><code><span><span>var</span></span> t2 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Clicks`, `Title`, `CreateTime`) </span>
<span>//VALUES(@Clicks0, @Title0, @CreateTime0), (@Clicks1, @Title1, @CreateTime1), </span>
<span>//(@Clicks2, @Title2, @CreateTime2), (@Clicks3, @Title3, @CreateTime3), </span>
<span>//(@Clicks4, @Title4, @CreateTime4), (@Clicks5, @Title5, @CreateTime5), </span>
<span>//(@Clicks6, @Title6, @CreateTime6), (@Clicks7, @Title7, @CreateTime7), </span>
<span>//(@Clicks8, @Title8, @CreateTime8), (@Clicks9, @Title9, @CreateTime9)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><blockquote>
<p>The errors that are easily caused by adding SqlServer in batches have been resolved:</p>
<div><pre><code>The incoming request has too many parameters. The server supports a maximum of 2100 parameters. Reduce the number of parameters and resend the request.
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>Principle: Split into multiple packages and execute them in transactions.</p>
</blockquote>
<p>When inserting large quantities of data, the internal logic is divided and executed in batches. The segmentation rules are as follows:</p>
<table>
<thead>
<tr>
<th></th>
<th>Quantity</th>
<th>Size of Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql</td>
<td>5000</td>
<td>3000</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>5000</td>
<td>3000</td>
</tr>
<tr>
<td>SqlServer</td>
<td>1000</td>
<td>2100</td>
</tr>
<tr>
<td>Oracle</td>
<td>500</td>
<td>999</td>
</tr>
<tr>
<td>Sqlite</td>
<td>5000</td>
<td>999</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Quantity: It is the size of each batch of division. For example, a batch of 10,000 pieces of data will be inserted into two batches when mysql is executed.<br />
Size of Parameters: the size of the parameter size divided into each batch. For example, when inserting 10,000 pieces of data in batches, each row needs to use 5 parameterizations, which will be divided into 3000/5 for each batch when mysql is executed.</p>
</blockquote>
<p>After the execution of the split, when the external transaction is not provided, the internal transaction is opened to achieve insertion integrity. You can also set appropriate values through <code>BatchOptions</code>.</p>
<p>FreeSql adapts to the use of parameterization and non-parameterization of each data type. It is recommended to turn off the parameterization function for batch insertion and use <code>.NoneParameter()</code> to execute it.</p>
<h2 id="_3-executesqlbulkcopy-executepgcopy-executemysqlbulkcopy-and-executeoraclebulkcopy" tabindex="-1"> 3. ExecuteSqlBulkCopy, ExecutePgCopy, ExecuteMySqlBulkCopy and ExecuteOracleBulkCopy</h2>
<p>Bulk Copy operation is implemented in the form of an extension method. For SqlServer/PostgreSQL/MySql/Oracle databases, the available packages are: FreeSql.Provider.SqlServer/FreeSql.Provider.PostgreSQL/FreeSql.Provider.MySqlConnector/FreeSql.Provider.Oracle.</p>
<h3 id="bulk-insert-test-reference-52-fields" tabindex="-1"> bulk insert test reference (52 fields)</h3>
<table>
<thead>
<tr>
<th></th>
<th>18W</th>
<th>1W</th>
<th>5K</th>
<th>2K</th>
<th>1K</th>
<th>500</th>
<th>100</th>
<th>50</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql 5.5 ExecuteAffrows</td>
<td>38,481</td>
<td>2,234</td>
<td>1,136</td>
<td>284</td>
<td>239</td>
<td>167</td>
<td>66</td>
<td>30</td>
</tr>
<tr>
<td>MySql 5.5 ExecuteMySqlBulkCopy</td>
<td>28,405</td>
<td>1,142</td>
<td>657</td>
<td>451</td>
<td>435</td>
<td>592</td>
<td>47</td>
<td>22</td>
</tr>
<tr>
<td>SqlServer Express ExecuteAffrows</td>
<td>402,355</td>
<td>24,847</td>
<td>11,465</td>
<td>4,971</td>
<td>2,437</td>
<td>915</td>
<td>138</td>
<td>88</td>
</tr>
<tr>
<td>SqlServer Express ExecuteSqlBulkCopy</td>
<td>21,065</td>
<td>578</td>
<td>326</td>
<td>139</td>
<td>105</td>
<td>79</td>
<td>60</td>
<td>48</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecuteAffrows</td>
<td>46,756</td>
<td>3,294</td>
<td>2,269</td>
<td>1,019</td>
<td>374</td>
<td>209</td>
<td>51</td>
<td>37</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecutePgCopy</td>
<td>10,090</td>
<td>583</td>
<td>337</td>
<td>136</td>
<td>88</td>
<td>61</td>
<td>30</td>
<td>25</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Explanation of 8W: insert 180000 rows of records, and the number in the table is the execution time (unit: ms)</p>
</blockquote>
<h3 id="bulk-insert-test-reference-10-fields" tabindex="-1"> bulk insert test reference (10 fields)</h3>
<table>
<thead>
<tr>
<th></th>
<th>18W</th>
<th>1W</th>
<th>5K</th>
<th>2K</th>
<th>1K</th>
<th>500</th>
<th>100</th>
<th>50</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql 5.5 ExecuteAffrows</td>
<td>11,171</td>
<td>866</td>
<td>366</td>
<td>80</td>
<td>83</td>
<td>50</td>
<td>24</td>
<td>34</td>
</tr>
<tr>
<td>MySql 5.5 ExecuteMySqlBulkCopy</td>
<td>6,504</td>
<td>399</td>
<td>257</td>
<td>116</td>
<td>87</td>
<td>100</td>
<td>16</td>
<td>16</td>
</tr>
<tr>
<td>SqlServer Express ExecuteAffrows</td>
<td>47,204</td>
<td>2,275</td>
<td>1,108</td>
<td>488</td>
<td>279</td>
<td>123</td>
<td>35</td>
<td>16</td>
</tr>
<tr>
<td>SqlServer Express ExecuteSqlBulkCopy</td>
<td>4,248</td>
<td>127</td>
<td>71</td>
<td>30</td>
<td>48</td>
<td>14</td>
<td>11</td>
<td>10</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecuteAffrows</td>
<td>9,786</td>
<td>568</td>
<td>336</td>
<td>157</td>
<td>102</td>
<td>34</td>
<td>9</td>
<td>6</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecutePgCopy</td>
<td>4,081</td>
<td>167</td>
<td>93</td>
<td>39</td>
<td>21</td>
<td>12</td>
<td>4</td>
<td>2</td>
</tr>
</tbody>
</table>
<blockquote>
<p>The test results are all based on the same operating system, and all are preheated.</p>
</blockquote>
<h2 id="_4-insert-the-specified-columns" tabindex="-1"> 4. Insert the specified columns</h2>
<div><pre><code><span><span>var</span></span> t3 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>InsertColumns</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Title`) </span>
<span>//VALUES(@Title0), (@Title1), (@Title2), (@Title3), (@Title4), </span>
<span>//(@Title5), (@Title6), (@Title7), (@Title8), (@Title9)</span>

<span><span>var</span></span> t4 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>InsertColumns</span><span>(</span>a <span>=></span><span>new</span> <span>{</span> a<span>.</span>Title<span>,</span> a<span>.</span>Clicks <span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Clicks`, `Title`) </span>
<span>//VALUES(@Clicks0, @Title0), (@Clicks1, @Title1), (@Clicks2, @Title2), </span>
<span>//(@Clicks3, @Title3), (@Clicks4, @Title4), (@Clicks5, @Title5), </span>
<span>//(@Clicks6, @Title6), (@Clicks7, @Title7), (@Clicks8, @Title8), </span>
<span>//(@Clicks9, @Title9)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="_5-ignore-the-specified-columns" tabindex="-1"> 5. Ignore the specified columns</h2>
<div><pre><code><span><span>var</span></span> t5 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Clicks`, `Title`) </span>
<span>//VALUES(@Clicks0, @Title0), (@Clicks1, @Title1), (@Clicks2, @Title2), </span>
<span>//(@Clicks3, @Title3), (@Clicks4, @Title4), (@Clicks5, @Title5), </span>
<span>//(@Clicks6, @Title6), (@Clicks7, @Title7), (@Clicks8, @Title8), </span>
<span>//(@Clicks9, @Title9)</span>

<span><span>var</span></span> t6 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Title<span>,</span> a<span>.</span>CreateTime <span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>///INSERT INTO `Topic`(`Clicks`) </span>
<span>//VALUES(@Clicks0), (@Clicks1), (@Clicks2), (@Clicks3), (@Clicks4), </span>
<span>//(@Clicks5), (@Clicks6), (@Clicks7), (@Clicks8), (@Clicks9)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="_6-column-insertion-priority" tabindex="-1"> 6. Column Insertion Priority</h2>
<div><pre><code>All Columns <span>&lt;</span> <span>Specified</span> columns <span>(</span>InsertColumns<span>)</span> <span>&lt;</span> <span>Ignored</span> Columns <span>(</span>IgnoreColumns<span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><ul>
<li>Without using <code>InsertColumns/IgnoreColumns</code>, all columns of the entity will be inserted into the database;</li>
<li>Otherwise, when using <code>InsertColumns</code> and not using <code>IgnoreColumns</code>, only the specified columns are inserted into the database;</li>
<li>Otherwise, in the case of using <code>IgnoreColumns</code>, only unspecified columns are inserted into the database.</li>
</ul>
<h2 id="_7、dictionary-insert" tabindex="-1"> 7、Dictionary Insert</h2>
<div><pre><code><span><span>var</span></span> dic <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"id"</span><span>,</span> <span>1</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"name"</span><span>,</span> <span>"xxxx"</span><span>)</span><span>;</span>

fsql<span>.</span><span>InsertDict</span><span>(</span>dic<span>)</span><span>.</span><span>AsTable</span><span>(</span><span>"table1"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="_8-import-table-data" tabindex="-1"> 8. Import table data</h2>
<div><pre><code><span><span>int</span></span> affrows <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Limit</span><span>(</span><span>10</span><span>)</span>
  <span>.</span><span>InsertInto</span><span>(</span><span>null</span><span>,</span> a <span>=></span> <span>new</span> <span>Topic2</span>
  <span>{</span>
    Title <span>=</span> a<span>.</span>Title
  <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><div><pre><code><span>INSERT</span> <span>INTO</span> <span><span>`</span>Topic2<span>`</span></span><span>(</span><span><span>`</span>Title<span>`</span></span><span>,</span> <span><span>`</span>Clicks<span>`</span></span><span>,</span> <span><span>`</span>CreateTime<span>`</span></span><span>)</span>
<span>SELECT</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> <span>0</span><span>,</span> <span>'0001-01-01 00:00:00'</span> 
<span>FROM</span> <span><span>`</span>Topic<span>`</span></span> a 
<span>limit</span> <span>10</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>Note: Because <code>Clicks</code> and <code>CreateTime</code> are not selected, it'll use the value set by the target entity attribute <code>[Column(InsertValueSql = xx)]</code>, or the default value of <code>C#</code> of the target entity attribute.</p>
<h2 id="_8-insert-ignore-into-mysql-only" tabindex="-1"> 8. <code>Insert Ignore Into</code> (MySql only)</h2>
<div><pre><code>fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>MySqlIgnoreInto</span><span>(</span><span>)</span><span>.</span><span>AppendData</span><span>(</span>items<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>///INSERT IGNORE INTO `Topic`(`Clicks`) </span>
<span>//VALUES(@Clicks0), (@Clicks1), (@Clicks2), (@Clicks3), (@Clicks4), </span>
<span>//(@Clicks5), (@Clicks6), (@Clicks7), (@Clicks8), (@Clicks9)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Database-Transaction">《Database Transaction》</a></li>
<li><a href="Delete-Data">《FreeSql 101, Part 2: Delete Data》</a></li>
<li><a href="Update-Data">《FreeSql 101, Part 3: Update Data》</a></li>
<li><a href="Query-Data">《FreeSql 101, Part 4: Query Data》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
</ul>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>Methods</th>
<th>Return</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppendData</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>Append the entity to be inserted</td>
</tr>
<tr>
<td>InsertIdentity</td>
<td>&lt;this&gt;</td>
<td>None</td>
<td>Specify the insert auto-increment column</td>
</tr>
<tr>
<td>InsertColumns</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Specify the inserted columns</td>
</tr>
<tr>
<td>IgnoreColumns</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Specify the ignored columns</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>Command timeout setting (seconds)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>Set transaction object</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>Set the connection object</td>
</tr>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>Return the SQL statement to be executed.</td>
</tr>
<tr>
<td><a href="%e6%b7%bb%e5%8a%a0%e6%88%96%e4%bf%ae%e6%94%b9">OnDuplicateKeyUpdate</a></td>
<td>OnDuplicateKeyUpdate&lt;T1&gt;</td>
<td>None</td>
<td>MySql only. <code>On Duplicate Key Update</code></td>
</tr>
<tr>
<td><a href="%e6%b7%bb%e5%8a%a0%e6%88%96%e4%bf%ae%e6%94%b9">OnConflictDoUpdate</a></td>
<td>OnConflictDoUpdate&lt;T1&gt;</td>
<td>None</td>
<td>PostgreSQL only. <code>On Conflict Do Update</code></td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>long</td>
<td></td>
<td>Execute SQL and return the number of rows affected.</td>
</tr>
<tr>
<td>ExecuteIdentity</td>
<td>long</td>
<td></td>
<td>Execute SQL and return the incremented value.</td>
</tr>
<tr>
<td>ExecuteInserted</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>Execute SQL and return the inserted records.</td>
</tr>
<tr>
<td>ExecuteSqlBulkCopy</td>
<td>void</td>
<td></td>
<td>SqlServer only. To execute BulkCopy to import data in batches, you need to reference <code>FreeSql.Provider.SqlServer</code></td>
</tr>
<tr>
<td>ExecutePgCopy</td>
<td>void</td>
<td></td>
<td>PostgreSQL only. To execute BulkCopy to import data in batches, you need to reference <code>FreeSql.Provider.PostgreSQL</code></td>
</tr>
<tr>
<td>ExecuteMySqlBulkCopy</td>
<td>void</td>
<td></td>
<td>MySql only. To execute BulkCopy to import data in batches, you need to reference <code>FreeSql.Provider.MysqlConnector</code></td>
</tr>
<tr>
<td>ExecuteOracleBulkCopy</td>
<td>void</td>
<td></td>
<td>Oracle only. To execute BulkCopy to import data in batches, you need to reference <code>FreeSql.Provider.Oracle</code></td>
</tr>
<tr>
<td>ExecuteDmBulkCopy</td>
<td>void</td>
<td></td>
<td>Dameng database only. To execute BulkCopy to import data in batches, you need to reference <code>FreeSql.Provider.Dameng</code></td>
</tr>
</tbody>
</table>
]]></content:encoded>
    </item>
    <item>
      <title>Lazy Loading</title>
      <link>http://freesql.net/en/guide/Lazy-Loading.html</link>
      <guid>http://freesql.net/en/guide/Lazy-Loading.html</guid>
      <source url="http://freesql.net/rss.xml">Lazy Loading</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="lazy-loading" tabindex="-1"> Lazy Loading</h1>
<p>FreeSql supports lazy loading of navigation properties, that is, data is loaded (read) when we need it. It supports navigation properties of <em>One-to-One</em>, <em>Many-to-One</em>, <em>One-to-Many</em>, and <em>Many-to-Many</em> relationships.</p>
<p>When we want to query a certain order information and display its corresponding order detailed records, we hope to use lazy loading to achieve. This not only speeds up the reading speed, but also avoids loading unnecessary data. Lazy loading is usually used for <em>foreach loop</em> queries.</p>
<p>When we are defining the <em>Model</em>, we need to add the <code>virtual</code> keyword in front of the properties. As follows:</p>
<div><pre><code><span>public</span> <span>class</span> <span>Order</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> OrderID <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> OrderTitle <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> CustomerName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> TransactionDate <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>List<span>&lt;</span>OrderDetail<span>></span></span> OrderDetails <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>OrderDetail</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> DetailId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> OrderId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Order</span> Order <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><blockquote>
<p>The Lazy Loading function is <em>turn-off</em> by default. When using this function, please turn it on at the place of declaration.</p>
</blockquote>
<blockquote>
<p>Lazy loading function depends on <em>FreeSql.Extensions.LazyLoading</em> package, please go to NuGet to download.</p>
</blockquote>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseLazyLoading</span><span>(</span><span>true</span><span>)</span> <span>//Enable Lazy Loading</span>
    <span>.</span><span>UseMonitorCommand</span><span>(</span>
        cmd <span>=></span> Console<span>.</span><span>WriteLine</span><span>(</span>cmd<span>.</span>CommandText<span>)</span><span>)</span> <span>//Monitor SQL commands before execution</span>
     <span>//Be sure to define as singleton mode</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> 

<span><span>var</span></span> order <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Order<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>OrderID <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span> <span>//Query from Order table</span>
<span><span>var</span></span> orderDetail1 <span>=</span> order<span>.</span>OrderDetails<span>;</span> <span>//First visit, query the database</span>
<span><span>var</span></span> orderDetail2 <span>=</span> order<span>.</span>OrderDetails<span>;</span> <span>//Second visit, do not query from the database</span>
<span><span>var</span></span> order1 <span>=</span> orderDetail1<span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span><span>;</span> <span>//Access the navigation properties without querying the database at this time. Because this property is already populated when OrderDetails is queried</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p>Console output:</p>
<div><pre><code><span>SELECT</span> a<span>.</span><span><span>`</span>OrderID<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>OrderTitle<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CustomerName<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TransactionDate<span>`</span></span> 
<span>FROM</span> <span><span>`</span>Order<span>`</span></span> a 
<span>WHERE</span> <span>(</span>a<span>.</span><span><span>`</span>OrderID<span>`</span></span> <span>=</span> <span>1</span><span>)</span> 
<span>limit</span> <span>0</span><span>,</span><span>1</span>

<span>SELECT</span> a<span>.</span><span><span>`</span>DetailId<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>OrderId<span>`</span></span> 
<span>FROM</span> <span><span>`</span>OrderDetail<span>`</span></span> a 
<span>WHERE</span> <span>(</span>a<span>.</span><span><span>`</span>OrderId<span>`</span></span> <span>=</span> <span>1</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>FreeSql lazy loading supports navigation properties of <em>One-to-One</em>, <em>Many-to-One</em>, <em>One-to-Many</em>, and <em>Many-to-Many</em> relationships. The first three are similar. We separately introduce the <em>Many-to-Many</em> relationship.</p>
<h2 id="many-to-many-lazy-loading" tabindex="-1"> Many-to-Many Lazy Loading</h2>
<div><pre><code><span>public</span> <span>partial</span> <span>class</span> <span>Song</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime<span>?</span></span> Create_time <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>bool</span><span>?</span></span> Is_deleted <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Url <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>partial</span> <span>class</span> <span>Song_tag</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Song_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Song</span> Song <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> Tag_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Tag</span> Tag <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>partial</span> <span>class</span> <span>Tag</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span><span>?</span></span> Parent_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Tag</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>decimal</span><span>?</span></span> Ddd <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br></div></div><p>As above, there are three tables: <strong>Song</strong>, <strong>Tag</strong>, and their relationship table.</p>
<div><pre><code><span><span>var</span></span> songs <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Limit</span><span>(</span><span>10</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span> <span>//Take 10 pieces of song</span>
<span><span>var</span></span> songs1 <span>=</span> songs<span>.</span><span>First</span><span>(</span><span>)</span><span>.</span>Tags<span>;</span> <span>//First visit, query the database</span>
<span><span>var</span></span> songs2 <span>=</span> Songs<span>.</span><span>First</span><span>(</span><span>)</span><span>.</span>Tags<span>;</span> <span>//Second visit, do not query from the database</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>Console output:</p>
<div><pre><code><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Create_time<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Is_deleted<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Url<span>`</span></span> 
<span>FROM</span> <span><span>`</span>Song<span>`</span></span> a 
<span>limit</span> <span>0</span><span>,</span><span>10</span>

<span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Parent_id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Ddd<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Name<span>`</span></span> 
<span>FROM</span> <span><span>`</span>Tag<span>`</span></span> a 
<span>WHERE</span> <span>(</span><span>exists</span><span>(</span><span>SELECT</span> <span>1</span> 
<span>FROM</span> <span><span>`</span>Song_tag<span>`</span></span> b 
<span>WHERE</span> <span>(</span>b<span>.</span><span><span>`</span>Song_id<span>`</span></span> <span>=</span> <span>2</span> <span>AND</span> b<span>.</span><span><span>`</span>Tag_id<span>`</span></span> <span>=</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>)</span> 
<span>limit</span> <span>0</span><span>,</span><span>1</span><span>)</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h2 id="summary" tabindex="-1"> Summary</h2>
<p>Advantages: Load data only when needed, without pre-planning, avoiding the inefficiency problems caused by various complicated outer joins, indexes, and view operations.</p>
<p>Defect: Interacting with DB many times, performance degradation.</p>
<p>If you want to use data in a loop, use <a href="Greed-Loading">Greed Loading</a>, otherwise use <strong>Lazy Loading</strong>.</p>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Query-from-Multi-Tablea">《Query from Multi Tables》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Linq to Sql</title>
      <link>http://freesql.net/en/guide/Linq-to-Sql.html</link>
      <guid>http://freesql.net/en/guide/Linq-to-Sql.html</guid>
      <source url="http://freesql.net/rss.xml">Linq to Sql</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="linq-to-sql" tabindex="-1"> Linq to Sql</h1>
<p>Originally not supporting IQueryable is mainly due to the consideration of usage habits. The intelligence of writing code will always prompt a bunch of methods you don't want to use. IQueryable itself provides a bunch of methods that cannot be implemented, as well as external intrusion extension methods, which seriously affect Coding experience. As shown below:</p>
<p><img src="https://user-images.githubusercontent.com/16286519/57295126-5dd7bd00-70fc-11e9-99c0-d1c46423afa2.png" alt="image" loading="lazy"></p>
<p>For FreeSql v1.4.0+ version, please use the following items to install with commands (old version does not need to be installed):</p>
<blockquote>
<p>dotnet add package FreeSql.Extensions.Linq</p>
</blockquote>
<h2 id="special-note" tabindex="-1"> Special Note</h2>
<ul>
<li>
<p>Please try not to use the following Linq methods in <code>ISelect</code> mode: <code>GroupJoin</code>, <code>Select</code>, <code>SelectMany</code>, <code>Join</code> and <code>DefaultIfEmpty</code>.</p>
</li>
<li>
<p>If you must use the <code>.Select()</code> method in <code>ISelect</code>, be sure to call it before <code>.ToList()</code>.</p>
</li>
</ul>
<h2 id="iqueryable" tabindex="-1"> IQueryable</h2>
<p>FreeSql provides a powerful data query object: ISelect.</p>
<p>FreeSql.Extensions.Linq v1.4.0+ implements the common functions of IQueryable query objects for interactive use in various frameworks.</p>
<div><pre><code><span>//Convert ISelect to IQueryable</span>
<span>IQueryable<span>&lt;</span>Student<span>></span></span> queryable <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>AsQueryable</span><span>(</span><span>)</span><span>;</span>

<span>//Linq Query</span>
<span><span>var</span></span> t1 <span>=</span> queryable<span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>id <span>==</span> <span>1</span><span>)</span><span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span><span>;</span>

<span>//Restore IQueryable to ISelect</span>
<span>ISelect<span>&lt;</span>Studeng<span>></span></span> <span>select</span> <span>=</span> queryable<span>.</span><span>RestoreToSelect</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>Note: The implementation of IQueryable does not currently support <code>GroupBy</code>. You can consider using the <code>RestoreSelect</code> method to switch back to <code>ISelect</code> for query.</p>
<h2 id="where" tabindex="-1"> Where</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> a
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="specify-fields-select" tabindex="-1"> Specify Fields: Select</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="casewhen" tabindex="-1"> CaseWhen</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span>
        a<span>.</span>id<span>,</span>
        a<span>.</span>name<span>,</span>
        testsub <span>=</span> <span>new</span> <span>{</span>
            time <span>=</span> a<span>.</span>age <span>></span> <span>10</span> <span>?</span> <span>"大于"</span> <span>:</span> <span>"小于或等于"</span>
        <span>}</span>
    <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="join" tabindex="-1"> Join</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId
    <span>select</span> a
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t2 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> b<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t3 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> b<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><h2 id="leftjoin" tabindex="-1"> LeftJoin</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId <span>into</span> temp
    <span>from</span> tc <span>in</span> temp<span>.</span><span>DefaultIfEmpty</span><span>(</span><span>)</span>
    <span>select</span> a
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t2 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId <span>into</span> temp
    <span>from</span> tc <span>in</span> temp<span>.</span><span>DefaultIfEmpty</span><span>(</span><span>)</span>
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> tc<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t3 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId <span>into</span> temp
    <span>from</span> tc <span>in</span> temp<span>.</span><span>DefaultIfEmpty</span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> tc<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><h2 id="multi-table-query-from" tabindex="-1"> Multi-table Query: From</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>from</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> b<span>.</span>StudentId
    <span>select</span> a
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t2 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>from</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> b<span>.</span>StudentId
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> b<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t3 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>from</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> b<span>.</span>StudentId
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> b<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><h2 id="grouping-groupby" tabindex="-1"> Grouping: GroupBy</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>group</span> a <span>by</span> <span>new</span> <span>{</span>a<span>.</span>id<span>,</span> a<span>.</span>name <span>}</span> <span>into</span> g
    <span>select</span> <span>new</span> <span>{</span>
        g<span>.</span>Key<span>.</span>id<span>,</span> g<span>.</span>Key<span>.</span>name<span>,</span>
        cou <span>=</span> g<span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span>
        avg <span>=</span> g<span>.</span><span>Avg</span><span>(</span>g<span>.</span>Value<span>.</span>age<span>)</span><span>,</span>
        sum <span>=</span> g<span>.</span><span>Sum</span><span>(</span>g<span>.</span>Value<span>.</span>age<span>)</span><span>,</span>
        max <span>=</span> g<span>.</span><span>Max</span><span>(</span>g<span>.</span>Value<span>.</span>age<span>)</span><span>,</span>
        min <span>=</span> g<span>.</span><span>Min</span><span>(</span>g<span>.</span>Value<span>.</span>age<span>)</span>
    <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Query-from-Multi-Tablea">《Query from Multi Tables》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
</ul>
]]></content:encoded>
      <enclosure url="https://user-images.githubusercontent.com/16286519/57295126-5dd7bd00-70fc-11e9-99c0-d1c46423afa2.png" type="image/png"/>
    </item>
    <item>
      <title>Pagination</title>
      <link>http://freesql.net/en/guide/Pagination.html</link>
      <guid>http://freesql.net/en/guide/Pagination.html</guid>
      <source url="http://freesql.net/rss.xml">Pagination</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="pagination" tabindex="-1"> Pagination</h1>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//Be sure to define as singleton mode</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> CategoryId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h2 id="_20-data-per-page-query-page-1" tabindex="-1"> 20 data per page, query page 1</h2>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>></span> <span>10</span><span>)</span>
    <span>.</span><span>Count</span><span>(</span><span>out</span> <span><span>var</span></span> total<span>)</span> <span>//Total number of records</span>
    <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>20</span><span>)</span>
    <span>.</span><span>Tolist</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="optimization" tabindex="-1"> Optimization</h2>
<p>For the previous versions of <code>SqlServer 2012</code>, use <code>row_number</code> for pagination;</p>
<p>For <code>SqlServer 2012+</code> version, using the latest <code>fetch next rows</code> pagination;</p>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>Methods</th>
<th>Return</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>Return the SQL statement to be executed</td>
</tr>
<tr>
<td>ToList</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>Execute SQL query, and return the records of all the fields of the <code>T1</code> entity. If there are navigation properties, they will be queried and returned together. If the record does not exist, a list with <code>Count</code> of <code>0</code> will be returned.</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>Execute SQL query, and return the record of the specified fields. If the record does not exist, a list with <code>Count</code> of <code>0</code> will be returned.</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>string field</td>
<td>Execute SQL query, and return the record of the specified fields of the parameters, and receive it as a tuple or basic type (<code>int</code>, <code>string</code>, <code>long</code>). If the record does not exist, a list with <code>Count</code> of <code>0</code> will be returned.</td>
</tr>
<tr>
<td>【Pagination】</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Count</td>
<td>long</td>
<td></td>
<td>Number of records queried</td>
</tr>
<tr>
<td>Count</td>
<td>&lt;this&gt;</td>
<td>out long</td>
<td>The number of records to be queried, returned in the form of parameter with <code>out</code></td>
</tr>
<tr>
<td>Skip</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>Query the number of rows shifted backward</td>
</tr>
<tr>
<td>Offset</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>Query the number of rows shifted backward</td>
</tr>
<tr>
<td>Limit</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>Number of query data</td>
</tr>
<tr>
<td>Take</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>Number of query data</td>
</tr>
<tr>
<td>Page</td>
<td>&lt;this&gt;</td>
<td>int pageIndex, int pageSize</td>
<td>Pagination</td>
</tr>
</tbody>
</table>
<h2 id="参考资料" tabindex="-1"> 参考资料</h2>
<ul>
<li><a href="Query-from-Multi-Tables">《Query from Multi Tables》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Linq-to-Sql">《LinqToSql》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
<li><a href="Performance">《Performance》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
<li><a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Parent Child Relationship Query</title>
      <link>http://freesql.net/en/guide/Parent-Child-Relationship-Query.html</link>
      <guid>http://freesql.net/en/guide/Parent-Child-Relationship-Query.html</guid>
      <source url="http://freesql.net/rss.xml">Parent Child Relationship Query</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="parent-child-relationship-query" tabindex="-1"> Parent Child Relationship Query</h1>
<p>Unlimited classification (father and child) is a commonly used table design. Each design method highlights advantages but also brings defects, such as:</p>
<ul>
<li>Way 1：There is only the <code>parent_id</code> field in the table design, which is <strong>troublesome</strong>: query trouble (this article can solve it).</li>
<li>Way 2：The redundant child id in the table design is easy to query, and it is <strong>troublesome</strong>: it needs to be recalculated when insert/update/delete;</li>
<li>Way 3：The left and right value codes are stored in the table design, <strong>troublesome</strong>: the same as above;</li>
</ul>
<p>Way 1: The design is the simplest. This article solves its recursive query problem and makes the use transparent.</p>
<h2 id="parent-child-navigation-properties" tabindex="-1"> Parent-child Navigation Properties</h2>
<p>Among the FreeSql navigation properties, there are settings for the parent-child relationship, as follows:</p>
<div><pre><code><span>public</span> <span>class</span> <span>Area</span>
<span>{</span>
  <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span><span>string</span></span> Code <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span><span>string</span></span> ParentCode <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>ParentCode<span>)</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span>Area</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>ParentCode<span>)</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span>List<span>&lt;</span>Area<span>></span></span> Childs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><p>Define the Parent property, in the expression can be like this:</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Parent<span>.</span>Parent<span>.</span>Parent<span>.</span>Name <span>==</span> <span>"中国"</span><span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>Define the Childs attribute, in the expression (subquery):</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Childs<span>.</span><span>Any</span><span>(</span>c <span>=></span> c<span>.</span>Name <span>==</span> <span>"北京"</span><span>)</span><span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>To define the Childs property, you can also use <a href="Cascade-Saving">Cascade Saving</a>, <a href="Greed-Loading">Greed Loading</a> and so on.</p>
<div><pre><code>fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>"1=1"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>true</span><span>;</span>
repo<span>.</span>DbContextOptions<span>.</span>NoneParameter <span>=</span> <span>true</span><span>;</span>
repo<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Area</span>
<span>{</span>
  Code <span>=</span> <span>"100000"</span><span>,</span>
  Name <span>=</span> <span>"中国"</span><span>,</span>
  Childs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Area<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span>
    <span>new</span> <span>Area</span>
    <span>{</span>
      Code <span>=</span> <span>"110000"</span><span>,</span>
      Name <span>=</span> <span>"北京"</span><span>,</span>
      Childs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Area<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span>
        <span>new</span> <span>Area</span><span>{</span> Code<span>=</span><span>"110100"</span><span>,</span> Name <span>=</span> <span>"北京市"</span> <span>}</span><span>,</span>
        <span>new</span> <span>Area</span><span>{</span> Code<span>=</span><span>"110101"</span><span>,</span> Name <span>=</span> <span>"东城区"</span> <span>}</span><span>,</span>
      <span>}</span><span>)</span>
    <span>}</span>
  <span>}</span><span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><h2 id="totreelist" tabindex="-1"> ToTreeList</h2>
<p>After configuring the parent-child properties, you can use it like this:</p>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span>
Assert<span>.</span><span>Single</span><span>(</span>t1<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"100000"</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Single</span><span>(</span>t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110000"</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>2</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span>Count<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110100"</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110101"</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>1</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>The query data is originally flat. The <code>ToTreeList</code> method processes the returned flat data into a tree list in memory and returns it.</p>
<h2 id="delete-recursively-astreecte" tabindex="-1"> Delete Recursively - AsTreeCte</h2>
<p>Very common infinite level classification table function, when deleting a tree node, the child nodes are also processed.</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"中国"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span><span>)</span>
  <span>.</span><span>ToDelete</span><span>(</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//Delete all records under 中国.</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>If logically delete:</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"中国"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span><span>)</span>
  <span>.</span><span>ToUpdate</span><span>(</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>IsDeleted<span>,</span> <span>true</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//Logically delete all records under 中国.</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="query-recursively-astreecte" tabindex="-1"> Query Recursively - AsTreeCte</h2>
<p>If you do not design an infinite level classification table with data redundancy, recursive query is essential. <code>AsTreeCte</code> is the package for solving recursive query. Method parameters description:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>(Optional) pathSelector</td>
<td>Path content selection, you can set the query to return: <code>中国 -&gt; 北京 -&gt; 东城区</code></td>
</tr>
<tr>
<td>(Optional) up</td>
<td><em>false</em> (default): recursive query from parent to child; <br /><em>true</em>: recursive query from child to parent</td>
</tr>
<tr>
<td>(Optional) pathSeparator</td>
<td>Set the connector of <code>pathSelector</code>, default: <code>-&gt;</code></td>
</tr>
<tr>
<td>(Optional) level</td>
<td>Set recursion level</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Databases that have passed the test: MySql8.0, SqlServer, PostgreSQL, Oracle, Sqlite, Firebird, 达梦, 人大金仓, 神舟通用, 南大通用, 翰高, MSAccess And ClickHouse.</p>
</blockquote>
<p>Practice 1: AsTreeCte() + ToTreeList</p>
<div><pre><code><span><span>var</span></span> t2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"中国"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span><span>)</span> <span>//Query all records under 中国</span>
  <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Code<span>)</span>
  <span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span> <span>//Not necessary, you can also use ToList (see Practice 2)</span>
Assert<span>.</span><span>Single</span><span>(</span>t2<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"100000"</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Single</span><span>(</span>t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110000"</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>2</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span>Count<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110100"</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110101"</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>1</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>

<span>// WITH "as_tree_cte"</span>
<span>// as</span>
<span>// (</span>
<span>// SELECT 0 as cte_level, a."Code", a."Name", a."ParentCode" </span>
<span>// FROM "Area" a </span>
<span>// WHERE (a."Name" = '中国')</span>

<span>// union all</span>

<span>// SELECT wct1.cte_level + 1 as cte_level, wct2."Code", wct2."Name", wct2."ParentCode" </span>
<span>// FROM "as_tree_cte" wct1 </span>
<span>// INNER JOIN "Area" wct2 ON wct2."ParentCode" = wct1."Code"</span>
<span>// )</span>
<span>// SELECT a."Code", a."Name", a."ParentCode" </span>
<span>// FROM "as_tree_cte" a </span>
<span>// ORDER BY a."Code"</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br></div></div><p>Practice 2: AsTreeCte() + ToList</p>
<div><pre><code><span><span>var</span></span> t3 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"中国"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span><span>)</span>
  <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Code<span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>4</span><span>,</span> t3<span>.</span>Count<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"100000"</span><span>,</span> t3<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110000"</span><span>,</span> t3<span>[</span><span>1</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110100"</span><span>,</span> t3<span>[</span><span>2</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110101"</span><span>,</span> t3<span>[</span><span>3</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
<span>//The executed SQL is the same as Practice 1</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>Practice 3: AsTreeCte(pathSelector) + ToList</p>
<p>After setting the <code>pathSelector</code> parameter, how to return the hidden field?</p>
<div><pre><code><span><span>var</span></span> t4 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"中国"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>+</span> <span>"["</span> <span>+</span> a<span>.</span>Code <span>+</span> <span>"]"</span><span>)</span>
  <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Code<span>)</span>
  <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> 
    item <span>=</span> a<span>,</span> 
    level <span>=</span> Convert<span>.</span><span>ToInt32</span><span>(</span><span>"a.cte_level"</span><span>)</span><span>,</span> 
    path <span>=</span> <span>"a.cte_path"</span> 
  <span>}</span><span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>4</span><span>,</span> t4<span>.</span>Count<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"100000"</span><span>,</span> t4<span>[</span><span>0</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110000"</span><span>,</span> t4<span>[</span><span>1</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110100"</span><span>,</span> t4<span>[</span><span>2</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110101"</span><span>,</span> t4<span>[</span><span>3</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"中国[100000]"</span><span>,</span> t4<span>[</span><span>0</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"中国[100000] -> 北京[110000]"</span><span>,</span> t4<span>[</span><span>1</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"中国[100000] -> 北京[110000] -> 北京市[110100]"</span><span>,</span> t4<span>[</span><span>2</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"中国[100000] -> 北京[110000] -> 东城区[110101]"</span><span>,</span> t4<span>[</span><span>3</span><span>]</span><span>.</span>path<span>)</span><span>;</span>

<span>// WITH "as_tree_cte"</span>
<span>// as</span>
<span>// (</span>
<span>// SELECT 0 as cte_level, a."Name" || '[' || a."Code" || ']' as cte_path, a."Code", a."Name", a."ParentCode" </span>
<span>// FROM "Area" a </span>
<span>// WHERE (a."Name" = '中国')</span>

<span>// union all</span>

<span>// SELECT wct1.cte_level + 1 as cte_level, wct1.cte_path || ' -> ' || wct2."Name" || '[' || wct2."Code" || ']' as cte_path, wct2."Code", wct2."Name", wct2."ParentCode" </span>
<span>// FROM "as_tree_cte" wct1 </span>
<span>// INNER JOIN "Area" wct2 ON wct2."ParentCode" = wct1."Code"</span>
<span>// )</span>
<span>// SELECT a."Code" as1, a."Name" as2, a."ParentCode" as5, a.cte_level as6, a.cte_path as7 </span>
<span>// FROM "as_tree_cte" a </span>
<span>// ORDER BY a."Code"</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br></div></div><blockquote>
<p>More practice...please try according to the code comments.</p>
</blockquote>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Query-from-Multi-Tablea">《Query from Multi Tables》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Linq-to-Sql">《LinqToSql》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
<li><a href="Performance">《Performance》</a></li>
<li><a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Query Data</title>
      <link>http://freesql.net/en/guide/Query-Data.html</link>
      <guid>http://freesql.net/en/guide/Query-Data.html</guid>
      <source url="http://freesql.net/rss.xml">Query Data</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="query-data" tabindex="-1"> Query Data</h1>
<p>FreeSql has made great efforts in querying data, especially the functions such as chain query syntax, multi-table query, expression function, etc.</p>
<ul>
<li><a href="Pagination">《Paging Query》</a></li>
<li><a href="Query-from-Single-Table">《Query from Single Table》</a></li>
<li><a href="Query-from-Multi-Table">《Query from Multi Tables》</a></li>
<li><a href="Grouped-Aggregate-Query">《Grouped Aggregate Query》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Linq-to-Sql">《LinqToSql》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
<li><a href="Using-Read-Write-Separation">《Using Read/Write Separation》</a></li>
<li><a href="Performance">《Performance》</a></li>
<li><a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
</ul>
<h2 id="special-introduction-to-wheredynamicfilter" tabindex="-1"> Special introduction to WhereDynamicFilter</h2>
<p>The <code>ISelect.WhereDynamicFilter</code> method implements dynamic filter conditions (interacting with the front-end), supported operators:</p>
<ul>
<li>Contains/StartsWith/EndsWith/NotContains/NotStartsWith/NotEndsWith: include/not include, <code>like'%xx%'</code>, or <code>like'xx%'</code>, or <code>like'%xx'</code></li>
<li>Equal/NotEqual</li>
<li>GreaterThan/GreaterThanOrEqual</li>
<li>LessThan/LessThanOrEqual</li>
<li>Range: Range query</li>
<li>DateRange: date range, with special processing value[1] + 1</li>
<li>Any/NotAny: Does it match any item in <code>value</code> (to put it bluntly, <code>SQL IN</code>)</li>
</ul>
<div><pre><code><span>DynamicFilterInfo</span> dyfilter <span>=</span> JsonConvert<span>.</span><span><span>DeserializeObject</span><span><span>&lt;</span>DynamicFilterInfo<span>></span></span></span><span>(</span><span>@"
{
  ""Logic"" : ""Or"",
  ""Filters"" :
  [
    {
      ""Field"" : ""Code"", ""Operator"" : ""NotContains"", ""Value"" : ""val1"", 
      ""Filters"" : [{ ""Field"" : ""Name"", ""Operator"" : ""NotStartsWith"", ""Value"" : ""val2"" }]
    },
    {
      ""Field"" : ""Parent.Code"", ""Operator"" : ""Equals"", ""Value"" : ""val11"",
      ""Filters"" : [{ ""Field"" : ""Parent.Name"", ""Operator"" : ""Contains"", ""Value"" : ""val22"" }]
    }
  ]
}"</span><span>)</span><span>;</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>VM_District_Parent<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>WhereDynamicFilter</span><span>(</span>dyfilter<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span>//SELECT a.""Code"", a.""Name"", a.""ParentCode"", a__Parent.""Code"" as4, a__Parent.""Name"" as5, a__Parent.""ParentCode"" as6 </span>
<span>//FROM ""D_District"" a </span>
<span>//LEFT JOIN ""D_District"" a__Parent ON a__Parent.""Code"" = a.""ParentCode"" </span>
<span>//WHERE (not((a.""Code"") LIKE '%val1%') AND not((a.""Name"") LIKE 'val2%') OR a__Parent.""Code"" = 'val11' AND (a__Parent.""Name"") LIKE '%val22%')</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><blockquote>
<p>Dynamic sorting: <code>ISelect.OrderByPropertyName(&quot;Parent.Code&quot;)</code></p>
</blockquote>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>Methods</th>
<th>Return</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>Return the SQL statement to be executed</td>
</tr>
<tr>
<td>ToList</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>Execute SQL query and return the records of all fields of the <code>T1</code> entity. If there are navigation properties, they will be queried and returned together. If the record does not exist, it will return a list with <code>Count</code> being <code>0</code></td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>Execute SQL query, return the record of the specified field, if the record does not exist, return the list with <code>Count</code> as <code>0</code></td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>string field</td>
<td>Execute SQL query, return the record of the field specified by field, and receive it as a tuple or basic type (int, string, long). If the record does not exist, return a list with <code>Count</code> as <code>0</code></td>
</tr>
<tr>
<td>ToOne</td>
<td>T1</td>
<td></td>
<td>Execute SQL query and return the first record of all fields of the <code>T1</code> entity, or <code>null</code> if the record does not exist</td>
</tr>
<tr>
<td>ToAggregate&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>Execute SQL query and return the aggregated result of the specified field (suitable for scenarios where <code>GroupBy</code> is not needed)</td>
</tr>
<tr>
<td>Any</td>
<td>bool</td>
<td></td>
<td>Execute SQL query, if there are records, return true, otherwise return false.</td>
</tr>
<tr>
<td>Sum</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column and calculate the sum.</td>
</tr>
<tr>
<td>Min</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column and calculate the minimum value.</td>
</tr>
<tr>
<td>Max</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column and calculate the maximum value.</td>
</tr>
<tr>
<td>Avg</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column, calculate the average value.</td>
</tr>
<tr>
<td>【Pagination】</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Count</td>
<td>long</td>
<td></td>
<td>The number of queried records</td>
</tr>
<tr>
<td>Count</td>
<td>&lt;this&gt;</td>
<td>out long</td>
<td>The number of queried records, returned in the form of parameter <code>out</code></td>
</tr>
<tr>
<td>Skip</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>Query the number of rows shifted backward</td>
</tr>
<tr>
<td>Offset</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>Query the number of rows shifted backward</td>
</tr>
<tr>
<td>Limit</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>Query a specified amount of data</td>
</tr>
<tr>
<td>Take</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>Query a specified amount of data</td>
</tr>
<tr>
<td>Page</td>
<td>&lt;this&gt;</td>
<td>int pageIndex, int pageSize</td>
<td>Pagination</td>
</tr>
<tr>
<td>【Where】</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Supports multi-table query expressions, multiple use is equivalent to <code>AND</code>.</td>
</tr>
<tr>
<td>WhereIf</td>
<td>&lt;this&gt;</td>
<td>bool, Lambda</td>
<td>Support multi-table query expression</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Native Sql syntax conditions, <code>Where(&quot;id = @id&quot;, new {id = 1 })</code> Note that the prefix <code>@</code> will be <a href="ActiveX-Data-Objects#parameterization">determined according to the specific database</a></td>
</tr>
<tr>
<td>WhereIf</td>
<td>&lt;this&gt;</td>
<td>bool, string, parms</td>
<td>Native Sql syntax conditions, <code>WhereIf(true, &quot;id = @id&quot;, new {id = 1 })</code> Note that the prefix <code>@</code> will be <a href="ActiveX-Data-Objects#parameterization">determined according to the specific database</a></td>
</tr>
<tr>
<td>WhereCascade</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>When querying multiple tables, add conditions to each table.</td>
</tr>
<tr>
<td>WhereDynamicFilter</td>
<td>&lt;this&gt;</td>
<td>DynamicFilterInfo</td>
<td>Dynamic filter conditions (interact with the front end)</td>
</tr>
<tr>
<td>【Group】</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Group by selected column, <code>GroupBy(a =&gt; a.Name)</code></td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Group by native sql syntax <code>GroupBy(&quot;concat(name, @cc)&quot;, new { cc = 1 })</code>. Note that the prefix <code>@</code> will be <a href="ActiveX-Data-Objects#parameterization">determined according to the specific database</a></td>
</tr>
<tr>
<td>Having</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Filter by aggregation conditions of native sql syntax <code>Having(&quot;count(name) = @cc&quot;, new { cc = 1 })</code>. Note that the prefix <code>@</code> will be <a href="ActiveX-Data-Objects#parameterization">determined according to the specific database</a></td>
</tr>
<tr>
<td>Distinct</td>
<td>&lt;this&gt;</td>
<td></td>
<td><code>.Distinct().ToList(x =&gt; x.GroupName)</code> is to perform <code>DISTINCT</code> for the specified field.</td>
</tr>
<tr>
<td>【Order】</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>OrderBy</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Sort by column, <code>OrderBy(a =&gt; a.Time)</code>, can be used multiple times</td>
</tr>
<tr>
<td>OrderByDescending</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>按列倒向排序，OrderByDescending(a =&gt; a.Time)</td>
</tr>
<tr>
<td>OrderBy</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>按原生sql语法排序，OrderBy(&quot;count(name) + @cc&quot;, new { cc = 1 })</td>
</tr>
<tr>
<td>OrderByPropertyName</td>
<td>string, bool</td>
<td></td>
<td>Sort by attribute name string (support navigation attributes)</td>
</tr>
<tr>
<td>【Join】</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>LeftJoin</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Left-join query, you can use navigation properties, or specify the associated entity type</td>
</tr>
<tr>
<td>InnerJoin</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Inner-join query, you can use navigation properties, or specify the associated entity type</td>
</tr>
<tr>
<td>RightJoin</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Right-join query, you can use navigation properties, or specify the associated entity type</td>
</tr>
<tr>
<td>LeftJoin</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Left-join query, using native sql syntax, <code>LeftJoin(&quot;type b on b.id = a.id and b.clicks&gt; @clicks&quot;, new {clicks = 1 })</code></td>
</tr>
<tr>
<td>InnerJoin</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Inner-join query, using native sql syntax, <code>InnerJoin(&quot;type b on b.id = a.id and b.clicks &gt; @clicks&quot;, new { clicks = 1 })</code></td>
</tr>
<tr>
<td>RightJoin</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Right-join query, using native sql syntax, <code>RightJoin(&quot;type b on b.id = a.id and b.clicks &gt; @clicks&quot;, new { clicks = 1 })</code></td>
</tr>
<tr>
<td>From</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Multi-table query, more than 3 tables will be very convenient to use (currently supports up to 10 tables by design)</td>
</tr>
<tr>
<td>【Other】</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>As</td>
<td>&lt;this&gt;</td>
<td>string alias = &quot;a&quot;</td>
<td>Specify alias</td>
</tr>
<tr>
<td>Master</td>
<td>&lt;this&gt;</td>
<td></td>
<td>Specify query from the main database (default query from the slave database)</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>Command timeout setting (seconds)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>Set the transaction object</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>Set the connection object</td>
</tr>
<tr>
<td>WithLock</td>
<td>&lt;this&gt;</td>
<td>Enum</td>
<td>Specific settings such as SqlServer <code>NoLock</code></td>
</tr>
<tr>
<td>ForUpdate</td>
<td>&lt;this&gt;</td>
<td>bool</td>
<td>Exclusive update lock, adapted to different databases, see notes for details</td>
</tr>
<tr>
<td>AsQueryable</td>
<td>IQueryable</td>
<td></td>
<td>Convert <code>ISelect</code> to <code>IQueryable</code>. This method is mainly used for extensions, for example: Abp's <code>IRepository GetAll()</code> interface method needs to return an <code>IQueryable</code> object. Note: <code>IQueryable</code> method is more polluted, please try to avoid this conversion.</td>
</tr>
<tr>
<td>InsertInto</td>
<td>int</td>
<td>string, Lambda</td>
<td>Convert the query to <code>INSERT INTO tableName SELECT ... FROM t</code> and perform the insert.</td>
</tr>
<tr>
<td>ToUpdate</td>
<td>IUpdate&lt;TEntity&gt;</td>
<td>-</td>
<td>Convert the query to <code>IUpdate&lt;TEntity&gt;</code></td>
</tr>
<tr>
<td>ToDelete</td>
<td>IDelete&lt;TEntity&gt;</td>
<td>-</td>
<td>Convert the query to <code>IDelete&lt;TEntity&gt;</code></td>
</tr>
<tr>
<td>ToTreeList</td>
<td>List&lt;TEntity&gt;</td>
<td>-</td>
<td>Return the data of the parent-child relationship in the form of a TreeList</td>
</tr>
<tr>
<td>AsTreeCte</td>
<td>ISelect</td>
<td>(up, pathSelector, level)</td>
<td>Recursively query the parent-child relationship table</td>
</tr>
</tbody>
</table>
]]></content:encoded>
    </item>
    <item>
      <title>Query from Multi Tables</title>
      <link>http://freesql.net/en/guide/Query-from-Multi-Table.html</link>
      <guid>http://freesql.net/en/guide/Query-from-Multi-Table.html</guid>
      <source url="http://freesql.net/rss.xml">Query from Multi Tables</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="query-from-multi-tables" tabindex="-1"> Query from Multi Tables</h1>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//Be sure to define as singleton mode</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> CategoryId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Category</span> Category <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>Category</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> ParentId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>CategoryType</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>List<span>&lt;</span>Topic<span>></span></span> Topics <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>CategoryType</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br></div></div><h2 id="_1-navigation-property-table" tabindex="-1"> 1. Navigation Property Table</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> a<span>.</span>Category<span>.</span>Id <span>==</span> a<span>.</span>CategoryId<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> a<span>.</span>Category<span>.</span>Parent<span>.</span>Id <span>==</span> a<span>.</span>Category<span>.</span>ParentId<span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Category<span>.</span>Parent<span>.</span>Id <span>></span> <span>0</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`, a__Category.`Id` as6, a__Category.`Name`, a__Category.`ParentId`</span>
<span>//FROM `Topic` a</span>
<span>//LEFT JOIN `Category` a__Category ON a__Category.`Id` = a.`CategoryId`</span>
<span>//LEFT JOIN `CategoryType` a__Category__Parent ON a__Category__Parent.`Id` = a__Category.`ParentId`</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><blockquote>
<p>Tip: After <a href="Entity-Relationship">the navigation relationship</a> is configured correctly, you no longer need to manually call <code>LeftJoin</code>.</p>
</blockquote>
<h2 id="_2-complex-multi-table-join" tabindex="-1"> 2. Complex multi-table join</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>,</span> Category<span>,</span> CategoryType<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> a<span>.</span>CategoryId <span>==</span> b<span>.</span>Id<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> b<span>.</span>ParentId <span>==</span> c<span>.</span>Id<span>)</span>
  <span>.</span><span>Where</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> c<span>.</span>Id <span>></span> <span>0</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> <span>new</span> <span>{</span> a<span>,</span>b<span>,</span>c <span>}</span><span>)</span><span>;</span>

<span>//OR</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>From</span><span><span>&lt;</span>Category<span>,</span> CategoryType<span>></span></span></span><span>(</span><span>(</span>s<span>,</span> b<span>,</span> c<span>)</span> <span>=></span> s
  <span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> a<span>.</span>CategoryId <span>==</span> b<span>.</span>Id<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> b<span>.</span>ParentId <span>==</span> c<span>.</span>Id<span>)</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> c<span>.</span>Id <span>></span> <span>0</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> <span>new</span> <span>{</span> a<span>,</span>b<span>,</span>c <span>}</span><span>)</span><span>;</span>

<span>//WITHOUT DEFINE a, b, c</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>,</span> Category<span>,</span> CategoryType<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>w <span>=></span> w<span>.</span>t1<span>.</span>CategoryId <span>==</span> w<span>.</span>t2<span>.</span>Id<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>w <span>=></span> w<span>.</span>t2<span>.</span>ParentId <span>==</span> w<span>.</span>t3<span>.</span>Id<span>)</span>
  <span>.</span><span>Where</span><span>(</span>w <span>=></span> w<span>.</span>t3<span>.</span>Id <span>></span> <span>0</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span>w <span>=></span> <span>new</span> <span>{</span> w<span>.</span>t1<span>,</span>w<span>.</span>t2<span>,</span>w<span>.</span>t3 <span>}</span><span>)</span><span>;</span>

<span>//SELECT ...</span>
<span>//FROM `Topic` a</span>
<span>//LEFT JOIN `Category` b ON a.`CategoryId` = b.`Id`</span>
<span>//LEFT JOIN `CategoryType` c ON b.`ParentId` = c.`Id`</span>
<span>//WHERE c. `Id` > 0</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div><blockquote>
<p>Experience: <a href="https://github.com/dotnetcore/FreeSql/issues/430" target="_blank" rel="noopener noreferrer">One-to-many, only the last record is taken from the associated table </a></p>
</blockquote>
<h2 id="_3-withsql" tabindex="-1"> 3. WithSql</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>,</span> Category<span>,</span> CategoryType<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>WithSql</span><span>(</span>
      <span>"select * from Topic where id=@id1"</span><span>,</span>
      <span>"select * from Category where id=@id2"</span><span>,</span>
      <span>null</span><span>,</span> <span>//Do not set the SQL corresponding to CategoryType</span>
      <span>new</span> <span>{</span> id1 <span>=</span> <span>10</span><span>,</span> id2 <span>=</span> <span>11</span><span>,</span> id3 <span>=</span> <span>13</span> <span>}</span>
  <span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> a<span>.</span>CategoryId <span>==</span> b<span>.</span>Id<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> b<span>.</span>ParentId <span>==</span> c<span>.</span>Id<span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span>//SELECT ...</span>
<span>//FROM ( select * from Topic where id=@id1 ) a</span>
<span>//LEFT JOIN ( select * from Category where id=@id2 ) b ON a.`CategoryId` = b.`Id`</span>
<span>//LEFT JOIN `CategoryType` c ON b.`ParentId` = c.`Id`</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><blockquote>
<p>Tip: <code>ISelect.ToSql</code> can be used with <code>WithSql</code></p>
</blockquote>
<h2 id="_4-sql-join-table" tabindex="-1"> 4. SQL join table</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>"Category b on b.Id = a.CategoryId and b.Name = @bname"</span><span>,</span> <span>new</span> <span>{</span> bname <span>=</span> <span>"xxx"</span> <span>}</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//LEFT JOIN Category b on b.Id = a.CategoryId and b.Name = @bname</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>Extended question: How to specify the fields of the SQL join table <code>b</code> in <code>ToList</code>?</p>
<div><pre><code><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
  bid <span>=</span> Convert<span>.</span><span>ToInt32</span><span>(</span><span>"b.Id"</span><span>)</span><span>,</span>
  bName <span>=</span> <span>"b.Name"</span>
<span>}</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="_5-subtable-exists" tabindex="-1"> 5. Subtable: Exists</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>As</span><span>(</span><span>"b"</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Id <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Any</span><span>(</span><span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (exists(SELECT 1</span>
<span>//    FROM `Topic` b</span>
<span>//    WHERE (b.`Id` = a.`Id`)</span>
<span>//    limit 0,1))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><blockquote>
<p>Tip: Since the entity class of the subquery is the same as the upper layer, use <code>As(&quot;b&quot;)</code> to specify the alias to distinguish.</p>
</blockquote>
<h2 id="_6-subtable-in" tabindex="-1"> 6. Subtable: In</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>As</span><span>(</span><span>"b"</span><span>)</span><span>.</span><span>ToList</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>.</span><span>Contains</span><span>(</span>a<span>.</span>Id<span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (((a.`Id`) in (SELECT b.`Id`</span>
<span>//    FROM `Topic` b)))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><h2 id="_7-subtable-join" tabindex="-1"> 7. Subtable: Join</h2>
<p>Since version 1.8.0, <code>string.Join</code> + <code>ToList</code> can concatenate the results of multiple rows of sub-queries into one string, such as: &quot;1,2,3,4&quot;:</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
  id <span>=</span> a<span>.</span>Id<span>,</span>
  concat <span>=</span> <span>string</span><span>.</span><span>Join</span><span>(</span><span>","</span><span>,</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>StringJoin01<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>)</span>
<span>}</span><span>)</span><span>;</span>

<span>//SELECT a.`Id`, (SELECT group_concat(b.`Id` separator ',') </span>
<span>//    FROM `StringJoin01` b) </span>
<span>//FROM `Topic` a</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><blockquote>
<p>Tip: The subquery <code>string.Join</code> + <code>ToList</code> is adapted to sqlserver/pgsql/oracle/mysql/sqlite/firebird/Dameng/KingbaseES/翰高<a href="https://github.com/dotnetcore/FreeSql/issues/405" target="_blank" rel="noopener noreferrer">#405</a></p>
</blockquote>
<h2 id="_8-subtable-first-count-sum-max-min-avg" tabindex="-1"> 8. Subtable: First/Count/Sum/Max/Min/Avg</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Category<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span>  <span>{</span>
  all <span>=</span> a<span>,</span>
  first <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>First</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>,</span>
  count <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span>
  sum <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Sum</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span><span>,</span>
  max <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Max</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span><span>,</span>
  min <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Min</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span><span>,</span>
  avg <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Avg</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="_9-asselect" tabindex="-1"> 9. AsSelect</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Category<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Topics<span>.</span><span>AsSelect</span><span>(</span><span>)</span><span>.</span><span>Any</span><span>(</span>b <span>=></span> b<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"xx"</span><span>)</span><span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>The effect is equivalent to:</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Category<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Any</span><span>(</span>b <span>=></span> b<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"xx"</span><span>)</span><span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>Quickly convert the collection properties to <code>ISelect</code> for sub-query operations.</p>
<h2 id="_10-wherecascade" tabindex="-1"> 10. WhereCascade</h2>
<p>When querying multiple tables, it is troublesome to add conditions to each table like <code>ISelect</code>, and <code>WhereCascade</code> came into being. After using <code>WhereCascade</code>, when SQL is generated, all tables will be attached to this condition.</p>
<p>Such as:</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>t1<span>></span></span></span><span>(</span><span>)</span>
<span>.</span><span><span>LeftJoin</span><span><span>&lt;</span>t2<span>></span></span></span><span>(</span><span>..</span><span>.</span><span>)</span>
<span>.</span><span>WhereCascade</span><span>(</span>x <span>=></span> x<span>.</span>IsDeleted <span>==</span> <span>false</span><span>)</span>
<span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>The SQL obtained is:</p>
<div><pre><code><span>SELECT</span> <span>.</span><span>.</span><span>.</span>
<span>FROM</span> t1
<span>LEFT</span> <span>JOIN</span> t2 <span>on</span> <span>.</span><span>.</span><span>.</span> <span>AND</span> <span>(</span>t2<span>.</span>IsDeleted <span>=</span> <span>0</span><span>)</span> 
<span>WHERE</span> t1<span>.</span>IsDeleted <span>=</span> <span>0</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>It will only take effect when the entity can attach expressions, and supports sub-table query. The more tables used in a single query, the greater the benefits.</p>
<p>Applicable to:</p>
<ul>
<li>Subqueries, one-to-many, many-to-many, and custom sub-queries;</li>
<li>Join query, navigation properties, custom Join query;</li>
<li>Include/<a href="Lazy-Loading#2-Navigation-Property-OneToManyManyToMany">IncludeMany</a> sub-collection query;</li>
</ul>
<blockquote>
<p>The propagation of <strong>Lazy Property</strong> is temporarily not supported;</p>
</blockquote>
<blockquote>
<p>This function is different from <strong>Filter</strong>, this function is used for the propagation of single multi-table query conditions;</p>
</blockquote>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Linq-to-Sql">《LinqToSql》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
<li><a href="Performance">《Performance》</a></li>
<li><a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Query from Single Table</title>
      <link>http://freesql.net/en/guide/Query-from-Single-Table.html</link>
      <guid>http://freesql.net/en/guide/Query-from-Single-Table.html</guid>
      <source url="http://freesql.net/rss.xml">Query from Single Table</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="query-from-single-table" tabindex="-1"> Query from Single Table</h1>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//Be sure to define as singleton mode</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> CategoryId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h2 id="single-table" tabindex="-1"> Single Table</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>10</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>///SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime` </span>
<span>//FROM `Topic` a </span>
<span>//WHERE (a.`Id` = 10)</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>10</span> <span>&amp;&amp;</span> a<span>.</span>Id <span>></span> <span>10</span> <span>||</span> a<span>.</span>Clicks <span>></span> <span>100</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>///SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime` </span>
<span>//FROM `Topic` a </span>
<span>//WHERE (a.`Id` = 10 AND a.`Id` > 10 OR a.`Clicks` > 100)</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> <span>new</span> <span>[</span><span>]</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>.</span><span>Contains</span><span>(</span>a<span>.</span>Id<span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime` </span>
<span>//FROM `Topic` a </span>
<span>//WHERE (a.`Id` in (1,2,3))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><h2 id="withsql" tabindex="-1"> WithSql</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>WithSql</span><span>(</span><span>"select * from Topic where clicks > @val"</span><span>,</span> <span>new</span> <span>{</span> val <span>=</span> <span>10</span> <span>}</span><span>)</span>
  <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span>
<span>//SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime` </span>
<span>//FROM (select * from Topic where clicks > @val) a </span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><blockquote>
<p>When <code>WithSql</code> is used multiple times, it will be converted to <code>UNION ALL</code> query</p>
</blockquote>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Query-from-Multi-Tables">《Query from Multi Tables》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Linq-to-Sql">《LinqToSql》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
<li><a href="Performance">《Performance》</a></li>
<li><a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Repository Layer</title>
      <link>http://freesql.net/en/guide/Repository-Layer.html</link>
      <guid>http://freesql.net/en/guide/Repository-Layer.html</guid>
      <source url="http://freesql.net/rss.xml">Repository Layer</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="repository-layer" tabindex="-1"> Repository Layer</h1>
<p>As an extension, FreeSql.Repository realizes the functions of the common DAL. There is a certain standard definition for the repository layer. FreeSql.Repository refers to the interface design of Abp vNext, defines and implements the basic repository layer for CURD operations.</p>
<h2 id="features" tabindex="-1"> Features</h2>
<ul>
<li><code>Select/Attach</code>: Snapshot object, the corresponding <code>Update</code> only updates the changed fields.</li>
<li><code>Insert</code>: Insert data, adapt to each database to optimize execution <code>ExecuteAffrows</code>, <code>ExecuteIdentity</code> or <code>ExecuteInserted</code>;</li>
<li><code>InsertOrUpdate</code>: Insert or update data.</li>
<li><code>SaveMany</code>: Quickly save navigation objects (one-to-many, many-to-many).</li>
</ul>
<h2 id="install" tabindex="-1"> Install</h2>
<p>Situation 1: .NET Core or .NET 5.0+</p>
<div><pre><code>dotnet <span>add</span> package FreeSql.Repository
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>Situation 2、.NET Framework</p>
<div><pre><code>Install-Package FreeSql.DbContext
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="declaring" tabindex="-1"> Declaring</h2>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> connectionString<span>)</span>
    <span>//Automatically synchronize the entity structure to the database.</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> 
    <span>//Be sure to define as singleton mode</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> 

<span>public</span> <span>class</span> <span>Song</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><h2 id="usage" tabindex="-1"> Usage</h2>
<p>Method 1. The extension method of IFreeSql</p>
<div><pre><code><span><span>var</span></span> curd <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><blockquote>
<p>Note: Repository objects are not safe under multiple threads, so you should not operate them on multiple threads at the same time.</p>
</blockquote>
<ul>
<li>Does not support using the same repository instance in different threads at the same time</li>
</ul>
<p>Method 2. Inheritance</p>
<div><pre><code><span>public</span> <span>class</span> <span>SongRepository</span> <span>:</span> <span><span>BaseRepository<span>&lt;</span>Song<span>,</span> <span>int</span><span>></span></span></span> <span>{</span>
    <span>public</span> <span>SongRepository</span><span>(</span><span>IFreeSql</span> fsql<span>)</span> <span>:</span> <span>base</span><span>(</span>fsql<span>,</span> <span>null</span><span>,</span> <span>null</span><span>)</span> <span>{</span><span>}</span>

    <span>//Do something except CURD. </span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>Method 3: Dependency Injection</p>
<div><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span> <span>{</span>
    
    services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>Fsql<span>)</span><span>;</span>
    services<span>.</span><span>AddFreeRepository</span><span>(</span>filter <span>=></span> filter
        <span>.</span><span><span>Apply</span><span><span>&lt;</span>ISoftDelete<span>></span></span></span><span>(</span><span>"SoftDelete"</span><span>,</span> a <span>=></span> a<span>.</span>IsDeleted <span>==</span> <span>false</span><span>)</span>
        <span>.</span><span><span>Apply</span><span><span>&lt;</span>ITenant<span>></span></span></span><span>(</span><span>"Tenant"</span><span>,</span> a <span>=></span> a<span>.</span>TenantId <span>==</span> <span>1</span><span>)</span>
        <span>,</span>
        <span>this</span><span>.</span><span>GetType</span><span>(</span><span>)</span><span>.</span>Assembly
    <span>)</span><span>;</span>
<span>}</span>

<span>//Use in the controller</span>
<span>public</span> <span>SongsController</span><span>(</span><span>IBaseRepository<span>&lt;</span>Song<span>></span></span> repos1<span>)</span> <span>{</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><blockquote>
<p>Dependency injection can realize the global setting of <strong>filtering and verification</strong>, which is convenient for the design of tenant functions.</p>
</blockquote>
<p>For more information: <a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></p>
<h2 id="state-management" tabindex="-1"> State Management</h2>
<p>Only update the changed properties:</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> item <span>=</span> repo<span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>  <span>//Take a snapshot of item at this time</span>
item<span>.</span>Title <span>=</span> <span>"newtitle"</span><span>;</span>
repo<span>.</span><span>Update</span><span>(</span>item<span>)</span><span>;</span> <span>//Compare with snapshots to get changes</span>

<span>//UPDATE `tb_topic` SET `Title` = @p_0</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>Or further streamline:</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> item <span>=</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span> <span>}</span><span>;</span>
repo<span>.</span><span>Attach</span><span>(</span>item<span>)</span><span>;</span> <span>//Take a snapshot of item at this time</span>
item<span>.</span>Title <span>=</span> <span>"newtitle"</span><span>;</span>
repo<span>.</span><span>Update</span><span>(</span>item<span>)</span><span>;</span> <span>//Compare with snapshots to get changes</span>

<span>//UPDATE `tb_topic` SET `Title` = @p_0</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><h2 id="filtering-and-verification" tabindex="-1"> Filtering and Verification</h2>
<p>Suppose we have two entities: <code>User</code> and <code>Topic</code>, and two repositories are defined in the domain class:</p>
<div><pre><code><span><span>var</span></span> userRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> topicRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>In practice, we always worry about the data security of <code>topicRepository</code>, that is, it is possible to query or change the topic of other users. Therefore, we have made improvements in the v0.0.7 version, adding the filter lambda expression parameter.</p>
<div><pre><code><span><span>var</span></span> userRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>;</span>
<span><span>var</span></span> topicRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span>a <span>=></span> a<span>.</span>UserId <span>==</span> <span>1</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><ul>
<li>Attach this condition when querying/modifying/deleting, so that the data of other users will not be modified.</li>
<li>When adding, use expressions to verify the legality of the data, if not legal, an exception will be thrown.</li>
</ul>
<h2 id="sharding-tables-and-database" tabindex="-1"> Sharding Tables and Database</h2>
<p>FreeSql provides a basic method of sharding tables through <code>AsTable</code>. As a distributed repository, and <code>GuidRepository</code> as a distributed storage, realizes the encapsulation of sharding tables and database (cross-server sharding-database is not supported).</p>
<div><pre><code><span><span>var</span></span> logRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Log<span>></span></span></span><span>(</span><span>null</span><span>,</span> oldname <span>=></span> <span><span>$"</span><span><span>{</span><span>oldname</span><span>}</span></span><span>_</span><span><span>{</span><span>DateTime<span>.</span>Now<span>.</span><span>ToString</span><span>(</span><span>"YYYYMM"</span><span>)</span></span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>Above we got a log repository, which corresponds to the shareding-table by year and month. Using CURD operation will finally take effect in the <code>Log_201903</code> table.</p>
<p>Notice:</p>
<ul>
<li>Versions after v0.11.12 can use CodeFirst to migrate sharding tables.</li>
<li>Do not use lazy loading in the entity type of sharding tables and database.</li>
</ul>
<h2 id="compatibility-problems" tabindex="-1"> Compatibility Problems</h2>
<p>The <code>output inserted</code> feature provided by SqlServer. When the table uses auto-increment or the database defines a default value, use this feature to quickly return the inserted data. PostgreSQL also has similar functions, but not every database supports it.</p>
<p>When a database that does not support this feature (Sqlite/MySql/Oracle/Damen/MsAccess) is used, and the entity uses auto-increment attributes, the batch insertion of the repository will be executed one by one. The following improvements can be considered:</p>
<ul>
<li>Use uuid as the primary key (ie Guid).</li>
<li>Avoid using the default value function of the database.</li>
</ul>
<h2 id="cascade-saving" tabindex="-1"> Cascade Saving</h2>
<p>Please view the documentation of <a href="Cascade-Saving">Cascade Saving</a>.</p>
<h2 id="apis" tabindex="-1"> APIs</h2>
<table>
<thead>
<tr>
<th>Property</th>
<th>Return</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>EntityType</td>
<td>Type</td>
<td>The entity type that the repository is operating. Note that it is not necessarily <code>TEntity</code></td>
</tr>
<tr>
<td>UnitOfWork</td>
<td>IUnitOfWork</td>
<td>Unit of work currently in use</td>
</tr>
<tr>
<td>Orm</td>
<td>IFreeSql</td>
<td>ORM currently in use</td>
</tr>
<tr>
<td>DbContextOptions</td>
<td>DbContextOptions</td>
<td>DbContext settings currently in use，modifying the DbContextOptions will not affect other repository.</td>
</tr>
<tr>
<td>DataFilter</td>
<td>IDataFilter&lt;TEntity&gt;</td>
<td>Repository Filter, valid in this object</td>
</tr>
<tr>
<td>Select</td>
<td>ISelect&lt;TEntity&gt;</td>
<td>Prepare to query data</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Method</th>
<th>Return</th>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>AsType</td>
<td>void</td>
<td>Type</td>
<td>Change the type of entity that the repository is operating</td>
</tr>
<tr>
<td>Get</td>
<td>TEntity</td>
<td>TKey</td>
<td>Query data by the primary key</td>
</tr>
<tr>
<td>Find</td>
<td>TEntity</td>
<td>TKey</td>
<td>Query data by the primary key</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>TKey</td>
<td>Delete data by the primary key</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>Lambda</td>
<td>Delete data by lambda conditions</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>TEntity</td>
<td>Query entity</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>Delete data in bulk</td>
</tr>
<tr>
<td>DeleteCascadeByDatabase</td>
<td>List&lt;object&gt;</td>
<td>Lambda</td>
<td>Recursively delete data from the database according to navigation attributes</td>
</tr>
<tr>
<td>Insert</td>
<td>-</td>
<td>TEntity</td>
<td>Insert data, if the entity has an auto-increment column, the auto-increment after insertion will be filled into the entity</td>
</tr>
<tr>
<td>Insert</td>
<td>-</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>Insert data in bulk</td>
</tr>
<tr>
<td>Update</td>
<td>-</td>
<td>TEntity</td>
<td>Update entity</td>
</tr>
<tr>
<td>Update</td>
<td>-</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>Update data in bulk</td>
</tr>
<tr>
<td>InsertOrUpdate</td>
<td>-</td>
<td>TEntity</td>
<td>Insert ot update data in bulk</td>
</tr>
<tr>
<td>FlushState</td>
<td>-</td>
<td>-</td>
<td>Clear status information</td>
</tr>
<tr>
<td>Attach</td>
<td>-</td>
<td>TEntity</td>
<td>Attach entities to state management, which can be used to update or delete without querying</td>
</tr>
<tr>
<td>Attach</td>
<td>-</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>Batch attach entities to state management</td>
</tr>
<tr>
<td>AttachOnlyPrimary</td>
<td>-</td>
<td>TEntity</td>
<td>Only attach the primary key data of the entity to the state management</td>
</tr>
<tr>
<td><a href="Cascade-Saving#many-to-many-cascade-saving">SaveMany</a></td>
<td>-</td>
<td>TEntity, string</td>
<td>Save the specified many-to-many or one-to-many navigation properties of the entity (full comparison)</td>
</tr>
<tr>
<td><a href="Insert-or-Update#3-batch-editing-beginedit">BeginEdit</a></td>
<td>-</td>
<td>List&lt;TEntity&gt;</td>
<td>Start editing the data of a set of entities</td>
</tr>
<tr>
<td>EndEdit</td>
<td>int</td>
<td>-</td>
<td>After a set of data is edited, save it</td>
</tr>
</tbody>
</table>
<blockquote>
<p>State management can realize that <code>Update</code> only updates the changed fields (not all fields), and it is very comfortable to use <code>Attach</code> and <code>Update</code> flexibly.</p>
</blockquote>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Insert-Data">《FreeSql 101, Part 1: Insert Data》</a></li>
<li><a href="Delete-Data">《FreeSql 101, Part 2: Delete Data》</a></li>
<li><a href="Update-Data">《FreeSql 101, Part 3: Update Data》</a></li>
<li><a href="Query-Data">《FreeSql 101, Part 4: Query Data》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Aspect-Oriented-Programming">《AOP》</a></li>
<li><a href="Unit-of-Work">《UnitOfWork》</a></li>
<li><a href="Batabase-Context">《DbContext》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Return Data</title>
      <link>http://freesql.net/en/guide/Return-Data.html</link>
      <guid>http://freesql.net/en/guide/Return-Data.html</guid>
      <source url="http://freesql.net/rss.xml">Return Data</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="return-data" tabindex="-1"> Return Data</h1>
<p>FreeSql uses ExpressionTree to optimize the reading speed. If you know the technology, you must know that in addition to native code under .NETCore technology, the fastest are Emit and ExpressionTree.</p>
<p>At the beginning, we used Reflection + Cache. Although .NETCore optimized the reflection performance, after comparing the performance with Dapper, we found that there was still a certain gap. After we refactored to an implementation based on ExpresstionTree, our performance was comparable to Dapper.</p>
<p>FreeSql supports many types, and the complexity of implementing ExpressionTree is relatively large. If developers are interested in this, you can browse the source code.</p>
<h2 id="return-a-single-record" tabindex="-1"> Return a Single Record</h2>
<div><pre><code><span>Topic</span> t1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><blockquote>
<p>The FreeSql convention is that <code>ToOne</code>/<code>First</code> will always return null or entity object with data, and <code>ToList</code> will always return a non-null List&lt;entity type&gt;</p>
</blockquote>
<h2 id="return-list" tabindex="-1"> Return List</h2>
<div><pre><code><span>List<span>&lt;</span>Topic<span>></span></span> t1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="return-treelist" tabindex="-1"> Return TreeList</h2>
<div><pre><code><span>List<span>&lt;</span>Category<span>></span></span> t2 <span>=</span> fsql<span>.</span>Select<span>&lt;</span>Category<span>></span><span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span>
<span>List<span>&lt;</span>Category<span>></span></span> t3 <span>=</span> fsql<span>.</span>Select<span>&lt;</span>Category<span>></span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>=</span> <span>"Home Appliances"</span><span>)</span><span>.</span><span>AsTreeCte</span><span>(</span><span>)</span><span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span>
<span>//v1.6.0 AsTreeCte() Recursive CTE query for all sub-categories under "Home Appliances"</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><blockquote>
<p>The query data will be processed into a tree type.</p>
</blockquote>
<p>Note: the entity needs to be configured with parent-child navigation properties</p>
<h2 id="return-list-with-navigation-property-data" tabindex="-1"> Return List with Navigation Property Data</h2>
<div><pre><code><span>List<span>&lt;</span>Topic<span>></span></span> t4 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> a<span>.</span>Type<span>.</span>Id <span>==</span> a<span>.</span>TypeId<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><blockquote>
<p>At this time, the common field of <code>Topic</code> and the <code>Type</code> field of navigation property will be queried</p>
</blockquote>
<h2 id="return-the-specify-field" tabindex="-1"> Return the Specify Field</h2>
<div><pre><code><span>//Return a field</span>
<span>List<span>&lt;</span><span>int</span><span>></span></span> t5 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>;</span>

<span>//Return anonymous class</span>
<span>List<span>&lt;</span>ANONYMOUS_TYPE<span>></span></span> t6 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Id<span>,</span> a<span>.</span>Title <span>}</span><span>)</span><span>;</span>

<span>//Return tuple</span>
<span>List<span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span><span>)</span><span>></span></span> t7 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>ToList</span><span><span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span><span>)</span><span>></span></span></span><span>(</span><span>"id, title"</span><span>)</span><span>;</span>

<span>//Return to navigation properties</span>
<span>List<span>&lt;</span>ANONYMOUS_TYPE<span>></span></span> t8 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    a<span>.</span>Id<span>,</span> a<span>.</span>Title<span>,</span>
    a<span>.</span>Type <span>//You can directly return the navigation property "Type"</span>
<span>}</span><span>)</span><span>;</span>

<span>//Return SQL field</span>
<span>List<span>&lt;</span>ANONYMOUS_TYPE<span>></span></span> t9 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    cstitle <span>=</span> <span>"substr(a.title, 0, 2)"</span><span>,</span> <span>//Use substr(a.title, 0, 2) as the query field</span>
    csnow <span>=</span> Convert<span>.</span><span>ToDateTime</span><span>(</span><span>"now()"</span><span>)</span><span>,</span> <span>//Use now() as the query field</span>
    <span>//Wonderful idea: how to query the result of window function</span>
<span>}</span><span>)</span><span>;</span>

<span>//Return the fields of the subquery</span>
<span>List<span>&lt;</span>ANONYMOUS_TYPE<span>></span></span> t10 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    a<span>.</span>Id<span>,</span>
    count <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span>
    max <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Max</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>,</span>
    min <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Min</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>,</span>
    name <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>First</span><span>(</span>b <span>=></span> b<span>.</span>name<span>)</span>
<span>}</span><span>)</span><span>;</span>

<span>//Return the records of the subquery v3.2.650+</span>
<span>List<span>&lt;</span>匿名类<span>></span></span> t11 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    a<span>.</span>Id<span>,</span>
    list1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>,</span>
    list2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>TopicId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br></div></div><blockquote>
<p>In the early constant mechanism, we left it to raw SQL. If you really need to return the string, you can write: &quot;'xxx'&quot;</p>
</blockquote>
<h2 id="ignore-the-specified-field-when-returning" tabindex="-1"> Ignore the Specified Field When Returning</h2>
<p>Reference to: https://github.com/dotnetcore/FreeSql/issues/528</p>
<h2 id="tosql" tabindex="-1"> ToSql</h2>
<p>All <code>ToList</code> can use <code>ToSql</code> to return SQL string. There are two options:</p>
<ul>
<li>FieldAliasOptions.AsIndex, the default option, automatically generates as1, as2, as3 .... etc. field aliases, which can prevent the problem of multiple tables with the same field.</li>
<li>FieldAliasOptions.AsProperty, use the property name as the field alias, appropriately use the two-stage structure SQL and execute it again.</li>
</ul>
<h2 id="executing-sql" tabindex="-1"> Executing SQL</h2>
<div><pre><code><span>class</span> <span>xxx</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Path <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title2 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>List<span>&lt;</span>xxx<span>></span></span> t11 <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span>xxx<span>></span></span></span><span>(</span><span>"select * from song"</span><span>)</span><span>;</span>
<span>List<span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span> <span>,</span><span>string</span><span>)</span><span>></span></span> t12 <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span><span>,</span> <span>string</span><span>)</span><span>></span></span></span><span>(</span><span>"select * from song"</span><span>)</span><span>;</span>
<span>List<span>&lt;</span><span>dynamic</span><span>></span></span> t13 <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span><span>dynamic</span><span>></span></span></span><span>(</span><span>"select * from song"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><blockquote>
<p>Note: The entity attributes of <code>Ado.Query</code> are invalid, for example, <code>[Column(Name = &quot;xxx&quot;)]</code> is invalid</p>
</blockquote>
<h2 id="withsql" tabindex="-1"> WithSql</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>WithSql</span><span>(</span><span>"select * from Topic where clicks > @val"</span><span>,</span> <span>new</span> <span>{</span> val <span>=</span> <span>10</span> <span>}</span><span>)</span>
  <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span>

<span>//SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime` </span>
<span>//FROM (select * from Topic where clicks > @val) a </span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><blockquote>
<p>When <code>WithSql</code> is used multiple times, <code>UNION ALL</code> query will be used</p>
</blockquote>
<h2 id="tochunk" tabindex="-1"> ToChunk</h2>
<p>Execute queries and return data in blocks, which can reduce memory overhead. For example, if 100,000 pieces of data are read, 100 pieces of data are returned for processing each time.</p>
<div><pre><code><span><span>var</span></span> testlist1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> testlist2 <span>=</span> <span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>)</span><span>;</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>.</span><span>ToChunk</span><span>(</span><span>100</span><span>,</span> done <span>=></span> <span>{</span>
    testlist2<span>.</span><span>AddRange</span><span>(</span>done<span>.</span>Object<span>)</span><span>;</span>
    <span>//done.IsBreak = true; v1.7.0 stop reading </span>
<span>}</span><span>)</span><span>;</span>
<span>//Here is a demonstration that the final data returned by testlist1 and testlist2 are the same.</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="dto-mapping" tabindex="-1"> Dto Mapping</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>ToList</span><span><span>&lt;</span>Dto<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span>//Case 1: The field with the same property name of Dto and Song is queried, and List&lt;Dto> is returned</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span> <span>{</span> xxx <span>=</span> a<span>.</span>ext <span>}</span><span>)</span> 
<span>//Case 2: The field with the same property name of Dto and Song is queried, the mapping ext is adjusted, and List&lt;Dto> is returned</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span> <span>{</span> id <span>=</span> a<span>.</span>id <span>}</span><span>)</span> 
<span>//Case 3: The type specified by Lambda is the same as the type of Song, only the specified field id is queried, and List&lt;Song> is returned</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> id <span>=</span> a<span>.</span>id <span>}</span><span>)</span> 
<span>//Case 4: Lambda specifies an anonymous type, only queries the specified field id, and returns List&lt;ANONYMOUS_OBJECT></span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><blockquote>
<p>Please handle the difference carefully.</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span><span>(</span>a<span>.</span>id<span>)</span><span>)</span>
<span>//Case 5: Only query id and return List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span><span>(</span>a<span>.</span>id<span>)</span> <span>{</span> xxx <span>=</span> a<span>.</span>ext <span>}</span><span>)</span>
<span>//Case 6: Query id, ext and return List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span><span>(</span>a<span>.</span>id<span>)</span><span>)</span>
<span>//Case 7: Query id and return List&lt;Song></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span><span>(</span>a<span>.</span>id<span>)</span> <span>{</span> xxx <span>=</span> a<span>.</span>ext <span>}</span><span>)</span>
<span>//Case 8: Query id, ext and return List&lt;Song></span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><blockquote>
<p>All methods of GroupBy are not applicable to DTO mapping rules</p>
</blockquote>
<p>This kind of mapping supports single table/multi-table, mapping before querying data (not to query all fields first and then to memory mapping).</p>
<p>Searching rules, searching for property names, will loop the internal object <code>_tables</code> (it will grow after join query), and check the main table first until the same field is found.</p>
<p>For example:</p>
<p>Suppose A, B, and C all have id. When the queried Dto structure is: <code>Dto {id, a1, a2, b1, b2 }</code>, <code>A.id</code> is mapped. You can also specify the <code>id = C.id</code> mapping.</p>
<blockquote>
<p>Reminder: You can directly map a navigation property in DTO</p>
</blockquote>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Return</th>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>Return the SQL statement to be executed</td>
</tr>
<tr>
<td>ToList</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>Execute a SQL query and return the records of all the fields of the T1 entity. If there are navigation properties, they will be queried and returned together. If the record does not exist, a list with Count of 0 will be returned.</td>
</tr>
<tr>
<td>ToList&lt;Dto&gt;</td>
<td>List&lt;Dto&gt;</td>
<td>Lambda</td>
<td>Execute SQL query, return the record of the specified field or Dto mapping, if the record does not exist, return the list with Count as 0.</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>string field</td>
<td>Execute SQL query, return the record of the field specified by field, and receive it as a tuple or basic type (int, string, long). If the record does not exist, return a list with Count of 0.</td>
</tr>
<tr>
<td>ToOne</td>
<td>T1</td>
<td></td>
<td>Execute SQL query and return the first record of all fields of the T1 entity, or null if the record does not exist.</td>
</tr>
<tr>
<td>ToChunk</td>
<td>&lt;空&gt;</td>
<td>int size, Action&lt;FetchCallbackArgs&lt;List&lt;T1&gt;&gt;&gt; done</td>
<td>Execute SQL query and return data in blocks, which can reduce memory overhead. For example, if 100,000 pieces of data are read, 100 pieces of data are returned for processing each time.</td>
</tr>
<tr>
<td>Any</td>
<td>bool</td>
<td></td>
<td>Execute SQL query to determine whether there is a record</td>
</tr>
<tr>
<td>Sum</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column to sum.</td>
</tr>
<tr>
<td>Min</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column to find the minimum.</td>
</tr>
<tr>
<td>Max</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column to find the maximum.</td>
</tr>
<tr>
<td>Avg</td>
<td>T</td>
<td>Lambda</td>
<td>Specify a column to average.</td>
</tr>
</tbody>
</table>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Query-from-Multi-Tablea">《Query from Multi Tables》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Linq-to-Sql">《LinqToSql》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
<li><a href="Performance">《Performance》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Unit of Work Manager</title>
      <link>http://freesql.net/en/guide/Unit-of-Work-Manager.html</link>
      <guid>http://freesql.net/en/guide/Unit-of-Work-Manager.html</guid>
      <source url="http://freesql.net/rss.xml">Unit of Work Manager</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="unit-of-work-manager" tabindex="-1"> Unit of Work Manager</h1>
<h2 id="use-freesql-s-repository-transaction-in-asp-net-core" tabindex="-1"> Use FreeSql's repository transaction in ASP.NET Core</h2>
<h4 id="step-1-configure-startup-cs" tabindex="-1"> Step 1: Configure Startup.cs</h4>
<p>Install NuGet packages:</p>
<div><pre><code>dotnet <span>add</span> package FreeSql
dotnet <span>add</span> package FreeSql.DbContext
dotnet <span>add</span> package FreeSql.Provider.MySqlConnector
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>Configure <code>Startup.cs</code>:</p>
<div><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  <span>IConfigurationSection</span> Mysql <span>=</span> Configuration<span>.</span><span>GetSection</span><span>(</span><span>"Mysql"</span><span>)</span><span>;</span>
        Fsql <span>=</span> <span>new</span> <span>FreeSqlBuilder</span><span>(</span><span>)</span>
            <span>.</span><span>UseConnectionString</span><span>(</span>DataType<span>.</span>MySql<span>,</span> Mysql<span>.</span>Value<span>)</span>
            <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span>
            <span>.</span><span>UseNameConvert</span><span>(</span>NameConvertType<span>.</span>PascalCaseToUnderscoreWithLower<span>)</span>
            <span>.</span><span>UseMonitorCommand</span><span>(</span>cmd <span>=></span> Trace<span>.</span><span>WriteLine</span><span>(</span>cmd<span>.</span>CommandText<span>)</span><span>)</span>
            <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
    services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>fsql<span>)</span><span>;</span>
    services<span>.</span><span><span>AddScoped</span><span><span>&lt;</span>UnitOfWorkManager<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    services<span>.</span><span>AddFreeRepository</span><span>(</span><span>null</span><span>,</span> <span>typeof</span><span>(</span><span>Startup</span><span>)</span><span>.</span>Assembly<span>)</span><span>;</span>
    <span>//Add your own service, here is only an implementation</span>
    services<span>.</span><span><span>AddScoped</span><span><span>&lt;</span>TransBlogService<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>Update your <code>appsettings.json</code>:</p>
<div><pre><code><span>{</span>
  <span>"Mysql"</span><span>:</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=ovov_freesql_repository;Charset=utf8;SslMode=none;Max pool size=10"</span><span>,</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><table>
<thead>
<tr>
<th>UnitOfWorkManager Members</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>IUnitOfWork Current</td>
<td>Return the current unit of work</td>
</tr>
<tr>
<td>void Binding(repository)</td>
<td>Hand over repository transaction to ir for management</td>
</tr>
<tr>
<td>IUnitOfWork Begin(propagation, isolationLevel)</td>
<td>Create unit of work</td>
</tr>
</tbody>
</table>
<ul>
<li>TransBlogService.cs</li>
</ul>
<div><pre><code><span>private</span> <span>readonly</span> <span>IBaseRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span> _blogRepository<span>;</span>
<span>private</span> <span>readonly</span> <span>IBaseRepository<span>&lt;</span>Tag<span>,</span> <span>int</span><span>></span></span> _tagRepository<span>;</span>
<span>private</span> <span>readonly</span> <span>UnitOfWorkManager</span> _unitOfWorkManager<span>;</span>

<span>public</span> <span>TransBlogService</span><span>(</span><span>IBaseRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span> blogRepository<span>,</span> <span>IBaseRepository<span>&lt;</span>Tag<span>,</span> <span>int</span><span>></span></span> tagRepository<span>,</span><span>UnitOfWorkManager</span> unitOfWorkManager<span>)</span>
<span>{</span>
    _blogRepository <span>=</span> blogRepository <span>;</span>
    _tagRepository <span>=</span> tagRepository <span>;</span>
    _unitOfWorkManager <span>=</span> unitOfWorkManager<span>;</span>
<span>}</span>

<span>public</span> <span>async</span> <span>Task</span> <span>CreateBlogUnitOfWorkAsync</span><span>(</span><span>Blog</span> blog<span>,</span>List<span>&lt;</span>Tag<span>></span>tagList<span>)</span>
<span>{</span>
    <span>using</span> <span>(</span><span>IUnitOfWork</span> unitOfWork <span>=</span> _unitOfWorkManager<span>.</span><span>Begin</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        <span>try</span>
        <span>{</span>
            <span>await</span> _blogRepository<span>.</span><span>InsertAsync</span><span>(</span>blog<span>)</span><span>;</span>
            tagList<span>.</span><span>ForEach</span><span>(</span>r <span>=></span>
            <span>{</span>
                r<span>.</span>PostId <span>=</span> blog<span>.</span>Id<span>;</span>
            <span>}</span><span>)</span><span>;</span>
            <span>await</span> _tagRepository<span>.</span><span>InsertAsync</span><span>(</span>tagList<span>)</span><span>;</span>
            unitOfWork<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
        <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span>
        <span>{</span>     
            <span>//Actually, Rollback may not be used. </span>
            <span>//Because the internal Dispose of IUnitOfWork will roll back the transaction without Commit. </span>
            <span>//But here can be Rollback in advance.</span>
        
            unitOfWork<span>.</span><span>Rollback</span><span>(</span><span>)</span><span>;</span>
            <span>//Log, </span>
            <span>//or use throw to continue throwing exceptions upwards</span>
        <span>}</span>
    <span>}</span>
<span>}</span>

<span>public</span> <span>async</span> <span>Task</span> <span>UpdateBlogAsync</span><span>(</span><span><span>int</span></span> id<span>)</span>
<span>{</span>
    <span>using</span> <span>(</span><span>IUnitOfWork</span> unitOfWork <span>=</span> _unitOfWorkManager<span>.</span><span>Begin</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        <span>try</span>
        <span>{</span>
            <span>Blog</span> blog <span>=</span> _blogRepository<span>.</span>Select<span>.</span><span>Where</span><span>(</span>r <span>=></span> r<span>.</span>Id <span>==</span> id<span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>
            blog<span>.</span>IsDeleted <span>=</span> <span>true</span><span>;</span>
            <span>await</span> _blogRepository<span>.</span><span>UpdateAsync</span><span>(</span>blog<span>)</span><span>;</span>
            unitOfWork<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
        <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span>
        <span>{</span>
            <span>//Log, </span>
            <span>//or use throw to continue throwing exceptions upwards</span>
            unitOfWork<span>.</span><span>Rollback</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br></div></div><table>
<thead>
<tr>
<th>IUnitOfWork Members</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>IFreeSql Orm</td>
<td>The object Select/Delete/Insert/Update/InsertOrUpdate is consistent with the unit of work transaction and can be omitted to pass WithTransaction</td>
</tr>
<tr>
<td>DbTransaction GetOrBeginTransaction()</td>
<td>Open the transaction, or return to the opened transaction</td>
</tr>
<tr>
<td>void Commit()</td>
<td>Commit transaction</td>
</tr>
<tr>
<td>void Rollback()</td>
<td>Rollback transaction</td>
</tr>
<tr>
<td>DbContext.EntityChangeReport EntityChangeReport</td>
<td>Entity change tracking within the unit of work</td>
</tr>
</tbody>
</table>
<h4 id="complete-code" tabindex="-1"> Complete code</h4>
<ul>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/ORM/FreeSql/OvOv.Core/Domain/Blog.cs" target="_blank" rel="noopener noreferrer">Blog.cs</a></li>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/ORM/FreeSql/OvOv.Core/Domain/Tag.cs" target="_blank" rel="noopener noreferrer">Tag.cs</a></li>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/ORM/FreeSql/OvOv.FreeSql.AutoFac.DynamicProxy/Services/TransBlogService.cs" target="_blank" rel="noopener noreferrer">TransBlogService.cs</a></li>
</ul>
<p>The above uses generic repository.</p>
<p>If you want to rewrite a repository, how do you keep the same transaction as <code>UnitOfWorkManager</code>? You can inherit the existing <code>DefaultRepository&lt;,&gt;</code> and implement a custom repository <code>BlogRepository.cs</code>:</p>
<div><pre><code>    <span>public</span> <span>class</span> <span>BlogRepository</span> <span>:</span> <span><span>DefaultRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span><span>,</span> <span>IBlogRepository</span></span>
    <span>{</span>
        <span>public</span> <span>BlogRepository</span><span>(</span><span>UnitOfWorkManager</span> uowm<span>)</span> <span>:</span> <span>base</span><span>(</span>uowm<span>?.</span>Orm<span>,</span> uowm<span>)</span>
        <span>{</span>
        <span>}</span>

        <span>public</span> <span>List<span>&lt;</span>Blog<span>></span></span> <span>GetBlogs</span><span>(</span><span>)</span>
        <span>{</span>
            <span>return</span> Select<span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>The interface is <code>IBlogRepository.cs</code>:</p>
<div><pre><code>    <span>public</span> <span>interface</span> <span>IBlogRepository</span> <span>:</span> <span><span>IBaseRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span></span>
    <span>{</span>
        <span>List<span>&lt;</span>Blog<span>></span></span> <span>GetBlogs</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>Inject this service in <code>startup.cs</code></p>
<div><pre><code>    services<span>.</span><span><span>AddScoped</span><span><span>&lt;</span>IBlogRepository<span>,</span> BlogRepository<span>></span></span></span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Unit of Work</title>
      <link>http://freesql.net/en/guide/Unit-of-Work.html</link>
      <guid>http://freesql.net/en/guide/Unit-of-Work.html</guid>
      <source url="http://freesql.net/rss.xml">Unit of Work</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="unit-of-work" tabindex="-1"> Unit of Work</h1>
<p>Unit of work can put multiple repositories into one unit for internal management and execution, and finally execute all operations through <code>Commit</code>. Unit of work internally uses database transactions.</p>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>//Automatically synchronize the entity structure to the database.</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> 
    <span>//Be sure to define as singleton mode</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> 
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="usage" tabindex="-1"> Usage</h2>
<div><pre><code><span>using</span> <span>(</span><span><span>var</span></span> uow <span>=</span> fsql<span>.</span><span>CreateUnitOfWork</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
  <span><span>var</span></span> songRepo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
  <span><span>var</span></span> userRepo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span><span>;</span>
  songRepo<span>.</span>UnitOfWork <span>=</span> uow<span>;</span> <span>//Manually bind unit of work</span>
  userRepo<span>.</span>UnitOfWork <span>=</span> uow<span>;</span>

  songRepo<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Song</span><span>(</span><span>)</span><span>)</span><span>;</span>
  userRepo<span>.</span><span>Update</span><span>(</span><span>..</span><span>.</span><span>)</span><span>;</span>

  uow<span>.</span>Orm<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Song</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
  <span>//Note: uow.Orm and fsql are both IFreeSql</span>
  <span>//uow.Orm CRUD and uow are the same transaction (understood as temporary IFreeSql)</span>
  <span>//fsql CRUD and uow are not in the same transaction</span>

  uow<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><p>Reference: <a href="https://github.com/dotnetcore/FreeSql/issues/289" target="_blank" rel="noopener noreferrer">Use TransactionalAttribute + UnitOfWorkManager in ASP.NET Core to achieve multiple transaction propagation</a></p>
<h2 id="interface-definition" tabindex="-1"> Interface Definition</h2>
<p>The <code>uow.GetOrBeginTransaction()</code> method can get the transaction object.</p>
<div><pre><code><span>public</span> <span>interface</span> <span>IUnitOfWork</span> <span>:</span> <span><span>IDisposable</span></span>
<span>{</span>
  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// The object Select/Delete/Insert/Update/InsertOrUpdate is consistent with the unit of work transaction and can be omitted to pass WithTransaction</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span>IFreeSql</span> Orm <span>{</span> <span>get</span><span>;</span> <span>}</span>

  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// Open the transaction, or return to the opened transaction</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span>/// <span><span><span>&lt;</span>param</span> <span>name</span><span><span>=</span><span>"</span>isCreate<span>"</span></span><span>></span></span>If the transaction is not opened, then open<span><span><span>&lt;/</span>param</span><span>></span></span></span>
  <span>/// <span><span><span>&lt;</span>returns</span><span>></span></span><span><span><span>&lt;/</span>returns</span><span>></span></span></span>
  <span>DbTransaction</span> <span>GetOrBeginTransaction</span><span>(</span><span><span>bool</span></span> isCreate <span>=</span> <span>true</span><span>)</span><span>;</span>

  <span>IsolationLevel<span>?</span></span> IsolationLevel <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span><span>void</span></span> <span>Commit</span><span>(</span><span>)</span><span>;</span>

  <span><span>void</span></span> <span>Rollback</span><span>(</span><span>)</span><span>;</span>

  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// Entity change tracking within the unit of work</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span>DbContext<span>.</span>EntityChangeReport</span> EntityChangeReport <span>{</span> <span>get</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div><h2 id="entity-changing-event" tabindex="-1"> Entity Changing Event</h2>
<p>Global Settings:</p>
<div><pre><code>fsql<span>.</span><span>SetDbContextOptions</span><span>(</span>opt <span>=></span> <span>{</span>
  opt<span>.</span>OnEntityChange <span>=</span> report <span>=></span> <span>{</span>
    Console<span>.</span><span>WriteLine</span><span>(</span>report<span>)</span><span>;</span>
  <span>}</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>Individual Settings:</p>
<div><pre><code><span><span>var</span></span> uow <span>=</span> fsql<span>.</span><span>CreateUnitOfWork</span><span>(</span><span>)</span><span>;</span>
uow<span>.</span>OnEntityChange <span>=</span> report <span>=></span> <span>{</span>
  Console<span>.</span><span>WriteLine</span><span>(</span>report<span>)</span><span>;</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>The parameter <code>report</code> is a list collection, and the type of the collection elements is defined as follows:</p>
<div><pre><code><span>public</span> <span>class</span> <span>ChangeInfo</span> <span>{</span>
  <span>public</span> <span><span>object</span></span> Object <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>EntityChangeType</span> Type <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// When Type = Update, get the object before the update</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span>public</span> <span><span>object</span></span> BeforeObject <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>enum</span> <span>EntityChangeType</span> <span>{</span> Insert<span>,</span> Update<span>,</span> Delete<span>,</span> SqlRaw <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><table>
<thead>
<tr>
<th>Type of Change</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Insert</td>
<td>The entity object is inserted</td>
</tr>
<tr>
<td>Update</td>
<td>The entity object is updated</td>
</tr>
<tr>
<td>Delete</td>
<td>The entity object is deleted</td>
</tr>
<tr>
<td>SqlRaw</td>
<td>SQL statement executed</td>
</tr>
</tbody>
</table>
<p>SqlRaw currently has two special features:</p>
<ul>
<li>When the navigation properties are updated in the many-to-many cascade, delete the relevant data in the intermediate table.</li>
<li>The common repository <code>BaseRepository</code> has a Delete method, and the parameter is an expression, not an entity.</li>
</ul>
<div><pre><code><span><span>int</span></span> <span>Delete</span><span>(</span><span>Expression<span>&lt;</span>Func<span>&lt;</span>TEntity<span>,</span> <span>bool</span><span>></span><span>></span></span> predicate<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p><code>DbContext.SaveChanges</code> or Repository's Insert/Update/Delete method of the entity, or <code>UnitOfWork.Commit</code> operation will trigger this event at most once.</p>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Tenant">《Tenant》</a></li>
<li><a href="Using-Read-Write-Separation">《Using Read/Write Separation》</a></li>
<li><a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Aspect-Oriented-Programming">《AOP》</a></li>
<li><a href="Batabase-Context">《DbContext》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Update</title>
      <link>http://freesql.net/en/guide/Update-Data.html</link>
      <guid>http://freesql.net/en/guide/Update-Data.html</guid>
      <source url="http://freesql.net/rss.xml">Update</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="update" tabindex="-1"> Update</h1>
<p>FreeSql provides a variety of database update functions. It supports single or batch updates, and can also return updated records when executed in a specific database.</p>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//Automatically synchronize the entity structure to the database.</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//Be sure to define as singleton mode</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><h2 id="dynamic-conditions" tabindex="-1"> Dynamic Conditions</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span><span>object</span></span> dywhere<span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p><code>dywhere</code> supports:</p>
<ul>
<li>Primary key</li>
<li><code>new[] { PrimaryKey1, PrimaryKey2 }</code></li>
<li>Topic Object</li>
<li><code>new[] { TopicObject1, TopicObject2 }</code></li>
<li><code>new { id = 1 }</code></li>
</ul>
<h2 id="_1-update-the-specified-column" tabindex="-1"> 1. Update the specified column</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>1</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>,</span> DateTime<span>.</span>Now<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `CreateTime` = '2018-12-08 00:04:59' </span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><blockquote>
<p>Support multiple calls to <code>Set()</code>, which is equivalent to splicing Sql statements.</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>1</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Clicks <span>+</span> <span>1</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Time <span>==</span> DateTime<span>.</span>Now<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Clicks` = ifnull(`Clicks`,0) + 1, `Time` = now() </span>
<span>//WHERE (`Id` = 1)</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>1</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> <span>new</span> <span>Topic</span>
  <span>{</span>
    Clicks <span>=</span> a<span>.</span>Clicks <span>+</span> <span>1</span><span>,</span>
    Time <span>=</span> DateTime<span>.</span>Now
  <span>}</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Clicks` = ifnull(`Clicks`,0) + 1, `Time` = now() </span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></div></div><h2 id="_2-update-conditions" tabindex="-1"> 2. Update Conditions</h2>
<blockquote>
<p>In addition to the <code>dywhere</code> parameter described above, it also supports the <code>Where lambda/sql</code> method</p>
</blockquote>
<blockquote>
<p>For safety reasons, when there are no conditions, the update action will not be executed to avoid updating the entire table data by mistake. Update the entire table data: <code>fsql.Update&lt;T&gt;().Where(&quot;1=1&quot;).Set(a =&gt; a.Xxx == xxx).ExecuteAffrows()</code></p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>,</span> <span>"New Title"</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Time<span>,</span> DateTime<span>.</span>Now<span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = @p_0, `Time` = @p_1 </span>
<span>//WHERE (Id = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="_3-update-the-entity" tabindex="-1"> 3. Update the Entity</h2>
<p>Method 1: (recommended)</p>
<blockquote>
<p>Only update the changed properties (depend on <code>FreeSql.Repository</code> package)</p>
</blockquote>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> item <span>=</span> repo<span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>  <span>//Snapshot item at this time</span>
item<span>.</span>Title <span>=</span> <span>"newtitle"</span><span>;</span>
repo<span>.</span><span>Update</span><span>(</span>item<span>)</span><span>;</span> <span>//Compare the changes before and after the snapshot.</span>
<span>//UPDATE `Topic` SET `Title` = @p_0</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><blockquote>
<p>Do you think it’s verbose to query first and then update?</p>
</blockquote>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> item <span>=</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span> <span>}</span><span>;</span>
repo<span>.</span><span>Attach</span><span>(</span>item<span>)</span><span>;</span> <span>//Snapshot item at this time</span>
item<span>.</span>Title <span>=</span> <span>"newtitle"</span><span>;</span>
repo<span>.</span><span>Update</span><span>(</span>item<span>)</span><span>;</span> <span>//Compare the changes before and after the snapshot.</span>
<span>//UPDATE `Topic` SET `Title` = @p_0</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>Method 2: (Original)</p>
<div><pre><code><span>//v1.5.0 Ignore properties that update null values</span>
fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSourceIgnore</span><span>(</span>item<span>,</span> col <span>=></span> col <span>==</span> <span>null</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span><span>var</span></span> item <span>=</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span><span>,</span> Title <span>=</span> <span>"newtitle"</span> <span>}</span><span>;</span>
fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>item<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Clicks` = @p_0, `Title` = @p_1, `CreateTime` = @p_2 </span>
<span>//WHERE (`Id` = 1)</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>item<span>)</span>
  <span>.</span><span>UpdateColumns</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Title<span>,</span> a<span>.</span>CreateTime <span>}</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = @p_0, `CreateTime` = @p_1 </span>
<span>//WHERE (`Id` = 1)</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>item<span>)</span>
  <span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Clicks<span>,</span> a<span>.</span>CreateTime <span>}</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = @p_0 </span>
<span>//WHERE (`Id` = 1)</span>

<span><span>var</span></span> items <span>=</span> <span>new</span> <span>List<span>&lt;</span>Topic<span>></span></span><span>(</span><span>)</span><span>;</span>
<span>for</span> <span>(</span><span><span>var</span></span> a <span>=</span> <span>0</span><span>;</span> a <span>&lt;</span> <span>10</span><span>;</span> a<span>++</span><span>)</span> items<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> a <span>+</span> <span>1</span><span>,</span> Title <span>=</span> <span><span>$"newtitle</span><span><span>{</span><span>a</span><span>}</span></span><span>"</span></span><span>,</span> Clicks <span>=</span> a <span>*</span> <span>100</span> <span>}</span><span>)</span><span>;</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>items<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Clicks` = CASE `Id` WHEN 1 THEN @p_0 WHEN 2 THEN @p_1 WHEN 3 THEN @p_2 WHEN 4 THEN @p_3 WHEN 5 THEN @p_4 WHEN 6 THEN @p_5 WHEN 7 THEN @p_6 WHEN 8 THEN @p_7 WHEN 9 THEN @p_8 WHEN 10 THEN @p_9 END, </span>
<span>//`Title` = CASE `Id` WHEN 1 THEN @p_10 WHEN 2 THEN @p_11 WHEN 3 THEN @p_12 WHEN 4 THEN @p_13 WHEN 5 THEN @p_14 WHEN 6 THEN @p_15 WHEN 7 THEN @p_16 WHEN 8 THEN @p_17 WHEN 9 THEN @p_18 WHEN 10 THEN @p_19 END, </span>
<span>//`CreateTime` = CASE `Id` WHEN 1 THEN @p_20 WHEN 2 THEN @p_21 WHEN 3 THEN @p_22 WHEN 4 THEN @p_23 WHEN 5 THEN @p_24 WHEN 6 THEN @p_25 WHEN 7 THEN @p_26 WHEN 8 THEN @p_27 WHEN 9 THEN @p_28 WHEN 10 THEN @p_29 END </span>
<span>//WHERE (`Id` IN (1,2,3,4,5,6,7,8,9,10))</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>items<span>)</span>
  <span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Clicks<span>,</span> a<span>.</span>CreateTime <span>}</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = CASE `Id` WHEN 1 THEN @p_0 WHEN 2 THEN @p_1 WHEN 3 THEN @p_2 WHEN 4 THEN @p_3 WHEN 5 THEN @p_4 WHEN 6 THEN @p_5 WHEN 7 THEN @p_6 WHEN 8 THEN @p_7 WHEN 9 THEN @p_8 WHEN 10 THEN @p_9 END </span>
<span>//WHERE (`Id` IN (1,2,3,4,5,6,7,8,9,10))</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>items<span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>,</span> DateTime<span>.</span>Now<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `CreateTime` = @p_0 </span>
<span>//WHERE (`Id` IN (1,2,3,4,5,6,7,8,9,10))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br></div></div><blockquote>
<p>After the specified <code>Set</code> column is updated, <code>SetSource</code> will become invalid</p>
</blockquote>
<h2 id="_4-custom-sql" tabindex="-1"> 4. Custom SQL</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetRaw</span><span>(</span><span>"Title = @title"</span><span>,</span> <span>new</span> <span>{</span> title <span>=</span> <span>"New Title"</span> <span>}</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span><span>"Id = @id"</span><span>,</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET Title = @title WHERE (Id = @id)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="_5-update-according-to-the-dto" tabindex="-1"> 5. Update According to the DTO</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetDto</span><span>(</span><span>new</span> <span>{</span> title <span>=</span> <span>"xxx"</span><span>,</span> clicks <span>=</span> <span>2</span> <span>}</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = @p_0, `Clicks` = @p_1 WHERE (Id = 1)</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetDto</span><span>(</span><span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span> <span>{</span> <span>[</span><span>"title"</span><span>]</span> <span>=</span> <span>"xxx"</span><span>,</span> <span>[</span><span>"clicks"</span><span>]</span> <span>=</span> <span>2</span> <span>}</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h2 id="_6-the-difference-between-set-setsource-and-setdto" tabindex="-1"> 6. The difference between Set, SetSource and SetDto</h2>
<p>The three of them are functions of the same level, corresponding to:</p>
<ul>
<li>
<p><code>Set/SetRaw</code> is used when the entity is known, corresponding to <code>update t set x = x</code></p>
</li>
<li>
<p><code>SetSource</code> updates the entire entity, you can use <code>UpdateColumns</code> and/or <code>IgnoreColumns</code> to specify or ignore fields</p>
</li>
<li>
<p><code>SetDto</code> is a batch operation of <code>Set</code></p>
</li>
</ul>
<h2 id="_7、dictionary-update" tabindex="-1"> 7、Dictionary Update</h2>
<div><pre><code><span><span>var</span></span> dic <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"id"</span><span>,</span> <span>1</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"name"</span><span>,</span> <span>"xxxx"</span><span>)</span><span>;</span>

fsql<span>.</span><span>UpdateDict</span><span>(</span>dic<span>)</span><span>.</span><span>AsTable</span><span>(</span><span>"table1"</span><span>)</span><span>.</span><span>WherePrimary</span><span>(</span><span>"id"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="_8-optimistic-lock" tabindex="-1"> 8. Optimistic Lock</h2>
<p>When updating the entire entity data, it is very easy to cause the old data to update the new record in the case of concurrency.</p>
<p>The principle of optimistic locking: use a certain field of the entity, such as <code>long version</code>. Query the data before updating, and then <code>version</code> is <code>1</code>. The SQL generated during the update will append <code>where version = 1</code>, and an exception (DbUpdateVersionException) will be thrown when the modification fails (ie, <code>Affrows == 0</code>).</p>
<p>Each entity only supports one optimistic lock attribute, mark the attribute before the property: <code>[Column(IsVersion = true)]</code>.</p>
<blockquote>
<p>Applicable to SetSource update, the value of <code>version</code> will increase by <code>1</code> each time it is updated.</p>
</blockquote>
<h2 id="_9-pessimistic-lock" tabindex="-1"> 9. Pessimistic Lock</h2>
<div><pre><code><span><span>var</span></span> user <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>ForUpdate</span><span>(</span><span>true</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT ... FROM User a for update nowait</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p><code>ForUpdate</code> is a common way of writing in Oracle/PostgreSQL/MySql. We have made a special adaptation to SqlServer. The SQL statements executed are roughly as follows:</p>
<div><pre><code><span>SELECT</span> <span>.</span><span>.</span><span>.</span> <span>FROM</span> <span>[</span><span>User</span><span>]</span> a <span>With</span><span>(</span>UpdLock<span>,</span> RowLock<span>,</span> NoWait<span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="_10-advanced-update-iselect-toupdate" tabindex="-1"> 10. Advanced Update: <code>ISelect.ToUpdate</code></h2>
<p><code>IUpdate</code> does not support navigation objects, multi-table association, etc. by default. <code>ISelect.ToUpdate</code> can convert the query to <code>IUpdate</code> to update the data using the navigation object, as follows:</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T1<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Options<span>.</span>xxx <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ToUpdate</span><span>(</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>,</span> <span>"111"</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>Note: This method is not to query the data to the memory and then update, the above code produces the following SQL execution:</p>
<div><pre><code><span>UPDATE</span> <span><span>`</span>T1<span>`</span></span> <span>SET</span> Title <span>=</span> <span>'111'</span> <span>WHERE</span> id <span>in</span> <span>(</span><span>select</span> a<span>.</span>id <span>from</span> T1 a <span>left</span> <span>join</span> Options b <span>on</span> b<span>.</span>t1id <span>=</span> a<span>.</span>id <span>where</span> b<span>.</span>xxx <span>=</span> <span>1</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>The benefits of using this program for dang complex update:</p>
<ul>
<li>Data can be previewed before updating to prevent wrong update operations;</li>
<li>Support complex update operations, for example: Use <code>Limit(10)</code> on <code>ISelect</code> to update the first 10 records that meet the conditions;</li>
</ul>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Database-Transaction">《Database Transaction》</a></li>
<li><a href="Insert-Data">《FreeSql 101, Part 1: Insert Data》</a></li>
<li><a href="Delete-Data">《FreeSql 101, Part 2: Delete Data》</a></li>
<li><a href="Query-Data">《FreeSql 101, Part 4: Query Data》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Unit-of-Work">《UnitOfWork》</a></li>
</ul>
<h1 id="api" tabindex="-1"> API</h1>
<table>
<thead>
<tr>
<th>Methods</th>
<th>Return</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SetSource</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>Update data, set updated entity</td>
</tr>
<tr>
<td>IgnoreColumns</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Ignored columns</td>
</tr>
<tr>
<td>Set</td>
<td>&lt;this&gt;</td>
<td>Lambda, value</td>
<td>Set the new value of the column <code>Set(a =&gt; a.Name, &quot;newvalue&quot;)</code></td>
</tr>
<tr>
<td>Set</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Set the new value of the column based on the original value  <code>Set(a =&gt; a.Clicks + 1)</code>, which is equivalent to <code>clicks=clicks+1</code></td>
</tr>
<tr>
<td>SetDto</td>
<td>&lt;this&gt;</td>
<td>object</td>
<td>Update according to DTO</td>
</tr>
<tr>
<td>SetRaw</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Set value, custom SQL syntax <code>SetRaw(&quot;title = @title&quot;, new {title = &quot;newtitle&quot; })</code></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>Expression conditions, only support entity members (not including navigation objects)</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>Raw SQL syntax conditions <code>Where(&quot;id = @id&quot;, new {id = 1 })</code></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>Pass in the entity or collection, and use its primary key as the condition</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>Command timeout setting (seconds)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>Set transaction object</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>Set the connection object</td>
</tr>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>Return the SQL statement to be executed</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>long</td>
<td></td>
<td>Execute SQL statement and return the number of rows affected</td>
</tr>
<tr>
<td>ExecuteUpdated</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>Execute SQL statement and return the updated record</td>
</tr>
</tbody>
</table>
]]></content:encoded>
    </item>
    <item>
      <title>withsql</title>
      <link>http://freesql.net/en/guide/With-Sql.html</link>
      <guid>http://freesql.net/en/guide/With-Sql.html</guid>
      <source url="http://freesql.net/rss.xml">withsql</source>
      <pubDate>Sun, 21 Nov 2021 08:13:16 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="withsql" tabindex="-1"> withsql</h1>
<h1 id="use-custom-sql-statements" tabindex="-1"> Use Custom SQL Statements</h1>
<p>Define entity class:</p>
<div><pre><code>    <span>public</span> <span>class</span> <span>TestClass</span>
    <span>{</span>
        <span>[</span><span><span>Column</span><span><span>(</span>Name <span>=</span> <span>"ID"</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> No <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>int</span><span>?</span></span> Age <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>[</span><span><span>Column</span><span><span>(</span>Name <span>=</span> <span>"BIRTH_DAY"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span>DateTime<span>?</span></span> Birthday <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>decimal</span></span> Point <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>Sex<span>?</span></span> Sex <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
    <span>public</span> <span>enum</span> <span>Sex</span>
    <span>{</span>
        Boy<span>,</span>
        Girl
    <span>}</span>
    <span>public</span> <span>class</span> <span>TestClssDto</span>
    <span>{</span>
        <span>public</span> <span><span>string</span></span> ID <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

        <span>public</span> <span><span>int</span><span>?</span></span> Age <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

        <span>public</span> <span>DateTime<span>?</span></span> Birthday <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br></div></div><p>Different query results:</p>
<ul>
<li>Return to <code>DataTable</code>.</li>
<li>Return <code>List&lt;Tuplue&gt;</code> i.e. <code>List&lt;(string,string)&gt;</code> tuple.</li>
<li>Return <code>List&lt;object&gt;</code> and support paging.</li>
<li>Return <code>List&lt;TestClassDto&gt;</code> and support paging.</li>
</ul>
<h3 id="return-to-datatable-with-specified-columns" tabindex="-1"> Return to DataTable with specified columns</h3>
<div><pre><code><span>DataTable</span> dt1 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
	<span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
	<span>.</span><span>ToDataTable</span><span>(</span><span>"ID,Age"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><div><pre><code><span>SELECT</span> ID<span>,</span>Age 
	<span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="return-to-datatable-with-all-columns" tabindex="-1"> Return to DataTable with all columns</h3>
<div><pre><code><span>DataTable</span> dt2 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
	<span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
	<span>.</span><span>ToDataTable</span><span>(</span><span>"*"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><div><pre><code><span>SELECT</span> <span>*</span> 
<span>FROM</span> <span>(</span> <span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="return-list-tuple-i-e-list-string-string" tabindex="-1"> Return List&lt;Tuple&gt; (i.e. List&lt;(string, string)&gt;)</h3>
<div><pre><code><span>List<span>&lt;</span><span>(</span><span>string</span><span>,</span><span>string</span><span>)</span><span>></span></span> list1 <span>=</span> _fsql
    <span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
	<span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
	<span>.</span><span><span>ToList</span><span><span>&lt;</span><span>(</span><span>string</span><span>,</span> <span>string</span><span>)</span><span>></span></span></span><span>(</span><span>"ID,Age"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span>SELECT</span> ID<span>,</span> Age
	<span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="return-list-object" tabindex="-1"> Return List&lt;object&gt;</h3>
<div><pre><code><span><span>var</span></span> list2 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
	<span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
	<span>.</span><span><span>ToList</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>"*"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><div><pre><code><span>SELECT</span> <span>*</span>
	<span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="return-list-object-and-support-paging" tabindex="-1"> Return List&lt;object&gt; and support paging</h3>
<div><pre><code>  <span><span>var</span></span> list3 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
	<span>.</span><span>WhereIf</span><span>(</span><span>true</span><span>,</span> <span>"1=1"</span><span>)</span>
	<span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span><span>.</span><span>OrderBy</span><span>(</span><span>"ID DESC"</span><span>)</span>
	<span>.</span><span><span>ToList</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>"ID,Age"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><div><pre><code><span>SELECT</span> ID<span>,</span> Age
	<span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
	<span>WHERE</span><span>(</span><span>1</span> <span>=</span> <span>1</span><span>)</span>
	<span>ORDER</span> <span>BY</span> ID <span>DESC</span>
	<span>limit</span> <span>0</span><span>,</span><span>10</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h3 id="return-list-testclassdto-and-support-paging" tabindex="-1"> Return List&lt;TestClassDto&gt; and support paging</h3>
<div><pre><code><span><span>var</span></span> list4 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
	<span>.</span><span>WhereIf</span><span>(</span><span>true</span><span>,</span> <span>"1=1"</span><span>)</span>
	<span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
	<span>.</span><span>OrderBy</span><span>(</span><span>"ID DESC"</span><span>)</span>
	<span>.</span><span><span>ToList</span><span><span>&lt;</span>TestClssDto<span>></span></span></span><span>(</span><span>"ID,Age,BIRTH_DAY as Birthday"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><div><pre><code><span>SELECT</span> ID<span>,</span> Age<span>,</span>BIRTH_DAY <span>as</span> Birthday
	<span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
	<span>WHERE</span><span>(</span><span>1</span> <span>=</span> <span>1</span><span>)</span>
	<span>ORDER</span> <span>BY</span> ID <span>DESC</span>
	<span>limit</span> <span>0</span><span>,</span><span>10</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="withsql-tosql-union-all" tabindex="-1"> WithSql+ ToSQL = Union ALL</h2>
<h3 id="two-stage-iselect-query-use-withsql-multiple-times-to-convert-to-union-all-query" tabindex="-1"> Two-Stage ISelect Query: Use WithSql Multiple Times to Convert to UNION ALL Query</h3>
<p>After using <code>WithSql</code> multiple times, a query statement based on <code>UNION ALL</code> will be generated. So we can use <code>ISelect.ToSql(FieldAliasOptions.AsProperty)</code> to get the generated SQL as follows:</p>
<div><pre><code><span><span>var</span></span> sql1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"xxx"</span><span>)</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> sql2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"yyy"</span><span>)</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span>sql1<span>)</span>
    <span>.</span><span>WithSql</span><span>(</span>sql2<span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><div><pre><code><span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span> 
<span>FROM</span> <span>(</span> <span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span> 
    <span>FROM</span> <span><span>`</span>tb_topic<span>`</span></span> a 
    <span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>LIKE</span> <span>'%xxx%'</span><span>)</span> <span>)</span> a<span>)</span> ftb
 
<span>UNION</span> <span>ALL</span>
 
<span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span> 
<span>FROM</span> <span>(</span> <span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span> 
    <span>FROM</span> <span><span>`</span>tb_topic<span>`</span></span> a 
    <span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>LIKE</span> <span>'%yyy%'</span><span>)</span> <span>)</span> a<span>)</span> ftb
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h3 id="cross-sub-table-query-wse-astable-for-the-same-entity-multiple-times-to-convert-to-union-all-query" tabindex="-1"> Cross Sub-Table Query: Wse AsTable for the Same Entity Multiple Times to Convert to UNION ALL Query</h3>
<div><pre><code><span><span>var</span></span> sql <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>AsTable</span><span>(</span><span>(</span>type<span>,</span> oldname<span>)</span> <span>=></span> <span>"table_1"</span><span>)</span>
    <span>.</span><span>AsTable</span><span>(</span><span>(</span>type<span>,</span> oldname<span>)</span> <span>=></span> <span>"table_2"</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span>select</span> <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span>"Id"</span> as1 <span>FROM</span> <span>"table_1"</span> a<span>)</span> ftb 
<span>UNION</span> <span>ALL</span>
<span>select</span> <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span>"Id"</span> as1 <span>FROM</span> <span>"table_2"</span> a<span>)</span> ftb 
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h3 id="use-tosql-to-splice-new-sql-statements-and-use-iado-to-execute" tabindex="-1"> Use ToSql to Splice New SQL Statements, And Use IAdo to Execute</h3>
<div><pre><code><span><span>var</span></span> sql1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>></span> <span>100</span> <span>&amp;&amp;</span> a<span>.</span>Id <span>&lt;</span> <span>200</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Id<span>,</span> a<span>.</span>Title <span>}</span><span>,</span> FieldAliasOptions<span>.</span>AsProperty<span>)</span><span>;</span>
<span><span>var</span></span> sql2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>></span> <span>1001</span> <span>&amp;&amp;</span> a<span>.</span>Id <span>&lt;</span> <span>1200</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Id<span>,</span> a<span>.</span>Title <span>}</span><span>,</span> FieldAliasOptions<span>.</span>AsProperty<span>)</span><span>;</span>

fsql<span>.</span>Ado<span>.</span><span>CommandFluent</span><span>(</span><span><span>$"</span><span><span>{</span><span>sql1</span><span>}</span></span><span> UNION ALL </span><span><span>{</span><span>sql2</span><span>}</span></span><span>"</span></span><span>)</span>
    <span>.</span><span>ExecuteDataTable</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="paging-problem" tabindex="-1"> Paging Problem</h2>
<p>After using <code>UNION ALL</code>, there will be a problem if you paginate directly. Please see the specific example:</p>
<p>There is a problem with using WithSql + Page multiple times: There is a paging statement in each WithSql</p>
<div><pre><code><span><span>var</span></span> sql1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"xxx"</span><span>)</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> sql2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"yyy"</span><span>)</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>WithSql</span><span>(</span>sql1<span>)</span><span>.</span><span>WithSql</span><span>(</span>sql2<span>)</span><span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>20</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><div><pre><code> <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span> 
<span>FROM</span> <span>(</span> <span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span> 
    <span>FROM</span> <span><span>`</span>tb_topic<span>`</span></span> a 
    <span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>LIKE</span> <span>'%xxx%'</span><span>)</span> <span>)</span> a 
<span>limit</span> <span>0</span><span>,</span><span>20</span><span>)</span> ftb
 
<span>UNION</span> <span>ALL</span>
 
<span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span> 
<span>FROM</span> <span>(</span> <span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span> 
    <span>FROM</span> <span><span>`</span>tb_topic<span>`</span></span> a 
    <span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>LIKE</span> <span>'%yyy%'</span><span>)</span> <span>)</span> a 
<span>limit</span> <span>0</span><span>,</span><span>20</span><span>)</span> ftb

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>After multiple Sql statements are combined with WithSql (and a <code>UNION ALL</code> statement is generated), if you directly use the <code>Page</code> method for paging, it will cause a paging statement to be generated in each sub-table.</p>
<p><code>WithSql</code> can realize the function of sub-table with <code>AsTable</code>. When querying across sub-tables, paging will take effect in each sub-table (that is, each SQL paging in WithSql).</p>
<h3 id="solution-call-withsql-multiple-times" tabindex="-1"> Solution: Call WithSql Multiple Times</h3>
<p>Call WithSql multiple times. If you need to paging, you need to follow the two steps below.</p>
<ul>
<li>Step 1: combine the two Sql statements into one by <code>WithSql</code>:</li>
</ul>
<div><pre><code> <span><span>var</span></span> sql <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
	<span>.</span><span>WithSql</span><span>(</span><span>"SELECT * FROM tb_topic where id > 11"</span><span>)</span>
	<span>.</span><span>WithSql</span><span>(</span><span>"SELECT * FROM tb_topic where id &lt; 10"</span><span>)</span>
	<span>.</span><span>ToSql</span><span>(</span><span>"*"</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>The above code will be generated as a Sql statement using <code>UNION ALL</code>:</p>
<div><pre><code> <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> <span>*</span> 
         <span>FROM</span> <span>(</span> <span>SELECT</span> <span>*</span> <span>FROM</span> tb_topic <span>where</span> id <span>></span> <span>11</span> <span>)</span> a<span>)</span> ftb

         <span>UNION</span> <span>ALL</span>

         <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> <span>*</span> 
         <span>FROM</span> <span>(</span> <span>SELECT</span> <span>*</span> <span>FROM</span> tb_topic <span>where</span> id <span>&lt;</span> <span>10</span> <span>)</span> a<span>)</span> ftb
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><ul>
<li>Step 2: on the basis of the SQL statement containing <code>UNION ALL</code>, page by calling the <code>Page</code> method:</li>
</ul>
<div><pre><code> <span><span>var</span></span> sql2 <span>=</span> g<span>.</span>mysql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
	 <span>.</span><span>WithSql</span><span>(</span>sql<span>)</span>
	 <span>.</span><span>Page</span><span>(</span><span>2</span><span>,</span> <span>10</span><span>)</span>
	 <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
<span>FROM</span> <span>(</span> <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> <span>*</span>
    <span>FROM</span> <span>(</span> <span>SELECT</span> <span>*</span> <span>FROM</span> tb_topic <span>where</span> id <span>></span> <span>11</span> <span>)</span> a<span>)</span> ftb

    <span>UNION</span> <span>ALL</span>

    <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> <span>*</span>
    <span>FROM</span> <span>(</span> <span>SELECT</span> <span>*</span> <span>FROM</span> tb_topic <span>where</span> id <span>&lt;</span> <span>10</span> <span>)</span> a<span>)</span> ftb <span>)</span> a 
<span>limit</span> <span>10</span><span>,</span><span>10</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Getting Started</title>
      <link>http://freesql.net/en/guide/getting-started.html</link>
      <guid>http://freesql.net/en/guide/getting-started.html</guid>
      <source url="http://freesql.net/rss.xml">Getting Started</source>
      <pubDate>Sat, 21 Aug 2021 05:59:59 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="getting-started" tabindex="-1"> Getting Started</h1>
<p>FreeSql is a powerful <strong>.NET ORM</strong> that supports all <em>.NET Standard</em> runtime platforms like <em>.NET Framework 4.0+</em>, <em>.NET Core 2.1+</em> and <em>Xamarin</em>, etc.</p>
<p>FreeSql supports MySql, SqlServer, PostgreSQL, Oracle, Sqlite, Firebird, Dameng, Shentong Database, Kingbase ES(V008R003), Hangao Database, ClickHouse, GBase and MsAccess.</p>
<p>QQ Groups：4336577(full)、8578575(full)、<strong>52508226(available)</strong></p>
<h2 id="models" tabindex="-1"> Models</h2>
<p>FreeSql uses a model to perform data access. The model is represented by an entity class to represent a database table or view for querying and saving data.</p>
<p>The entity model can be generated from an existing database, and FreeSql provides the <code>IDbFirst</code> interface to <a href="DbFirst-Mode">generate the entity model</a>.</p>
<p>Or you can create the model manually, and then create or modify the database based on the model. FreeSql provides an API for the <code>ICodeFirst</code> synchronization structure (it can even be synchronized automatically during the development phase).</p>
<div><pre><code><span>using</span> <span>FreeSql<span>.</span>DataAnnotations</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>

<span>public</span> <span>class</span> <span>Blog</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Url <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Rating <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="packages" tabindex="-1"> Packages</h2>
<p>FreeSql.Provider.XXX (<a href="Install">Optional Providers</a>)</p>
<CodeGroup>
<CodeGroupItem title=".NET CLI">
<div><pre><code>dotnet <span>add</span> package FreeSql
dotnet <span>add</span> package FreeSql.Provider.Sqlite
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div></CodeGroupItem>
<CodeGroupItem title="Package Manager">
<div><pre><code>Install-Package FreeSql
Install-Package FreeSql.Provider.Sqlite
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div></CodeGroupItem>
</CodeGroup>
<h2 id="declaring" tabindex="-1"> Declaring</h2>
<blockquote>
<p>Note: IFreeSql should be declared as a singleton in the project, not created every time it is used.</p>
</blockquote>
<ul>
<li>.NET Core Singleton</li>
</ul>
<CodeGroup>
<CodeGroupItem title=".NET Core 5">
<div><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
    <span>Func<span>&lt;</span>IServiceProvider<span>,</span> IFreeSql<span>></span></span> implementationFreeSql <span>=</span> r <span>=></span>
    <span>{</span>
        <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
        <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>@"Data Source=db1.db"</span><span>)</span>
        <span>.</span><span>UseMonitorCommand</span><span>(</span>cmd <span>=></span> Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$"Sql：</span><span><span>{</span><span>cmd<span>.</span>CommandText</span><span>}</span></span><span>"</span></span><span>)</span><span>)</span>
        <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span>      
        <span>//Automatically synchronize the entity structure to the database.</span>
        <span>//FreeSql will not scan the assembly, and will generate a table if and only when the CRUD instruction is executed.</span>
        <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
        <span>return</span> fsql<span>;</span>
    <span>}</span><span>;</span>
    services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>implementationFreeSql<span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div></CodeGroupItem>
<CodeGroupItem title=".NET 6">
<div><pre><code><span><span>var</span></span> builder <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>;</span>
<span>Func<span>&lt;</span>IServiceProvider<span>,</span> IFreeSql<span>></span></span> implementationFreeSql <span>=</span> r <span>=></span>
<span>{</span>
    <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
        <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>@"Data Source=db1.db"</span><span>)</span>
        <span>.</span><span>UseMonitorCommand</span><span>(</span>cmd <span>=></span> Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$"Sql：</span><span><span>{</span><span>cmd<span>.</span>CommandText</span><span>}</span></span><span>"</span></span><span>)</span><span>)</span>
        <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> 
        <span>//Automatically synchronize the entity structure to the database.</span>
        <span>//FreeSql will not scan the assembly, and will generate a table if and only when the CRUD instruction is executed.</span>
        <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> fsql<span>;</span>
<span>}</span><span>;</span> 
builder<span>.</span>Services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>implementationFreeSql<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div></CodeGroupItem>
</CodeGroup>
<ul>
<li><a href="https://github.com/dotnetcore/FreeSql/issues/44" target="_blank" rel="noopener noreferrer">.NET Core injects multiple FreeSql instances</a></li>
<li>.NET Framework Singleton</li>
</ul>
<div><pre><code><span>public</span> <span>class</span> <span>DB</span>
<span>{</span>
   <span>static</span> Lazy<span>&lt;</span>IFreeSql<span>></span>sqliteLazy <span>=</span> <span>new</span> <span>Lazy<span>&lt;</span>IFreeSql<span>></span></span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
        <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>@"Data Source=db1.db"</span><span>)</span>
        <span>.</span><span>UseMonitorCommand</span><span>(</span>cmd <span>=></span> Trace<span>.</span><span>WriteLine</span><span>(</span><span><span>$"Sql：</span><span><span>{</span><span>cmd<span>.</span>CommandText</span><span>}</span></span><span>"</span></span><span>)</span><span>)</span>
        <span>//Automatically synchronize the entity structure to the database.</span>
        <span>//FreeSql will not scan the assembly, and will generate a table if and only when the CRUD instruction is executed.</span>
        <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span>
        <span>.</span><span>Build</span><span>(</span><span>)</span><span>)</span><span>;</span>

    <span>public</span> <span>static</span> <span>IFreeSql</span> Sqlite <span>=></span> sqliteLazy<span>.</span>Value<span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p>Then when using it, use <code>fsql</code> directly through <code>IFreeSql fsql = DB.Sqlite;</code>.</p>
<p>IFreeSql is the top-level object of ORM, and all operations use its methods or properties:</p>
<div><pre><code>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span> <span>//Query</span>
fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span> <span>//Insert</span>
fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span> <span>//Update</span>
fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span> <span>//Delete</span>
fsql<span>.</span><span><span>InsertOrUpdate</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>// Insert or Update</span>
fsql<span>.</span><span>Transaction</span><span>(</span><span>..</span><span>)</span><span>;</span> <span>//Transaction</span>

fsql<span>.</span>CodeFirst<span>;</span> <span>//CodeFirst Object</span>
fsql<span>.</span>DbFirst<span>;</span> <span>//DbFirst Object</span>
fsql<span>.</span>Ado<span>;</span> <span>//Ado Object</span>
fsql<span>.</span>Aop<span>;</span> <span>//Aop Object</span>
fsql<span>.</span>GlobalFilter<span>;</span> <span>//Gloabl Filter Object</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h2 id="migration" tabindex="-1"> Migration</h2>
<p>When the program is running, <code>FreeSql</code> will check the <code>AutoSyncStructure</code> parameter, and use this condition to determine whether to compare the changes between the entity and the database structure to achieve the purpose of automatic migration. For more information, please refer to the <a href="CodeFirst-Mode">CodeFirst Documentation</a>.</p>
<blockquote>
<p>Note: Use this feature in a production environment with <strong>caution</strong>.</p>
</blockquote>
<blockquote>
<p>Note: Use this feature in a production environment with <strong>caution</strong>.</p>
</blockquote>
<blockquote>
<p>Note: Use this feature in a production environment with <strong>caution</strong>.</p>
</blockquote>
<h2 id="query-data" tabindex="-1"> Query Data</h2>
<div><pre><code><span><span>var</span></span> blogs <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Rating <span>></span> <span>3</span><span>)</span>
    <span>.</span><span>OrderBy</span><span>(</span>b <span>=></span> b<span>.</span>Url<span>)</span>
    <span>.</span><span>Skip</span><span>(</span><span>100</span><span>)</span>
    <span>.</span><span>Limit</span><span>(</span><span>10</span><span>)</span> <span>//Query the record from line 100 to line 110</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="insert-data" tabindex="-1"> Insert Data</h2>
<div><pre><code><span><span>var</span></span> blog <span>=</span> <span>new</span> <span>Blog</span> <span>{</span> Url <span>=</span> <span>"http://sample.com"</span> <span>}</span><span>;</span>
blog<span>.</span>BlogId <span>=</span> <span>(</span><span>int</span><span>)</span>fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>AppendData</span><span>(</span>blog<span>)</span>
    <span>.</span><span>ExecuteIdentity</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="update-data" tabindex="-1"> Update Data</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Set</span><span>(</span>b <span>=></span> b<span>.</span>Url<span>,</span> <span>"http://sample2222.com"</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Url <span>==</span> <span>"http://sample.com"</span><span>)</span>
    <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="delete-data" tabindex="-1"> Delete Data</h2>
<div><pre><code>fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Url <span>==</span> <span>"http://sample.com"</span><span>)</span>
    <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h1 id="freesqlbuilder" tabindex="-1"> FreeSqlBuilder</h1>
<table>
<thead>
<tr>
<th>Methods</th>
<th>Return</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>UseConnectionString</td>
<td>this</td>
<td>Connection string</td>
</tr>
<tr>
<td>UseSlave</td>
<td>this</td>
<td>Set up the slave database, support multipleslace databases.</td>
</tr>
<tr>
<td>UseConnectionFactory</td>
<td>this</td>
<td>Set up a custom database connection object (abandon the built-in object connection pool technology)</td>
</tr>
<tr>
<td>UseAutoSyncStructure</td>
<td>this</td>
<td><strong>[Recommended development environment]</strong> Automatically synchronize the entity structure to the database, and check entity creation or modification table structure during program operation</td>
</tr>
<tr>
<td>UseNoneCommandParameter</td>
<td>this</td>
<td>Do not use command parameterized execution. for <code>Insert/Update</code>, you can also temporarily use <code>IInsert/IUpdate.NoneParameter()</code></td>
</tr>
<tr>
<td>UseGenerateCommandParameterWithLambda</td>
<td>this</td>
<td>For lambda expression analysis, generate command parameterized execution</td>
</tr>
<tr>
<td>UseLazyLoading</td>
<td>this</td>
<td>Turn on the lazy loading function,</td>
</tr>
<tr>
<td>UseMonitorCommand</td>
<td>this</td>
<td>Monitor before and after global SQL execution.</td>
</tr>
<tr>
<td>UseMappingPriority</td>
<td>this</td>
<td>Specify mapping priority（default Aop &lt; FluentApi &lt; Attribute）</td>
</tr>
<tr>
<td>UseNameConvert</td>
<td>this</td>
<td>Automatic name conversion Entity -&gt; Db</td>
</tr>
<tr>
<td>UseExitAutoDisposePool</td>
<td>this</td>
<td>Listen to the AppDomain.CurrentDomain.ProcessExit/Console.CancelKeyPress event to automatically release the connection pool (default true)</td>
</tr>
<tr>
<td>Build&lt;T&gt;</td>
<td>IFreeSql&lt;T&gt;</td>
<td>Create an IFreeSql object. Note: Singleton design, don’t repeat creation</td>
</tr>
</tbody>
</table>
<h1 id="connectionstrings" tabindex="-1"> ConnectionStrings</h1>
<table>
<thead>
<tr>
<th>DataType</th>
<th>ConnectionString</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataType.MySql</td>
<td>Data Source=127.0.0.1;Port=3306;User ID=root;Password=root; Initial Catalog=cccddd;Charset=utf8; SslMode=none;Min pool size=1</td>
</tr>
<tr>
<td>DataType.PostgreSQL</td>
<td>Host=192.168.164.10;Port=5432;Username=postgres;Password=123456; Database=tedb;Pooling=true;Minimum Pool Size=1</td>
</tr>
<tr>
<td>DataType.SqlServer</td>
<td>Data Source=.;User Id=sa;Password=123456;Initial Catalog=freesqlTest;TrustServerCertificate=true;Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.Oracle</td>
<td>user id=user1;password=123456; data source=//127.0.0.1:1521/XE;Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.Sqlite</td>
<td>Data Source=|DataDirectory|\document.db; Attachs=xxxtb.db; Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.Firebird</td>
<td>database=localhost:D:\fbdata\EXAMPLES.fdb;user=sysdba;password=123456</td>
</tr>
<tr>
<td>DataType.MsAccess</td>
<td>Provider=Microsoft.Jet.OleDb.4.0;Data Source=d:/accdb/2003.mdb</td>
</tr>
<tr>
<td>DataType.Dameng(达梦)</td>
<td>server=127.0.0.1;port=5236;user id=2user;password=123456789;database=2user;poolsize=5</td>
</tr>
<tr>
<td>DataType.ShenTong(神通)</td>
<td>HOST=192.168.164.10;PORT=2003;DATABASE=OSRDB;USERNAME=SYSDBA;PASSWORD=szoscar55;MAXPOOLSIZE=2</td>
</tr>
<tr>
<td>DataType.KingbaseES(人大金仓) V008R003</td>
<td>Server=127.0.0.1;Port=54321;UID=USER2;PWD=123456789;database=TEST;MAXPOOLSIZE=2</td>
</tr>
<tr>
<td>DataType.Gbase(南大通用)</td>
<td>Driver={GBase ODBC DRIVER (64-Bit)};Host=192.168.164.134;Service=9088;Server=gbase01;Database=testdb;Protocol=onsoctcp;Uid=gbasedbt;Pwd=GBase123;Db_locale=zh_CN.utf8;Client_locale=zh_CN.utf8</td>
</tr>
<tr>
<td>DataType.OdbcMySql</td>
<td>Driver={MySQL ODBC 8.0 Unicode Driver}; Server=127.0.0.1;Persist Security Info=False; Trusted_Connection=Yes;UID=root;PWD=root; DATABASE=cccddd_odbc;Charset=utf8; SslMode=none;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.OdbcSqlServer</td>
<td>Driver={SQL Server};Server=.;Persist Security Info=False; Trusted_Connection=Yes;Integrated Security=True; DATABASE=freesqlTest_odbc; Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.OdbcOracle</td>
<td>Driver={Oracle in XE};Server=//127.0.0.1:1521/XE; Persist Security Info=False; Trusted_Connection=Yes;UID=odbc1;PWD=123456; Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.OdbcPostgreSQL</td>
<td>Driver={PostgreSQL Unicode(x64)};Server=192.168.164.10; Port=5432;UID=postgres;PWD=123456; Database=tedb_odbc;Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.OdbcDameng (达梦)</td>
<td>Driver={DM8 ODBC DRIVER};Server=127.0.0.1:5236; Persist Security Info=False; Trusted_Connection=Yes; UID=USER1;PWD=123456789</td>
</tr>
<tr>
<td>DataType.OdbcKingbaseES (人大金仓) V008R003</td>
<td>Driver={KingbaseES 8.2 ODBC Driver ANSI};Server=127.0.0.1;Port=54321;UID=USER2;PWD=123456789;database=TEST</td>
</tr>
<tr>
<td>DataType.Odbc</td>
<td>Driver={SQL Server};Server=.;Persist Security Info=False; Trusted_Connection=Yes;Integrated Security=True; DATABASE=freesqlTest_odbc; Pooling=true;Min pool size=1</td>
</tr>
<tr>
<td><a href="https://github.com/dotnetcore/FreeSql/tree/master/Providers/FreeSql.Provider.Custom" target="_blank" rel="noopener noreferrer">DataType.Custom</a></td>
<td>Custom connection string, access any database</td>
</tr>
</tbody>
</table>
<h2 id="reference" tabindex="-1"> Reference</h2>
<ul>
<li><a href="Install">《Install FreeSql》</a></li>
<li><a href="Insert-Data">《FreeSql 101, Part 1: Insert Data》</a></li>
<li><a href="Delete-Data">《FreeSql 101, Part 2: Delete Data》</a></li>
<li><a href="Update-Data">《FreeSql 101, Part 3: Update Data》</a></li>
<li><a href="Query-Data">《FreeSql 101, Part 4: Query Data》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
<li><a href="Filters-and-Global-Filters">《Filters and Global Filters》</a></li>
<li><a href="Unit-of-Work">《UnitOfWork》</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Insert Or Update</title>
      <link>http://freesql.net/en/guide/insert-or-update.html</link>
      <guid>http://freesql.net/en/guide/insert-or-update.html</guid>
      <source url="http://freesql.net/rss.xml">Insert Or Update</source>
      <pubDate>Sat, 21 Aug 2021 05:59:59 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="insert-or-update" tabindex="-1"> Insert Or Update</h1>
<h2 id="_1-ifreesql-insertorupdate" tabindex="-1"> 1. IFreeSql.InsertOrUpdate</h2>
<p><code>IFreeSql</code> defines the <code>InsertOrUpdate</code> method, which uses the characteristics and functions of the database to implement the added or modified functions. (since 1.5.0)</p>
<table>
<thead>
<tr>
<th>Database</th>
<th>Features</th>
<th></th>
<th>Database</th>
<th>Features</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql</td>
<td>on duplicate key update</td>
<td></td>
<td>Dameng</td>
<td>merge into</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>on conflict do update</td>
<td></td>
<td>Kingbase ES</td>
<td>on conflict do update</td>
</tr>
<tr>
<td>SqlServer</td>
<td>merge into</td>
<td></td>
<td>Shentong Database</td>
<td>merge into</td>
</tr>
<tr>
<td>Oracle</td>
<td>merge into</td>
<td></td>
<td>MsAccess</td>
<td>not support</td>
</tr>
<tr>
<td>Sqlite</td>
<td>replace into</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Firebird</td>
<td>merge into</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div><pre><code>fsql<span>.</span><span><span>InsertOrUpdate</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>items<span>)</span> <span>//Data to be processed</span>
  <span>//.IfExistsDoNothing() //If the data exists, do nothing (that means, insert the data if and only if the data does not exist)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>When the entity class has auto-increment properties, batch <code>InsertOrUpdate</code> can be split into two executions at most. Internally, FreeSql will calculate the data without self-increment and with self-increment, and execute the two commands of <code>insert into</code> and <code>merge into</code> mentioned above (using transaction execution).</p>
<p>Note: the common repository in <code>FreeSql.Repository</code> also has <code>InsertOrUpdate</code> method, but their mechanism is different.</p>
<hr>
<h2 id="_2-ifreesql-insertorupdatedict" tabindex="-1"> 2. IFreeSql.InsertOrUpdateDict</h2>
<div><pre><code><span><span>var</span></span> dic <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"id"</span><span>,</span> <span>1</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"name"</span><span>,</span> <span>"xxxx"</span><span>)</span><span>;</span>

fsql<span>.</span><span>InsertOrUpdateDict</span><span>(</span>dic<span>)</span><span>.</span><span>AsTable</span><span>(</span><span>"table1"</span><span>)</span><span>.</span><span>WherePrimary</span><span>(</span><span>"id"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//The generated SQL is the same as above</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="_3-insertorupdate-in-freesql-repository" tabindex="-1"> 3. InsertOrUpdate in <code>FreeSql.Repository</code></h2>
<p>To use this method, you need to reference the <code>FreeSql.Repository</code> or <code>FreeSql.DbContext</code> extensions package.</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span><span>InsertOrUpdate</span><span>(</span>YOUR_ENTITY<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>If there is data in the internal state management, then update it.</p>
<p>If there is no data in the internal state management, query the database to determine whether it exists.</p>
<blockquote>
<p>Update if it exists, insert if it doesn't exist</p>
</blockquote>
<p>Disadvantages: does not support batch operations</p>
<hr>
<h2 id="_4-batch-editing-beginedit" tabindex="-1"> 4. Batch Editing: <code>BeginEdit</code></h2>
<div><pre><code><span>[</span><span><span>Fact</span></span><span>]</span>
<span>public</span> <span><span>void</span></span> <span>BeginEdit</span><span>(</span><span>)</span>
<span>{</span>
    fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>BeginEdit01<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>"1=1"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>BeginEdit01<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> cts <span>=</span> <span>new</span><span>[</span><span>]</span> <span>{</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"Category1"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"Category1_1"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"Category1_2"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"Category1_3"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"Category2"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"Category2_1"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"Category2_2"</span> <span>}</span>
    <span>}</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span><span>Insert</span><span>(</span>cts<span>)</span><span>;</span>

    repo<span>.</span><span>BeginEdit</span><span>(</span>cts<span>)</span><span>;</span> <span>//Start editing `cts`</span>

    cts<span>.</span><span>Add</span><span>(</span><span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"Category2_3"</span> <span>}</span><span>)</span><span>;</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"123123"</span><span>;</span>
    cts<span>.</span><span>RemoveAt</span><span>(</span><span>1</span><span>)</span><span>;</span>

    Assert<span>.</span><span>Equal</span><span>(</span><span>3</span><span>,</span> repo<span>.</span><span>EndEdit</span><span>(</span><span>)</span><span>)</span><span>;</span>
<span>}</span>
<span>class</span> <span>BeginEdit01</span>
<span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br></div></div><p>When the above code <code>EndEdit</code> method is executed, 3 SQL statements are generated, as follows:</p>
<div><pre><code><span>INSERT</span> <span>INTO</span> <span>"BeginEdit01"</span><span>(</span><span>"Id"</span><span>,</span> <span>"Name"</span><span>)</span> <span>VALUES</span><span>(</span><span>'5f26bf07-6ac3-cbe8-00da-7dd74818c3a6'</span><span>,</span> <span>'Category2_3'</span><span>)</span>


<span>UPDATE</span> <span>"BeginEdit01"</span> <span>SET</span> <span>"Name"</span> <span>=</span> <span>'123123'</span> 
<span>WHERE</span> <span>(</span><span>"Id"</span> <span>=</span> <span>'5f26bf00-6ac3-cbe8-00da-7dd01be76e26'</span><span>)</span>


<span>DELETE</span> <span>FROM</span> <span>"BeginEdit01"</span> <span>WHERE</span> <span>(</span><span>"Id"</span> <span>=</span> <span>'5f26bf00-6ac3-cbe8-00da-7dd11bcf54dc'</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>Use case: In winform, after loading the table data, perform some operations such as adding, modifying, and deleting, and then click [Save]</p>
<p>Note: This operation is only valid for the variable <code>cts</code>, not for comparison and update of the entire table.</p>
<h2 id="_4-on-duplicate-key-update-mysql-only" tabindex="-1"> 4. <code>On Duplicate Key Update</code> (MySql only)</h2>
<p><code>FreeSql.Provider.MySql</code> and <code>FreeSql.Provider.MySqlConnector</code> support MySql's unique function <code>On Duplicate Key Update</code>.</p>
<p>This function can also insert or update data, and supports batch operations.</p>
<div><pre><code><span>class</span> <span>TestOnDuplicateKeyUpdateInfo</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> time <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span><span>var</span></span> item <span>=</span> <span>new</span> <span>TestOnDuplicateKeyUpdateInfo</span> <span>{</span> id <span>=</span> <span>100</span><span>,</span> title <span>=</span> <span>"title-100"</span><span>,</span> time <span>=</span> DateTime<span>.</span><span>Parse</span><span>(</span><span>"2000-01-01"</span><span>)</span> <span>}</span><span>;</span>
fsql<span>.</span><span>Insert</span><span>(</span>item<span>)</span>
    <span>.</span><span>NoneParameter</span><span>(</span><span>)</span>
    <span>.</span><span>OnDuplicateKeyUpdate</span><span>(</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `TestOnDuplicateKeyUpdateInfo`(`id`, `title`, `time`) VALUES(100, 'title-100', '2000-01-01 00:00:00.000')</span>
<span>//ON DUPLICATE KEY UPDATE</span>
<span>//`title` = VALUES(`title`), </span>
<span>//`time` = VALUES(`time`)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>Methods that can be called after <code>OnDuplicateKeyUpdate()</code>:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>IgnoreColumns</td>
<td>Ignore updated columns, the mechanism is the same as <code>IUpdate.IgnoreColumns</code></td>
</tr>
<tr>
<td>UpdateColumns</td>
<td>Specify updated columns, the mechanism is the same as <code>IUpdate.UpdateColumns</code></td>
</tr>
<tr>
<td>Set</td>
<td>Manually specify the updated column, the same function as <code>IUpdate.Set</code></td>
</tr>
<tr>
<td>SetRaw</td>
<td>As a supplement to the <code>Set</code> method, SQL strings can be passed in.</td>
</tr>
<tr>
<td>ToSql</td>
<td>Return the SQL statement to be executed</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>Execute and return the number of rows affected</td>
</tr>
</tbody>
</table>
<p>Both <code>IInsert</code> and <code>OnDuplicateKeyUpdate</code> have <code>IgnoreColumns</code> and <code>UpdateColumns</code> methods.</p>
<p>When inserting an entity or a set of entities, the <code>time</code> column is ignored, the code is as follows:</p>
<div><pre><code>fsql<span>.</span><span>Insert</span><span>(</span>item<span>)</span>
    <span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> a<span>.</span>time<span>)</span>
    <span>.</span><span>NoneParameter</span><span>(</span><span>)</span>
    <span>.</span><span>OnDuplicateKeyUpdate</span><span>(</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `TestOnDuplicateKeyUpdateInfo`(`id`, `title`) VALUES(200, 'title-200')</span>
<span>//ON DUPLICATE KEY UPDATE</span>
<span>//`title` = VALUES(`title`), </span>
<span>//`time` = '2000-01-01 00:00:00.000'</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>We found that the <code>UPDATE time</code> part became a constant instead of <strong>VALUES(`time`)</strong>. The mechanism is as follows:</p>
<p>When there are columns in the <code>insert</code> part, they will be set in the form of VALUES(`field`) in the <code>update</code>;</p>
<p>When a column that does not exist in the <code>insert</code> part, it will be set as a constant in the <code>update</code>. When manipulating the entity array, this constant is executed for <code>case when ... end</code> (same as <code>IUpdate</code>);</p>
<hr>
<h2 id="_5-on-conflict-do-update-postgresql-only" tabindex="-1"> 5. <code>On Conflict Do Update</code> (PostgreSQL only)</h2>
<p><code>FreeSql.Provider.PostgreSQL</code> supports PostgreSQL 9.5+ unique function <code>On Conflict(id) Do Update</code>.</p>
<p>The usage method is roughly the same as that of MySql's <code>OnDuplicateKeyUpdate</code>.</p>
<div><pre><code><span>class</span> <span>TestOnConflictDoUpdateInfo</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime<span>?</span></span> time <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span><span>var</span></span> items <span>=</span> <span>new</span> <span>[</span><span>]</span> <span>{</span>
    <span>new</span> <span>TestOnConflictDoUpdateInfo</span> <span>{</span> id <span>=</span> <span>200</span><span>,</span> title <span>=</span> <span>"title-200"</span><span>,</span> time <span>=</span> DateTime<span>.</span><span>Parse</span><span>(</span><span>"2000-01-01"</span><span>)</span> <span>}</span><span>,</span>
    <span>new</span> <span>TestOnConflictDoUpdateInfo</span> <span>{</span> id <span>=</span> <span>201</span><span>,</span> title <span>=</span> <span>"title-201"</span><span>,</span> time <span>=</span> DateTime<span>.</span><span>Parse</span><span>(</span><span>"2000-01-01"</span><span>)</span> <span>}</span><span>,</span>
    <span>new</span> <span>TestOnConflictDoUpdateInfo</span> <span>{</span> id <span>=</span> <span>202</span><span>,</span> title <span>=</span> <span>"title-202"</span><span>,</span> time <span>=</span> DateTime<span>.</span><span>Parse</span><span>(</span><span>"2000-01-01"</span><span>)</span> <span>}</span>
<span>}</span><span>;</span>
fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span>
    <span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> a<span>.</span>time<span>)</span>
    <span>.</span><span>NoneParameter</span><span>(</span><span>)</span>
    <span>.</span><span>OnConflictDoUpdate</span><span>(</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO ""testonconflictdoupdateinfo""(""id"", ""title"") VALUES(200, 'title-200'), (201, 'title-201'), (202, 'title-202')</span>
<span>//ON CONFLICT(""id"") DO UPDATE SET</span>
<span>//""title"" = EXCLUDED.""title"", </span>
<span>//""time"" = CASE EXCLUDED.""id"" </span>
<span>//WHEN 200 THEN '2000-01-01 00:00:00.000000' </span>
<span>//WHEN 201 THEN '2000-01-01 00:00:00.000000' </span>
<span>//WHEN 202 THEN '2000-01-01 00:00:00.000000' END::timestamp</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Install</title>
      <link>http://freesql.net/en/guide/install.html</link>
      <guid>http://freesql.net/en/guide/install.html</guid>
      <source url="http://freesql.net/rss.xml">Install</source>
      <pubDate>Sat, 21 Aug 2021 05:59:59 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="install" tabindex="-1"> Install</h1>
<p>FreeSql is a <code>.NET Standard 2.0</code> library, which only supports applications of <code>.NET Framework 4.0</code>, <code>.NET Core</code> or higher.</p>
<div><pre><code>dotnet add package FreeSql
dotnet add package FreeSql.DbContext
dotnet add package FreeSql.Provider.MySqlConnector
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h2 id="packages" tabindex="-1"> Packages</h2>
<table>
<thead>
<tr>
<th>Package Name</th>
<th>Version</th>
<th>Description</th>
<th>NuGet</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="Repository">FreeSql.Repository</a></td>
<td>NETStandard2.0、net45、net40</td>
<td>Common Repository + UoW</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Repository" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Repository" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td><a href="DbContext">FreeSql.DbContext</a></td>
<td>NETStandard2.0、net45、net40</td>
<td>EfCore Style Implementation</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.DbContext" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.DbContext" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.MySql</td>
<td>NETStandard2.0、net45、net40</td>
<td>Based on MySql.Data (Oracle official)</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.MySql" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.MySql" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.MySqlConnector</td>
<td>NETStandard2.0、net45</td>
<td>Based on MySqlConnector</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.MySqlConnector" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.MySqlConnector" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.PostgreSQL</td>
<td>NETStandard2.0、net45</td>
<td>Based on PostgreSQL 9.5+</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.PostgreSQL" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.PostgreSQL" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.SqlServer</td>
<td>NETStandard2.0、net45、net40</td>
<td>Support SqlServer 2005+, based on Microsoft.Data.SqlClient</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.SqlServer" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.SqlServer" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.SqlServerForSystem</td>
<td>NETStandard2.0、net45、net40</td>
<td>Support SqlServer 2005+, based on Microsoft.Data.SqlClient</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.SqlServerForSystem" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.SqlServerForSystem" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.Sqlite</td>
<td>NETStandard2.0、net45、net40</td>
<td></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Sqlite" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Sqlite" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.Oracle</td>
<td>NETStandard2.0、net45、net40</td>
<td>Oracle.ManagedDataAccess.Core</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Oracle" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Oracle" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.Firebird</td>
<td>NETStandard2.0、net452</td>
<td>FirebirdSql.Data.FirebirdClient</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Firebird" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Firebird" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.MsAccess</td>
<td>NETStandard2.0、net45、net40</td>
<td></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.MsAccess" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.MsAccess" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.Dameng</td>
<td>NETStandard2.0、net45、net40</td>
<td>Based on Dameng Database</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Dameng" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Dameng" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.ShenTong</td>
<td>NETStandard2.0、net45、net40</td>
<td>Based on ShenTong Database</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.ShenTong" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.ShenTong" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.KingbaseES</td>
<td>NETStandard2.0、net461</td>
<td>Based on KingbaseEs</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.KingbaseES" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.KingbaseES" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td><a href="https://github.com/dotnetcore/FreeSql/tree/master/Providers/FreeSql.Provider.Odbc" target="_blank" rel="noopener noreferrer">FreeSql.Provider.Odbc</a></td>
<td>NETStandard2.0、net45、net40</td>
<td>Based on ODBC</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Odbc" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Odbc" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td><a href="https://github.com/dotnetcore/FreeSql/tree/master/Providers/FreeSql.Provider.Custom" target="_blank" rel="noopener noreferrer">FreeSql.Provider.Custom</a></td>
<td>NETStandard2.0、net45、net40</td>
<td>Custom database provider</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Custom" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Custom" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Extensions.LazyLoading</td>
<td>NETStandard2.0、net45、net40</td>
<td>Lazy loading extensions</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Extensions.LazyLoading" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Extensions.LazyLoading" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Extensions.JsonMap</td>
<td>NETStandard2.0、net45、net40</td>
<td>Json serialization extensions</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Extensions.JsonMap" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Extensions.JsonMap" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Extensions.Linq</td>
<td>NETStandard2.0、net45、net40</td>
<td>LinqToSql IQueryable extensions</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Extensions.Linq" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Extensions.Linq" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Extensions.BaseEntity</td>
<td>NETStandard2.0</td>
<td></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Extensions.BaseEntity" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Extensions.BaseEntity" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Generator</td>
<td>NETCoreapp3.1</td>
<td>Generate entity classes from the database. <a href="https://www.cnblogs.com/igeekfan/p/freesql-generator.html" target="_blank" rel="noopener noreferrer">How does it work?</a></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Generator" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Generator" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
</tbody>
</table>
<h2 id="guide" tabindex="-1"> Guide</h2>
<p>FreeSql supports basic CURD. In addition, it also supports creating models based on existing databases (<a href="DbFirst-Mode">DbFirst</a>), and supports creating databases based on models (<a href="CodeFirst-Mode">CodeFirst</a>).</p>
<h4 id="getting-started" tabindex="-1"> Getting Started</h4>
<ul>
<li><a href="Insert-Data">《FreeSql 101, Part 1: Insert Data》</a></li>
<li><a href="Delete-Data">《FreeSql 101, Part 2: Delete Data》</a></li>
<li><a href="Update-Data">《FreeSql 101, Part 3: Update Data》</a></li>
<li><a href="Query-Data">《FreeSql 101, Part 4: Query Data》</a></li>
<li><a href="Repository-Layer">《Repository Layer》</a></li>
</ul>
<h4 id="deep-learning" tabindex="-1"> Deep Learning</h4>
<ul>
<li><a href="CodeFirst-Mode">《Introduction to Codefirst Mode》</a>
<ul>
<li><a href="Entity-Attributes">《CodeFirst Mode, Part 1: Entity Attributes》</a></li>
<li><a href="FluentApi-Mode">《CodeFirst Mode, Part 2: FluentApi》</a></li>
<li><a href="Custom-Attributes">《CodeFirst Mode, Part 3: Custom Attributes》</a></li>
<li><a href="Type-Mapping">《CodeFirst Mode, Part 4: Type Mapping》</a></li>
<li><a href="Migration-Structure">《CodeFirst Mode, Part 5: Migration Structure》</a></li>
</ul>
</li>
<li><a href="DbFirst-Mode">《Introduction to DbFirst Mode》</a></li>
</ul>
<h4 id="advanced" tabindex="-1"> Advanced</h4>
<ul>
<li><a href="Database-Transaction">《Database Transaction》</a></li>
<li><a href="Using-Read-Write-Separation">《Using Read/Write Separation》</a></li>
<li><a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
<li><a href="Tenant">《Tenant》</a></li>
<li><a href="Return-Data">《Return Data》</a></li>
<li><a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li><a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li><a href="Expression-Function">《Expression Function》</a></li>
<li><a href="Aspect-Oriented-Programming">《AOP》</a></li>
</ul>
]]></content:encoded>
      <enclosure url="https://buildstats.info/nuget/FreeSql.Repository" type="image/"/>
    </item>
    <item>
      <title>Guide</title>
      <link>http://freesql.net/en/guide/</link>
      <guid>http://freesql.net/en/guide/</guid>
      <source url="http://freesql.net/rss.xml">Guide</source>
      <pubDate>Thu, 04 Feb 2021 16:03:18 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="guide" tabindex="-1"> Guide</h1>
<h2 id="freesql" tabindex="-1"> FreeSql</h2>
<p><a href="https://github.com/dotnetcore" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/member project of-NCC-9e20c9.svg" alt="Member project of .NET Core Community" loading="lazy"></a>
<a href="https://www.nuget.org/packages/FreeSql" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/nuget/v/FreeSql.svg?style=flat-square" alt="nuget" loading="lazy"></a>
<a href="https://www.nuget.org/stats/packages/FreeSql?groupby=Version" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/nuget/dt/FreeSql.svg?style=flat-square" alt="stats" loading="lazy"></a>
<a href="https://github.com/dotnetcore/FreeSql/blob/master/LICENSE" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License" loading="lazy"></a></p>
<p><a href="https://starchart.cc/dotnetcore/FreeSql" target="_blank" rel="noopener noreferrer"><img src="https://starchart.cc/dotnetcore/FreeSql.svg" alt="Stargazers over time" loading="lazy"></a></p>
<p>FreeSql is a powerful <strong>.NET ORM</strong> that supports all <em>.NET Standard</em> runtime platforms like <em>.NET Framework 4.0+</em>, <em>.NET Core 2.1+</em> and <em>Xamarin</em>, etc.</p>
<p>QQ Groups：4336577(full)、8578575(full)、<strong>52508226(available)</strong></p>
<h2 id="features" tabindex="-1"> Features</h2>
<ul>
<li>🛠 Support CodeFirst data migration.</li>
<li>💻 Support DbFirst import entity class from database, or use <a href="https://github.com/dotnetcore/FreeSql/wiki/DbFirst" target="_blank" rel="noopener noreferrer">Generation Tool</a>.</li>
<li>⛳ Support advanced type mapping, such as PostgreSQL array type, etc.</li>
<li>🌲 Support expression functions, and customizable analysis.</li>
<li>🏁 Support one-to-many and many-to-many navigation properties, include and lazy loading.</li>
<li>📃 Support Read/Write separation, Splitting Table/Database, Global filters, Optimistic and pessimistic locker.</li>
<li>🌳 Support MySql/SqlServer/PostgreSQL/Oracle/Sqlite/Firebird/达梦/人大金仓/神舟通用/翰高/ClickHouse, GBase/Access, etc.</li>
</ul>
<h2 id="guide-1" tabindex="-1"> Guide</h2>
<p>FreeSql supports basic CURD. In addition, it also supports creating models based on existing databases (<a href="DbFirst-Mode">DbFirst</a>), and supports creating databases based on models (<a href="CodeFirst-Mode">CodeFirst</a>).</p>
<h4 id="getting-started" tabindex="-1"> Getting Started</h4>
<ul>
<li><a href="Insert-Data">《FreeSql 101, Part 1: Insert Data》</a></li>
<li><a href="Delete-Data">《FreeSql 101, Part 2: Delete Data》</a></li>
<li><a href="Update-Data">《FreeSql 101, Part 3: Update Data》</a></li>
<li><a href="Query-Data">《FreeSql 101, Part 4: Query Data》</a></li>
<li>🚧 <a href="Repository-Layer">《Repository Layer》</a></li>
</ul>
<h4 id="deep-learning" tabindex="-1"> Deep Learning</h4>
<ul>
<li>🚧 <a href="CodeFirst-Mode">《Introduction to Codefirst Mode》</a>
<ul>
<li>🚧 <a href="Entity-Attributes">《CodeFirst Mode, Part 1: Entity Attributes》</a></li>
<li>🚧 <a href="FluentApi-Mode">《CodeFirst Mode, Part 2: FluentApi》</a></li>
<li>🚧 <a href="Custom-Attributes">《CodeFirst Mode, Part 3: Custom Attributes》</a></li>
<li>🚧 <a href="Type-Mapping">《CodeFirst Mode, Part 4: Type Mapping》</a></li>
<li>🚧 <a href="Migration-Structure">《CodeFirst Mode, Part 5: Migration Structure》</a></li>
</ul>
</li>
<li>🚧 <a href="DbFirst-Mode">《Introduction to DbFirst Mode》</a></li>
</ul>
<h4 id="advanced" tabindex="-1"> Advanced</h4>
<ul>
<li>🚧 <a href="Database-Transaction">《Database Transaction》</a></li>
<li>🚧 <a href="Using-Read-Write-Separation">《Using Read/Write Separation》</a></li>
<li>🚧 <a href="Sharding-Tables-and-Database">《Sharding Tables and Database》</a></li>
<li>🚧 <a href="Tenant">《Tenant》</a></li>
<li>🚧 <a href="Return-Data">《Return Data》</a></li>
<li>🚧 <a href="Lazy-Loading">《FreeSql Optimization: Lazy Loading》</a></li>
<li>🚧 <a href="Greed-Loading">《FreeSql Optimization: Greed Loading》</a></li>
<li>🚧 <a href="Expression-Function">《Expression Function》</a></li>
<li>🚧 <a href="ActiveX-Data-Objects">《ADO》</a></li>
<li>🚧 <a href="Aspect-Oriented-Programming">《AOP》</a></li>
</ul>
<h4 id="wechat" tabindex="-1"> WeChat</h4>
<p>Welcome to follow on Wechat <strong>dotNET搬砖队</strong>, we will share information about .NET Core and FreeSql.</p>
<p><img src="https://pic.downk.cc/item/5f80867d1cd1bbb86bc67041.jpg" alt="分享.NET Core+FreeSql相关技术" loading="lazy"></p>
]]></content:encoded>
      <enclosure url="https://img.shields.io/badge/member%20project%20of-NCC-9e20c9.svg" type="image/svg+xml"/>
    </item>
  </channel>
</rss>