<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-CN">
  <id>http://freesql.net/FreeSql.Wiki.VuePress/</id>
  <title>FreeSql å®˜æ–¹æ–‡æ¡£</title>
  <subtitle>FreeSql Documents</subtitle>
  <updated>2022-06-22T02:28:59.919Z</updated>
  <generator>vuepress-plugin-feed2</generator>
  <link rel="self" href="http://freesql.net/FreeSql.Wiki.VuePress/atom.xml"/>
  <link rel="alternate" href="http://freesql.net/FreeSql.Wiki.VuePress/"/>
  <entry>
    <title type="html">æœåŠ¡æ”¯æŒ</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/reference/service-support.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/reference/service-support.html"/>
    <updated>2022-05-25T15:18:32.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æœåŠ¡æ”¯æŒ" tabindex="-1"> æœåŠ¡æ”¯æŒ</h1>
<h2 id="ğŸ’»-å¼€æºå…è´¹" tabindex="-1"> ğŸ’» å¼€æºå…è´¹</h2>
<p>FreeSql é‡‡ç”¨ MIT æœ€å®½æ¾çš„å¼€æºåè®®ï¼Œæ°¸ä¹…å…è´¹å¼€æºã€‚ä»»ä½•å…¬å¸æˆ–ä¸ªäººï¼Œéƒ½å¯ä»¥ä½¿ç”¨åœ¨ä»»ä½•å•†ä¸šé¡¹ç›®ä¸­ã€‚</p>
<p>QQ æŠ€æœ¯ç¾¤ï¼š4336577(æ»¡å‘˜)ã€8578575(æ»¡å‘˜)ã€52508226(åœ¨çº¿)</p>
<h2 id="ğŸŒ³-æœ‰å¿æœåŠ¡" tabindex="-1"> ğŸŒ³ æœ‰å¿æœåŠ¡</h2>
<table>
<thead>
<tr>
<th>æœåŠ¡é¡¹ç›®</th>
<th>æè¿°</th>
<th>ä»·æ ¼(RMB)</th>
<th>ä»˜æ¬¾æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>FreeSql æŠ€æœ¯æ”¯æŒ(ä¼ä¸š)</td>
<td>å¯¹ä¼ä¸šé‡åˆ°ä»»ä½• FreeSql é—®é¢˜ï¼Œæä¾›è¿œç¨‹ååŠ©æˆ–ç´§æ€¥åŠŸèƒ½æ”¯æŒ</td>
<td>5000/å¹´</td>
<td>å¯„å‘ç¥¨åä»˜æ¬¾</td>
</tr>
<tr>
<td>.NET å¤–åŒ…é¡¹ç›®</td>
<td>ä»·æ ¼ä¸ä½äº 5 ä¸‡ï¼Œèµ°å…¬å¸åˆåŒ</td>
<td>é¢è®®</td>
<td>æŒ‰åˆåŒä»˜æ¬¾</td>
</tr>
</tbody>
</table>
<p>è”ç³»æ–¹å¼</p>
<p>QQï¼š2881099</p>
<p>Weixinï¼šq2881099</p>
<blockquote>
<p>å¼€æºä¸æ˜“ï¼Œæœªæ¥è¥é€ ï¼Œæ„Ÿæ©æœ‰ä½ ï¼Œä¼´æˆ‘åŒè¡Œ</p>
</blockquote>
<h2 id="ğŸ’•-è‡ªæ„¿æ‰“èµ" tabindex="-1"> ğŸ’• è‡ªæ„¿æ‰“èµ</h2>
<p>L*y 58 å…ƒã€èŠ±èŠ± 88 å…ƒã€éº¦å…œå¾ˆä¹– 50 å…ƒã€ç½‘ç»œæ¥è€… 2000 å…ƒã€John 99.99 å…ƒã€alex 666 å…ƒã€bacongao 36 å…ƒã€æ— å 100 å…ƒã€Eternity 188 å…ƒã€æ— å 10 å…ƒã€âŒ’.Helper~..oO 66 å…ƒã€ä¹ æƒ¯ä¸è¢«ä¹ æƒ¯ 100 å…ƒã€æ— å 100 å…ƒã€è”¡æ˜“å–‹ 88.88 å…ƒã€ä¸­è®¯ç§‘æŠ€ 1000 å…ƒã€Good Good Work 24 å…ƒã€ç‚½ç„° 6.6 å…ƒã€Nothing 100 å…ƒã€å…°å·å¤©æ“èµµ 500 å…ƒã€å“ˆåˆ©è·¯äºš 300 å…ƒã€
æ— å 100 å…ƒã€è›°ä¼ 99.99 å…ƒã€TCYM 66.66 å…ƒã€MOTA 5 å…ƒã€LDZXG 30 å…ƒã€Near 30 å…ƒã€å»ºçˆ½ 66 å…ƒã€æ— å 200 å…ƒã€LambertWu 100 å…ƒã€æ— å 18.88 å…ƒã€ä¹Œé¾™ 50 å…ƒã€æ— å 100 å…ƒã€é™³æ€¼æ€¼ 66.66 å…ƒã€é™³æ€¼æ€¼ 66.66 å…ƒã€ä¸æ·® 100 å…ƒã€æä¼Ÿåš-Excel å‚¬åŒ–å‰‚ 100 å…ƒã€ç™½ç‹ 6.66 å…ƒã€å¥¹å¾®ç¬‘çš„è„¸ y 30 å…ƒã€EternityÂ²ÂºÂ²Â¹ 588 å…ƒã€å¤œå½’æŸ´é—¨ 88 å…ƒã€è”¡æ˜“å–‹ 666.66 å…ƒã€
<em>ç¤¼ 10 å…ƒã€litrpa 88 å…ƒã€Alax CHOW 200 å…ƒã€Daily 66 å…ƒã€k</em>t 66 å…ƒã€è“ 100 å…ƒã€*èœ 10 å…ƒã€ç”Ÿå‘½å¦‚æ­Œ 1000 å…ƒ</p>
<blockquote>
<p>è¶…çº§æ„Ÿè°¢ä½ çš„æ‰“èµã€‚</p>
</blockquote>
<ul>
<li>
<p><a href="https://www.cnblogs.com/FreeSql/gallery/image/338860.html" target="_blank" rel="noopener noreferrer">Alipay</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/FreeSql/gallery/image/338859.html" target="_blank" rel="noopener noreferrer">WeChat</a></p>
</li>
</ul>
]]></content>
    <published>2022-05-25T15:18:32.000Z</published>
  </entry>
  <entry>
    <title type="html">FreeSql.Provider.SqliteCore</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/freesql-provider-sqlitecore.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/freesql-provider-sqlitecore.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="freesql-provider-sqlitecore" tabindex="-1"> FreeSql.Provider.SqliteCore</h1>
<p>FreeSql.Provider.SqliteCoreæ˜¯<code>FreeSql</code>åŸºäºå¾®è½¯æä¾›çš„æœ€æ–°çš„<a href="https://docs.microsoft.com/zh-cn/dotnet/standard/data/sqlite/?tabs=netcore-cli" target="_blank" rel="noopener noreferrer"><code>Microsoft.Data.Sqlite.Core</code></a>é©±åŠ¨çš„å®ç°ã€‚
<strong>éœ€è¦å¦å¤–å®‰è£…å¯¹åº”çš„bundle_xxx</strong>å®ç°åŠ å¯†ã€‚</p>
<h2 id="æ”¯æŒçš„ç‰ˆæœ¬" tabindex="-1"> æ”¯æŒçš„ç‰ˆæœ¬</h2>
<ul>
<li>.NETStandard2.0+</li>
<li>net6.0</li>
<li>SQLiteï¼ˆ3.7 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰</li>
</ul>
<p>å®‰è£…<code>FreeSql.Provider.SqliteCore</code>åŒ…ã€‚</p>
<div><pre><code>dotnet add package FreeSql.Provider.SqliteCore
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="ä¸æ”¯æŒåŠ å¯†" tabindex="-1"> ä¸æ”¯æŒåŠ å¯†</h2>
<p>0.å®‰è£…åŒ…ã€‚</p>
<div><pre><code>dotnet add package SQLitePCLRaw.bundle_e_sqlite3 
dotnet add package FreeSql.Provider.SqliteCore
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>ç›´æ¥æ­£å¸¸ä½¿ç”¨å…¶ä»–åŒ…ä¸€æ ·ä½¿ç”¨FreeSqlå³å¯ã€‚<code>SQLitePCLRaw.bundle_e_sqlite3</code>åŒ…ä¸æ”¯æŒåŠ å¯†ï¼Œä½†æ­¤ç§æ–¹å¼æ˜¯å®˜æ–¹å®ç°çš„<code>SQlite</code>ç‰ˆæœ¬,äºŒé€‰ä¸€å°±è¡Œ</p>
<table>
<thead>
<tr>
<th>æ†ç»‘</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>SQLitePCLRaw.bundle_e_sqlite3</td>
<td>åœ¨æ‰€æœ‰å¹³å°ä¸Šæä¾›ä¸€è‡´ç‰ˆæœ¬çš„ <code>SQLite</code>ã€‚ åŒ…æ‹¬ FTS4ã€FTS5ã€JSON1 å’Œ R* æ ‘æ‰©å±•ã€‚ å»ºè®®ä½¿ç”¨</td>
</tr>
<tr>
<td>SQLitePCLRaw.bundle_e_sqlcipher</td>
<td>æä¾› <code>SQLCipher</code> çš„éå®˜æ–¹å¼€æ”¾æºä»£ç å†…éƒ¨ç‰ˆæœ¬ï¼Œ<strong>æ”¯æŒåŠ å¯†</strong>ã€‚</td>
</tr>
</tbody>
</table>
<h1 id="freesql-provider-sqlitecoreå¦‚ä½•åŠ å¯†" tabindex="-1"> FreeSql.Provider.SqliteCoreå¦‚ä½•åŠ å¯†</h1>
<p>é‚£æˆ‘ä»¬ä¸å®‰è£… <code>SQLitePCLRaw.bundle_e_sqlite3</code>åŒ…ï¼Œæ¢<code>SQLitePCLRaw.bundle_e_sqlcipher</code></p>
<h2 id="åªæœ‰sqlcipheræ‰æ”¯æŒåŠ å¯†" tabindex="-1"> åªæœ‰<strong>sqlcipher</strong>æ‰æ”¯æŒåŠ å¯†</h2>
<p>0.é€‰æ‹©ä¸€ä¸ªç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªæ§åˆ¶å°é¡¹ç›®<code>OvOv.FreeSqlMicrosoftSqliteCore</code></p>
<div><pre><code>dotnet new console -n OvOv.FreeSqlMicrosoftSqliteCore
cd OvOv.FreeSqlMicrosoftSqliteCore
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>1.å®‰è£…åŒ…</p>
<div><pre><code>dotnet <span>add</span> package SQLitePCLRaw.bundle_e_sqlcipher
dotnet <span>add</span> package FreeSql.Provider.SqliteCore
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><ol start="2">
<li>è¿æ¥ä¸²ç›´æ¥æŒ‡å®šPassword=xxxå³å¯</li>
</ol>
<p>åˆ›å»ºä¸€ä¸ªç±»<code>g.cs</code>,å¯ç›´æ¥é€šè¿‡<code>g.sqlite</code>è®¿é—®åˆ°<code>IFreeSql</code>å¯¹è±¡</p>
<div><pre><code><span>public</span> <span>class</span> <span>g</span>
<span>{</span>
    <span>static</span> <span>Lazy<span>&lt;</span>IFreeSql<span>></span></span> sqliteLazy <span>=</span> <span>new</span> <span>Lazy<span>&lt;</span>IFreeSql<span>></span></span><span>(</span><span>(</span><span>)</span> <span>=></span>
    <span>{</span>
        <span><span>var</span></span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
                <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>@"Data Source=local.db;Password=123qwe"</span><span>)</span>
                <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span>
                <span>.</span><span>UseLazyLoading</span><span>(</span><span>true</span><span>)</span>
                <span>.</span><span>UseMonitorCommand</span><span>(</span>
                    cmd <span>=></span> Trace<span>.</span><span>WriteLine</span><span>(</span><span>"\r\nçº¿ç¨‹"</span> <span>+</span> Thread<span>.</span>CurrentThread<span>.</span>ManagedThreadId <span>+</span> <span>": "</span> <span>+</span> cmd<span>.</span>CommandText<span>)</span>
                    <span>)</span>
                <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
        <span>return</span> fsql<span>;</span>
    <span>}</span>
   <span>)</span><span>;</span>
    <span>public</span> <span>static</span> <span>IFreeSql</span> sqlite <span>=></span> sqliteLazy<span>.</span>Value<span>;</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><p>æµ‹è¯•åŠ å¯†,å¢åŠ ä¸€äº›æ•°æ®ã€‚<code>Program.cs</code>ä¸­æµ‹è¯•</p>
<div><pre><code><span>Test</span><span>(</span><span>)</span><span>;</span>

<span>static</span> <span><span>void</span></span> <span>Test</span><span>(</span><span>)</span>
<span>{</span>
    <span>IInsert<span>&lt;</span>Topic<span>></span></span> insert <span>=</span> g<span>.</span>sqlite<span>.</span><span><span>Insert</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> items <span>=</span> <span>new</span> <span>List<span>&lt;</span>Topic<span>></span></span><span>(</span><span>)</span><span>;</span>
    <span>for</span> <span>(</span><span><span>var</span></span> a <span>=</span> <span>0</span><span>;</span> a <span>&lt;</span> <span>10</span><span>;</span> a<span>++</span><span>)</span> items<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> a <span>+</span> <span>1</span><span>,</span> Title <span>=</span> <span><span>$"newTitle</span><span><span>{</span><span>a</span><span>}</span></span><span>"</span></span><span>,</span> Clicks <span>=</span> a <span>*</span> <span>100</span> <span>}</span><span>)</span><span>;</span>

    <span><span>var</span></span> affrows <span>=</span> insert<span>.</span><span>AppendData</span><span>(</span>items<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
    Console<span>.</span><span>WriteLine</span><span>(</span><span>"affrowsï¼š"</span> <span>+</span> affrows<span>)</span><span>;</span>
    <span><span>var</span></span> list <span>=</span> g<span>.</span>sqlite<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
    Console<span>.</span><span>WriteLine</span><span>(</span><span>"countï¼š"</span> <span>+</span> list<span>.</span>Count<span>)</span><span>;</span>
<span>}</span>



<span>[</span><span><span>Table</span><span><span>(</span>Name <span>=</span> <span>"tb_topic_insert"</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>Topic</span>
<span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div><p>è¿è¡Œé¡¹ç›®</p>
<div><pre><code>dotnet run
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h3 id="éªŒè¯æ˜¯å¦ç™»å½•æ˜¯å¦åŠ å¯†" tabindex="-1"> éªŒè¯æ˜¯å¦ç™»å½•æ˜¯å¦åŠ å¯†ï¼Ÿ</h3>
<p>é‡æ–°è¿è¡Œæ—¶ï¼Œåˆ é™¤ è¿æ¥ä¸²ä¸­çš„Password,å‘ç°æ— æ³•è·å–æ•°æ®ã€‚æˆ–ä½¿ç”¨<code>Navicat Premium</code>å·¥å…·å‘ç°æ— æ³•è¿æ¥ã€‚</p>
<div><pre><code><span><span>+</span><span> .UseConnectionString(FreeSql.DataType.Sqlite, @"Data Source=local.db;") 
</span></span><span><span>-</span><span> .UseConnectionString(FreeSql.DataType.Sqlite, @"Data Source=|DataDirectory|local.db;Password=123qwe")
</span></span></code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>æç¤ºå¦‚ä¸‹å†…å®¹ï¼Œä½†ä½¿ç”¨å¯†ç æ—¶åˆèƒ½æ­£å¸¸è®¿é—®æ•°æ®ã€‚</p>
<div><pre><code>SqliteException: SQLite Error 26: 'file is not a database'.
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ç›¸æ¯”åŒ… <code>FreeSql.Provider.Sqlite</code>æ¥è¯´ï¼Œç›®å‰å­˜åœ¨ä¸€äº›é™åˆ¶ï¼Œ</p>
<h4 id="datadirectory-é»˜è®¤ä¸æ”¯æŒ" tabindex="-1"> |DataDirectory| é»˜è®¤ä¸æ”¯æŒ</h4>
<p>éœ€è¦ä½¿ç”¨å‰ï¼ŒæŒ‡å®šå…·ä½“çš„æ–‡ä»¶å¤¹ï¼Œæ­¤å¤„ç›¸å½“äºæŒ‡å®šäº†å½“å‰<code>dll</code>æ‰€åœ¨ç›®å½•ï¼Œå³<code>bin/Debug/net6.0</code>ã€‚å‚è€ƒ</p>
<div><pre><code><span><span>string</span></span> dataSubDirectory <span>=</span> Path<span>.</span><span>Combine</span><span>(</span>AppContext<span>.</span>BaseDirectory<span>)</span><span>;</span>

<span>if</span> <span>(</span><span>!</span>Directory<span>.</span><span>Exists</span><span>(</span>dataSubDirectory<span>)</span><span>)</span>
    Directory<span>.</span><span>CreateDirectory</span><span>(</span>dataSubDirectory<span>)</span><span>;</span>

AppDomain<span>.</span>CurrentDomain<span>.</span><span>SetData</span><span>(</span><span>"DataDirectory"</span><span>,</span> dataSubDirectory<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>å³</p>
<div><pre><code><span>public</span> <span>class</span> <span>g</span>
<span>{</span>
    <span>static</span> <span>Lazy<span>&lt;</span>IFreeSql<span>></span></span> sqliteLazy <span>=</span> <span>new</span> <span>Lazy<span>&lt;</span>IFreeSql<span>></span></span><span>(</span><span>(</span><span>)</span> <span>=></span>
    <span>{</span>
        <span><span>string</span></span> dataSubDirectory <span>=</span> Path<span>.</span><span>Combine</span><span>(</span>AppContext<span>.</span>BaseDirectory<span>)</span><span>;</span>

        <span>if</span> <span>(</span><span>!</span>Directory<span>.</span><span>Exists</span><span>(</span>dataSubDirectory<span>)</span><span>)</span>
            Directory<span>.</span><span>CreateDirectory</span><span>(</span>dataSubDirectory<span>)</span><span>;</span>

        AppDomain<span>.</span>CurrentDomain<span>.</span><span>SetData</span><span>(</span><span>"DataDirectory"</span><span>,</span> dataSubDirectory<span>)</span><span>;</span>

        <span><span>var</span></span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
                <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>@"Data Source=|DataDirectory|local.db;Password=123qwe"</span><span>)</span>
                <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span>
                <span>.</span><span>UseLazyLoading</span><span>(</span><span>true</span><span>)</span>
                <span>.</span><span>UseMonitorCommand</span><span>(</span>
                    cmd <span>=></span> Trace<span>.</span><span>WriteLine</span><span>(</span><span>"\r\nçº¿ç¨‹"</span> <span>+</span> Thread<span>.</span>CurrentThread<span>.</span>ManagedThreadId <span>+</span> <span>": "</span> <span>+</span> cmd<span>.</span>CommandText<span>)</span>
                    <span>)</span>
                <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

        <span>return</span> fsql<span>;</span>
    <span>}</span>
   <span>)</span><span>;</span>
    <span>public</span> <span>static</span> <span>IFreeSql</span> sqlite <span>=></span> sqliteLazy<span>.</span>Value<span>;</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br></div></div><p>å…·ä½“çš„é“¾æ¥ä¸²ï¼Œè¯·å‚è€ƒ  <a href="https://docs.microsoft.com/zh-cn/dotnet/standard/data/sqlite/connection-strings" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/dotnet/standard/data/sqlite/connection-strings</a></p>
<h4 id="æ•°å­¦å‡½æ•°" tabindex="-1"> æ•°å­¦å‡½æ•°</h4>
<p>å¦‚ä¸‹å‡½æ•°ä¸æ”¯æŒ</p>
<ul>
<li>Floor</li>
<li>Ceiling</li>
<li>Log10</li>
<li>Pow</li>
<li>Sqrt</li>
<li>Cos</li>
</ul>
<h4 id="timespantest" tabindex="-1"> TimeSpanTest</h4>
<p>æµ‹è¯• ç±»ä¸­ ä¸é€šè¿‡ã€ulongæœ€å¤§å€¼ï¼Œæœ€å°å€¼ï¼Œè¶…å‡ºèŒƒå›´ã€‚</p>
<ul>
<li>ä¸æ”¯æŒ</li>
</ul>
<div><pre><code>  <span>public</span> <span><span>void</span></span> <span>Days</span><span>(</span><span>)</span>
  <span>{</span>
      <span><span>var</span></span> data <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
      data<span>.</span><span>Add</span><span>(</span><span>select</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>.</span>TimeOfDay<span>.</span>Days <span>==</span> <span>0</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ul>
<li>ä¸æ”¯æŒ</li>
</ul>
<div><pre><code> <span>public</span> <span><span>void</span></span> <span>Minutes</span><span>(</span><span>)</span>
  <span>{</span>
      <span><span>var</span></span> data <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
      data<span>.</span><span>Add</span><span>(</span><span>select</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>.</span>TimeOfDay<span>.</span>Minutes <span>></span> <span>0</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h4 id="å®Œæ•´ä»£ç " tabindex="-1"> å®Œæ•´ä»£ç </h4>
<ul>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/Database-Drivers/OvOv.FreeSqlMicrosoftSqliteCore/Program.cs" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/blob/master/Database-Drivers/OvOv.FreeSqlMicrosoftSqliteCore/Program.cs</a></li>
</ul>
<h2 id="ios" tabindex="-1"> iOS</h2>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/standard/data/sqlite/xamarin#ios" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/dotnet/standard/data/sqlite/xamarin#ios</a></p>
<p><code>Microsoft.Data.Sqlite</code> å°è¯•è‡ªåŠ¨åˆå§‹åŒ– <code>SQLitePCLRaw</code> æ†ç»‘ã€‚ é—æ†¾çš„æ˜¯ï¼Œç”±äºé’ˆå¯¹ <code>Xamarin.iOS</code> çš„é¢„å…ˆ (AOT) ç¼–è¯‘å­˜åœ¨é™åˆ¶ï¼Œå› æ­¤å°è¯•å¤±è´¥ï¼Œå¹¶å‡ºç°ä»¥ä¸‹é”™è¯¯ã€‚</p>
<blockquote>
<p>éœ€è¦è°ƒç”¨ <code>SQLitePCL.raw.SetProvider()</code>ã€‚ å¦‚æœä½¿ç”¨çš„æ˜¯æ†ç»‘åŒ…ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <code>SQLitePCL.Batteries.Init()</code> æ¥å®Œæˆæ­¤æ“ä½œã€‚</p>
</blockquote>
<p>è‹¥è¦åˆå§‹åŒ–è¯¥ç»‘å®šï¼Œè¯·åœ¨ä½¿ç”¨ <code>Microsoft.Data.Sqlite</code> ä¹‹å‰ï¼Œå°†ä»¥ä¸‹ä»£ç è¡Œæ·»åŠ åˆ°åº”ç”¨ã€‚</p>
<div><pre><code>SQLitePCL<span>.</span>Batteries_V2<span>.</span><span>Init</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å³åœ¨ä¸Šæ–¹å®šä¹‰<code>FreeSql</code>å•ä¾‹æ—¶ï¼Œåœ¨<code>new Lazy</code>å†…ï¼Œè°ƒç”¨ä¸€æ¬¡å³å¯ã€‚</p>
]]></content>
    <published>2022-03-25T06:41:57.000Z</published>
  </entry>
  <entry>
    <title type="html">UnitOfWorkManager äº‹åŠ¡</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/unitofwork-manager.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/unitofwork-manager.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="unitofworkmanager-äº‹åŠ¡" tabindex="-1"> UnitOfWorkManager äº‹åŠ¡</h1>
<h2 id="asp-net-core-ä¸‹-freesql-çš„ä»“å‚¨äº‹åŠ¡" tabindex="-1"> ASP.NET Core ä¸‹ FreeSql çš„ä»“å‚¨äº‹åŠ¡</h2>
<h3 id="å¼•å…¥åŒ…" tabindex="-1"> å¼•å…¥åŒ…</h3>
<div><pre><code>dotnet <span>add</span> package FreeSql
dotnet <span>add</span> package FreeSql.DbContext
dotnet <span>add</span> package FreeSql.Provider.MySqlConnector
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h3 id="é…ç½®-startup-cs-æ³¨å…¥" tabindex="-1"> é…ç½® Startup.cs æ³¨å…¥</h3>
<div><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  <span>IConfigurationSection</span> Mysql <span>=</span> Configuration<span>.</span><span>GetSection</span><span>(</span><span>"Mysql"</span><span>)</span><span>;</span>
        Fsql <span>=</span> <span>new</span> <span>FreeSqlBuilder</span><span>(</span><span>)</span>
            <span>.</span><span>UseConnectionString</span><span>(</span>DataType<span>.</span>MySql<span>,</span> Mysql<span>.</span>Value<span>)</span>
            <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span>
            <span>.</span><span>UseNameConvert</span><span>(</span>NameConvertType<span>.</span>PascalCaseToUnderscoreWithLower<span>)</span>
            <span>.</span><span>UseMonitorCommand</span><span>(</span>cmd <span>=></span> Trace<span>.</span><span>WriteLine</span><span>(</span>cmd<span>.</span>CommandText<span>)</span><span>)</span>
            <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
    services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>fsql<span>)</span><span>;</span>
    services<span>.</span><span><span>AddScoped</span><span><span>&lt;</span>UnitOfWorkManager<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    services<span>.</span><span>AddFreeRepository</span><span>(</span><span>null</span><span>,</span> <span>typeof</span><span>(</span><span>Startup</span><span>)</span><span>.</span>Assembly<span>)</span><span>;</span>
    <span>//æ–°å¢è‡ªå·±çš„æœåŠ¡ï¼Œè¿™é‡Œåªæœ‰å®ç°</span>
    services<span>.</span><span><span>AddScoped</span><span><span>&lt;</span>TransBlogService<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><ul>
<li>appsettings.json</li>
</ul>
<div><pre><code><span>{</span>
  <span>"Mysql"</span><span>:</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=ovov_freesql_repository;Charset=utf8;SslMode=none;Max pool size=10"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><table>
<thead>
<tr>
<th>UnitOfWorkManager æˆå‘˜</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>IUnitOfWork Current</td>
<td>è¿”å›å½“å‰çš„å·¥ä½œå•å…ƒ</td>
</tr>
<tr>
<td>void Binding(repository)</td>
<td>å°†ä»“å‚¨çš„äº‹åŠ¡äº¤ç»™å®ƒç®¡ç†</td>
</tr>
<tr>
<td>IUnitOfWork Begin(propagation, isolationLevel)</td>
<td>åˆ›å»ºå·¥ä½œå•å…ƒ</td>
</tr>
</tbody>
</table>
<h3 id="transblogservice-cs" tabindex="-1"> TransBlogService.cs</h3>
<div><pre><code><span>private</span> <span>readonly</span> <span>IBaseRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span> _blogRepository<span>;</span>
<span>private</span> <span>readonly</span> <span>IBaseRepository<span>&lt;</span>Tag<span>,</span> <span>int</span><span>></span></span> _tagRepository<span>;</span>
<span>private</span> <span>readonly</span> <span>UnitOfWorkManager</span> _unitOfWorkManager<span>;</span>

<span>public</span> <span>TransBlogService</span><span>(</span><span>IBaseRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span> blogRepository<span>,</span> <span>IBaseRepository<span>&lt;</span>Tag<span>,</span> <span>int</span><span>></span></span> tagRepository<span>,</span><span>UnitOfWorkManager</span> unitOfWorkManager<span>)</span>
<span>{</span>
    _blogRepository <span>=</span> blogRepository <span>;</span>
    _tagRepository <span>=</span> tagRepository <span>;</span>
    _unitOfWorkManager <span>=</span> unitOfWorkManager<span>;</span>
<span>}</span>

<span>public</span> <span>async</span> <span>Task</span> <span>CreateBlogUnitOfWorkAsync</span><span>(</span><span>Blog</span> blog<span>,</span>List<span>&lt;</span>Tag<span>></span>tagList<span>)</span>
<span>{</span>
    <span>using</span> <span>(</span><span>IUnitOfWork</span> unitOfWork <span>=</span> _unitOfWorkManager<span>.</span><span>Begin</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        <span>try</span>
        <span>{</span>
            <span>await</span> _blogRepository<span>.</span><span>InsertAsync</span><span>(</span>blog<span>)</span><span>;</span>
            tagList<span>.</span><span>ForEach</span><span>(</span>r <span>=></span>
            <span>{</span>
                r<span>.</span>PostId <span>=</span> blog<span>.</span>Id<span>;</span>
            <span>}</span><span>)</span><span>;</span>
            <span>await</span> _tagRepository<span>.</span><span>InsertAsync</span><span>(</span>tagList<span>)</span><span>;</span>
            unitOfWork<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
        <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span>
        <span>{</span>
            <span>//å®é™… å¯ä»¥ä¸Rollbackã€‚å› ä¸ºIUnitOfWorkå†…éƒ¨Disposeï¼Œä¼šæŠŠæ²¡æœ‰Commitçš„äº‹åŠ¡Rollbackå›æ¥ï¼Œä½†èƒ½æå‰Rollback</span>

            unitOfWork<span>.</span><span>Rollback</span><span>(</span><span>)</span><span>;</span>
            <span>//è®°å½•æ—¥å¿—ã€æˆ–ç»§ç»­throw;å‡ºæ¥</span>
        <span>}</span>
    <span>}</span>
<span>}</span>

<span>public</span> <span>async</span> <span>Task</span> <span>UpdateBlogAsync</span><span>(</span><span><span>int</span></span> id<span>)</span>
<span>{</span>
    <span>using</span> <span>(</span><span>IUnitOfWork</span> unitOfWork <span>=</span> _unitOfWorkManager<span>.</span><span>Begin</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        <span>try</span>
        <span>{</span>
            <span>Blog</span> blog <span>=</span> _blogRepository<span>.</span>Select<span>.</span><span>Where</span><span>(</span>r <span>=></span> r<span>.</span>Id <span>==</span> id<span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>
            blog<span>.</span>IsDeleted <span>=</span> <span>true</span><span>;</span>
            <span>await</span> _blogRepository<span>.</span><span>UpdateAsync</span><span>(</span>blog<span>)</span><span>;</span>
            unitOfWork<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
        <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span>
        <span>{</span>
           <span>//è®°å½•æ—¥å¿—ã€æˆ–ç»§ç»­throw;å‡ºæ¥</span>
            unitOfWork<span>.</span><span>Rollback</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br></div></div><table>
<thead>
<tr>
<th>IUnitOfWork æˆå‘˜</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>IFreeSql Orm</td>
<td>è¯¥å¯¹è±¡ Select/Delete/Insert/Update/InsertOrUpdate ä¸å·¥ä½œå•å…ƒäº‹åŠ¡ä¿æŒä¸€è‡´ï¼Œå¯çœç•¥ä¼ é€’ WithTransaction</td>
</tr>
<tr>
<td>DbTransaction GetOrBeginTransaction()</td>
<td>å¼€å¯äº‹åŠ¡ï¼Œæˆ–è€…è¿”å›å·²å¼€å¯çš„äº‹åŠ¡</td>
</tr>
<tr>
<td>void Commit()</td>
<td>æäº¤äº‹åŠ¡</td>
</tr>
<tr>
<td>void Rollback()</td>
<td>å›æ»šäº‹åŠ¡</td>
</tr>
<tr>
<td>DbContext.EntityChangeReport EntityChangeReport</td>
<td>å·¥ä½œå•å…ƒå†…çš„å®ä½“å˜åŒ–è·Ÿè¸ª</td>
</tr>
<tr>
<td>Dictionary&lt;string, object&gt; States</td>
<td>ç”¨æˆ·è‡ªå®šä¹‰çš„çŠ¶æ€æ•°æ®ï¼Œä¾¿äºæ‰©å±•</td>
</tr>
</tbody>
</table>
<h3 id="å®Œæ•´ä»£ç " tabindex="-1"> å®Œæ•´ä»£ç </h3>
<ul>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/ORM/FreeSql/OvOv.Core/Domain/Blog.cs" target="_blank" rel="noopener noreferrer">Blog.cs</a></li>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/ORM/FreeSql/OvOv.Core/Domain/Tag.cs" target="_blank" rel="noopener noreferrer">Tag.cs</a></li>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/ORM/FreeSql/OvOv.FreeSql.AutoFac.DynamicProxy/Services/TransBlogService.cs" target="_blank" rel="noopener noreferrer">TransBlogService.cs</a></li>
</ul>
<h3 id="é‡å†™ä»“å‚¨å®ç°" tabindex="-1"> é‡å†™ä»“å‚¨å®ç°</h3>
<p>ä»¥ä¸Šä½¿ç”¨çš„æ˜¯æ³›å‹ä»“å‚¨ï¼Œé‚£æˆ‘ä»¬å¦‚æœæ˜¯é‡å†™ä¸€ä¸ªä»“å‚¨ å¦‚ä½•ä¿æŒå’Œ<code>UnitOfWorkManager</code>åŒä¸€ä¸ªäº‹åŠ¡å‘¢ã€‚
ç»§æ‰¿ç°æœ‰çš„<code>DefaultRepository&lt;,&gt;</code>ä»“å‚¨ï¼Œå®ç°è‡ªå®šä¹‰çš„ä»“å‚¨<code>BlogRepository.cs</code>,</p>
<div><pre><code>    <span>public</span> <span>class</span> <span>BlogRepository</span> <span>:</span> <span><span>DefaultRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span><span>,</span> <span>IBlogRepository</span></span>
    <span>{</span>
        <span>public</span> <span>BlogRepository</span><span>(</span><span>UnitOfWorkManager</span> uowm<span>)</span> <span>:</span> <span>base</span><span>(</span>uowm<span>?.</span>Orm<span>,</span> uowm<span>)</span>
        <span>{</span>
        <span>}</span>

        <span>public</span> <span>List<span>&lt;</span>Blog<span>></span></span> <span>GetBlogs</span><span>(</span><span>)</span>
        <span>{</span>
            <span>return</span> Select<span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>å…¶ä¸­æ¥å£ã€‚<code>IBlogRepository.cs</code></p>
<div><pre><code>    <span>public</span> <span>interface</span> <span>IBlogRepository</span> <span>:</span> <span><span>IBaseRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span></span>
    <span>{</span>
        <span>List<span>&lt;</span>Blog<span>></span></span> <span>GetBlogs</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>åœ¨ startup.cs æ³¨å…¥æ­¤æœåŠ¡</p>
<div><pre><code>    services<span>.</span><span><span>AddScoped</span><span><span>&lt;</span>IBlogRepository<span>,</span> BlogRepository<span>></span></span></span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div>]]></content>
    <published>2021-08-21T05:59:59.000Z</published>
  </entry>
  <entry>
    <title type="html">IFreesql å’Œ Context</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/ifreesql-context.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/ifreesql-context.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ifreesql-å’Œ-context" tabindex="-1"> IFreesql å’Œ Context</h1>
<h3 id="ä¸¤è€…å¹¶å­˜" tabindex="-1"> ä¸¤è€…å¹¶å­˜</h3>
<p>åœ¨ Freesql ä¸­ï¼Œæ”¯æŒ IFreesql å’Œ Context ä¸¤ç§å½¢å¼ï¼Œè¿™ä¸¤ç§å½¢å¼çš„ä½¿ç”¨æ–¹æ³•å·®å¼‚ä¹Ÿæœ‰äº›å¤§ï¼Œå…¶ä¸­ Context è·Ÿ EFCore çš„ Context ä½¿ç”¨æ–¹å¼åŸºæœ¬ä¸€è‡´ï¼Œä½¿ç”¨ç®€å•ã€ä¾èµ–æ³¨å…¥æ–¹ä¾¿ã€‚</p>
<p>è€Œ IFreesql æ”¯æŒæ›´å¤šç»†ç²’åº¦çš„æ“ä½œã€‚åœ¨ Context ä¸­ï¼Œè¦åˆ é™¤å¤šä¸ªè¡Œè®°å½•ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢å®ä½“åï¼Œå†ä½¿ç”¨ <code>RemoveRange()</code> åˆ é™¤è¿™äº›å®ä½“ï¼Œå½“æ•°æ®é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œä¾¿ä¼šæ¶ˆè€—å¤§é‡æ—¶é—´å’Œæ€§èƒ½ã€‚è€Œ IFreesql ä¸­ï¼Œæ”¯æŒåµŒå…¥éƒ¨åˆ† SQL ï¼Œæ”¯æŒç»†ç²’åº¦çš„è¡Œè®°å½•æ“ä½œã€‚åœ¨ IFreesql ä¸­æ‰¹é‡åˆ é™¤ã€ä¿®æ”¹è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ SQL çš„æ¨¡å¼ï¼š</p>
<div><pre><code>            <span>await</span> _freesql<span>.</span><span><span>Update</span><span><span>&lt;</span>Roles<span>></span></span></span><span>(</span><span>)</span>
                <span>.</span><span>Set</span><span>(</span>x <span>=></span> x<span>.</span>IsDeleted<span>,</span> <span>1</span><span>)</span>
                <span>.</span><span>Where</span><span>(</span>x <span>=></span>  x<span>.</span>TenantId <span>==</span> tenantId <span>)</span>
                <span>.</span><span>ExecuteAffrowsAsync</span><span>(</span><span>)</span><span>;</span>

update roles <span>set</span> is_deleted<span>=</span><span>1</span> <span>where</span> <span>where</span> tenant_id<span>=</span><span>1</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>æ‰€ä»¥å¾€å¾€å°† IFreesql å’Œ Context å¹¶å­˜ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œæ ¹æ®åœºæ™¯ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼æ“ä½œæ•°æ®åº“ã€‚</p>
<h3 id="ä½¿ç”¨æ–¹æ³•" tabindex="-1"> ä½¿ç”¨æ–¹æ³•</h3>
<p>åœ¨ Freesql ä¸­ï¼ŒIFreesql çš„åˆ›å»ºéœ€è¦å®šä¹‰ä¸ºå•ä¾‹æ¨¡å¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>è€Œ Freesql ä¹Ÿæ”¯æŒäº†ç±»ä¼¼ EFCore çš„ Context æ¨¡å¼ã€‚é€šè¿‡å¼•å…¥ <code>FreeSql.DbContext</code> åº“ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ€§ã€Fluent api ç­‰é…ç½®å®ä½“æ˜ å°„ã€å¯¼èˆªå±æ€§ç­‰ï¼Œç”Ÿæˆç±»ä¼¼äº EFCore çš„ Context ç±»å‹ï¼Œç„¶åé€šè¿‡ä¾èµ–æ³¨å…¥å®ä¾‹åŒ–ä½¿ç”¨ã€‚</p>
<p>é€šè¿‡å®šä¹‰ Context ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® EFCore çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œå¿«é€ŸæŒæ¡ Freesql çš„ä½¿ç”¨ï¼Œç”šè‡³å¯ä»¥ç›´æ¥å°† EFCore Context è½¬ä¸º Freesql Contextï¼Œå› ä¸º Freesql Context æ”¯æŒäº† 95% çš„ EFCore Fluent api ã€‚</p>
<p>ä¸‹é¢è¯´è¯´å¦‚ä½•åˆ©ç”¨ Freesql æ›´åŠ æ–¹ä¾¿åœ°è¿ç§»æ•°æ®åº“ä»¥åŠå®šä¹‰ Contextã€‚</p>
<p>å®‰è£… Freesql å·¥å…·ï¼š</p>
<div><pre><code>dotnet tool <span>install</span> -g FreeSql.Generator
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ¥ç€è¿˜åŸæ•°æ®åº“è¡¨ä¸ºå®ä½“ï¼š</p>
<div><pre><code>FreeSql.Generator  -NameOptions <span>1,1</span>,0,1 -NameSpace AuthCenter.Database.Entities -DB <span>"MySql,data source=123.123.123.123;port=3306;user id=root;password=root;initial catalog=datab;charset=utf8;sslmode=none;max pool size=2"</span> -FileName <span>"{name}.cs"</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>è¿˜åŸçš„å®ä½“ç¤ºä¾‹ï¼š</p>
<div><pre><code>	<span>[</span><span><span>JsonObject</span><span><span>(</span>MemberSerialization<span>.</span>OptIn<span>)</span></span><span>,</span> <span>Table</span><span><span>(</span>Name <span>=</span> <span>"roles"</span><span>,</span> DisableSyncStructure <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
	<span>public</span> <span>partial</span> <span>class</span> <span>Roles</span>
	<span>{</span>

		<span>[</span><span><span>JsonProperty</span><span>,</span> <span>Column</span><span><span>(</span>Name <span>=</span> <span>"id"</span><span>,</span> DbType <span>=</span> <span>"bigint unsigned"</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
		<span>public</span> <span><span>ulong</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

		<span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
		<span>/// åˆ›å»ºæ—¶é—´</span>
		<span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
		<span>[</span>JsonProperty<span>,</span> <span>Column</span><span>(</span>Name <span>=</span> <span>"creation_time"</span><span>,</span> DbType <span>=</span> <span>"bigint unsigned"</span><span>)</span><span>]</span>
		<span>public</span> <span><span>ulong</span></span> CreationTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><p>åœ¨ Freesql ä¸­ï¼Œå®ä½“ç‰¹æ€§ä¼˜å…ˆäº Fluent apiï¼ŒåŒæ—¶ Freesql ä¹Ÿå…¼å®¹ EFCore çš„å®ä½“ç‰¹æ€§ã€‚</p>
<p>ç”±äº <code>FreeSql.Generator</code> å·¥å…·å¾ˆæ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¦å¤–ä½¿ç”¨ Fluent api å»å®šä¹‰å¤æ‚çš„é€»è¾‘ç»“æ„ã€‚</p>
<p>æ¥ç€å®šä¹‰ Contextï¼š</p>
<div><pre><code><span>using</span> <span>FreeSql</span><span>;</span>

<span>namespace</span> <span>My<span>.</span>Context</span>
<span>{</span>
    <span>public</span> <span>partial</span> <span>class</span> <span>AuthcenterContext</span> <span>:</span> <span><span>DbContext</span></span>
    <span>{</span>
        <span>private</span> <span>readonly</span> <span>IFreeSql</span> iFreesql<span>;</span>
        <span>public</span> <span>AuthcenterContext</span><span>(</span><span>)</span>
        <span>{</span>
        <span>}</span>

        <span>public</span> <span>AuthcenterContext</span><span>(</span><span>IFreeSql</span> freeSql<span>)</span>
        <span>{</span>
            iFreesql <span>=</span> freeSql<span>;</span>
        <span>}</span>

        <span>public</span> <span>virtual</span> <span>DbSet<span>&lt;</span>Roles<span>></span></span> Roles <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>protected</span> <span>override</span> <span><span>void</span></span> <span>OnConfiguring</span><span>(</span><span>DbContextOptionsBuilder</span> builder<span>)</span>
        <span>{</span>
            <span>// iFreesql.xxxx</span>
            <span>// ä½¿ç”¨ iFreesql è°ƒç”¨ Fluent api</span>
            builder<span>.</span><span>UseFreeSql</span><span>(</span>iFreesql<span>)</span><span>;</span>
        <span>}</span>

        <span>protected</span> <span>override</span> <span><span>void</span></span> <span>OnModelCreating</span><span>(</span><span>ICodeFirst</span> codefirst<span>)</span>
        <span>{</span>

        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br></div></div><blockquote>
<p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼ŒIFreesql å’Œ Context ä¸­çš„å®ä½“åŠå…¶å®ä½“ç‰¹æ€§ã€Fluent api ç­‰éƒ½ä¿æŒä¸€è‡´ã€‚</p>
</blockquote>
<p>æ¥ç€ï¼Œåœ¨ä¾èµ–æ³¨å…¥ä¸­ï¼Œå°† IFreesql å’Œ Context éƒ½æ³¨å…¥ã€‚</p>
<div><pre><code>        <span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
        <span>{</span>
            <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
              <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> <span>@"data source=123.123.123.123;port=3306;user id=root;password=root;initial catalog=authcenter;charset=utf8"</span><span>)</span>
              <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
            services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>fsql<span>)</span><span>;</span>
            services<span>.</span><span><span>AddFreeDbContext</span><span><span>&lt;</span>AuthcenterContext<span>></span></span></span><span>(</span>options <span>=></span> options<span>.</span><span>UseFreeSql</span><span>(</span>fsql<span>)</span><span>)</span><span>;</span>
        <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>æˆ‘ä»¬åœ¨ç±»å‹ä¸­é€šè¿‡ä¾èµ–æ³¨å…¥è·å–åˆ°è¿™ä¸¤ç§æœåŠ¡ï¼š</p>
<div><pre><code>        <span>private</span> <span>readonly</span> <span>IFreeSql</span> _freesql<span>;</span>
        <span>private</span> <span>readonly</span> <span>MyContext</span> _context<span>;</span>

        <span>public</span> <span>Test</span><span>(</span><span>IFreeSql</span> freeSql<span>,</span> <span>MyContext</span> context<span>)</span>
        <span>{</span>
            _freesql <span>=</span> freeSql<span>;</span>
            _context <span>=</span> context<span>;</span>
        <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>ç„¶åå°±å¯ä»¥å¿«ä¹åœ°ä½¿ç”¨ Freesql äº†ã€‚</p>
]]></content>
    <published>2021-07-14T05:16:31.000Z</published>
  </entry>
  <entry>
    <title type="html">WithSql</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/withsql.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/withsql.html"/>
    <updated>2022-05-31T14:08:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="withsql" tabindex="-1"> WithSql</h1>
<h2 id="withsql-è‡ªå®šä¹‰-sql" tabindex="-1"> WithSql è‡ªå®šä¹‰ SQL</h2>
<p>å®šä¹‰å®ä½“ç±»</p>
<div><pre><code>    <span>public</span> <span>class</span> <span>TestClass</span>
    <span>{</span>
        <span>[</span><span><span>Column</span><span><span>(</span>Name <span>=</span> <span>"ID"</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> No <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>int</span><span>?</span></span> Age <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>[</span><span><span>Column</span><span><span>(</span>Name <span>=</span> <span>"BIRTH_DAY"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span>DateTime<span>?</span></span> Birthday <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>decimal</span></span> Point <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>Sex<span>?</span></span> Sex <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
    <span>public</span> <span>enum</span> <span>Sex</span>
    <span>{</span>
        Boy<span>,</span>
        Girl
    <span>}</span>
    <span>public</span> <span>class</span> <span>TestClssDto</span>
    <span>{</span>
        <span>public</span> <span><span>string</span></span> ID <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

        <span>public</span> <span><span>int</span><span>?</span></span> Age <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

        <span>public</span> <span>DateTime<span>?</span></span> Birthday <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br></div></div><p>ä¸åŒçš„æŸ¥è¯¢æ–¹å¼ã€‚</p>
<ul>
<li>è¿”å›<code>DataTable</code></li>
<li>è¿”å›<code>List&lt;Tuplue&gt;</code> å³<code>List&lt;(string,string)&gt;</code>å…ƒç»„</li>
<li>è¿”å›<code>List&lt;object&gt;</code> ä¸”èƒ½æ”¯æŒåˆ†é¡µ</li>
<li>è¿”å›<code>List&lt;TestClassDto&gt;</code>ä¸”èƒ½æ”¯æŒåˆ†é¡µ</li>
</ul>
<h3 id="_1-è¿”å›-datatable" tabindex="-1"> 1.è¿”å› DataTable</h3>
<div><pre><code><span>DataTable</span> dt1 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
    <span>.</span><span>ToDataTable</span><span>(</span><span>"ID,Age"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><div><pre><code><span>SELECT</span> ID<span>,</span>Age
    <span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="_2-è¿”å›-datatable" tabindex="-1"> 2.è¿”å› DataTable</h3>
<div><pre><code><span>DataTable</span> dt2 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
    <span>.</span><span>ToDataTable</span><span>(</span><span>"*"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><div><pre><code><span>SELECT</span> <span>*</span>
<span>FROM</span> <span>(</span> <span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="_3-è¿”å›list-tuplue-å³list-string-string-å…ƒç»„" tabindex="-1"> 3.è¿”å›<code>List&lt;Tuplue&gt;</code> å³<code>List&lt;(string,string)&gt;</code> å…ƒç»„</h3>
<div><pre><code><span>List<span>&lt;</span><span>(</span><span>string</span><span>,</span><span>string</span><span>)</span><span>></span></span> list1 <span>=</span> _fsql
    <span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
    <span>.</span><span><span>ToList</span><span><span>&lt;</span><span>(</span><span>string</span><span>,</span> <span>string</span><span>)</span><span>></span></span></span><span>(</span><span>"ID,Age"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span>SELECT</span> ID<span>,</span> Age
    <span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="_4-è¿”å›list-object" tabindex="-1"> 4.è¿”å›<code>List&lt;object&gt;</code></h3>
<div><pre><code><span><span>var</span></span> list2 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
    <span>.</span><span><span>ToList</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>"*"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><div><pre><code><span>SELECT</span> <span>*</span>
    <span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="_5-è¿”å›list-object-ä¸”èƒ½æ”¯æŒåˆ†é¡µ" tabindex="-1"> 5.è¿”å›<code>List&lt;object&gt;</code> ä¸”èƒ½æ”¯æŒåˆ†é¡µ</h3>
<div><pre><code>  <span><span>var</span></span> list3 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
    <span>.</span><span>WhereIf</span><span>(</span><span>true</span><span>,</span> <span>"1=1"</span><span>)</span>
    <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span><span>.</span><span>OrderBy</span><span>(</span><span>"ID DESC"</span><span>)</span>
    <span>.</span><span><span>ToList</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>"ID,Age"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><div><pre><code><span>SELECT</span> ID<span>,</span> Age
    <span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
    <span>WHERE</span><span>(</span><span>1</span> <span>=</span> <span>1</span><span>)</span>
    <span>ORDER</span> <span>BY</span> ID <span>DESC</span>
    <span>limit</span> <span>0</span><span>,</span><span>10</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h3 id="_6-è¿”å›list-testclassdto-ä¸”èƒ½æ”¯æŒåˆ†é¡µ" tabindex="-1"> 6.è¿”å›<code>List&lt;TestClassDto&gt;</code>ä¸”èƒ½æ”¯æŒåˆ†é¡µ</h3>
<div><pre><code><span><span>var</span></span> list4 <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"select * from TestClass "</span><span>)</span>
    <span>.</span><span>WhereIf</span><span>(</span><span>true</span><span>,</span> <span>"1=1"</span><span>)</span>
    <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
    <span>.</span><span>OrderBy</span><span>(</span><span>"ID DESC"</span><span>)</span>
    <span>.</span><span><span>ToList</span><span><span>&lt;</span>TestClssDto<span>></span></span></span><span>(</span><span>"ID,Age,BIRTH_DAY as Birthday"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><div><pre><code><span>SELECT</span> ID<span>,</span>Age<span>,</span>BIRTH_DAY <span>as</span> Birthday
    <span>FROM</span><span>(</span><span>select</span> <span>*</span> <span>from</span> TestClass  <span>)</span> a
    <span>WHERE</span><span>(</span><span>1</span> <span>=</span> <span>1</span><span>)</span>
    <span>ORDER</span> <span>BY</span> ID <span>DESC</span>
    <span>limit</span> <span>0</span><span>,</span><span>10</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="é€šè¿‡-withsql-tosql-å®ç°-union-all-æŸ¥è¯¢æ–¹æ³•" tabindex="-1"> é€šè¿‡ WithSql+ ToSQL å®ç° Union ALL æŸ¥è¯¢æ–¹æ³•</h2>
<h3 id="_1ã€äºŒæ¬¡-iselect-æŸ¥è¯¢-withsql-ä½¿ç”¨å¤šæ¬¡-ç­‰äº-union-all-æŸ¥è¯¢" tabindex="-1"> 1ã€äºŒæ¬¡ ISelect æŸ¥è¯¢ï¼šWithSql ä½¿ç”¨å¤šæ¬¡ï¼Œç­‰äº UNION ALL æŸ¥è¯¢</h3>
<p>WithSql ä½¿ç”¨å¤šæ¬¡ä¸º UNION ALL æŸ¥è¯¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ ISelect.ToSql(FieldAliasOptions.AsProperty) å¾—åˆ°ç”Ÿæˆçš„ SQLï¼Œå¦‚ä¸‹ï¼š</p>
<div><pre><code><span><span>var</span></span> sql1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"xxx"</span><span>)</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> sql2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"yyy"</span><span>)</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span>sql1<span>)</span>
    <span>.</span><span>WithSql</span><span>(</span>sql2<span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><div><pre><code><span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
<span>FROM</span> <span>(</span> <span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
    <span>FROM</span> <span><span>`</span>tb_topic<span>`</span></span> a
    <span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>LIKE</span> <span>'%xxx%'</span><span>)</span> <span>)</span> a<span>)</span> ftb

<span>UNION</span> <span>ALL</span>

<span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
<span>FROM</span> <span>(</span> <span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
    <span>FROM</span> <span><span>`</span>tb_topic<span>`</span></span> a
    <span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>LIKE</span> <span>'%yyy%'</span><span>)</span> <span>)</span> a<span>)</span> ftb
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h3 id="_2ã€è·¨åˆ†è¡¨æŸ¥è¯¢-astable-ç›¸åŒå®ä½“å¤šæ¬¡æ“ä½œ-ç­‰äº-union-all-æŸ¥è¯¢" tabindex="-1"> 2ã€è·¨åˆ†è¡¨æŸ¥è¯¢ï¼šAsTable ç›¸åŒå®ä½“å¤šæ¬¡æ“ä½œï¼Œç­‰äº Union ALL æŸ¥è¯¢</h3>
<div><pre><code><span><span>var</span></span> sql <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>AsTable</span><span>(</span><span>(</span>type<span>,</span> oldname<span>)</span> <span>=></span> <span>"table_1"</span><span>)</span>a
    <span>.</span><span>AsTable</span><span>(</span><span>(</span>type<span>,</span> oldname<span>)</span> <span>=></span> <span>"table_2"</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span>select</span> <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span>"Id"</span> as1 <span>FROM</span> <span>"table_1"</span> a<span>)</span> ftb
<span>UNION</span> <span>ALL</span>
<span>select</span> <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span>"Id"</span> as1 <span>FROM</span> <span>"table_2"</span> a<span>)</span> ftb
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h3 id="_3ã€åˆ©ç”¨-tosql-æ‹¼æ¥æ–°çš„-sql-ä½¿ç”¨-iado-æ‰§è¡Œ" tabindex="-1"> 3ã€åˆ©ç”¨ ToSql æ‹¼æ¥æ–°çš„ SQLï¼Œä½¿ç”¨ IAdo æ‰§è¡Œ</h3>
<div><pre><code><span><span>var</span></span> sql1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>></span> <span>100</span> <span>&amp;&amp;</span> a<span>.</span>Id <span>&lt;</span> <span>200</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Id<span>,</span> a<span>.</span>Title <span>}</span><span>,</span> FieldAliasOptions<span>.</span>AsProperty<span>)</span><span>;</span>
<span><span>var</span></span> sql2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>></span> <span>1001</span> <span>&amp;&amp;</span> a<span>.</span>Id <span>&lt;</span> <span>1200</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Id<span>,</span> a<span>.</span>Title <span>}</span><span>,</span> FieldAliasOptions<span>.</span>AsProperty<span>)</span><span>;</span>

fsql<span>.</span>Ado<span>.</span><span>CommandFluent</span><span>(</span><span><span>$"</span><span><span>{</span><span>sql1</span><span>}</span></span><span> UNION ALL </span><span><span>{</span><span>sql2</span><span>}</span></span><span>"</span></span><span>)</span>
    <span>.</span><span>ExecuteDataTable</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="åˆ†é¡µé—®é¢˜" tabindex="-1"> åˆ†é¡µé—®é¢˜</h2>
<p>Union All ä¹‹å å¦‚æœç›´æ¥ åˆ†é¡µä¼šæœ‰ä¸€ä¸ªé—®é¢˜ã€‚è¯·çœ‹å…·ä½“ç¤ºä¾‹</p>
<p>å¤šæ¬¡ WithSql + Page å­˜åœ¨é—®é¢˜ï¼šæ¯ä¸ª WithSql å†…éƒ½æœ‰ä¸€ä¸ª Page åˆ†é¡µ</p>
<div><pre><code><span><span>var</span></span> sql1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"xxx"</span><span>)</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> sql2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"yyy"</span><span>)</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>WithSql</span><span>(</span>sql1<span>)</span><span>.</span><span>WithSql</span><span>(</span>sql2<span>)</span><span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>20</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><div><pre><code> <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
    <span>FROM</span> <span>(</span> <span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
        <span>FROM</span> <span><span>`</span>tb_topic<span>`</span></span> a
        <span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>LIKE</span> <span>'%xxx%'</span><span>)</span> <span>)</span> a
    <span>limit</span> <span>0</span><span>,</span><span>20</span><span>)</span> ftb

    <span>UNION</span> <span>ALL</span>

    <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
    <span>FROM</span> <span>(</span> <span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
        <span>FROM</span> <span><span>`</span>tb_topic<span>`</span></span> a
        <span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>LIKE</span> <span>'%yyy%'</span><span>)</span> <span>)</span> a
    <span>limit</span> <span>0</span><span>,</span><span>20</span><span>)</span> ftb

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>å¤šä¸ª sql union all ä½¿ç”¨ withsqlï¼Œç›´æ¥ Page åˆ†é¡µï¼Œä¼šå¯¼è‡´æ¯ä¸ªå­è¡¨éƒ½ç”Ÿæ•ˆï¼Œå­è¡¨éƒ½ç”Ÿæˆåˆ†é¡µã€‚</p>
<p>WithSql å¯ä»¥å’Œ AsTable å®ç°åˆ†è¡¨çš„åŠŸèƒ½ã€‚</p>
<p>åˆ†è¡¨è·¨è¡¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œåˆ†é¡µæ˜¯è¦å‘æ¯ä¸ªå­è¡¨ï¼ˆå³æ¯ä¸ª WithSql ä¸­çš„ SQL åˆ†é¡µï¼‰éƒ½ç”Ÿæ•ˆã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ" tabindex="-1"> è§£å†³æ–¹æ¡ˆ</h3>
<p>å¤šæ¬¡ withsql ï¼Œå¦‚éœ€åˆ†é¡µï¼Œéœ€è¦æŒ‰ä¸‹é¢çš„äºŒæ­¥æ“ä½œ</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šé€šè¿‡ witsqlï¼Œå°†äºŒä¸ª sql ç»„æˆä¸€ä¸ª sqlã€‚</li>
</ul>
<div><pre><code> <span><span>var</span></span> sql <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"SELECT * FROM tb_topic where id > 11"</span><span>)</span>
    <span>.</span><span>WithSql</span><span>(</span><span>"SELECT * FROM tb_topic where id &lt; 10"</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span><span>"*"</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å¦‚ä¸Šç”Ÿæˆçš„ UOION ALL çš„ sql</p>
<div><pre><code><span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> <span>*</span>
    <span>FROM</span> <span>(</span> <span>SELECT</span> <span>*</span> <span>FROM</span> tb_topic <span>where</span> id <span>></span> <span>11</span> <span>)</span> a<span>)</span> ftb

    <span>UNION</span> <span>ALL</span>

    <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> <span>*</span>
    <span>FROM</span> <span>(</span> <span>SELECT</span> <span>*</span> <span>FROM</span> tb_topic <span>where</span> id <span>&lt;</span> <span>10</span> <span>)</span> a<span>)</span> ftb
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><ul>
<li>ç¬¬äºŒæ­¥ï¼šä¹‹å è°ƒç”¨ Page åˆ™æ˜¯é€šè¿‡ Union ALL åçš„ç»“æœä¸Šåˆ†é¡µ</li>
</ul>
<div><pre><code> <span><span>var</span></span> sql2 <span>=</span> g<span>.</span>mysql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
     <span>.</span><span>WithSql</span><span>(</span>sql<span>)</span>
     <span>.</span><span>Page</span><span>(</span><span>2</span><span>,</span> <span>10</span><span>)</span>
     <span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Clicks<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TypeGuid<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CreateTime<span>`</span></span>
<span>FROM</span> <span>(</span> <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> <span>*</span>
    <span>FROM</span> <span>(</span> <span>SELECT</span> <span>*</span> <span>FROM</span> tb_topic <span>where</span> id <span>></span> <span>11</span> <span>)</span> a<span>)</span> ftb

    <span>UNION</span> <span>ALL</span>

    <span>SELECT</span>  <span>*</span> <span>from</span> <span>(</span><span>SELECT</span> <span>*</span>
    <span>FROM</span> <span>(</span> <span>SELECT</span> <span>*</span> <span>FROM</span> tb_topic <span>where</span> id <span>&lt;</span> <span>10</span> <span>)</span> a<span>)</span> ftb <span>)</span> a
<span>limit</span> <span>10</span><span>,</span><span>10</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div>]]></content>
    <published>2021-06-16T16:56:09.000Z</published>
  </entry>
  <entry>
    <title type="html">Awesome FreeSql</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/reference/awesome-freesql.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/reference/awesome-freesql.html"/>
    <updated>2022-05-19T13:04:10.000Z</updated>
    <content type="html"><![CDATA[<h1 id="awesome-freesql" tabindex="-1"> Awesome FreeSql</h1>
<h2 id="freesql-å®˜æ–¹åšå®¢" tabindex="-1"> FreeSql å®˜æ–¹åšå®¢</h2>
<ul>
<li><a href="https://www.cnblogs.com/kellynic/" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/kellynic/</a></li>
<li><a href="https://www.cnblogs.com/freesql/" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/freesql/</a></li>
</ul>
<h2 id="å®˜æ–¹æ–‡æ¡£" tabindex="-1"> å®˜æ–¹æ–‡æ¡£</h2>
<ul>
<li><a href="http://freesql.net" target="_blank" rel="noopener noreferrer">http://freesql.net</a></li>
<li><a href="https://github.com/dotnetcore/FreeSql/wiki" target="_blank" rel="noopener noreferrer">https://github.com/dotnetcore/FreeSql/wiki</a></li>
<li><a href="http://124.70.130.97:8082/api/index.html" target="_blank" rel="noopener noreferrer">API å‚è€ƒ(å›½å†…é•œåƒ)</a></li>
<li><a href="https://docs.dotnet-china.com/FreeSql/index.html" target="_blank" rel="noopener noreferrer">API å‚è€ƒ</a></li>
</ul>
<h2 id="æºç " tabindex="-1"> æºç </h2>
<ul>
<li>GitHub <a href="https://github.com/dotnetcore/FreeSql" target="_blank" rel="noopener noreferrer">https://github.com/dotnetcore/FreeSql</a></li>
<li>Gitee <a href="https://gitee.com/FreeSql/FreeSql-ORM" target="_blank" rel="noopener noreferrer">https://gitee.com/FreeSql/FreeSql-ORM</a></li>
</ul>
<h2 id="ç›¸å…³åšå®¢æŒ‡å—" tabindex="-1"> ç›¸å…³åšå®¢æŒ‡å—</h2>
<ul>
<li><a href="https://www.cnblogs.com/igeekfan/p/cap_freesql_flush.html" target="_blank" rel="noopener noreferrer">FreeSql æ¥å…¥ CAP çš„å®è·µ</a></li>
<li><a href="https://www.cnblogs.com/igeekfan/p/freesql-generator.html" target="_blank" rel="noopener noreferrer">FreeSql.Generator å‘½ä»¤è¡Œä»£ç ç”Ÿæˆå™¨æ˜¯å¦‚ä½•å®ç°çš„</a></li>
<li><a href="https://www.cnblogs.com/igeekfan/p/aop-freesql-autofac.html" target="_blank" rel="noopener noreferrer">AOP +FreeSql è·¨æ–¹æ³•å¼‚æ­¥äº‹åŠ¡</a></li>
</ul>
<h2 id="ä»¥ä¸‹å¯ä»github-issues-docsæ‰¾åˆ°" tabindex="-1"> ä»¥ä¸‹å¯ä»<a href="https://github.com/dotnetcore/FreeSql/issues?q=label%3Adocs" target="_blank" rel="noopener noreferrer">GitHub Issues Docs</a>æ‰¾åˆ°</h2>
<ul>
<li><a href="https://github.com/dotnetcore/FreeSql/issues/601" target="_blank" rel="noopener noreferrer">CentOS8 ARM ä¸‹è¿æ¥ SQL Server 2008 R2ï¼ˆHypervisorï¼‰</a></li>
<li><a href="https://github.com/dotnetcore/FreeSql/issues/650" target="_blank" rel="noopener noreferrer">.net5 ç½‘ç«™ä½¿ç”¨ Sqlserver æ•°æ®åº“éƒ¨ç½²åœ¨ docker å®¹å™¨å†…è¿è¡ŒæŠ¥ä¸»åº“é“¾æ¥å¤±è´¥</a></li>
<li><a href="https://github.com/dotnetcore/FreeSql/issues/652" target="_blank" rel="noopener noreferrer">æŠ€å·§ï¼šè‡ªå®šä¹‰è§£æè¡¨è¾¾å¼æ ‘ï¼Œå®ç°åŠ¨æ€èšåˆåˆ— sum(case when )</a></li>
<li><a href="https://github.com/dotnetcore/FreeSql/issues/644" target="_blank" rel="noopener noreferrer">æŠ€å·§ï¼šISelect å¦‚ä½•æ‹·è´(copy)å¤ç”¨ï¼Œå…‹éš†(clone) </a></li>
<li><a href="https://github.com/dotnetcore/FreeSql/issues/473" target="_blank" rel="noopener noreferrer">FreeSql å¦‚ä½•å®ç°å®¡è®¡è·Ÿè¸ªè¡¨</a></li>
<li><a href="https://github.com/dotnetcore/FreeSql/issues/430" target="_blank" rel="noopener noreferrer">ä¸€å¯¹å¤šå…³ç³»ï¼Œåˆ†è¡¨åªå–å…³è”çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œå¦‚ä½•è·å–</a></li>
</ul>
<h2 id="åŸºäº-freesql-çš„å¼€æºé¡¹ç›®" tabindex="-1"> åŸºäº FreeSql çš„å¼€æºé¡¹ç›®</h2>
<h3 id="zhontai-net-admin-åå°ç®¡ç†ç³»ç»Ÿ" tabindex="-1"> <a href="https://github.com/zhontai/Admin.Core" target="_blank" rel="noopener noreferrer">zhontai.net Admin åå°ç®¡ç†ç³»ç»Ÿ</a></h3>
<p><code>Admin</code>åç«¯ï¼Œå‰åç«¯åˆ†ç¦»çš„æƒé™ç®¡ç†ç³»ç»Ÿï¼Œé›†æˆç»Ÿä¸€è®¤è¯æˆæƒã€å¤šç§Ÿæˆ·ã€ç¼“å­˜ã€<code>Ip</code>é™æµã€å…¨<code>Api</code>é‰´æƒã€‚æ”¯æŒå›½å†…å¤–ä¸»æµæ•°æ®åº“è‡ªç”±åˆ‡æ¢å’ŒåŠ¨æ€é«˜çº§æŸ¥è¯¢ï¼ŒåŸºäº<code>.Net</code>è·¨å¹³å°å¼€å‘çš„ WebApi</p>
<h3 id="a-simple-and-practical-cms-implemented-by-net-core" tabindex="-1"> <a href="https://github.com/luoyunchong/lin-cms-dotnetcore" target="_blank" rel="noopener noreferrer">A simple and practical CMS implemented by .NET Core</a></h3>
<p>æœ¬é¡¹ç›®æ˜¯ <a href="https://github.com/luoyunchong/lin-cms-vue" target="_blank" rel="noopener noreferrer">Lin CMS</a> åç«¯çš„ <code>.NET5</code> å®ç°ï¼Œé€šè¿‡<code>Vue.js</code>å®ç°çš„å‰åç«¯åˆ†ç¦»<code>CMS</code>å¹³å°ï¼Œç›®å‰å®ç°ç®€çº¦çš„æƒé™ç®¡ç†ç³»ç»Ÿã€åŸºç¡€å­—å…¸é¡¹ç®¡ç†ã€éšç¬”ä¸“æ ï¼Œè¯„è®ºç‚¹èµï¼Œæ¶ˆæ¯é€šçŸ¥ï¼Œæ ‡ç­¾ç­‰ä»¿æ˜é‡‘æ¨¡å—ã€‚</p>
<h3 id="iusaas-com-saas-ä¼ä¸šåº”ç”¨ç®¡ç†ç³»ç»Ÿ" tabindex="-1"> <a href="https://github.com/alonsoalon/TenantSite.Server" target="_blank" rel="noopener noreferrer">iusaas.com SaaS ä¼ä¸šåº”ç”¨ç®¡ç†ç³»ç»Ÿ</a></h3>
<p>ä¼ä¸šåº”ç”¨ç®¡ç†ç³»ç»Ÿï¼Œå®šä½äºä¼ä¸šåº”ç”¨çš„ SaaS æœåŠ¡æ¡†æ¶ï¼Œä¼ä¸šäº‘ç«¯åº”ç”¨çš„åŸºç¡€å¼€å‘æ¡†æ¶ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥éƒ¨ç½²äºæœ¬åœ°ï¼‰ï¼Œç³»ç»Ÿè¢«è®¾è®¡ç”¨äºå¤šç§Ÿæˆ·ï¼Œé‡‡ç”¨å‰ç«¯åç«¯å®Œå…¨åˆ†ç¦»æŠ€æœ¯æ–¹æ¡ˆã€‚ æŠ½ç¦»ä¼ä¸šåº”ç”¨è½¯ä»¶ç ”å‘å…¬å…±éƒ¨åˆ†ï¼Œè®©ç ”å‘äººå‘˜æœ‰æ¡ä»¶
èšç„¦åœ¨ä¸šåŠ¡ç ”å‘ï¼Œå®ç°äº†ç”¨äºæƒé™ç®¡ç†çš„åŸºç¡€æ•°æ®ç»´æŠ¤ï¼Œæƒé™èµ‹æƒï¼Œç¼“å­˜ï¼Œä¸Šä¼ ç­‰å¸¸è§„åŠŸèƒ½ã€‚</p>
<h3 id="easycms-ä¼ä¸šå»ºç«™-äº‹ä¸šå•ä½ä½¿ç”¨çš„-cms-ç®¡ç†ç³»ç»Ÿ" tabindex="-1"> <a href="https://github.com/jasonyush/EasyCMS" target="_blank" rel="noopener noreferrer">EasyCms ä¼ä¸šå»ºç«™ï¼Œäº‹ä¸šå•ä½ä½¿ç”¨çš„ CMS ç®¡ç†ç³»ç»Ÿ</a></h3>
<p>EasyCms åå°æƒé™ç®¡ç†ç³»ç»Ÿ åŸºäº<code>Asp.net Core</code>çš„åå°å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œå¯ç”¨äºå¿«é€Ÿå¼€å‘ ä¼ä¸šåå°ç®¡ç†ç³»ç»Ÿï¼ŒWebApi æ¥å£ï¼Œå¾®ä¿¡å…¬ä¼—å·å’Œå°ç¨‹åºåå°ï¼Œä¼ä¸šç«™ã€‚</p>
<h3 id="fscms-å†…å®¹ç®¡ç†ç³»ç»Ÿ" tabindex="-1"> <a href="https://github.com/hejiyong/fscms" target="_blank" rel="noopener noreferrer">fscms å†…å®¹ç®¡ç†ç³»ç»Ÿ</a></h3>
<p>å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ŒåŠ¨æ€åŒæ­¥ md æ–‡ä»¶ç”Ÿæˆæ–‡æ¡£ã€‚</p>
<h3 id="freesql-çš„å„ç§å·¥ç¨‹-demo-console-xamarin-app-ios-android-wpf-blazor-nf461" tabindex="-1"> <a href="https://github.com/densen2014/FreeSqlDemos" target="_blank" rel="noopener noreferrer">FreeSql çš„å„ç§å·¥ç¨‹ demo, console,xamarin app,ios,android,wpf,blazor,nf461 ...</a></h3>
<h3 id="åŸºäº-net-core-3-1-æˆ–-net-5-æ¡†æ¶ç®€å•-2-å±‚æ¶æ„-å®ç°åŸºäºæƒé™è§’è‰²çš„é¡µé¢çº§æƒé™åå°æ¡†æ¶" tabindex="-1"> <a href="https://gitee.com/sundayisblue/BoYuanCore/" target="_blank" rel="noopener noreferrer">åŸºäº.Net Core 3.1 æˆ– .Net 5 æ¡†æ¶ç®€å• 2 å±‚æ¶æ„ï¼Œå®ç°åŸºäºæƒé™è§’è‰²çš„é¡µé¢çº§æƒé™åå°æ¡†æ¶</a></h3>
<p>å®ç°é¡µé¢æƒé™åŸºäºæƒé™è§’è‰²çš„åå°æ¡†æ¶ï¼Œé…å¥—å®Œå–„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå¯å¼€ç®±å³ç”¨ï¼Œé€‚ç”¨äºä¸­å°å‹é¡¹ç›®å¿«é€Ÿå¼€å‘ã€‚ é¡¹ç›®ä¸º<code>.Net Core 3.1</code>æˆ–<code>.Net 5</code>ï¼Œä½¿ç”¨ç®€å•çš„<code>service</code>åˆ†å±‚æ¶æ„ï¼Œå‰ç«¯ä¸º<code>FineUICore</code> , æ•°æ®å±‚ä½¿ç”¨ FreeSql ORM+
é›ªèŠ±ç®—æ³•å®ä½“æ¨¡å¼ï¼Œå…¼å®¹å„ç§ä¸åŒçš„æ•°æ®åº“è¿ç§»(æ”¯æŒçš„æ•°æ®åº“ï¼š<code>SqlServer</code>, <code>Mysql</code>, <code>Postgresql</code>,<code>Oracle</code> ç­‰)ï¼Œå¹¶æœ‰å®Œå–„çš„å¼‚å¸¸æ‹¦æˆªå†™å…¥æ—¥å¿—åŠŸèƒ½ã€‚ ä¼˜ç§€çš„ç¼–ç ä½“éªŒï¼Œå±‚æ¬¡åˆ†æ˜ï¼Œç®€å•æ˜“å­¦ï¼Œä»è€Œå®ç°å¿«é€Ÿå¼€å‘çš„ç›®çš„ï¼Œ
æˆ–å…¥é—¨å­¦ä¹ <code>.Net Core</code>ã€‚</p>
<h3 id="åŸºäº-net-5-å¹³å°çš„å¿«é€Ÿå¼€å‘æ¡†æ¶" tabindex="-1"> <a href="https://gitee.com/rongguohao/HaoHaoPlay_Back" target="_blank" rel="noopener noreferrer">åŸºäº.Net 5 å¹³å°çš„å¿«é€Ÿå¼€å‘æ¡†æ¶</a></h3>
<p>åŸºäº<code>.Net 5</code>å¹³å°çš„å¿«é€Ÿå¼€å‘æ¡†æ¶ã€‚
ç›®å‰ç³»ç»ŸåŒ…å«åŠŸèƒ½æœ‰ç™»å½•ï¼Œç”¨æˆ·ç®¡ç†ï¼Œåº”ç”¨èœå•ç®¡ç†ï¼Œæƒé™ç®¡ç†ï¼Œå­—å…¸ç®¡ç†ï¼Œé€€å‡ºç™»å½•ï¼Œä¹Ÿæ–¹ä¾¿æ‰©å±•å¤šç§Ÿæˆ·ä½¿ç”¨ã€‚
é€šè¿‡è¿™äº›åŸºç¡€åŠŸèƒ½çš„å®ç°ï¼Œåˆ†äº«è‡ªå·±å¯¹ç³»ç»Ÿæ¡†æ¶è®¾è®¡çš„ç†è§£ï¼Œå¯¹<code>ddd</code>è®¾è®¡çš„ç†è§£ï¼Œå¸Œæœ›å¯¹å¤§å®¶å­¦ä¹ ä½¿ç”¨<code>.net core</code>æœ‰å¸®åŠ©ï¼Œå°‘è¸©ä¸€äº›å‘ï¼Œå½“ç„¶ä¹Ÿä¼šå­˜åœ¨ä¸è¶³ä¹‹å¤„ï¼Œè¿˜æœ›æŒ‡å‡ºã€‚</p>
<h3 id="yc-boilerplate" tabindex="-1"> <a href="https://github.com/linbin524/yc.boilerplate" target="_blank" rel="noopener noreferrer">YC.Boilerplate</a></h3>
<p>æ˜¯ä¸€å¥—å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œé‡‡ç”¨å½“ä¸‹æµè¡Œçš„å‰åç«¯åˆ†ç¦»å¼€å‘æ¨¡å¼ï¼Œå‰ç«¯ é‡‡ç”¨<code>VUE</code>ã€åç«¯é‡‡ç”¨<code>Net 5.0</code>
æ¡†æ¶å®ç°äº† å¤šç§Ÿæˆ·ã€åŠ¨æ€<code>webApi</code>ã€å¤šç§<code>ORM</code>ã€<code>IOC</code>ã€æ•°æ®åº“è¡¨å’Œä¸šåŠ¡ä»£ç ç”Ÿæˆç­‰ç­‰ä¸€ç³»åˆ—æ¨¡å—ï¼Œå¹¶å¼€å‘äº†ç”¨æˆ·ç®¡ç†ã€è§’è‰²æƒé™ã€ç»„ç»‡æœºæ„ã€ æ•°æ®å­—å…¸ã€å®¡è®¡æ—¥å¿—ç­‰å¸¸è§„åŠŸèƒ½ã€‚</p>
<p>æ¡†æ¶çš„å®—æ—¨:æ„å»ºä¸€å¥—æ¾è€¦åˆã€çµæ´»ç»„åˆã€åŠŸèƒ½é½å…¨ã€å¼€å‘ä¾¿æ·ã€å‡å°‘å¼€å‘å·¥ä½œé‡çš„æ ·æ¿åŒ–å¼€å‘æ¡†æ¶ã€‚</p>
]]></content>
    <published>2021-02-09T12:13:50.000Z</published>
  </entry>
  <entry>
    <title type="html">ç‰¹åˆ«é¸£è°¢</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/reference/donation.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/reference/donation.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ç‰¹åˆ«é¸£è°¢" tabindex="-1"> ç‰¹åˆ«é¸£è°¢</h1>
<table>
<thead>
<tr>
<th>æèµ è€…</th>
<th>é‡‘é¢</th>
<th>ç•™è¨€</th>
</tr>
</thead>
<tbody>
<tr>
<td>L*y</td>
<td>58 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>èŠ±èŠ±</td>
<td>88 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>éº¦å…œå¾ˆä¹–</td>
<td>50 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>ç½‘ç»œæ¥è€…</td>
<td>2000 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>John</td>
<td>99.99 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>alex</td>
<td>666 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>bacongao</td>
<td>36 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>æ— å</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>Eternity</td>
<td>188 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>æ— å</td>
<td>10 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>âŒ’.Helper~..oO</td>
<td>66 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>ä¹ æƒ¯ä¸è¢«ä¹ æƒ¯</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>æ— å</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>è”¡æ˜“å–‹</td>
<td>88.88 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>ä¸­è®¯ç§‘æŠ€</td>
<td>1000 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>Good Good Work</td>
<td>24 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>ç‚½ç„°</td>
<td>6.6 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>Nothing</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>å…°å·å¤©æ“èµµ</td>
<td>500 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>å“ˆåˆ©è·¯äºš</td>
<td>300 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>æ— å</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>è›°ä¼</td>
<td>99.99 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>TCYM</td>
<td>66.66 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>MOTA</td>
<td>5 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>LDZXG</td>
<td>30 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>Near</td>
<td>30 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>å»ºçˆ½</td>
<td>66 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>æ— å</td>
<td>200 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>LambertWu</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>æ— å</td>
<td>18.88 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>ä¹Œé¾™</td>
<td>50 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>æ— å</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>é™³æ€¼æ€¼</td>
<td>66.66 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>é™³æ€¼æ€¼</td>
<td>66.66 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>ä¸æ·®</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>æä¼Ÿåš-Excel å‚¬åŒ–å‰‚</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>ç™½ç‹</td>
<td>6.66 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>å¥¹å¾®ç¬‘çš„è„¸ y</td>
<td>30 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>Eternity2o21</td>
<td>588 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>å¤œå½’æŸ´é—¨</td>
<td>88 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>è”¡æ˜“å–‹</td>
<td>666.66 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>*ç¤¼</td>
<td>10 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>litrpa</td>
<td>88 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>Alax CHOW</td>
<td>200 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>Daily</td>
<td>66 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>k*t</td>
<td>66 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>è“</td>
<td>100 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>*èœ</td>
<td>10 å…ƒ</td>
<td></td>
</tr>
<tr>
<td>ç”Ÿå‘½å¦‚æ­Œ</td>
<td>1000 å…ƒ</td>
<td></td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-09T12:13:50.000Z</published>
  </entry>
  <entry>
    <title type="html">ADO</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/ado.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/ado.html"/>
    <updated>2022-05-31T14:08:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ado" tabindex="-1"> ADO</h1>
<p>Ado æ˜¯ IFreeSql ä¸‹é‡è¦çš„å¯¹è±¡ä¹‹ä¸€ï¼Œå®ƒåŒ…æ‹¬æ‰€æœ‰å¯¹ SQL æ“ä½œçš„å°è£…ï¼Œæä¾› ExecuteReaderã€ExecuteDataSetã€ExecuteDataTableã€ExecuteNonQueryã€ExecuteScalar ç­‰æ–¹æ³•ï¼Œä½¿ç”¨èµ·æ¥å’Œä¼ ç»Ÿ SqlHelper ä¸€æ ·ã€‚</p>
<h2 id="æŸ¥è¯¢-sql-è¿”å›å®ä½“" tabindex="-1"> æŸ¥è¯¢ SQL è¿”å›å®ä½“</h2>
<div><pre><code><span>//è¿”å›å¤šæ¡è®°å½•</span>
<span>List<span>&lt;</span>T<span>></span></span> list <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>"select * from t1"</span><span>)</span><span>;</span>

<span>//è¿”å›å•æ¡è®°å½•</span>
<span>T</span> item <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>QuerySingle</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>"select * from t1 where id = @id"</span><span>,</span> <span>new</span> <span>{</span> id <span>=</span> <span>1</span> <span>}</span><span>)</span><span>;</span>

<span>//è¿”å›å¤šä¸ªç»“æœé›†</span>
<span><span>var</span></span> result <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span>T1<span>,</span> T2<span>></span></span></span><span>(</span><span>"select * from t1; select * from t2"</span><span>)</span><span>;</span>
<span>List<span>&lt;</span>T1<span>></span></span> list1 <span>=</span> result<span>.</span>Item1<span>;</span>
<span>List<span>&lt;</span>T2<span>></span></span> list2 <span>=</span> result<span>.</span>Item2<span>;</span>

<span>// like æŸ¥è¯¢</span>
<span><span>string</span></span> searchText <span>=</span> <span>"abc"</span><span>;</span>
<span>List<span>&lt;</span>T<span>></span></span> users <span>=</span> _fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>"select * from t1 where name like @name"</span><span>,</span> <span>new</span> <span>{</span> name <span>=</span> <span>"%"</span> <span>+</span> searchText <span>+</span> <span>"%"</span> <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><h2 id="å‚æ•°åŒ–" tabindex="-1"> å‚æ•°åŒ–</h2>
<p>Ado ä¸‹é¢æ‰€æœ‰å‚æ•° object parms éƒ½å¯ä»¥æ¥å—åŒ¿åå¯¹è±¡ï¼Œæˆ–è€…å­—å…¸ï¼š</p>
<ul>
<li>new { id = 1, name = &quot;xx&quot; }</li>
<li>new Dictionary&lt;string, object&gt; { [&quot;id&quot;] = 1, [&quot;name&quot;] = &quot;xx&quot; }</li>
</ul>
<p>å…³äºå‚æ•°å‰ç¼€ï¼š</p>
<ul>
<li>odbc æ˜¯ ? å¹¶ä¸”æ²¡æœ‰æ ‡è¯†ï¼Œæ‰€ä»¥ freesql ç¦ç”¨äº† odbc å‚æ•°åŒ–</li>
<li>oracle æ˜¯ :</li>
<li>mysql.data æ˜¯ ?</li>
<li>mysqlconnector æ˜¯ @</li>
<li>å…¶ä»–åŸºæœ¬éƒ½æ˜¯ @</li>
</ul>
<p>IN å‚æ•°åŒ–æŸ¥è¯¢ï¼š</p>
<blockquote>
<p>å½“å‰ä»…æ”¯æŒ Array å’Œ IList ç±»å‹ç»‘å®š</p>
</blockquote>
<div><pre><code><span><span>var</span></span> ids <span>=</span> <span>new</span> <span><span>int</span><span>[</span><span>]</span></span> <span>{</span> <span>1</span><span>,</span><span>2</span><span>,</span><span>3</span> <span>}</span><span>;</span>
<span>List<span>&lt;</span>T<span>></span></span> list <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>"select * from t1 where id in @ids"</span><span>,</span> <span>new</span> <span>{</span> ids <span>=</span> ids <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h2 id="æ£€æµ‹è¿æ¥" tabindex="-1"> æ£€æµ‹è¿æ¥</h2>
<div><pre><code><span><span>bool</span></span> isok <span>=</span> fsql<span>.</span>Ado<span>.</span><span>ExecuteConnectTest</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="commandfluent" tabindex="-1"> CommandFluent</h2>
<p>fsql.Ado é‡è½½æ–¹æ³•å¤ªå¤šçš„æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨ CommandFluentï¼Œä¾‹å¦‚å­˜å‚¨è¿‡ç¨‹ï¼š</p>
<div><pre><code><span>DbParameter</span> p2 <span>=</span> <span>null</span><span>;</span>
fsql<span>.</span>Ado<span>.</span><span>CommandFluent</span><span>(</span><span>"dbo.GetICMaxNum"</span><span>)</span>
    <span>.</span><span>CommandType</span><span>(</span>CommandType<span>.</span>StoredProcedure<span>)</span>
    <span>.</span><span>CommandTimeout</span><span>(</span><span>60</span><span>)</span>

    <span>.</span><span>WithParameter</span><span>(</span><span>"TableName"</span><span>,</span> <span>"tb1"</span><span>)</span>
    <span>.</span><span>WithParameter</span><span>(</span><span>"FInterID"</span><span>,</span> <span>null</span><span>,</span> p <span>=></span>
    <span>{</span>
        p2 <span>=</span> p<span>;</span> <span>//Output å‚æ•°</span>
        p<span>.</span>DbType <span>=</span> DbType<span>.</span>Int32<span>;</span>
        p<span>.</span>Direction <span>=</span> ParameterDirection<span>.</span>Output<span>;</span>
    <span>}</span><span>)</span>
    <span>.</span><span>ExecuteNonQuery</span><span>(</span><span>)</span><span>;</span> <span>//.Query&lt;T>() æˆ–è€… .ExecuteDataTable() æˆ–è€… ...</span>

Console<span>.</span><span>WriteLine</span><span>(</span>p2<span>.</span>Value<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><h2 id="ado-net-æ‰©å±•æ–¹æ³•" tabindex="-1"> Ado.net æ‰©å±•æ–¹æ³•</h2>
<p>æä¾›äº†ç±»ä¼¼ Dapper çš„ä½¿ç”¨æ–¹æ³•ï¼ŒFreeSql å¢åŠ äº† IDbConnection/IDbTransaction å¯¹è±¡çš„æ‰©å±•æ–¹æ³• Select/Insert/Update/Delete å®ç° CRUDã€‚</p>
<div><pre><code><span>using</span> <span>FreeSql</span><span>;</span>

<span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> <span>new</span> <span>SqlConnection</span><span>(</span><span>..</span><span>.</span><span>)</span><span>)</span>
<span>{</span>
  <span>//IFreeSql fsql = conn.GetIFreeSql();</span>
  <span>//fsql.CodeFirst.IsNoneCommandParameter = true;</span>
  <span>//fsql.CodeFirst.IsSyncStructureToUpper = true;</span>
  <span>//fsql.Aop.CommandBefore += (_, e) => Trace.WriteLine(e.Command.CommandText);</span>
  <span>//ä»¥ä¸Šæ•´ä¸ªç¨‹åºåªéœ€è¦è®¾ç½®ä¸€æ¬¡</span>

  conn<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>..</span><span>.</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

  conn<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>T</span> <span>{</span><span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
  conn<span>.</span><span>Update</span><span>(</span><span>)</span><span>.</span><span>SetSource</span><span>(</span><span>new</span> <span>T</span> <span>{</span><span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
  conn<span>.</span><span>InsertOrUpdate</span><span>(</span><span>)</span><span>.</span><span>SetSource</span><span>(</span><span>new</span> <span>T</span> <span>{</span><span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>

  conn<span>.</span><span><span>Delete</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>..</span><span>.</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><ul>
<li>æ¯ä¸ª SqlConnection GetFreeSql() è¿”å›çš„ IFreeSql å®ä¾‹ç›¸åŒï¼›</li>
<li>å¯ä»¥å¯¹ fsql è®¾ç½® Aop äº‹ä»¶ï¼Œæ¯”å¦‚ç›‘è§† SQLï¼›</li>
<li>IFreeSql è‡ªèº«çš„æˆå‘˜ IDbFirstã€Transaction ä¸å¯ç”¨ï¼›</li>
</ul>
<p>åˆ©ç”¨æœ¬åŠŸèƒ½å¯ä»¥å¿«é€Ÿå°† FreeSql ä½¿ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œåªéœ€è¦å¤„ç†å¥½å®ä½“ç±»çš„ç‰¹æ€§ã€‚</p>
<p>æç¤ºï¼šFreeSql å…¼å®¹ EFCore 99% çš„å®ä½“ç‰¹æ€§</p>
]]></content>
    <published>2021-02-06T16:18:46.000Z</published>
  </entry>
  <entry>
    <title type="html">å‰è¨€</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/BaseEntity.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/BaseEntity.html"/>
    <updated>2022-05-17T06:09:12.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å‰è¨€" tabindex="-1"> å‰è¨€</h1>
<p>å°è¯•è¿‡ ado.netã€dapperã€efï¼Œä»¥åŠ Repository ä»“å‚¨ï¼Œç”šè‡³è‡ªå·±è¿˜å†™è¿‡ç”Ÿæˆå™¨å·¥å…·ï¼Œä»¥ä¾¿åšå¸¸è§„ CRUD æ“ä½œã€‚</p>
<p>å®ƒä»¬æ—¥å¸¸æ“ä½œä¸æ–¹ä¾¿ä¹‹å¤„ï¼š</p>
<ul>
<li>
<p>æ¯æ¬¡ä½¿ç”¨å‰éœ€è¦å£°æ˜ï¼Œå†æ“ä½œï¼›</p>
</li>
<li>
<p>å¾ˆå¤šäººä¸€ä¸ªå®ä½“ç±»ï¼Œå¯¹åº”ä¸€ä¸ªæ“ä½œç±»ï¼ˆæˆ– DALã€DbContextã€Repositoryï¼‰ï¼›</p>
</li>
</ul>
<p>æœ¬æ–‡ä»‹ç» BaseEntity ä¸€ç§æç®€çº¦çš„ CRUD æ“ä½œæ–¹æ³•ã€‚</p>
<h2 id="åŠŸèƒ½ç‰¹ç‚¹" tabindex="-1"> åŠŸèƒ½ç‰¹ç‚¹</h2>
<ul>
<li>
<p>è‡ªåŠ¨è¿ç§»å®ä½“ç»“æ„ï¼ˆCodeFirstï¼‰ï¼Œåˆ°æ•°æ®åº“ï¼›</p>
</li>
<li>
<p>ç›´æ¥æ“ä½œå®ä½“çš„æ–¹æ³•ï¼Œè¿›è¡Œ CRUD æ“ä½œï¼›</p>
</li>
<li>
<p>ç®€åŒ–ç”¨æˆ·å®šä¹‰å®ä½“ç±»å‹ï¼Œçœå»ä¸»é”®ã€å¸¸ç”¨å­—æ®µçš„é…ç½®ï¼ˆå¦‚ CreateTimeã€UpdateTimeï¼‰ï¼›</p>
</li>
<li>
<p>å®ç°å•è¡¨ã€å¤šè¡¨æŸ¥è¯¢çš„è½¯åˆ é™¤é€»è¾‘ï¼›</p>
</li>
</ul>
<h2 id="å£°æ˜" tabindex="-1"> å£°æ˜</h2>
<p>å‚è€ƒ BaseEntity.cs æºç ï¼ˆçº¦ 100 è¡Œï¼‰ï¼Œcopy åˆ°é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œç„¶åæ·»åŠ  nuget å¼•ç”¨åŒ…ï¼š</p>
<blockquote>
<p>dotnet add package FreeSql.DbContext</p>
</blockquote>
<blockquote>
<p>dotnet add package FreeSql.Provider.Sqlite</p>
</blockquote>
<p>1ã€å®šä¹‰ä¸€ä¸ªä¸»é”® int å¹¶ä¸”è‡ªå¢çš„å®ä½“ç±»å‹ï¼ŒBaseEntity TKey æŒ‡å®šä¸º int/long æ—¶ï¼Œä¼šè®¤ä¸ºä¸»é”®æ˜¯è‡ªå¢ï¼›</p>
<div><pre><code><span>public</span> <span>class</span> <span>UserGroup</span> <span>:</span> <span><span>BaseEntity<span>&lt;</span>UserGroup<span>,</span> <span>int</span><span>></span></span></span> <span>{</span>
    <span>public</span> <span><span>string</span></span> GroupName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>å¦‚æœä¸æƒ³ä¸»é”®æ˜¯è‡ªå¢é”®ï¼Œå¯ä»¥é‡å†™å±æ€§ï¼š</p>
<div><pre><code><span>public</span> <span>class</span> <span>UserGroup</span> <span>:</span> <span><span>BaseEntity<span>&lt;</span>UserGroup<span>,</span> <span>int</span><span>></span></span></span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>false</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>override</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> GroupName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><blockquote>
<p>æœ‰å…³æ›´å¤šå®ä½“çš„ç‰¹æ€§é…ç½®ï¼Œå¯å‚é˜… <a href="/guide/entity-attribute.html">å®ä½“å±æ€§</a></p>
</blockquote>
<p>2ã€å®šä¹‰ä¸€ä¸ªä¸»é”® Guid çš„å®ä½“ç±»å‹ï¼Œä¿å­˜æ•°æ®æ—¶ä¼šè‡ªåŠ¨äº§ç”Ÿæœ‰åºä¸é‡å¤çš„ Guid å€¼ï¼ˆä¸ç”¨è‡ªå·±æŒ‡å®š Guid.NewGuid()ï¼‰ï¼›</p>
<div><pre><code><span>public</span> <span>class</span> <span>User</span> <span>:</span> <span><span>BaseEntity<span>&lt;</span>UserGroup<span>,</span> Guid<span>></span></span></span> <span>{</span>
    <span>public</span> <span><span>string</span></span> UserName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>3ã€å®šä¹‰å¤šä¸»é”®çš„å®ä½“ç±»å‹ï¼Œå¯ä»¥åœ¨ static æ„é€ å‡½æ•°ä¸­é‡å†™å­—æ®µåï¼›</p>
<div><pre><code><span>public</span> <span>class</span> <span>User2</span> <span>:</span> <span><span>BaseEntity<span>&lt;</span>User2<span>,</span> Guid<span>,</span> <span>int</span><span>></span></span></span> <span>{</span>
    <span>static</span> <span>User2</span><span>(</span><span>)</span>
    <span>{</span>
        User2<span>.</span>Orm<span>.</span>CodeFirst<span>.</span><span><span>ConfigEntity</span><span><span>&lt;</span>User2<span>></span></span></span><span>(</span>t <span>=></span>
        <span>{</span>
            t<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>PkId1<span>)</span><span>.</span><span>Name</span><span>(</span><span>"UserId"</span><span>)</span><span>;</span>
            t<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>PkId2<span>)</span><span>.</span><span>Name</span><span>(</span><span>"Index"</span><span>)</span><span>;</span>
        <span>}</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span><span>string</span></span> Username <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><h2 id="crud-ä½¿ç”¨" tabindex="-1"> CRUD ä½¿ç”¨</h2>
<div><pre><code><span>//æ·»åŠ </span>
<span><span>var</span></span> item <span>=</span> <span>new</span> <span>UserGroup</span> <span>{</span> GroupName <span>=</span> <span>"ç»„ä¸€"</span> <span>}</span><span>;</span>
item<span>.</span><span>Insert</span><span>(</span><span>)</span><span>;</span>

<span>//æ›´æ–°</span>
item<span>.</span>GroupName <span>=</span> <span>"ç»„äºŒ"</span><span>;</span>
item<span>.</span><span>Update</span><span>(</span><span>)</span><span>;</span>

<span>//æ·»åŠ æˆ–æ›´æ–°</span>
item<span>.</span><span>Save</span><span>(</span><span>)</span><span>;</span>

<span>//è½¯åˆ é™¤</span>
item<span>.</span><span>Delete</span><span>(</span><span>)</span><span>;</span>

<span>//æ¢å¤è½¯åˆ é™¤</span>
item<span>.</span><span>Restore</span><span>(</span><span>)</span><span>;</span>

<span>//æ ¹æ®ä¸»é”®è·å–å¯¹è±¡</span>
<span><span>var</span></span> item <span>=</span> UserGroup<span>.</span><span>Find</span><span>(</span><span>1</span><span>)</span><span>;</span>

<span>//æŸ¥è¯¢æ•°æ®</span>
<span><span>var</span></span> items <span>=</span> UserGroup<span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>></span> <span>10</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br></div></div><p>å®ä½“ç±»å‹.Select æ˜¯ä¸€ä¸ªæŸ¥è¯¢å¯¹è±¡ï¼Œä½¿ç”¨æ–¹æ³•å’Œ FreeSql.ISelect ä¸€æ ·ï¼›</p>
<p>æ”¯æŒå¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œè½¯åˆ é™¤æ¡ä»¶ä¼šé™„åŠ åœ¨æ¯ä¸ªè¡¨ä¸­ï¼›</p>
<blockquote>
<p>æœ‰å…³æ›´å¤šæŸ¥è¯¢æ–¹æ³•ï¼Œå¯å‚é˜… <a href="/guide/select.html">æŸ¥è¯¢</a></p>
</blockquote>
<p>ç¤ºèŒƒé¡¹ç›®ï¼š<a href="https://github.com/2881099/FreeSql/tree/master/Examples/base_entity" target="_blank" rel="noopener noreferrer">https://github.com/2881099/FreeSql/tree/master/Examples/base_entity</a></p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">æŒ‡å—</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æŒ‡å—" tabindex="-1"> æŒ‡å—</h1>
<p><a href="https://github.com/dotnetcore" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/member project of-NCC-9e20c9.svg" alt="Member project of .NET Core Community" loading="lazy"></a>
<a href="https://www.nuget.org/packages/FreeSql" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/nuget/v/FreeSql.svg?style=flat-square" alt="nuget" loading="lazy"></a>
<a href="https://www.nuget.org/stats/packages/FreeSql?groupby=Version" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/nuget/dt/FreeSql.svg?style=flat-square" alt="stats" loading="lazy"></a>
<a href="https://github.com/dotnetcore/FreeSql/blob/master/LICENSE" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License" loading="lazy"></a></p>
<p><a href="https://starchart.cc/dotnetcore/FreeSql" target="_blank" rel="noopener noreferrer"><img src="https://starchart.cc/dotnetcore/FreeSql.svg" alt="Stargazers over time" loading="lazy"></a></p>
<h2 id="freesql" tabindex="-1"> FreeSql</h2>
<p><code>FreeSql</code>æ˜¯åŠŸèƒ½å¼ºå¤§çš„ <code>.NET ORM</code>ï¼Œæ”¯æŒ <code>.NetFramework 4.0+</code>ã€<code>.NetCore 2.1+</code>ã€<code>Xamarin</code>ç­‰æ”¯æŒ NetStandard æ‰€æœ‰è¿è¡Œå¹³å°ã€‚</p>
<p>æ”¯æŒ <code>MySql/SqlServer/PostgreSQL/Oracle/Sqlite/Firebird/è¾¾æ¢¦/ç¥é€š/äººå¤§é‡‘ä»“/ç¿°é«˜/åä¸ºGaussDB/MsAccess</code> ç­‰æ•°æ®åº“ã€‚</p>
<ul>
<li>
<p>QQ ç¾¤ï¼š4336577(å·²æ»¡)ã€8578575(å·²æ»¡)ã€<code>52508226(åœ¨çº¿)</code></p>
</li>
<li>
<p>æ¬¢è¿å¾®ä¿¡å…³æ³¨ <strong>dotNET æ¬ç –é˜Ÿ</strong>ï¼Œåˆ†äº« .NET Core + FreeSql ç›¸å…³æŠ€æœ¯æ ˆ</p>
</li>
</ul>
<p><img src="/wechat_qrcode.jpg" alt="åˆ†äº«.NET Core+FreeSqlç›¸å…³æŠ€æœ¯" loading="lazy"></p>
<h2 id="ç‰¹æ€§" tabindex="-1"> ç‰¹æ€§</h2>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-0"><label for="task-item-0"> æ”¯æŒ CodeFirst è¿ç§»ï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-1"><label for="task-item-1"> æ”¯æŒ DbFirst ä»æ•°æ®åº“å¯¼å…¥å®ä½“ç±»ï¼Œæ”¯æŒä¸‰ç§æ¨¡æ¿ç”Ÿæˆå™¨ï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-2"><label for="task-item-2"> é‡‡ç”¨ ExpressionTree é«˜æ€§èƒ½è¯»å–æ•°æ®ï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-3"><label for="task-item-3"> æ”¯æŒæ·±å…¥çš„ç±»å‹æ˜ å°„ï¼Œæ¯”å¦‚ pgsql çš„æ•°ç»„ç±»å‹ï¼Œå ªç§°åŒ å¿ƒåˆ¶ä½œï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-4"><label for="task-item-4"> æ”¯æŒä¸°å¯Œçš„è¡¨è¾¾å¼å‡½æ•°ï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-5"><label for="task-item-5"> æ”¯æŒå¯¼èˆªå±æ€§æŸ¥è¯¢ï¼Œå’Œå»¶æ—¶åŠ è½½ï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-6"><label for="task-item-6"> æ”¯æŒåŒæ­¥/å¼‚æ­¥æ•°æ®åº“æ“ä½œæ–¹æ³•ï¼Œä¸°å¯Œå¤šå½©çš„é“¾å¼æŸ¥è¯¢æ–¹æ³•ï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-7"><label for="task-item-7"> æ”¯æŒè¯»å†™åˆ†ç¦»ã€åˆ†è¡¨åˆ†åº“ï¼Œç§Ÿæˆ·è®¾è®¡ï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-8"><label for="task-item-8"> æ”¯æŒå¤šç§æ•°æ®åº“ï¼ŒMySql/SqlServer/PostgreSQL/Oracle/Sqlite/Firebird/è¾¾æ¢¦/ç¥é€š/äººå¤§é‡‘ä»“/ç¿°é«˜/åä¸º GaussDB/MsAccessï¼›</label></li>
</ul>
<h2 id="å­¦ä¹ æŒ‡å—" tabindex="-1"> å­¦ä¹ æŒ‡å—</h2>
<p>FreeSql é™¤äº†æ”¯æŒåŸºæœ¬çš„å¢åˆ æŸ¥æ”¹åŠŸèƒ½å¤–ï¼Œè¿˜æ”¯æŒåŸºäºç°æœ‰æ•°æ®åº“åˆ›å»ºæ¨¡å‹ï¼ˆ<a href="/guide/db-first.html">DbFirst</a>ï¼‰ï¼Œå’Œæ”¯æŒåŸºäºæ¨¡å‹åˆ›å»ºæ•°æ®åº“ï¼ˆ<a href="/guide/code-first.html">CodeFirst</a>)ã€‚</p>
<h4 id="åŸºç¡€" tabindex="-1"> åŸºç¡€</h4>
<ul>
<li><a href="/guide/insert.html">ã€Šå­¦ä¹  FreeSql ä¹‹ä¸€ï¼šæ·»åŠ æ•°æ®ã€‹</a></li>
<li><a href="/guide/delete.html">ã€Šå­¦ä¹  FreeSql ä¹‹äºŒï¼šåˆ é™¤æ•°æ®ã€‹</a></li>
<li><a href="/guide/update.html">ã€Šå­¦ä¹  FreeSql ä¹‹ä¸‰ï¼šä¿®æ”¹æ•°æ®ã€‹</a></li>
<li><a href="/guide/select.html">ã€Šå­¦ä¹  FreeSql ä¹‹å››ï¼šæŸ¥è¯¢æ•°æ®ã€‹</a></li>
<li><a href="/guide/repository.html">ã€Šä»“å‚¨å±‚ Repositoryã€‹</a></li>
</ul>
<h4 id="è¿›é˜¶" tabindex="-1"> è¿›é˜¶</h4>
<ul>
<li><a href="/guide/code-first.html">ã€ŠCodeFirst æ¨¡å¼å¼€å‘ä»‹ç»ã€‹</a>
<ul>
<li><a href="/guide/entity-attribute.html">ã€ŠCodeFirst æ¨¡å¼ä¹‹ä¸€ï¼šå®ä½“ç‰¹æ€§ã€‹</a></li>
<li><a href="/guide/fluent-api.html">ã€ŠCodeFirst æ¨¡å¼ä¹‹äºŒï¼šFluentApiã€‹</a></li>
<li><a href="/guide/custom-attribute.html">ã€ŠCodeFirst æ¨¡å¼ä¹‹ä¸‰ï¼šè‡ªå®šä¹‰ç‰¹æ€§ã€‹</a></li>
<li><a href="/guide/type-mapping.html">ã€ŠCodeFirst æ¨¡å¼ä¹‹å››ï¼šç±»å‹æ˜ å°„ã€‹</a></li>
<li><a href="/guide/code-first.html#%E8%BF%81%E7%A7%BB%E7%BB%93%E6%9E%84">ã€ŠCodeFirst æ¨¡å¼ä¹‹äº”ï¼šè¿ç§»ç»“æ„ã€‹</a></li>
</ul>
</li>
</ul>
<ul>
<li><a href="/guide/db-first.html">ã€ŠDbFirst æ¨¡å¼å¼€å‘ä»‹ç»ã€‹</a></li>
</ul>
<h4 id="é«˜çº§" tabindex="-1"> é«˜çº§</h4>
<ul>
<li><a href="/guide/transaction.html">ã€Šæ•°æ®åº“äº‹åŠ¡ã€‹</a></li>
<li><a href="/guide/read-write-splitting.html">ã€Šä½¿ç”¨è¯»å†™åˆ†ç¦»ã€‹</a></li>
<li><a href="/guide/sharding.html">ã€Šåˆ†è¡¨åˆ†åº“ã€‹</a></li>
<li><a href="/guide/multi-tenancy.html">ã€Šå¤šç§Ÿæˆ·ã€‹</a></li>
<li><a href="/guide/select-return-data.html">ã€Šè¿”å›æ•°æ®ã€‹</a></li>
<li><a href="/guide/select-lazy-loading.html">ã€Šä¼˜åŒ–ä¹‹ï¼šå»¶æ—¶åŠ è½½ã€‹</a></li>
<li><a href="/guide/select-include.html">ã€Šä¼˜åŒ–ä¹‹ï¼šè´ªå©ªåŠ è½½ã€‹</a></li>
<li><a href="/guide/expression-function.html">ã€ŠExpression è¡¨è¾¾å¼å‡½æ•°ã€‹</a></li>
<li><a href="/guide/aop.html">ã€ŠAOPã€‹</a></li>
</ul>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">AOPâœ¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/aop.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/aop.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="aopâœ¨" tabindex="-1"> AOPâœ¨</h1>
<p>FreeSql AOP å·²æœ‰çš„åŠŸèƒ½ä»‹ç»ï¼Œæœªæ¥ä¸ºä¼šæ ¹æ®ç”¨æˆ·éœ€æ±‚ä¸æ–­å¢å¼ºã€‚</p>
<h2 id="å®¡è®¡-crud" tabindex="-1"> å®¡è®¡ CRUD</h2>
<p>å¦‚æœå› ä¸ºæŸä¸ª sql éªšæ“ä½œè€—æ—¶å¾ˆé«˜ï¼Œæ²¡æœ‰ä¸€ä¸ªç›¸å…³çš„å®¡è®¡åŠŸèƒ½ï¼Œæ’æŸ¥èµ·æ¥å¯ä»¥è¯´æ— ä»ä¸‹æ‰‹ã€‚</p>
<p>FreeSql æ”¯æŒç®€å•çš„ç±»ä¼¼åŠŸèƒ½ï¼š</p>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>CurdAfter <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span>
<span>{</span>
    <span>if</span> <span>(</span>e<span>.</span>ElapsedMilliseconds <span>></span> <span>200</span><span>)</span>
    <span>{</span>
        <span>//è®°å½•æ—¥å¿—</span>
        <span>//å‘é€çŸ­ä¿¡ç»™è´Ÿè´£äºº</span>
    <span>}</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>åªéœ€è¦ä¸€ä¸ªäº‹ä»¶ï¼Œå°±å¯ä»¥å¯¹å…¨å±€èµ·åˆ°ä½œç”¨ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ª CurdBefore åœ¨æ‰§è¡Œ sql ä¹‹å‰è§¦å‘ï¼Œå¸¸ç”¨äºè®°å½•æ—¥å¿—æˆ–å¼€å‘è°ƒè¯•ã€‚</p>
<h2 id="å®¡è®¡å±æ€§å€¼" tabindex="-1"> å®¡è®¡å±æ€§å€¼</h2>
<p>å®ç°æ’å…¥/æ›´æ–°æ—¶ç»Ÿä¸€å¤„ç†æŸäº›å€¼ï¼Œæ¯”å¦‚æŸå±æ€§çš„é›ªèŠ±ç®—æ³•å€¼ã€åˆ›å»ºæ—¶é—´å€¼ã€ç”šè‡³æ˜¯ä¸šåŠ¡å€¼ã€‚</p>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>AuditValue <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span>
<span>{</span>
    <span>if</span> <span>(</span>e<span>.</span>Column<span>.</span>CsType <span>==</span> <span>typeof</span><span>(</span><span><span>long</span></span><span>)</span> <span>&amp;&amp;</span>
        e<span>.</span>Property<span>.</span><span><span>GetCustomAttribute</span><span><span>&lt;</span>SnowflakeAttribute<span>></span></span></span><span>(</span><span>false</span><span>)</span> <span>!=</span> <span>null</span> <span>&amp;&amp;</span>
        e<span>.</span>Value<span>?.</span><span>ToString</span><span>(</span><span>)</span> <span>==</span> <span>"0"</span><span>)</span>
        e<span>.</span>Value <span>=</span> <span>new</span> <span>Snowflake</span><span>(</span><span>)</span><span>.</span><span>GetId</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>class</span> <span>Order</span> <span>{</span>
    <span>[</span><span><span>Snowflake</span></span><span>]</span>
    <span>public</span> <span><span>long</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>//...</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><blockquote>
<p>å½“å±æ€§çš„ç±»å‹æ˜¯ longï¼Œå¹¶ä¸”æ ‡è®°äº† [Snowflake]ï¼Œå¹¶ä¸”å½“å‰å€¼æ˜¯ 0ï¼Œé‚£ä¹ˆåœ¨æ’å…¥/æ›´æ–°æ—¶å®ƒçš„å€¼å°†è®¾ç½®ä¸ºé›ªèŠ± id å€¼ã€‚</p>
</blockquote>
<blockquote>
<p>è¯´æ˜ï¼šSnowflakeAttribute æ˜¯ä½¿ç”¨è€…æ‚¨æ¥å®šä¹‰ï¼Œnew Snowflake().GetId() ä¹Ÿæ˜¯ç”±ä½¿ç”¨è€…æ‚¨æ¥å®ç°</p>
</blockquote>
<p>å¦‚æœå‘½åè§„èŒƒï¼Œå¯ä»¥åœ¨ aop é‡Œåˆ¤æ–­ï¼Œif (e.Property.Name == &quot;createtime&quot;) e.Value = DateTime.Now;</p>
<h2 id="å®¡è®¡å‘½ä»¤" tabindex="-1"> å®¡è®¡å‘½ä»¤</h2>
<p>fsql.Aop.CommandBeforeã€fsql.Aop.CommandAfterHandler è¿™ä¸¤ä¸ªäº‹ä»¶è§¦å‘æ‰€æœ‰ SQL å‘½ä»¤çš„æ‰§è¡Œå‰ã€å’Œæ‰§è¡Œåã€‚</p>
<p>æ‰§è¡Œåçš„äº‹ä»¶ä¼šé™„å¸¦å¼‚å¸¸ä¿¡æ¯ã€è€—æ—¶ä¿¡æ¯ç­‰ã€‚</p>
<p>å»ºè®®åœ¨å¼€å‘æ¨¡å¼ä¸‹å¼€å¯æ— å‚æ•°åŒ–æ¨¡å¼ï¼Œnew FreeSqlBuilder().UseNoneCommandParameter(true)ã€‚</p>
<blockquote>
<p>æç¤ºï¼šnew FreeSqlBuilder().UseMonitorCommand ä¹Ÿå¯ä»¥å®¡è®¡å‘½ä»¤æ‰§è¡Œå‰åã€‚</p>
</blockquote>
<div><pre><code>fsql1<span>.</span>Aop<span>.</span>CommandAfter <span>+=</span> <span>new</span> <span>EventHandler<span>&lt;</span>CommandAfterEventArgs<span>></span></span><span>(</span><span>(</span>s<span>,</span> e<span>)</span> <span>=></span>
<span>{</span>
   <span>if</span> <span>(</span>e<span>.</span>Exception <span>!=</span> <span>null</span><span>)</span>
   <span>{</span>
     <span>//åšä¸€äº›æ—¥å¿—è®°å½•çš„æ“ä½œã€‚ä»¥ä¸‹ä¸ºç¤ºä¾‹ã€‚</span>
     Trace<span>.</span><span>WriteLine</span><span>(</span><span><span>$"Message:</span><span><span>{</span><span>e<span>.</span>Exception<span>.</span>Message </span><span>}</span></span><span>\r\nStackTrace:</span><span><span>{</span><span>e<span>.</span>Exception<span>.</span>StackTrace</span><span>}</span></span><span>\r\nCommandText:</span><span><span>{</span><span>e<span>.</span>Command<span>.</span>CommandText</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>
   <span>}</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><h2 id="å®¡è®¡è¿ç§»è„šæœ¬" tabindex="-1"> å®¡è®¡è¿ç§»è„šæœ¬</h2>
<p>FreeSql è‡ªå¸¦è¿ç§»åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿ç§»çš„ SQL è¯­å¥é•¿å•¥æ ·ï¼Œä½ å¯èƒ½ä¼šå¥½å¥‡ã€‚</p>
<ul>
<li>
<p>æ¯”å¦‚åˆ›å»ºè¡¨æ—¶ï¼›</p>
</li>
<li>
<p>æ¯”å¦‚æ·»åŠ å­—æ®µæ—¶ï¼›</p>
</li>
<li>
<p>æ¯”å¦‚ä¿®æ”¹è¡¨åã€ä¿®æ”¹å­—æ®µåæ—¶ï¼›</p>
</li>
<li>
<p>åˆæ¯”å¦‚å­—æ®µç±»å‹æ›´æ”¹ä¹‹åæ—¶ï¼›</p>
</li>
</ul>
<p>è¿™äº›æ“ä½œåœ¨ FreeSql.CodeFirst å®ç°ä¸‹åŸºæœ¬ä¸éœ€è¦ç†ä¼šï¼Œè€Œä¸”æˆ‘ä»¬åªæ¨èåœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨è‡ªåŠ¨è¿ç§»çš„åŠŸèƒ½ï¼Œæ­£å¼ç¯å¢ƒå¯ä½¿ç”¨å…¶ä»–å·¥å…·æ›¿ä»£æ­¤æ“ä½œã€‚</p>
<p>ä½†æˆ‘ä»¬ä»ç„¶å¯èƒ½éœ€è¦å¯¹é¡¹ç›®åšå®Œæ•´çš„æ—¥å¿—è®°å½•ã€‚</p>
<p>fsql.Aop.SyncStructureBeforeã€fsql.Aop.SyncStructureAfter è¿™ä¸¤ä¸ªäº‹ä»¶å°†æ’ä¸Šç”¨åœºã€‚</p>
<h2 id="è‡ªå®šä¹‰å®ä½“ç‰¹æ€§" tabindex="-1"> è‡ªå®šä¹‰å®ä½“ç‰¹æ€§</h2>
<p>æ¯”å¦‚é¡¹ç›®å†…å·²ç»ä½¿ç”¨äº†å…¶å®ƒ ormï¼Œå¦‚ efcoreï¼Œè¿™æ ·æ„å‘³ç€å®ä½“ä¸­å¯èƒ½å­˜åœ¨ [Key]ï¼Œä½†å®ƒä¸ FreeSql [Column(IsPrimary = true] ä¸åŒã€‚</p>
<p>Qï¼š FreeSql å®ä½“ç‰¹æ€§ä¸ºå•¥è¿™ä¹ˆåˆ«æ‰­ï¼Ÿ</p>
<p>Aï¼š ä¸ºäº†è€ƒè™‘ä¸€è‡´æ€§ç”¨æ³•ï¼Œå…¨éƒ¨å°è£…åœ¨ ColumnAttribute ä¸‹ï¼Œè¿™æ ·ç”¨æˆ·ä½¿ç”¨èµ·æ¥ï¼Œä¸ç”¨åˆ°å¤„ using æˆ–è€… å›å¿†ç‰¹æ€§åº”è¯¥ç”¨å“ªä¸ªåå­—ï¼Œå¦‚è‡ªå¢ [Column(IsIdentity = true)] å³å¯ã€‚</p>
<p>FreeSql æä¾› AOP è‡ªå®šä¹‰ç‰¹æ€§åŠŸèƒ½ï¼Œå®ç°ä¸å¤šä¸ª orm å…±åŒæ‹¥æœ‰ä¸€å¥—å®ä½“ç‰¹æ€§ï¼Œå¯é¿å…é‡å¤å®šä¹‰ç‰¹æ€§ã€‚</p>
<blockquote>
<p>v1.4.0+ å·²è‡ªåŠ¨è¯†åˆ« EFCore å®ä½“ç‰¹æ€§ Key/Required/NotMapped/MaxLength/StringLength/DatabaseGenerated/Table/Column</p>
</blockquote>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>ConfigEntity <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span>
<span>{</span>
    <span><span>var</span></span> attr <span>=</span> e<span>.</span>EntityType<span>.</span><span>GetCustomAttributes</span><span>(</span><span>typeof</span><span>(</span><span>MyTableAttribute</span><span>)</span><span>,</span> <span>false</span><span>)</span><span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span> <span>as</span> <span>MyTableAttribute</span><span>;</span>
    <span>if</span> <span>(</span>attr <span>!=</span> <span>null</span><span>)</span>
        e<span>.</span>ModifyResult<span>.</span>Name <span>=</span> attr<span>.</span>Name<span>;</span> <span>//è¡¨å</span>
<span>}</span><span>;</span>
fsql<span>.</span>Aop<span>.</span>ConfigEntityProperty <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span>
<span>{</span>
    <span><span>var</span></span> attr <span>=</span> e<span>.</span>Property<span>.</span><span>GetCustomAttributes</span><span>(</span><span>typeof</span><span>(</span><span>MyColumnAttribute</span><span>)</span><span>,</span> <span>false</span><span>)</span><span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span> <span>as</span> <span>MyColumnAttribute</span><span>;</span>
    <span>if</span> <span>(</span>attr <span>!=</span> <span>null</span><span>)</span>
        e<span>.</span>ModifyResult<span>.</span>Name <span>=</span> attr<span>.</span>Name<span>;</span> <span>//å­—æ®µå</span>
<span>}</span><span>;</span>

<span>[</span><span><span>MyTable</span><span><span>(</span><span>"xxx"</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>YourEntity</span>
<span>{</span>
    <span>[</span><span><span>MyColumn</span><span><span>(</span><span>"id"</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> pkid <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>class</span> <span>MyTableAttribute</span> <span>:</span> <span><span>Attribute</span></span>
<span>{</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>}</span>
    <span>public</span> <span>MyTableAttribute</span><span>(</span><span><span>string</span></span> name<span>)</span>
    <span>{</span>
      <span>this</span><span>.</span>Name <span>=</span> name<span>;</span>
    <span>}</span>
<span>}</span>
<span>class</span> <span>MyColumnAttribute</span> <span>:</span> <span><span>Attribute</span></span>
<span>{</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>}</span>
    <span>public</span> <span>MyColumnAttribute</span><span>(</span><span><span>string</span></span> name<span>)</span>
    <span>{</span>
      <span>this</span><span>.</span>Name <span>=</span> name<span>;</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br></div></div><h2 id="ado-net-è¯»å–æ‹¦æˆª" tabindex="-1"> Ado.net è¯»å–æ‹¦æˆª</h2>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>AuditDataReader <span>+=</span> <span>(</span>_<span>,</span> e<span>)</span> <span>=></span>
<span>{</span>
    <span>if</span> <span>(</span>e<span>.</span>DataReader<span>.</span><span>GetFieldType</span><span>(</span>e<span>.</span>Index<span>)</span> <span>==</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span> <span>&amp;&amp;</span>
      e<span>.</span>Value <span>==</span> DBNull<span>.</span>Value<span>)</span>
        e<span>.</span>Value <span>=</span> <span>""</span><span>;</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="è¡¨è¾¾å¼æ‹¦æˆª" tabindex="-1"> è¡¨è¾¾å¼æ‹¦æˆª</h2>
<p>FreeSql å†…éƒ¨è¡¨è¾¾å¼æ”¯æŒéå¸¸ä¸°å¯Œï¼Œå¯¹å„å¤§æ•°æ®åº“çš„å…¼å®¹åº¦ä¹Ÿåšå¾—å¾ˆå¥½ã€‚</p>
<blockquote>
<p>æœ‰å…³è¡¨è¾¾å¼æ”¯æŒçš„ç¨‹åº¦ï¼Œå¯å‚é˜…ï¼š<a href="/guide/expression-function.html">è¡¨è¾¾å¼å‡½æ•°</a></p>
</blockquote>
<p>å³ä¾¿å¦‚æ­¤ä¸°å¯Œï¼Œä¹Ÿä»ç„¶æ— æ³•æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼ŒFreeSql å¯¹å¤–å¼€æ”¾äº†è‡ªå®šä¹‰è¡¨è¾¾å¼è§£ææ¥å£ï¼š</p>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>ParseExpression <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span>
<span>{</span>
    <span>if</span> <span>(</span>e<span>.</span>Expression<span>.</span>NodeType <span>==</span> Call <span>&amp;&amp;</span> e<span>.</span>Expression<span>.</span>Name <span>==</span> <span>"get_Item"</span><span>)</span>
        e<span>.</span>Result <span>=</span> <span>"1111"</span><span>;</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>è¿™ä¸ªè§£ææœ‰ç‚¹å¤æ‚ï¼Œå½“ <code>e.Expression</code> å¾ˆå¤æ‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜æä¾›äº† <code>e.FreeParse</code> æ–¹æ³•ï¼Œä½¿ç”¨å®ƒç›¸å½“äºè°ƒç”¨ <code>FreeSql</code> å†…ç½®è¡¨è¾¾å¼è§£æå¼•æ“ï¼Œè¾…åŠ©æ‚¨è¿›è¡Œè§£æã€‚</p>
<h2 id="ä¿®æ”¹-decimal-é»˜è®¤ç‰¹æ€§" tabindex="-1"> ä¿®æ”¹ decimal é»˜è®¤ç‰¹æ€§</h2>
<p>å› ä¸ºé»˜è®¤ decimal åªæ”¯æŒ decimal(10,2)ï¼ŒèŒƒå›´å¤ªå°ï¼Œæˆ‘ä»¬å¯ä»¥å…¨å±€ä¿®æ”¹ decimal ç±»å‹çš„æ”¯æŒèŒƒå›´ï¼Œæ¯”å¦‚æ”¯æŒ decimal(18,6)</p>
<div><pre><code>fsql1<span>.</span>Aop<span>.</span>ConfigEntityProperty <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span>
<span>{</span>
    <span>if</span> <span>(</span>e<span>.</span>Property<span>.</span>PropertyType <span>==</span> <span>typeof</span><span>(</span><span><span>decimal</span></span><span>)</span><span>||</span> e<span>.</span>Property<span>.</span>PropertyType <span>==</span> <span>typeof</span><span>(</span><span><span>decimal</span><span>?</span></span><span>)</span><span>)</span>
    <span>{</span>
       e<span>.</span>ModifyResult<span>.</span>Precision <span>=</span> <span>18</span><span>;</span>
       e<span>.</span>ModifyResult<span>.</span>Scale <span>=</span> <span>6</span><span>;</span>
    <span>}</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div>]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">çº§è”ä¿å­˜</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/cascade-saving.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/cascade-saving.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="çº§è”ä¿å­˜" tabindex="-1"> çº§è”ä¿å­˜</h1>
<p>å®è·µå‘ç°ï¼ŒN å¯¹ 1 ä¸é€‚åˆåšçº§è”ä¿å­˜ã€‚ä¿å­˜ Topic çš„æ—¶å€™æŠŠ Type ä¿¡æ¯ä¹Ÿä¿å­˜ï¼Ÿæˆ‘ä¸ªäººè®¤ä¸ºè‡ªä¸‹å‘ä¸Šä¿å­˜çš„åŠŸèƒ½å¤ªä¸å¯æ§äº†ï¼ŒFreeSql ç›®å‰ä¸æ”¯æŒè‡ªä¸‹å‘ä¸Šä¿å­˜ã€‚å› æ­¤ä¸‹é¢æˆ‘ä»¬åªè®² OneToOne/OneToMany/ManyToMany çº§è”ä¿å­˜ã€‚è‡³äº ManyToOne çº§è”ä¿å­˜ä½¿ç”¨æ‰‹å·¥å¤„ç†ï¼Œæ›´åŠ å®‰å…¨å¯æ§ã€‚</p>
<h2 id="savemany-æ‰‹å·¥ä¿å­˜" tabindex="-1"> SaveMany æ‰‹å·¥ä¿å­˜</h2>
<p>å®Œæ•´ä¿å­˜ï¼Œå¯¹æ¯”è¡¨å·²å­˜åœ¨çš„æ•°æ®ï¼Œè®¡ç®—å‡ºæ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤æ‰§è¡Œã€‚</p>
<p>é€’å½’ä¿å­˜å¯¼èˆªå±æ€§ä¸å®‰å…¨ï¼Œä¸å¯æ§ï¼Œå¹¶éæŠ€æœ¯é—®é¢˜ï¼Œè€Œæ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæä¾›äº†æ‰‹å·¥å®Œæ•´ä¿å­˜çš„æ–¹å¼ã€‚</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Type<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> type <span>=</span> <span>new</span> <span>Type</span>
<span>{</span>
    name <span>=</span> <span>"c#"</span><span>,</span>
    Topics <span>=</span> <span>new</span> <span>List<span>&lt;</span>Topic<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
    <span>{</span>
        <span>new</span> <span>Topic</span> <span>{</span> <span>..</span><span>.</span> <span>}</span>
    <span>}</span><span>)</span>
<span>}</span><span>;</span>
repo<span>.</span><span>Insert</span><span>(</span>type<span>)</span><span>;</span>
repo<span>.</span><span>SaveMany</span><span>(</span>type<span>,</span> <span>"Topics"</span><span>)</span><span>;</span> <span>//æ‰‹å·¥å®Œæ•´ä¿å­˜ Topics</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><ul>
<li>SaveMany ä»…æ”¯æŒ OneToManyã€ManyToMany å¯¼èˆªå±æ€§</li>
<li>åªä¿å­˜ Topicsï¼Œä¸å‘ä¸‹é€’å½’è¿½æœ”</li>
<li>å½“ Topics ä¸º Empty æ—¶ï¼Œåˆ é™¤ type å­˜åœ¨çš„ Topics æ‰€æœ‰è¡¨æ•°æ®ï¼Œç¡®è®¤ï¼Ÿ</li>
<li>ManyToMany æœºåˆ¶ä¸ºï¼Œå®Œæ•´å¯¹æ¯”ä¿å­˜ä¸­é—´è¡¨ï¼Œå¤–éƒ¨è¡¨åªè¿½åŠ ä¸æ›´æ–°</li>
</ul>
<p>å¦‚ï¼š</p>
<ul>
<li>æœ¬è¡¨ Song</li>
<li>å¤–éƒ¨è¡¨ Tag</li>
<li>ä¸­é—´è¡¨ SongTag</li>
</ul>
<h2 id="enablecascadesave-ä»“å‚¨çº§è”ä¿å­˜" tabindex="-1"> EnableCascadeSave ä»“å‚¨çº§è”ä¿å­˜</h2>
<p>DbContext/Repository EnableCascadeSave å¯å®ç°ä¿å­˜å¯¹è±¡çš„æ—¶å€™ï¼Œé€’å½’è¿½æœ”å…¶ OneToOneã€OneToManyã€ManyToMany å¯¼èˆªå±æ€§ä¹Ÿä¸€å¹¶ä¿å­˜ï¼Œæœ¬æ–‡æ¡£è¯´æ˜å®ç°çš„æœºåˆ¶é˜²æ­¢è¯¯ç”¨ã€‚</p>
<p>1ã€OneToOne çº§è”ä¿å­˜</p>
<blockquote>
<p>v3.2.606+ æ”¯æŒï¼Œå¹¶ä¸”æ”¯æŒ<a href="/guide/delete.html#ibaserepository-%E7%BA%A7%E8%81%94%E5%88%A0%E9%99%A4">çº§è”åˆ é™¤åŠŸèƒ½</a></p>
</blockquote>
<p>2ã€OneToMany è¿½åŠ æˆ–æ›´æ–°å­è¡¨ï¼Œä¸åˆ é™¤å­è¡¨å·²å­˜åœ¨çš„æ•°æ®</p>
<div><pre><code>repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>true</span><span>;</span> <span>//éœ€è¦æ‰‹å·¥å¼€å¯</span>
repo<span>.</span><span>Insert</span><span>(</span>type<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><ul>
<li>ä¸åˆ é™¤ Topics å­è¡¨å·²å­˜åœ¨çš„æ•°æ®ï¼Œç¡®è®¤ï¼Ÿ</li>
<li>å½“ Topics å±æ€§ä¸º Empty æ—¶ï¼Œä¸åšä»»ä½•æ“ä½œï¼Œç¡®è®¤ï¼Ÿ</li>
<li>ä¿å­˜ Topics çš„æ—¶å€™ï¼Œè¿˜ä¼šä¿å­˜ Topics[0-..] çš„ä¸‹çº§é›†åˆå±æ€§ï¼Œå‘ä¸‹ 18 å±‚ï¼Œç¡®è®¤ï¼Ÿ</li>
</ul>
<blockquote>
<p>å‘ä¸‹ 18 å±‚çš„æ„æ€ï¼Œæ¯”å¦‚ã€ç±»å‹ã€‘è¡¨ï¼Œä¸‹é¢æœ‰é›†åˆå±æ€§ã€æ–‡ç« ã€‘ï¼Œã€æ–‡ç« ã€‘ä¸‹é¢æœ‰é›†åˆå±æ€§ã€è¯„è®ºã€‘ã€‚</p>
</blockquote>
<blockquote>
<p>ä¿å­˜ã€ç±»å‹ã€‘è¡¨å¯¹è±¡çš„æ—¶å€™ï¼Œä»–ä¼šå‘ä¸‹æ£€ç´¢å‡ºé›†åˆå±æ€§ã€æ–‡ç« ã€‘ï¼Œç„¶åå¦‚æœã€æ–‡ç« ã€‘è¢«ä¿å­˜çš„æ—¶å€™ï¼Œå†ç»§ç»­å‘ä¸‹æ£€ç´¢å‡ºé›†åˆå±æ€§ã€è¯„è®ºã€‘ã€‚ä¸€èµ·åš InsertOrUpdate æ“ä½œã€‚</p>
</blockquote>
<p>3ã€ManyToMany å®Œæ•´å¯¹æ¯”ä¿å­˜ä¸­é—´è¡¨ï¼Œè¿½åŠ å¤–éƒ¨è¡¨</p>
<p>å®Œæ•´å¯¹æ¯”ä¿å­˜ä¸­é—´è¡¨ï¼Œå¯¹æ¯”ã€å¤šå¯¹å¤šã€‘ä¸­é—´è¡¨å·²å­˜åœ¨çš„æ•°æ®ï¼Œè®¡ç®—å‡ºæ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤æ‰§è¡Œã€‚</p>
<p>è¿½åŠ å¤–éƒ¨è¡¨ï¼Œåªè¿½åŠ ä¸æ›´æ–°ã€‚</p>
<ul>
<li>æœ¬è¡¨ Song</li>
<li>å¤–éƒ¨è¡¨ Tag</li>
<li>ä¸­é—´è¡¨ SongTag</li>
</ul>
<hr>
<p>æµ‹è¯• 1ï¼šè¿½åŠ ä¿å­˜ OneToMany</p>
<div><pre><code>
<span>class</span> <span>Cagetory</span>
<span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>Guid</span> ParentId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>ParentId<span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>List<span>&lt;</span>Cagetory<span>></span></span> Childs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span><span>void</span></span> <span>TestOneToManyParent</span><span>(</span><span>)</span>
<span>{</span>
    <span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Cagetory<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>true</span><span>;</span>
    <span><span>var</span></span> cts <span>=</span> <span>new</span><span>[</span><span>]</span>
    <span>{</span>
        <span>new</span> <span>Cagetory</span>
        <span>{</span>
            Name <span>=</span> <span>"åˆ†ç±»1"</span><span>,</span>
            Childs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Cagetory<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»1_1"</span> <span>}</span><span>,</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»1_2"</span> <span>}</span><span>,</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»1_3"</span> <span>}</span>
            <span>}</span><span>)</span>
        <span>}</span><span>,</span>
        <span>new</span> <span>Cagetory</span>
        <span>{</span>
            Name <span>=</span> <span>"åˆ†ç±»2"</span><span>,</span>
            Childs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Cagetory<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»2_1"</span> <span>}</span><span>,</span>
                <span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»2_2"</span> <span>}</span>
            <span>}</span><span>)</span>
        <span>}</span>
    <span>}</span><span>;</span>
    repo<span>.</span><span>Insert</span><span>(</span>cts<span>)</span><span>;</span>
    <span>//æ‰§è¡Œåˆ›å»ºè¡¨ï¼Œå’Œæ’å…¥æ•°æ®ï¼š</span>
    <span>//INSERT INTO "Cagetory"("Id", "Name", "ParentId") VALUES('5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f', 'åˆ†ç±»1', '00000000-0000-0000-0000-000000000000'), ('5d90afcb-ed57-f6f4-0082-cb6c5b531b3e', 'åˆ†ç±»2', '00000000-0000-0000-0000-000000000000')</span>
    <span>//INSERT INTO "Cagetory"("Id", "Name", "ParentId") VALUES('5d90afcb-ed57-f6f4-0082-cb6d0c1c5f1a', 'åˆ†ç±»1_1', '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f'), ('5d90afcb-ed57-f6f4-0082-cb6e74bd8eef', 'åˆ†ç±»1_2', '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f'), ('5d90afcb-ed57-f6f4-0082-cb6f6267cc5f', 'åˆ†ç±»1_3', '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f'), ('5d90afcb-ed57-f6f4-0082-cb7057c41d46', 'åˆ†ç±»2_1', '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e'), ('5d90afcb-ed57-f6f4-0082-cb7156e0375e', 'åˆ†ç±»2_2', '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e')</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"åˆ†ç±»11"</span><span>;</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Name <span>=</span> <span>"åˆ†ç±»22"</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Childs<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span><span>Update</span><span>(</span>cts<span>)</span><span>;</span>
    <span>//UPDATE "Cagetory" SET "Name" = CASE "Id"</span>
    <span>//WHEN '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f' THEN 'åˆ†ç±»11'</span>
    <span>//WHEN '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e' THEN 'åˆ†ç±»22' END</span>
    <span>//WHERE ("Id" IN ('5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f','5d90afcb-ed57-f6f4-0082-cb6c5b531b3e'))</span>
    <span>//Childs.Clear åæ²¡æœ‰æ‰§è¡Œåˆ é™¤å­é›†åˆæ“ä½œï¼Œè¯´æ˜æ²¡æœ‰åšå®Œæ•´çš„å¯¹æ¯”</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"åˆ†ç±»111"</span><span>;</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»1_33"</span> <span>}</span><span>)</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Name <span>=</span> <span>"åˆ†ç±»222"</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Childs<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    cts<span>[</span><span>1</span><span>]</span><span>.</span>Childs<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Cagetory</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»2_22"</span> <span>}</span><span>)</span><span>;</span>
    repo<span>.</span><span>Update</span><span>(</span>cts<span>)</span><span>;</span>
    <span>//UPDATE "Cagetory" SET "Name" = CASE "Id"</span>
    <span>//WHEN '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f' THEN 'åˆ†ç±»111'</span>
    <span>//WHEN '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e' THEN 'åˆ†ç±»222' END</span>
    <span>//WHERE ("Id" IN ('5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f','5d90afcb-ed57-f6f4-0082-cb6c5b531b3e'))</span>
    <span>//INSERT INTO "Cagetory"("Id", "Name", "ParentId") VALUES('5d90afe8-ed57-f6f4-0082-cb725df546ea', 'åˆ†ç±»1_33', '5d90afcb-ed57-f6f4-0082-cb6b78eaaf9f'), ('5d90afe8-ed57-f6f4-0082-cb7338a6214c', 'åˆ†ç±»2_22', '5d90afcb-ed57-f6f4-0082-cb6c5b531b3e')</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br></div></div><hr>
<p>æµ‹è¯• 2ï¼šå®Œæ•´ä¿å­˜ ManyToMany</p>
<div><pre><code><span>class</span> <span>Song</span>
<span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>List<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>Tag</span>
<span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> TagName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>List<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>SongTag</span>
<span>{</span>
    <span>public</span> <span>Guid</span> SongId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Song</span> Song <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Guid</span> TagId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Tag</span> Tag <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>[</span><span><span>Fact</span></span><span>]</span>
<span>public</span> <span><span>void</span></span> <span>TestManyToMany</span><span>(</span><span>)</span>
<span>{</span>
    <span><span>var</span></span> tags <span>=</span> <span>new</span><span>[</span><span>]</span>
    <span>{</span>
        <span>new</span> <span>Tag</span> <span>{</span> TagName <span>=</span> <span>"æµè¡Œ"</span> <span>}</span><span>,</span>
        <span>new</span> <span>Tag</span> <span>{</span> TagName <span>=</span> <span>"80å"</span> <span>}</span><span>,</span>
        <span>new</span> <span>Tag</span> <span>{</span> TagName <span>=</span> <span>"00å"</span> <span>}</span><span>,</span>
        <span>new</span> <span>Tag</span> <span>{</span> TagName <span>=</span> <span>"æ‘‡æ»š"</span> <span>}</span>
    <span>}</span><span>;</span>
    <span><span>var</span></span> ss <span>=</span> <span>new</span><span>[</span><span>]</span>
    <span>{</span>
        <span>new</span> <span>Song</span>
        <span>{</span>
            Name <span>=</span> <span>"çˆ±ä½ ä¸€ä¸‡å¹´.mp3"</span><span>,</span>
            Tags <span>=</span> <span>new</span> <span>List<span>&lt;</span>Tag<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                tags<span>[</span><span>0</span><span>]</span><span>,</span> tags<span>[</span><span>1</span><span>]</span>
            <span>}</span><span>)</span>
        <span>}</span><span>,</span>
        <span>new</span> <span>Song</span>
        <span>{</span>
            Name <span>=</span> <span>"æç™½.mp3"</span><span>,</span>
            Tags <span>=</span> <span>new</span> <span>List<span>&lt;</span>Tag<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                tags<span>[</span><span>0</span><span>]</span><span>,</span> tags<span>[</span><span>2</span><span>]</span>
            <span>}</span><span>)</span>
        <span>}</span>
    <span>}</span><span>;</span>
    <span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>true</span><span>;</span>
    repo<span>.</span><span>Insert</span><span>(</span>ss<span>)</span><span>;</span>
    <span>//INSERT INTO "Song"("Id", "Name") VALUES('5d90fdb3-6a6b-2c58-00c8-37974177440d', 'çˆ±ä½ ä¸€ä¸‡å¹´.mp3'), ('5d90fdb3-6a6b-2c58-00c8-37987f29b197', 'æç™½.mp3')</span>
    <span>//INSERT INTO "Tag"("Id", "TagName") VALUES('5d90fdb7-6a6b-2c58-00c8-37991ead4f05', 'æµè¡Œ'), ('5d90fdbd-6a6b-2c58-00c8-379a0432a09c', '80å')</span>
    <span>//INSERT INTO "SongTag"("SongId", "TagId") VALUES('5d90fdb3-6a6b-2c58-00c8-37974177440d', '5d90fdb7-6a6b-2c58-00c8-37991ead4f05'), ('5d90fdb3-6a6b-2c58-00c8-37974177440d', '5d90fdbd-6a6b-2c58-00c8-379a0432a09c')</span>
    <span>//INSERT INTO "Tag"("Id", "TagName") VALUES('5d90fdcc-6a6b-2c58-00c8-379b5af59d25', '00å')</span>
    <span>//INSERT INTO "SongTag"("SongId", "TagId") VALUES('5d90fdb3-6a6b-2c58-00c8-37987f29b197', '5d90fdb7-6a6b-2c58-00c8-37991ead4f05'), ('5d90fdb3-6a6b-2c58-00c8-37987f29b197', '5d90fdcc-6a6b-2c58-00c8-379b5af59d25')</span>

    ss<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"çˆ±ä½ ä¸€ä¸‡å¹´.mp5"</span><span>;</span>
    ss<span>[</span><span>0</span><span>]</span><span>.</span>Tags<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    ss<span>[</span><span>0</span><span>]</span><span>.</span>Tags<span>.</span><span>Add</span><span>(</span>tags<span>[</span><span>0</span><span>]</span><span>)</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Name <span>=</span> <span>"æç™½.mp5"</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Tags<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Tags<span>.</span><span>Add</span><span>(</span>tags<span>[</span><span>3</span><span>]</span><span>)</span><span>;</span>
    repo<span>.</span><span>Update</span><span>(</span>ss<span>)</span><span>;</span>
    <span>//UPDATE "Song" SET "Name" = CASE "Id"</span>
    <span>//WHEN '5d90fdb3-6a6b-2c58-00c8-37974177440d' THEN 'çˆ±ä½ ä¸€ä¸‡å¹´.mp5'</span>
    <span>//WHEN '5d90fdb3-6a6b-2c58-00c8-37987f29b197' THEN 'æç™½.mp5' END</span>
    <span>//WHERE ("Id" IN ('5d90fdb3-6a6b-2c58-00c8-37974177440d','5d90fdb3-6a6b-2c58-00c8-37987f29b197'))</span>

    <span>//SELECT a."SongId", a."TagId"</span>
    <span>//FROM "SongTag" a</span>
    <span>//WHERE (a."SongId" = '5d90fdb3-6a6b-2c58-00c8-37974177440d')</span>

    <span>//DELETE FROM "SongTag" WHERE ("SongId" = '5d90fdb3-6a6b-2c58-00c8-37974177440d' AND "TagId" = '5d90fdbd-6a6b-2c58-00c8-379a0432a09c')</span>
    <span>//INSERT INTO "Tag"("Id", "TagName") VALUES('5d90febd-6a6b-2c58-00c8-379c21acfc72', 'æ‘‡æ»š')</span>

    <span>//SELECT a."SongId", a."TagId"</span>
    <span>//FROM "SongTag" a</span>
    <span>//WHERE (a."SongId" = '5d90fdb3-6a6b-2c58-00c8-37987f29b197')</span>

    <span>//DELETE FROM "SongTag" WHERE ("SongId" = '5d90fdb3-6a6b-2c58-00c8-37987f29b197' AND "TagId" = '5d90fdb7-6a6b-2c58-00c8-37991ead4f05' OR "SongId" = '5d90fdb3-6a6b-2c58-00c8-37987f29b197' AND "TagId" = '5d90fdcc-6a6b-2c58-00c8-379b5af59d25')</span>
    <span>//INSERT INTO "SongTag"("SongId", "TagId") VALUES('5d90fdb3-6a6b-2c58-00c8-37987f29b197', '5d90febd-6a6b-2c58-00c8-379c21acfc72')</span>

    ss<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"çˆ±ä½ ä¸€ä¸‡å¹´.mp4"</span><span>;</span>
    ss<span>[</span><span>0</span><span>]</span><span>.</span>Tags<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Name <span>=</span> <span>"æç™½.mp4"</span><span>;</span>
    ss<span>[</span><span>1</span><span>]</span><span>.</span>Tags<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span><span>Update</span><span>(</span>ss<span>)</span><span>;</span>
    <span>//DELETE FROM "SongTag" WHERE ("SongId" = '5d90fdb3-6a6b-2c58-00c8-37974177440d')</span>
    <span>//DELETE FROM "SongTag" WHERE ("SongId" = '5d90fdb3-6a6b-2c58-00c8-37987f29b197')</span>

    <span>//UPDATE "Song" SET "Name" = CASE "Id"</span>
    <span>//WHEN '5d90fdb3-6a6b-2c58-00c8-37974177440d' THEN 'çˆ±ä½ ä¸€ä¸‡å¹´.mp4'</span>
    <span>//WHEN '5d90fdb3-6a6b-2c58-00c8-37987f29b197' THEN 'æç™½.mp4' END</span>
    <span>//WHERE ("Id" IN ('5d90fdb3-6a6b-2c58-00c8-37974177440d','5d90fdb3-6a6b-2c58-00c8-37987f29b197'))</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br><span>76</span><br><span>77</span><br><span>78</span><br><span>79</span><br><span>80</span><br><span>81</span><br><span>82</span><br><span>83</span><br><span>84</span><br><span>85</span><br><span>86</span><br><span>87</span><br><span>88</span><br><span>89</span><br><span>90</span><br><span>91</span><br><span>92</span><br><span>93</span><br><span>94</span><br><span>95</span><br><span>96</span><br><span>97</span><br></div></div>]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">Code First</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/code-first.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/code-first.html"/>
    <updated>2022-05-31T14:08:53.000Z</updated>
    <content type="html"><![CDATA[<p><code>FreeSql</code> æ”¯æŒ <code>CodeFirst</code> è¿ç§»ç»“æ„è‡³æ•°æ®åº“ï¼Œè¿™åº”è¯¥æ˜¯(<code>O/RM</code>)å¿…é¡»æ ‡é…çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</p>
<p>ä¸å…¶ä»–(<code>O/RM</code>)ä¸åŒçš„æ˜¯ï¼š<code>FreeSql</code>æ”¯æŒæ›´å¤šçš„æ•°æ®åº“ç‰¹æ€§ï¼Œè€Œä¸åªæ˜¯æ”¯æŒåŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œè¿™æ—¢æ˜¯ä¼˜ç‚¹ä¹Ÿæ˜¯ç¼ºç‚¹ï¼Œä¼˜ç‚¹æ˜¯å……åˆ†åˆ©ç”¨æ•°æ®åº“ç‰¹æ€§è¾…åŠ©å¼€å‘ï¼Œç¼ºç‚¹æ˜¯åˆ‡æ¢æ•°æ®åº“å˜å¾—å›°éš¾ã€‚ä¸åŒç¨‹åºå‘˜çš„ç†å¿µå¯èƒ½ä¸å¤ªä¸€è‡´ï¼Œ<code>FreeSql</code>å°½é‡æŠŠåŠŸèƒ½æ”¯æŒåˆ°æè‡´ï¼Œè‡³äºæ˜¯å¦ä½¿ç”¨æ˜¯é¡¹ç›®ç»„æŠ€æœ¯è¡¡é‡çš„å¦ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>å°½ç®¡å¤šç§æ•°æ®åº“é€‚é…é€»è¾‘éå¸¸å¤æ‚ï¼Œ<code>FreeSql</code>å§‹ç»ˆç§‰æ‰¿ä¼˜åŒ–ç¨‹åºå¼€å‘ä¹ æƒ¯çš„åŸåˆ™å°½é‡å»å®ç°ï¼Œä¸­é—´ç¢°åˆ°äº†ä¸€äº›éæŠ€æœ¯æ— æ³•æ”»å…‹çš„éš¾é¢˜ï¼Œæ¯”å¦‚æ•°æ®åº“çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå’Œå®ä½“ç±»æœ¬èº«å°±æ˜¯ä¸€ç§å†²çªï¼Œä¸ºäº†å‡å°‘ä½¿ç”¨æˆæœ¬ï¼Œè¯¸å¦‚æ­¤ç±»çš„æ•°æ®åº“åŠŸèƒ½æ²¡æœ‰å¾—åˆ°æ”¯æŒã€‚</p>
<div><pre><code><span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„ã€å¼€å‘ç¯å¢ƒå¿…å¤‡ã€‘ï¼ŒFreeSqlä¸ä¼šæ‰«æç¨‹åºé›†ï¼Œåªæœ‰CRUDæ—¶æ‰ä¼šç”Ÿæˆè¡¨ã€‚</span>
    <span>.</span><span>UseMonitorCommand</span><span>(</span>cmd <span>=></span> Console<span>.</span><span>Write</span><span>(</span>cmd<span>.</span>CommandText<span>)</span><span>)</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="è¿ç§»ç»“æ„" tabindex="-1"> è¿ç§»ç»“æ„</h2>
<table>
<thead>
<tr>
<th>åˆ›å»ºæ•°æ®åº“</th>
<th>Sqlite</th>
<th>Sql Server</th>
<th>MySql</th>
<th>PostgreSQL</th>
<th>Oracle</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>âˆš</td>
<td>X <a href="https://github.com/luoyunchong/lin-cms-dotnetcore/blob/master/src/LinCms.Infrastructure/FreeSql/FreeSqlExtension.cs#L153" target="_blank" rel="noopener noreferrer">å‚è€ƒ</a></td>
<td>X <a href="https://github.com/luoyunchong/lin-cms-dotnetcore/blob/master/src/LinCms.Infrastructure/FreeSql/FreeSqlExtension.cs#L129" target="_blank" rel="noopener noreferrer">å‚è€ƒ</a></td>
<td>X<a href="https://github.com/luoyunchong/lin-cms-dotnetcore/blob/master/src/LinCms.Infrastructure/FreeSql/FreeSqlExtension.cs#L233" target="_blank" rel="noopener noreferrer">å‚è€ƒ</a></td>
<td>X</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>å®ä½“ï¼†è¡¨å¯¹æ¯”</th>
<th>æ·»åŠ </th>
<th>æ”¹å</th>
<th>åˆ é™¤</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
<td>X</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>å®ä½“å±æ€§ï¼†å­—æ®µå¯¹æ¯”</th>
<th>æ·»åŠ </th>
<th>ä¿®æ”¹å¯ç©º</th>
<th>ä¿®æ”¹è‡ªå¢</th>
<th>ä¿®æ”¹ç±»å‹</th>
<th>æ”¹å</th>
<th>åˆ é™¤</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
<td>X</td>
<td>âˆš</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ä¸ºäº†ä¿è¯å®‰å…¨ï¼Œä¸æä¾›åˆ é™¤å­—æ®µã€‚</p>
</blockquote>
<p>è­¦å‘Šï¼šå¦‚æœå®ä½“ç±»å±æ€§ï¼Œä¸æ•°æ®åº“è¡¨å­—æ®µä¸å®Œæ•´æ˜ å°„çš„æ—¶å€™ï¼Œæœªæ˜ å°„çš„å­—æ®µæœ‰å¯èƒ½å‘ç”Ÿä¸¢å¤±ã€‚</p>
<blockquote>
<p>åŸå› ï¼šæŸäº›è¿ç§»å¯¹æ¯”æ“ä½œæ˜¯ï¼šåˆ›å»ºä¸´æ—¶è¡¨ã€å¯¼å…¥æ—§è¡¨æ•°æ®ã€åˆ é™¤æ—§è¡¨ã€‚</p>
</blockquote>
<h3 id="freesql-æä¾›ä¸¤ç§-codefirst-ç§»è¿æ–¹æ³•-è‡ªåŠ¨å’Œæ‰‹åŠ¨ã€‚" tabindex="-1"> FreeSql æä¾›ä¸¤ç§ CodeFirst ç§»è¿æ–¹æ³•ï¼Œè‡ªåŠ¨å’Œæ‰‹åŠ¨ã€‚</h3>
<p><strong>æ³¨æ„</strong>ï¼šè°¨æ…ã€è°¨æ…ã€è°¨æ…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šè°¨æ…ã€è°¨æ…ã€è°¨æ…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šè°¨æ…ã€è°¨æ…ã€è°¨æ…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚</p>
<h3 id="è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„ã€å¼€å‘ç¯å¢ƒå¿…å¤‡ã€‘" tabindex="-1"> è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„ã€å¼€å‘ç¯å¢ƒå¿…å¤‡ã€‘</h3>
<p>è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“ï¼Œç¨‹åºè¿è¡Œä¸­æ£€æŸ¥å®ä½“è¡¨æ˜¯å¦å­˜åœ¨ï¼Œç„¶åè¿ç§»æ‰§è¡Œåˆ›å»ºæˆ–ä¿®æ”¹ã€‚</p>
<div><pre><code>fsql<span>.</span>CodeFirst<span>.</span>IsAutoSyncDataStructure <span>=</span> <span>true</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><blockquote>
<p>æ­¤åŠŸèƒ½é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå‘å¸ƒæ­£å¼ç¯å¢ƒåï¼Œè¯·ä¿®æ”¹æ­¤è®¾ç½®ã€‚</p>
</blockquote>
<blockquote>
<p>è™½ç„¶ã€è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„ã€‘åŠŸèƒ½å¼€å‘éå¸¸å¥½ç”¨ï¼Œä½†æ˜¯æœ‰ä¸ªåå¤„ï¼Œå°±æ˜¯æ•°æ®åº“åé¢ä¼šå¾ˆä¹±ï¼Œæ²¡ç”¨çš„å­—æ®µå¯èƒ½ä¸€å¤§å †ï¼Œåº”å°½é‡æ§åˆ¶å®ä½“æˆ–å±æ€§å‘½åçš„ä¿®æ”¹ã€‚</p>
</blockquote>
<ul>
<li>æ³¨æ„ï¼šåªæœ‰å½“ CURD åˆ°æ­¤è¡¨æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨ç”Ÿæˆè¡¨ç»“æ„ã€‚å¦‚éœ€ç³»ç»Ÿè¿è¡Œæ—¶è¿ç§»è¡¨ç»“æ„ï¼Œè¯·ä½¿ç”¨<strong>SyncStructure</strong>æ–¹æ³•</li>
<li><code>FreeSql</code>ä¸ä¼šå¸®ä½ ç”Ÿæˆæ•°æ®åº“ï¼Œéœ€è¦ä½ æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“ã€‚<strong>å¦‚æœä½ ä½¿ç”¨<code>Mysql</code>ã€<code>Sql Server</code>,<code>PostgreSQL</code>ï¼Œéœ€è¦è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“.è¯·å‚è€ƒæ­¤ä»£ç ï¼Œè‡ªè¡Œ copyï¼Œ<a href="https://github.com/luoyunchong/lin-cms-dotnetcore/blob/master/src/LinCms.Infrastructure/FreeSql/FreeSqlExtension.cs" target="_blank" rel="noopener noreferrer">FreeSqlExtension.cs</a></strong></li>
</ul>
<h3 id="ç¦ç”¨è¿ç§»" tabindex="-1"> ç¦ç”¨è¿ç§»</h3>
<p>å½“ã€å®ä½“ç±»ã€‘å¯¹åº”çš„æ˜¯æ•°æ®åº“ã€è§†å›¾ã€‘æˆ–è€…å…¶ä»–æ—¶ï¼Œå¯é€šè¿‡ [Table(DisableSyncStructure = true)] ç¦ç”¨æŒ‡å®šçš„å®ä½“è¿ç§»æ“ä½œã€‚</p>
<div><pre><code><span>[</span><span><span>Table</span><span><span>(</span>DisableSyncStructure <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>ModelDisableSyncStructure</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>false</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> pkid <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="å¤‡æ³¨" tabindex="-1"> å¤‡æ³¨</h2>
<p>FreeSql CodeFirst æ”¯æŒå°† c# ä»£ç å†…çš„æ³¨é‡Šï¼Œè¿ç§»è‡³æ•°æ®åº“çš„å¤‡æ³¨ã€‚å…ˆå†³æ¡ä»¶ï¼š</p>
<p>1ã€å®ä½“ç±»æ‰€åœ¨ç¨‹åºé›†ï¼Œéœ€è¦å¼€å¯ xml æ–‡æ¡£åŠŸèƒ½ï¼›</p>
<p>2ã€xml æ–‡ä»¶å¿…é¡»ä¸ç¨‹åºé›†åŒç›®å½•ï¼Œä¸”æ–‡ä»¶åï¼šxxx.dll -&gt; xxx.xmlï¼›</p>
<blockquote>
<p>v1.5.0+ ç‰ˆæœ¬å¢åŠ äº†å¯¹ Description ç‰¹æ€§çš„è§£æï¼Œä¼˜å…ˆçº§ä½äº c# ä»£ç æ³¨é‡Šï¼›</p>
</blockquote>
<h3 id="æ‰‹å·¥åŒæ­¥å®ä½“ç»“æ„" tabindex="-1"> æ‰‹å·¥åŒæ­¥å®ä½“ç»“æ„</h3>
<p>æä¾›æ¥å£æ–¹æ³•å®ç°å¯¹æ¯”å®ä½“ï¼Œä¸æ•°æ®åº“ä¸­çš„å˜åŒ–éƒ¨åˆ†ï¼Œè¿”å› SQL è¯­å¥ã€‚</p>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> mysql<span>.</span>CodeFirst<span>.</span><span><span>GetComparisonDDLStatements</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>ushort</span></span> fusho <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><div><pre><code><span>CREATE</span> <span>TABLE</span> <span>IF</span> <span>NOT</span> <span>EXISTS</span> <span><span>`</span>cccddd<span>`</span></span><span>.</span><span><span>`</span>Topic<span>`</span></span> <span>(</span>
    <span><span>`</span>Id<span>`</span></span> <span>INT</span><span>(</span><span>11</span><span>)</span> <span>NOT</span> <span>NULL</span> <span>AUTO_INCREMENT</span><span>,</span>
    <span><span>`</span>Clicks<span>`</span></span> <span>INT</span><span>(</span><span>11</span><span>)</span> <span>NOT</span> <span>NULL</span><span>,</span>
    <span><span>`</span>Title<span>`</span></span> <span>VARCHAR</span><span>(</span><span>255</span><span>)</span><span>,</span>
    <span><span>`</span>CreateTime<span>`</span></span> <span>DATETIME</span> <span>NOT</span> <span>NULL</span><span>,</span>
    <span><span>`</span>fusho<span>`</span></span> <span>SMALLINT</span><span>(</span><span>5</span><span>)</span> <span>UNSIGNED</span> <span>NOT</span> <span>NULL</span><span>,</span>
    <span>PRIMARY</span> <span>KEY</span> <span>(</span><span><span>`</span>Id<span>`</span></span><span>)</span>
<span>)</span> <span>Engine</span><span>=</span><span>InnoDB</span> <span>CHARACTER</span> <span>SET</span> utf8<span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>æä¾›æ¥å£æ–¹æ³•å®ç°åŒæ­¥ç»“æ„</p>
<div><pre><code><span><span>var</span></span> t2 <span>=</span> fsql<span>.</span>CodeFirst<span>.</span><span><span>SyncStructure</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span>//åŒæ­¥å®ä½“ç±»å‹åˆ°æ•°æ®åº“</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h4 id="æ‰¹é‡ç”Ÿæˆè¡¨ç»“æ„" tabindex="-1"> æ‰¹é‡ç”Ÿæˆè¡¨ç»“æ„</h4>
<ul>
<li>void SyncStructure(params Type[]) é‡è½½æ–¹æ³•æ”¯æŒæ•°ç»„,åŒæ­¥å®ä½“ç±»å‹é›†åˆåˆ°æ•°æ®åº“</li>
<li>IEntity ç±»ï¼Œæ˜¯å®ä½“ç±»æ‰€åœ¨ç¨‹åºé›†çš„ä¸€ä¸ªç±»å³å¯ã€‚</li>
</ul>
<p>æ–¹æ³• 1ï¼šæ‰«æ IEntity ç±»æ‰€åœ¨ç¨‹åºé›†ï¼Œåå°„å¾—åˆ°ç±»ä¸Šæœ‰ç‰¹æ€§æ ‡ç­¾ä¸º TableAttribute çš„æ‰€æœ‰ç±»ï¼Œè¯¥æ–¹æ³•éœ€åœ¨å®ä½“ç±»ä¸ŠæŒ‡å®šäº† [Table(Name = &quot;xxx&quot;)]ç‰¹æ€§æ ‡ç­¾</p>
<div><pre><code><span>public</span> <span>static</span> <span>Type<span>[</span><span>]</span></span> <span>GetTypesByTableAttribute</span><span>(</span><span>)</span>
<span>{</span>
    <span>List<span>&lt;</span>Type<span>></span></span> tableAssembies <span>=</span> <span>new</span> <span>List<span>&lt;</span>Type<span>></span></span><span>(</span><span>)</span><span>;</span>
    <span>foreach</span> <span>(</span><span>Type</span> type <span>in</span> Assembly<span>.</span><span>GetAssembly</span><span>(</span><span>typeof</span><span>(</span><span>IEntity</span><span>)</span><span>)</span><span>.</span><span>GetExportedTypes</span><span>(</span><span>)</span><span>)</span>
        <span>foreach</span> <span>(</span><span>Attribute</span> attribute <span>in</span> type<span>.</span><span>GetCustomAttributes</span><span>(</span><span>)</span><span>)</span>
            <span>if</span> <span>(</span>attribute <span>is</span> <span>TableAttribute</span> tableAttribute<span>)</span>
                <span>if</span> <span>(</span>tableAttribute<span>.</span>DisableSyncStructure <span>==</span> <span>false</span><span>)</span>
                    tableAssembies<span>.</span><span>Add</span><span>(</span>type<span>)</span><span>;</span>

    <span>return</span> tableAssembies<span>.</span><span>ToArray</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>è°ƒç”¨</p>
<div><pre><code>fsql<span>.</span>CodeFirst<span>.</span><span>SyncStructure</span><span>(</span><span>GetTypesByTableAttribute</span><span>(</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ–¹æ³• 2ï¼šé€šè¿‡å‘½åç©ºé—´å¾—åˆ°æ‰€æœ‰è¦åˆ›å»ºçš„å®ä½“ç±».æ ¹æ®éœ€è¦è°ƒæ•´ entitiesFullName ä¸‹çš„å‘½åç©ºé—´å€¼ã€‚æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Entities æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾å®ä½“ç±»ã€‚è¯¥æ–¹æ³•é€šè¿‡ç­›é€‰ IEntity ç±»æ‰€åœ¨ç¨‹åºé›†æ‰€æœ‰çš„å®ä½“ç±»ã€‚ä»–ä»¬çš„å‘½åç©ºé—´éƒ½æ˜¯ LinCms.Entities å¼€å¤´ï¼Œå†…éƒ¨é€šè¿‡ StartsWith åˆ¤æ–­ã€‚</p>
<div><pre><code><span>public</span> <span>static</span> <span>Type<span>[</span><span>]</span></span> <span>GetTypesByNameSpace</span><span>(</span><span>)</span>
<span>{</span>
    <span>List<span>&lt;</span>Type<span>></span></span> tableAssembies <span>=</span> <span>new</span> <span>List<span>&lt;</span>Type<span>></span></span><span>(</span><span>)</span><span>;</span>
    <span>List<span>&lt;</span><span>string</span><span>></span></span> entitiesFullName <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>string</span><span>></span></span><span>(</span><span>)</span>
    <span>{</span>
        <span>"LinCms.Entities.Settings"</span><span>,</span>
        <span>"LinCms.Entities.Base"</span><span>,</span>
    <span>}</span><span>;</span>
    <span>foreach</span> <span>(</span><span>Type</span> type <span>in</span> Assembly<span>.</span><span>GetAssembly</span><span>(</span><span>typeof</span><span>(</span><span>IEntity</span><span>)</span><span>)</span><span>.</span><span>GetExportedTypes</span><span>(</span><span>)</span><span>)</span>
        <span>foreach</span> <span>(</span><span><span>var</span></span> fullname <span>in</span> entitiesFullName<span>)</span>
            <span>if</span> <span>(</span>type<span>.</span>FullName<span>.</span><span>StartsWith</span><span>(</span>fullname<span>)</span> <span>&amp;&amp;</span> type<span>.</span>IsClass<span>)</span>
                tableAssembies<span>.</span><span>Add</span><span>(</span>type<span>)</span><span>;</span>

    <span>return</span> tableAssembies<span>.</span><span>ToArray</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>æˆ–é€šè¿‡è°ƒç”¨åŒæ­¥æ‰€æœ‰è¡¨ç»“æ„</p>
<div><pre><code>fsql<span>.</span>CodeFirst<span>.</span><span>SyncStructure</span><span>(</span><span>GetTypesByNameSpace</span><span>(</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="å®ä½“ç‰¹æ€§" tabindex="-1"> å®ä½“ç‰¹æ€§</h2>
<p>æŒ‡å®šå®ä½“çš„è¡¨åï¼ŒæŒ‡å®š Name åï¼Œå®ä½“ç±»åå˜åŒ–ä¸å½±å“æ•°æ®åº“å¯¹åº”çš„è¡¨ã€‚FreeSql å°½é‡æ”¯æŒäº†å¯¹å¤šæ•°æ®åº“æˆ– schema æ”¯æŒï¼Œä¸é˜²è¯•è¯•æŒ‡å®šè¡¨åä¸ºï¼šå…¶ä»–æ•°æ®åº“.è¡¨åï¼Œä¸åŒæ•°æ®åº“çš„æŒ‡å®šæ–¹å¼æœ‰å·®å¼‚ï¼Œè¿™ä¸€ç‚¹ä»¥åæ·±å…¥è§£ç­”ã€‚</p>
<div><pre><code><span>[</span><span><span>Table</span><span><span>(</span>Name <span>=</span> <span>"db2.tb_topic111"</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>Topic</span> <span>{</span>
  <span>//...</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>æ— æŒ‡å®šå®ä½“çš„è¡¨åï¼Œä¿®æ”¹ä¸ºå®ä½“ç±»åã€‚æŒ‡å®šæ•°æ®åº“æ—§çš„è¡¨åï¼Œä¿®æ”¹å®ä½“å‘½åæ—¶ï¼ŒåŒæ—¶è®¾ç½®æ­¤å‚æ•°ä¸ºä¿®æ”¹ä¹‹å‰çš„å€¼ï¼ŒCodeFirst æ‰å¯ä»¥æ­£ç¡®ä¿®æ”¹æ•°æ®åº“è¡¨ï¼›å¦åˆ™å°†è§†ä¸ºã€åˆ›å»ºæ–°è¡¨ã€‘ã€‚</p>
<div><pre><code><span>[</span><span><span>Table</span><span><span>(</span>OldName <span>=</span> <span>"Topic"</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>Topic2</span> <span>{</span>
  <span>//...</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span>ALTER</span> <span>TABLE</span> <span><span>`</span>cccddd<span>`</span></span><span>.</span><span><span>`</span>Topic<span>`</span></span> <span>RENAME</span> <span>TO</span> <span><span>`</span>cccddd<span>`</span></span><span>.</span><span><span>`</span>Topic2<span>`</span></span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ä¿®æ”¹å­—æ®µç±»å‹ï¼ŒæŠŠ Title ç±»å‹æ”¹ä¸º varchar(128)ã€‚</p>
<div><pre><code><span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(128)"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><div><pre><code><span>ALTER</span> <span>TABLE</span> <span><span>`</span>cccddd<span>`</span></span><span>.</span><span><span>`</span>Topic2<span>`</span></span> <span>MODIFY</span> <span><span>`</span>Title<span>`</span></span> <span>VARCHAR</span><span>(</span><span>128</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æŒ‡å®šå±æ€§çš„å­—æ®µåï¼Œè¿™æ ·æŒ‡å®šåï¼Œä¿®æ”¹å®ä½“çš„å±æ€§åä¸å½±å“æ•°æ®åº“å¯¹åº”çš„åˆ—ã€‚</p>
<div><pre><code><span>[</span><span><span>Column</span><span><span>(</span>Name <span>=</span> <span>"titl2"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>æ— æŒ‡å®šå±æ€§çš„å­—æ®µåï¼Œä¿®æ”¹ä¸ºå±æ€§åï¼ŒæŒ‡å®šæ•°æ®åº“æ—§çš„åˆ—åï¼Œä¿®æ”¹å®ä½“å±æ€§å‘½åæ—¶ï¼ŒåŒæ—¶è®¾ç½®æ­¤å‚æ•°ä¸ºä¿®æ”¹ä¹‹å‰çš„å€¼ï¼ŒCodeFirst æ‰å¯ä»¥æ­£ç¡®ä¿®æ”¹æ•°æ®åº“å­—æ®µï¼›å¦åˆ™å°†è§†ä¸ºã€æ–°å¢å­—æ®µã€‘ã€‚</p>
<div><pre><code><span>[</span><span><span>Column</span><span><span>(</span>OldName <span>=</span> <span>"Title2"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><div><pre><code><span>ALTER</span> <span>TABLE</span> <span><span>`</span>cccddd<span>`</span></span><span>.</span><span><span>`</span>Topic2<span>`</span></span> CHANGE <span>COLUMN</span> <span><span>`</span>Title2<span>`</span></span> <span><span>`</span>Title<span>`</span></span> <span>VARCHAR</span><span>(</span><span>255</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div>]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">è‡ªå®šä¹‰ç‰¹æ€§</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/custom-attribute.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/custom-attribute.html"/>
    <updated>2021-06-16T16:56:09.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è‡ªå®šä¹‰ç‰¹æ€§" tabindex="-1"> è‡ªå®šä¹‰ç‰¹æ€§</h1>
<p>æœ¬åŠŸèƒ½å¯å®ç°ä¸å…¶ä»– ORM ä½¿ç”¨ä¸€å¥— Attributeï¼Œé¿å…ç»´æŠ¤ä¸¤ä»½å®ä½“ç‰¹æ€§çš„çƒ¦æ¼ï¼š</p>
<blockquote>
<p>v1.4.0+ å·²è‡ªåŠ¨è¯†åˆ« EFCore å®ä½“ç‰¹æ€§ Key/Required/NotMapped/MaxLength/StringLength/DatabaseGenerated/Table/Column</p>
</blockquote>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>ConfigEntity <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span> <span>{</span>
  <span><span>var</span></span> attr <span>=</span> e<span>.</span>EntityType<span>.</span><span>GetCustomAttributes</span><span>(</span><span>typeof</span><span>(</span><span>MyTableAttribute</span><span>)</span><span>,</span> <span>false</span><span>)</span><span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span> <span>as</span> <span>MyTableAttribute</span><span>;</span>
  <span>if</span> <span>(</span>attr <span>!=</span> <span>null</span><span>)</span>
    e<span>.</span>ModifyResult<span>.</span>Name <span>=</span> attr<span>.</span>Name<span>;</span> <span>//è¡¨å</span>
<span>}</span><span>;</span>
fsql<span>.</span>Aop<span>.</span>ConfigEntityProperty <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span> <span>{</span>
  <span><span>var</span></span> attr <span>=</span> e<span>.</span>Property<span>.</span><span>GetCustomAttributes</span><span>(</span><span>typeof</span><span>(</span><span>MyColumnAttribute</span><span>)</span><span>,</span> <span>false</span><span>)</span><span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span> <span>as</span> <span>MyColumnAttribute</span><span>;</span>
  <span>if</span> <span>(</span>attr <span>!=</span> <span>null</span><span>)</span>
    e<span>.</span>ModifyResult<span>.</span>Name <span>=</span> attr<span>.</span>Name<span>;</span> <span>//å­—æ®µå</span>
<span>}</span><span>;</span>

<span>[</span><span><span>MyTable</span><span><span>(</span><span>"xxx"</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>YourEntity</span> <span>{</span>
  <span>[</span><span><span>MyColumn</span><span><span>(</span><span>"id"</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span><span>int</span></span> pkid <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>class</span> <span>MyTableAttribute</span> <span>:</span> <span><span>Attribute</span></span> <span>{</span>
  <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>}</span>
  <span>public</span> <span>MyTableAttribute</span><span>(</span><span><span>string</span></span> name<span>)</span>
  <span>{</span>
    <span>this</span><span>.</span>Name <span>=</span> name<span>;</span>
  <span>}</span>
<span>}</span>
<span>class</span> <span>MyColumnAttribute</span> <span>:</span> <span><span>Attribute</span></span> <span>{</span>
  <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>}</span>
  <span>public</span> <span>MyColumnAttribute</span><span>(</span><span><span>string</span></span> name<span>)</span>
  <span>{</span>
    <span>this</span><span>.</span>Name <span>=</span> name<span>;</span>
  <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br></div></div><h2 id="ä¼˜å…ˆçº§" tabindex="-1"> ä¼˜å…ˆçº§</h2>
<p>æ•°æ®åº“ç‰¹æ€§ &gt; å®ä½“ç‰¹æ€§ &gt; FluentApiï¼ˆé…ç½®ç‰¹æ€§ï¼‰ &gt; AOPï¼ˆé…ç½®ç‰¹æ€§ï¼‰</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">DbContext</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/db-context.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/db-context.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="dbcontext" tabindex="-1"> DbContext</h1>
<p>FreeSql.DbContext å®ç°ç±»ä¼¼ EFCore ä½¿ç”¨ä¹ æƒ¯ï¼Œè·Ÿè¸ªå¯¹è±¡çŠ¶æ€ï¼Œæœ€ç»ˆé€šè¿‡ SaveChanges æ–¹æ³•æäº¤äº‹åŠ¡ã€‚</p>
<h2 id="ç‰¹æ€§" tabindex="-1"> ç‰¹æ€§</h2>
<ul>
<li>Select/Attach å¿«ç…§å¯¹è±¡ï¼ŒUpdate åªæ›´æ–°å˜åŒ–çš„å­—æ®µï¼›</li>
<li>Add/AddRange æ’å…¥æ•°æ®ï¼Œé€‚é…å„æ•°æ®åº“ä¼˜åŒ–æ‰§è¡Œ ExecuteAffrows/ExecuteIdentity/ExecuteInsertedï¼›</li>
<li>AddOrUpdate æ’å…¥æˆ–æ›´æ–°ï¼›</li>
<li>SaveMany æ–¹æ³•å¿«é€Ÿä¿å­˜å¯¼èˆªå¯¹è±¡ï¼ˆä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼‰ï¼›</li>
</ul>
<h2 id="å®‰è£…" tabindex="-1"> å®‰è£…</h2>
<blockquote>
<p>dotnet add package FreeSql.DbContext</p>
</blockquote>
<h2 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"> å¦‚ä½•ä½¿ç”¨</h2>
<p>0ã€é€šç”¨æ–¹æ³•ï¼Œä¸ºå•¥æ˜¯ 0ï¼Ÿï¼Ÿï¼Ÿ</p>
<div><pre><code><span>using</span> <span>(</span><span><span>var</span></span> ctx <span>=</span> fsql<span>.</span><span>CreateDbContext</span><span>(</span><span>)</span><span>)</span> <span>{</span>
  <span>//var db1 = ctx.Set&lt;Song>();</span>
  <span>//var db2 = ctx.Set&lt;Tag>();</span>

  <span><span>var</span></span> item <span>=</span> <span>new</span> <span>Song</span> <span>{</span> <span>}</span><span>;</span>
  ctx<span>.</span><span>Add</span><span>(</span>item<span>)</span><span>;</span>
  ctx<span>.</span><span>SaveChanges</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><blockquote>
<p>æ³¨æ„ï¼šDbContext å¯¹è±¡å¤šçº¿ç¨‹ä¸å®‰å…¨</p>
</blockquote>
<p>1ã€åœ¨ OnConfiguring æ–¹æ³•ä¸Šé…ç½®ä¸ IFreeSql å…³è”</p>
<div><pre><code><span>public</span> <span>class</span> <span>SongContext</span> <span>:</span> <span><span>DbContext</span></span> <span>{</span>

  <span>public</span> <span>DbSet<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>DbSet<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>protected</span> <span>override</span> <span><span>void</span></span> <span>OnConfiguring</span><span>(</span><span>DbContextOptionsBuilder</span> builder<span>)</span> <span>{</span>
    builder<span>.</span><span>UseFreeSql</span><span>(</span>GlobalVar<span>.</span>fsql<span>)</span><span>;</span>
    <span>//è¿™é‡Œç›´æ¥æŒ‡å®šä¸€ä¸ªé™æ€çš„ IFreeSql å¯¹è±¡å³å¯ï¼Œåˆ‡å‹¿é‡æ–° Build()</span>
  <span>}</span>

  <span>//æ¯ä¸ª DbContext åªè§¦å‘ä¸€æ¬¡</span>
  <span>protected</span> <span>override</span> <span><span>void</span></span> <span>OnModelCreating</span><span>(</span><span>ICodeFirst</span> codefirst<span>)</span>
  <span>{</span>
    codefirst<span>.</span><span><span>Entity</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span>eb <span>=></span>
    <span>{</span>
      eb<span>.</span><span>ToTable</span><span>(</span><span>"tb_song"</span><span>)</span><span>;</span>
      eb<span>.</span><span>Ignore</span><span>(</span>a <span>=></span> a<span>.</span>Field1<span>)</span><span>;</span>
      eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>)</span><span>.</span><span>HasColumnType</span><span>(</span><span>"varchar(50)"</span><span>)</span><span>.</span><span>IsRequired</span><span>(</span><span>)</span><span>;</span>
      eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>Url<span>)</span><span>.</span><span>HasMaxLength</span><span>(</span><span>100</span><span>)</span><span>;</span>

      eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>RowVersion<span>)</span><span>.</span><span>IsRowVersion</span><span>(</span><span>)</span><span>;</span>
      eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>)</span><span>.</span><span>HasDefaultValueSql</span><span>(</span><span>"current_timestamp"</span><span>)</span><span>;</span>

      eb<span>.</span><span>HasKey</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>;</span>
      eb<span>.</span><span>HasIndex</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Id<span>,</span> a<span>.</span>Title <span>}</span><span>)</span><span>.</span><span>IsUnique</span><span>(</span><span>)</span><span>.</span><span>HasName</span><span>(</span><span>"idx_xxx11"</span><span>)</span><span>;</span>

      <span>//ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€</span>
      eb<span>.</span><span>HasOne</span><span>(</span>a <span>=></span> a<span>.</span>Type<span>)</span><span>.</span><span>HasForeignKey</span><span>(</span>a <span>=></span> a<span>.</span>TypeId<span>)</span><span>.</span><span>WithMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>)</span><span>;</span>

      <span>//å¤šå¯¹å¤š</span>
      eb<span>.</span><span>HasMany</span><span>(</span>a <span>=></span> a<span>.</span>Tags<span>)</span><span>.</span><span>WithMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>,</span> <span>typeof</span><span>(</span><span>Song_tag</span><span>)</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>

    codefirst<span>.</span><span><span>Entity</span><span><span>&lt;</span>SongType<span>></span></span></span><span>(</span>eb <span>=></span>
    <span>{</span>
      eb<span>.</span><span>HasMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>)</span><span>.</span><span>WithOne</span><span>(</span>a <span>=></span> a<span>.</span>Type<span>)</span><span>.</span><span>HasForeignKey</span><span>(</span>a <span>=></span> a<span>.</span>TypeId<span>)</span><span>;</span>

      eb<span>.</span><span>HasData</span><span>(</span><span>new</span><span>[</span><span>]</span>
      <span>{</span>
        <span>new</span> <span>SongType</span>
        <span>{</span>
          Id <span>=</span> <span>1</span><span>,</span>
          Name <span>=</span> <span>"æµè¡Œ"</span><span>,</span>
          Songs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
          <span>{</span>
            <span>new</span> <span>Song</span><span>{</span> Title <span>=</span> <span>"çœŸçš„çˆ±ä½ "</span> <span>}</span><span>,</span>
            <span>new</span> <span>Song</span><span>{</span> Title <span>=</span> <span>"çˆ±ä½ ä¸€ä¸‡å¹´"</span> <span>}</span><span>,</span>
          <span>}</span><span>)</span>
        <span>}</span><span>,</span>
        <span>new</span> <span>SongType</span>
        <span>{</span>
          Id <span>=</span> <span>2</span><span>,</span>
          Name <span>=</span> <span>"ä¹¡æ‘"</span><span>,</span>
          Songs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
          <span>{</span>
            <span>new</span> <span>Song</span><span>{</span> Title <span>=</span> <span>"ä¹¡é‡Œä¹¡äº²"</span> <span>}</span><span>,</span>
          <span>}</span><span>)</span>
        <span>}</span><span>,</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>

    codefirst<span>.</span><span><span>SyncStructure</span><span><span>&lt;</span>SongType<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    codefirst<span>.</span><span><span>SyncStructure</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span>

<span>public</span> <span>class</span> <span>SongType</span> <span>{</span>
  <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span>List<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>Song</span> <span>{</span>
  <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span><span>string</span></span> Url <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span><span>int</span></span> TypeId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>SongType</span> Type <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>List<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span><span>int</span></span> Field1 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span><span>long</span></span> RowVersion <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>Song_tag</span> <span>{</span>
  <span>public</span> <span><span>int</span></span> Song_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>Song</span> Song <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span><span>int</span></span> Tag_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>Tag</span> Tag <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>Tag</span> <span>{</span>
  <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span>List<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br><span>76</span><br><span>77</span><br><span>78</span><br><span>79</span><br><span>80</span><br><span>81</span><br><span>82</span><br><span>83</span><br><span>84</span><br><span>85</span><br><span>86</span><br><span>87</span><br><span>88</span><br><span>89</span><br><span>90</span><br><span>91</span><br><span>92</span><br><span>93</span><br><span>94</span><br><span>95</span><br><span>96</span><br><span>97</span><br><span>98</span><br><span>99</span><br><span>100</span><br><span>101</span><br></div></div><p>ä½¿ç”¨çš„æ—¶å€™ä¸ EFCore ç±»ä¼¼ï¼š</p>
<div><pre><code><span><span>long</span></span> id <span>=</span> <span>0</span><span>;</span>

<span>using</span> <span>(</span><span><span>var</span></span> ctx <span>=</span> <span>new</span> <span>SongContext</span><span>(</span><span>)</span><span>)</span> <span>{</span>

  <span><span>var</span></span> song <span>=</span> <span>new</span> <span>Song</span> <span>{</span> <span>}</span><span>;</span>
  <span>await</span> ctx<span>.</span>Songs<span>.</span><span>AddAsync</span><span>(</span>song<span>)</span><span>;</span>
  id <span>=</span> song<span>.</span>Id<span>;</span>

  <span><span>var</span></span> adds <span>=</span> Enumerable<span>.</span><span>Range</span><span>(</span><span>0</span><span>,</span> <span>100</span><span>)</span>
    <span>.</span><span>Select</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span> <span>{</span> Create_time <span>=</span> DateTime<span>.</span>Now<span>,</span> Is_deleted <span>=</span> <span>false</span><span>,</span> Title <span>=</span> <span>"xxxx"</span> <span>+</span> a<span>,</span> Url <span>=</span> <span>"url222"</span> <span>}</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
  <span>await</span> ctx<span>.</span>Songs<span>.</span><span>AddRangeAsync</span><span>(</span>adds<span>)</span><span>;</span>

  <span>for</span> <span>(</span><span><span>var</span></span> a <span>=</span> <span>0</span><span>;</span> a <span>&lt;</span> adds<span>.</span>Count<span>;</span> a<span>++</span><span>)</span>
    adds<span>[</span>a<span>]</span><span>.</span>Title <span>=</span> <span>"dkdkdkdk"</span> <span>+</span> a<span>;</span>

  ctx<span>.</span>Songs<span>.</span><span>UpdateRange</span><span>(</span>adds<span>)</span><span>;</span>

  ctx<span>.</span>Songs<span>.</span><span>RemoveRange</span><span>(</span>adds<span>.</span><span>Skip</span><span>(</span><span>10</span><span>)</span><span>.</span><span>Take</span><span>(</span><span>20</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>)</span><span>;</span>

  <span>//ctx.Songs.Update(adds.First());</span>

  adds<span>.</span><span>Last</span><span>(</span><span>)</span><span>.</span>Url <span>=</span> <span>"skldfjlksdjglkjjcccc"</span><span>;</span>
  ctx<span>.</span>Songs<span>.</span><span>Update</span><span>(</span>adds<span>.</span><span>Last</span><span>(</span><span>)</span><span>)</span><span>;</span>

  <span>//throw new Exception("å›æ»š");</span>

  <span>await</span> ctx<span>.</span><span>SaveChangesAsync</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br></div></div><p>2ã€æ³¨å…¥æ–¹å¼ä½¿ç”¨</p>
<div><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span> <span>{</span>
  services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>Fsql<span>)</span><span>;</span>
  services<span>.</span><span><span>AddFreeDbContext</span><span><span>&lt;</span>SongContext<span>></span></span></span><span>(</span>options <span>=></span> options<span>.</span><span>UseFreeSql</span><span>(</span>Fsql<span>)</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>åœ¨ mvc ä¸­è·å–ï¼š</p>
<div><pre><code><span>IFreeSql</span> _orm<span>;</span>
<span>public</span> <span>ValuesController</span><span>(</span><span>SongContext</span> songContext<span>)</span> <span>{</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h2 id="ä¼˜å…ˆçº§" tabindex="-1"> ä¼˜å…ˆçº§</h2>
<p>OnConfiguring &gt; AddFreeDbContext</p>
<h2 id="è¯´æ˜" tabindex="-1"> è¯´æ˜</h2>
<ul>
<li>DbContext æ“ä½œçš„æ•°æ®åœ¨æœ€å SaveChanges æ—¶æ‰æ‰¹é‡ä¿å­˜ï¼›</li>
<li>DbContext å†…æ‰€æœ‰æ“ä½œï¼Œä½¿ç”¨åŒä¸€ä¸ªäº‹åŠ¡ï¼›</li>
<li>å½“å®ä½“å­˜åœ¨è‡ªå¢æ—¶ï¼Œæˆ–è€… Add/AddRange çš„æ—¶å€™ä¸»é”®å€¼ä¸ºç©ºï¼Œä¼šæå‰å¼€å¯äº‹åŠ¡ï¼›</li>
<li>æ”¯æŒåŒæ­¥/å¼‚æ­¥æ–¹æ³•ï¼›</li>
</ul>
<h2 id="åˆå¹¶æœºåˆ¶" tabindex="-1"> åˆå¹¶æœºåˆ¶</h2>
<p>db.Add(new Xxx());
db.Add(new Xxx());
db.Add(new Xxx());</p>
<p>è¿™ä¸‰æ­¥ï¼Œä¼šåˆå¹¶æˆä¸€ä¸ªæ‰¹é‡æ’å…¥çš„è¯­å¥æ‰§è¡Œï¼Œå‰ææ˜¯å®ƒä»¬æ²¡æœ‰è‡ªå¢å±æ€§ã€‚</p>
<p>é€‚ç”¨ Guid ä¸»é”®ï¼ŒGuid ä¸»é”®çš„å€¼ä¸ç”¨è®¾ç½®ï¼Œäº¤ç»™ FreeSql å¤„ç†å³å¯ï¼Œç©ºç€çš„ Guid ä¸»é”®ä¼šåœ¨æ’å…¥æ—¶è·å–æœ‰åºä¸é‡å€¼çš„ Guid å€¼ã€‚</p>
<p>åˆæ¯”å¦‚ï¼š</p>
<p>db.Add(new Xxx());
db.Add(new Xxx());
db.Update(xxx);
db.Add(new Xxx());</p>
<p>Guid Id çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œä¸‰æ¬¡å‘½ä»¤ï¼šå‰ä¸¤æ¬¡æ’å…¥åˆå¹¶æ‰§è¡Œï¼Œupdate ä¸ºä¸€æ¬¡ï¼Œåé¢çš„ add ä¸ºä¸€æ¬¡ã€‚</p>
<h2 id="è”çº§ä¿å­˜" tabindex="-1"> è”çº§ä¿å­˜</h2>
<p>è¯·ç§»æ­¥æ–‡æ¡£ <a href="/guide/cascade-saving.html">ã€è”çº§ä¿å­˜ã€‘</a></p>
<h2 id="å®ä½“å˜åŒ–äº‹ä»¶" tabindex="-1"> å®ä½“å˜åŒ–äº‹ä»¶</h2>
<p>å…¨å±€è®¾ç½®ï¼š</p>
<div><pre><code>fsql<span>.</span><span>SetDbContextOptions</span><span>(</span>opt <span>=></span> <span>{</span>
  opt<span>.</span>OnEntityChange <span>=</span> report <span>=></span> <span>{</span>
    Console<span>.</span><span>WriteLine</span><span>(</span>report<span>)</span><span>;</span>
  <span>}</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>å•ç‹¬è®¾ç½® DbContext æˆ–è€… UnitOfWorkï¼š</p>
<div><pre><code><span><span>var</span></span> ctx <span>=</span> fsql<span>.</span><span>CreateDbContext</span><span>(</span><span>)</span><span>;</span>
ctx<span>.</span>Options<span>.</span>OnEntityChange <span>=</span> report <span>=></span> <span>{</span>
  Console<span>.</span><span>WriteLine</span><span>(</span>report<span>)</span><span>;</span>
<span>}</span><span>;</span>

<span><span>var</span></span> uow <span>=</span> fsql<span>.</span><span>CreateUnitOfWork</span><span>(</span><span>)</span><span>;</span>
uow<span>.</span>OnEntityChange <span>=</span> report <span>=></span> <span>{</span>
  Console<span>.</span><span>WriteLine</span><span>(</span>report<span>)</span><span>;</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><p>å‚æ•° report æ˜¯ä¸€ä¸ª List é›†åˆï¼Œé›†åˆå…ƒç´ çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div><pre><code><span>public</span> <span>class</span> <span>ChangeInfo</span> <span>{</span>
  <span>public</span> <span><span>object</span></span> Object <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>EntityChangeType</span> Type <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// Type = Update çš„æ—¶å€™ï¼Œè·å–æ›´æ–°ä¹‹å‰çš„å¯¹è±¡</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span>public</span> <span><span>object</span></span> BeforeObject <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>enum</span> <span>EntityChangeType</span> <span>{</span> Insert<span>,</span> Update<span>,</span> Delete<span>,</span> SqlRaw <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><table>
<thead>
<tr>
<th>å˜åŒ–ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Insert</td>
<td>å®ä½“å¯¹è±¡è¢«æ’å…¥</td>
</tr>
<tr>
<td>Update</td>
<td>å®ä½“å¯¹è±¡è¢«æ›´æ–°</td>
</tr>
<tr>
<td>Delete</td>
<td>å®ä½“å¯¹è±¡è¢«åˆ é™¤</td>
</tr>
<tr>
<td>SqlRaw</td>
<td>æ‰§è¡Œäº† SQL è¯­å¥</td>
</tr>
</tbody>
</table>
<p>SqlRaw ç›®å‰æœ‰ä¸¤å¤„åœ°æ–¹æ¯”è¾ƒç‰¹æ®Šï¼š</p>
<ul>
<li>å¤šå¯¹å¤šè”çº§æ›´æ–°å¯¼èˆªå±æ€§çš„æ—¶å€™ï¼Œå¯¹ä¸­é—´è¡¨çš„å…¨éƒ¨åˆ é™¤æ“ä½œï¼›</li>
<li>é€šç”¨ä»“å‚¨ç±» BaseRepository æœ‰ä¸€ä¸ª Delete æ–¹æ³•ï¼Œå‚æ•°ä¸ºè¡¨è¾¾å¼ï¼Œè€Œå¹¶éå®ä½“ï¼›</li>
</ul>
<div><pre><code><span><span>int</span></span> <span>Delete</span><span>(</span><span>Expression<span>&lt;</span>Func<span>&lt;</span>TEntity<span>,</span> <span>bool</span><span>></span><span>></span></span> predicate<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>DbContext.SaveChangesï¼Œæˆ–è€… Repository å¯¹å®ä½“çš„ Insert/Update/Deleteï¼Œæˆ–è€… UnitOfWork.Commit æ“ä½œéƒ½ä¼šæœ€å¤šè§¦å‘ä¸€æ¬¡è¯¥äº‹ä»¶ã€‚</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">DB First</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/db-first.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/db-first.html"/>
    <updated>2022-05-17T06:09:12.000Z</updated>
    <content type="html"><![CDATA[<h1 id="db-first" tabindex="-1"> DB First</h1>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span>
     <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=10"</span>
     <span>)</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="è·å–æ‰€æœ‰æ•°æ®åº“" tabindex="-1"> è·å–æ‰€æœ‰æ•°æ®åº“</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> fsql<span>.</span>DbFirst<span>.</span><span>GetDatabases</span><span>(</span><span>)</span><span>;</span>
<span>//è¿”å›å­—ç¬¦ä¸²æ•°ç»„, ["cccddd", "test"]</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h2 id="è·å–æŒ‡å®šæ•°æ®åº“çš„è¡¨ä¿¡æ¯" tabindex="-1"> è·å–æŒ‡å®šæ•°æ®åº“çš„è¡¨ä¿¡æ¯</h2>
<div><pre><code><span><span>var</span></span> t2 <span>=</span> fsql<span>.</span>DbFirst<span>.</span><span>GetTablesByDatabase</span><span>(</span>fsql<span>.</span>DbFirst<span>.</span><span>GetDatabases</span><span>(</span><span>)</span><span>[</span><span>0</span><span>]</span><span>)</span><span>;</span>
<span>//è¿”å›åŒ…æ‹¬è¡¨ã€åˆ—è¯¦æƒ…ã€ä¸»é”®ã€å”¯ä¸€é”®ã€ç´¢å¼•ã€å¤–é”®ã€å¤‡æ³¨ç­‰ç­‰</span>

<span><span>var</span></span> t3 <span>=</span> fsql<span>.</span>DbFirst<span>.</span><span>GetTableByName</span><span>(</span><span>"table1"</span><span>)</span><span>;</span>
<span>//è¿”å›è¡¨çš„åˆ—è¯¦æƒ…ã€ä¸»é”®ã€å”¯ä¸€é”®ã€ç´¢å¼•ã€å¤‡æ³¨ç­‰ç­‰</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="net-core-cli-æ¨èä½¿ç”¨" tabindex="-1"> .NET Core CLI(æ¨èä½¿ç”¨)</h2>
<p>ä»£ç ç”Ÿæˆå™¨<code>FreeSql.Generator</code>,æ˜¯ FreeSql çš„ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ç”Ÿæˆå®ä½“ç±»ï¼Œæ”¯æŒå°†æ•°æ®åº“å®ä½“åŠ¨æ€ç”Ÿæˆå®ä½“ï¼Œé»˜è®¤æœ‰äºŒä¸ªæ¨¡æ¿ï¼ŒåŸºäº Razorï¼Œå¯æŒ‡å®šè‡ªå®šä¹‰æ¨¡æ¿</p>
<ul>
<li><code>dotnet-tool</code>å®‰è£… <code>FreeSql.Generator</code></li>
</ul>
<div><pre><code>dotnet tool <span>install</span> -g FreeSql.Generator
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><ul>
<li>æ›´æ–°<code>FreeSql.Generator</code></li>
</ul>
<div><pre><code>dotnet tool update -g FreeSql.Generator
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ–°å»ºç›®å½•ï¼Œåœ¨åœ°å€æ è¾“å…¥ cmd å¿«é€Ÿæ‰“å¼€å‘½ä»¤çª—å£ï¼Œè¾“å…¥å‘½ä»¤ï¼š</p>
<div><pre><code>FreeSql.Generator --help
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å‘½ä»¤è¡Œå·¥å…·ç”Ÿæˆå®ä½“ç±»æå¤§å¥½å¤„ï¼Œåç»­å†æ¬¡ç”Ÿæˆè¦†ç›–æ“ä½œç­‰äºä¸€é”®å®Œæˆï¼Œå¹¶ä¸”æ”¯æŒ Mac/Linux å¹³å°ã€‚</p>
<p><a href="https://www.cnblogs.com/igeekfan/p/freesql-generator.html" target="_blank" rel="noopener noreferrer">è¯¦ç»†è§£è¯»ï¼šç”Ÿæˆå™¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></p>
<div><pre><code>C:\WINDOWS\system32>FreeSql.Generator --help
        ____                   ____         __
       / __/  ____ ___  ___   / __/ ___ _  / /
      / _/   / __// -_)/ -_) _\ \  / _ `/ / /
     /_/    /_/   \__/ \__/ /___/  \_, / /_/
                                    /_/


  # Github # https://github.com/2881099/FreeSql v2.0.105

    FreeSql å¿«é€Ÿç”Ÿæˆæ•°æ®åº“çš„å®ä½“ç±»

    æ›´æ–°å·¥å…·ï¼šdotnet tool update -g FreeSql.Generator


  # å¿«é€Ÿå¼€å§‹ #

  > FreeSql.Generator -Razor 1 -NameOptions 0,0,0,0 -NameSpace MyProject -DB "MySql,Data Source=127.0.0.1;..."

     -Razor 1                  * é€‰æ‹©æ¨¡æ¿ï¼šå®ä½“ç±»+ç‰¹æ€§
     -Razor 2                  * é€‰æ‹©æ¨¡æ¿ï¼šå®ä½“ç±»+ç‰¹æ€§+å¯¼èˆªå±æ€§
     -Razor "d:\diy.cshtml"    * è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶

     -NameOptions              * 4ä¸ªå¸ƒå°”å€¼å¯¹åº”ï¼š
                                 é¦–å­—æ¯å¤§å†™
                                 é¦–å­—æ¯å¤§å†™,å…¶ä»–å°å†™
                                 å…¨éƒ¨å°å†™
                                 ä¸‹åˆ’çº¿è½¬é©¼å³°

     -NameSpace                * å‘½åç©ºé—´

     -DB "MySql,data source=127.0.0.1;port=3306;user id=root;password=root;initial catalog=æ•°æ®åº“;charset=utf8;sslmode=none;max pool size=2"
     -DB "SqlServer,data source=.;integrated security=True;initial catalog=æ•°æ®åº“;pooling=true;max pool size=2"
     -DB "PostgreSQL,host=192.168.164.10;port=5432;username=postgres;password=123456;database=æ•°æ®åº“;pooling=true;maximum pool size=2"
     -DB "Oracle,user id=user1;password=123456;data source=//127.0.0.1:1521/XE;pooling=true;max pool size=2"
     -DB "Sqlite,data source=document.db"
     -DB "Firebird,database=localhost:D:\fbdata\EXAMPLES.fdb;user=sysdba;password=123456;max pool size=2"
     -DB "Dameng,server=127.0.0.1;port=5236;user id=2user;password=123456789;database=2user;poolsize=2"
     -DB "KingbaseES,server=127.0.0.1;port=54321;uid=USER2;pwd=123456789;database=æ•°æ®åº“"
     -DB "ShenTong,host=192.168.164.10;port=2003;database=æ•°æ®åº“;username=SYSDBA;password=szoscar55;maxpoolsize=2"
                               * Dameng(è¾¾æ¢¦æ•°æ®åº“)ã€KingbaseES(äººå¤§é‡‘ä»“æ•°æ®åº“)ã€ShenTong(ç¥èˆŸé€šç”¨æ•°æ®åº“)

     -Filter                   Table+View+StoreProcedure
                               é»˜è®¤ç”Ÿæˆï¼šè¡¨+è§†å›¾+å­˜å‚¨è¿‡ç¨‹
                               å¦‚æœä¸æƒ³ç”Ÿæˆè§†å›¾å’Œå­˜å‚¨è¿‡ç¨‹ -Filter View+StoreProcedure

     -Match                    è¡¨åæˆ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªç”ŸæˆåŒ¹é…çš„è¡¨ï¼Œå¦‚ï¼šdbo\.TB_.+

     -FileName                 æ–‡ä»¶åï¼Œé»˜è®¤ï¼š{name}.cs
     -Output                   ä¿å­˜è·¯å¾„ï¼Œé»˜è®¤ä¸ºå½“å‰ shell æ‰€åœ¨ç›®å½•
                               æ¨èåœ¨å®ä½“ç±»ç›®å½•åˆ›å»º gen.batï¼ŒåŒå‡»å®ƒé‡æ–°æ‰€æœ‰å®ä½“ç±»
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br></div></div><h3 id="å¸¸ç”¨é€‰é¡¹" tabindex="-1"> å¸¸ç”¨é€‰é¡¹</h3>
<table>
<thead>
<tr>
<th style="text-align:left">é€‰é¡¹</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-Razor</td>
<td style="text-align:left">é€‰æ‹©æ¨¡æ¿ï¼š<code>å®ä½“ç±»+ç‰¹æ€§</code> <code>-Razor 1</code> /<code>å®ä½“ç±»+ç‰¹æ€§+å¯¼èˆªå±æ€§</code> <code>-Razor 1</code>/<code>è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶</code> <code>-Razor &quot;d:\diy.cshtml&quot;</code></td>
</tr>
<tr>
<td style="text-align:left">-NameOptions</td>
<td style="text-align:left">ç”Ÿæˆçš„å®ä½“å‘½åè§„èŒƒï¼Œåº”åªè®¾ç½®æŸä¸€ä¸ªä¸ºå‚æ•°ä¸º 1ï¼Œå…¶ä¸­ 4 ä¸ªå¸ƒå°”å€¼å¯¹åº”ï¼š<code>é¦–å­—æ¯å¤§å†™</code>/<code>é¦–å­—æ¯å¤§å†™,å…¶ä»–å°å†™</code>/<code>å…¨éƒ¨å°å†™</code>/<code>ä¸‹åˆ’çº¿è½¬é©¼</code>ï¼ˆ-NameOptions 0,0,0,1ï¼‰</td>
</tr>
<tr>
<td style="text-align:left">-NameSpace</td>
<td style="text-align:left">å‘½åç©ºé—´</td>
</tr>
<tr>
<td style="text-align:left">-DB</td>
<td style="text-align:left">çœ‹ä¸‹æ–‡ä¸­çš„-DB å‚æ•°</td>
</tr>
<tr>
<td style="text-align:left">-Filter</td>
<td style="text-align:left">Table+View+StoreProcedureï¼ˆ é»˜è®¤ç”Ÿæˆï¼šè¡¨+è§†å›¾+å­˜å‚¨è¿‡ç¨‹ï¼‰ï¼Œ å¦‚æœä¸æƒ³ç”Ÿæˆè§†å›¾å’Œå­˜å‚¨è¿‡ç¨‹ -Filter View+StoreProcedure</td>
</tr>
<tr>
<td style="text-align:left">-Match</td>
<td style="text-align:left">è¡¨åæˆ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªç”ŸæˆåŒ¹é…çš„è¡¨ï¼Œå¦‚ï¼šdbo.TB_.+</td>
</tr>
<tr>
<td style="text-align:left">-FileName</td>
<td style="text-align:left">æ–‡ä»¶åï¼Œé»˜è®¤ï¼š{name}.cs</td>
</tr>
<tr>
<td style="text-align:left">-Output</td>
<td style="text-align:left">æ¨èåœ¨å®ä½“ç±»ç›®å½•åˆ›å»º gen.batï¼ŒåŒå‡»å®ƒé‡æ–°æ‰€æœ‰å®ä½“ç±»</td>
</tr>
</tbody>
</table>
<h3 id="db-å‚æ•°" tabindex="-1"> -DB å‚æ•°</h3>
<div><pre><code>-DB "MySql,data source=127.0.0.1;port=3306;user id=root;password=root;initial catalog=æ•°æ®åº“;charset=utf8;sslmode=none;max pool size=2"
-DB "SqlServer,data source=.;integrated security=True;initial catalog=æ•°æ®åº“;pooling=true;max pool size=2"
-DB "PostgreSQL,host=192.168.164.10;port=5432;username=postgres;password=123456;database=æ•°æ®åº“;pooling=true;maximum pool size=2"
-DB "Oracle,user id=user1;password=123456;data source=//127.0.0.1:1521/XE;pooling=true;max pool size=2"
-DB "Sqlite,data source=document.db"
-DB "Firebird,database=localhost:D:\fbdata\EXAMPLES.fdb;user=sysdba;password=123456;max pool size=2"
-DB "Dameng,server=127.0.0.1;port=5236;user id=2user;password=123456789;database=2user;poolsize=2"
-DB "KingbaseES,server=127.0.0.1;port=54321;uid=USER2;pwd=123456789;database=æ•°æ®åº“"
-DB "ShenTong,host=192.168.164.10;port=2003;database=æ•°æ®åº“;username=SYSDBA;password=szoscar55;maxpoolsize=2"
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h3 id="ç¤ºä¾‹" tabindex="-1"> ç¤ºä¾‹</h3>
<blockquote>
<p>FreeSql.Generator -Razor 1 -NameOptions 0,0,0,1 -NameSpace LinCms.Core.Entities -DB &quot;MySql,Data Source=127.0.0.1;Port=3306;User ID=root;Password=123456;Initial Catalog=lincms;Charset=utf8;SslMode=none;Max pool size=2&quot;</p>
</blockquote>
<ul>
<li>æ•°æ®åº“è¡¨åæ˜¯ä¸‹åˆ’çº¿ï¼Œå­—æ®µä¹Ÿæ˜¯ä¸‹åˆ’çº¿æ–¹å¼ã€‚</li>
<li>-Razor æŒ‡å®š ç¬¬ä¸€ä¸ªæ¨¡æ¿</li>
<li>-NameOptions 0,0,0,1 æœ€åä¸€ä¸ª 1ï¼Œä»£è¡¨ ä¸‹åˆ’çº¿è½¬é©¼å³°ï¼Œæ»¡è¶³ C#å‘½åè§„åˆ™</li>
<li>-NameSpace æŒ‡å®šäº†å‘½åç©ºé—´ LinCms.Core.Entities</li>
<li>-DB å°±æ˜¯æ•°æ®åº“çš„ç›¸å…³é…ç½®</li>
<li>mysql æœ¬åœ°åœ°å€ 127.0.0.1 3306 ç«¯å£ ç”¨æˆ·å root å¯†ç  123456 æ•°æ®åº“ lin-cms</li>
<li>-Match book è¿™æ ·å°±èƒ½åªç”Ÿæˆ bookï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚ -Math lin<em>user å°±ä¼šç”Ÿæˆä»¥ lin_user å¼€å¤´çš„è¡¨ã€‚å¦‚ dbo.TB</em>.+ï¼Œä¼šç”Ÿæˆä»¥ TB å¼€å¤´çš„è¡¨ã€‚å³åªç”ŸæˆåŒ¹é…çš„è¡¨</li>
</ul>
<h2 id="å®‰è£…-winform-ç”Ÿæˆå™¨-å·²åœæ­¢æ›´æ–°" tabindex="-1"> å®‰è£… Winform ç”Ÿæˆå™¨ï¼ˆå·²åœæ­¢æ›´æ–°ï¼‰</h2>
<p>æºç åœ°å€ï¼š<a href="https://github.com/2881099/FreeSql.Tools" target="_blank" rel="noopener noreferrer">FreeSql.Tools</a></p>
<blockquote>
<p>ä½œè€…ï¼š<a href="https://github.com/mypeng1985" target="_blank" rel="noopener noreferrer">mypeng1985</a> å¼€å‘äº†ä¸¤ä¸ªç‰ˆæœ¬</p>
</blockquote>
<p><img src="https://user-images.githubusercontent.com/16286519/76141354-4790e980-609e-11ea-869b-bb2c6980d98f.png" alt="image" loading="lazy"></p>
<p><img src="https://user-images.githubusercontent.com/16286519/58793525-e0cf3300-8628-11e9-8959-d2efed685843.png" alt="image" loading="lazy"></p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">åˆ é™¤</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/delete.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/delete.html"/>
    <updated>2022-06-07T13:45:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åˆ é™¤" tabindex="-1"> åˆ é™¤</h1>
<p>åˆ é™¤æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„æ“ä½œï¼ŒFreeSql å¯¹åˆ é™¤æ”¯æŒå¹¶ä¸å¼ºå¤§ï¼Œé»˜è®¤ä»…æ”¯æŒå•è¡¨ã€ä¸”æœ‰æ¡ä»¶çš„åˆ é™¤æ–¹æ³•ã€‚</p>
<p>è‹¥ <code>Where</code> æ¡ä»¶ä¸ºç©ºçš„æ—¶å€™æ‰§è¡Œï¼Œä»…è¿”å› <code>0</code> æˆ–é»˜è®¤å€¼ï¼Œä¸æ‰§è¡ŒçœŸæ­£çš„ SQL åˆ é™¤æ“ä½œã€‚</p>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><h2 id="åŠ¨æ€æ¡ä»¶" tabindex="-1"> åŠ¨æ€æ¡ä»¶</h2>
<div><pre><code>fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span><span>object</span></span> dywhere<span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p><code>dywhere</code> æ”¯æŒï¼š</p>
<ul>
<li>ä¸»é”®å€¼</li>
<li><code>new[] { ä¸»é”®å€¼1, ä¸»é”®å€¼2 }</code></li>
<li>Topic å¯¹è±¡</li>
<li><code>new[] { Topicå¯¹è±¡1, Topicå¯¹è±¡2 }</code></li>
<li><code>new { id = 1 }</code></li>
</ul>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span> <span>1</span><span>,</span> <span>2</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1 OR `Id` = 2)</span>

<span><span>var</span></span> t2 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span><span>,</span> Title <span>=</span> <span>"test"</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1)</span>

<span><span>var</span></span> t3 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span><span>,</span> Title <span>=</span> <span>"test"</span> <span>}</span><span>,</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>2</span><span>,</span> Title <span>=</span> <span>"test"</span> <span>}</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1 OR `Id` = 2)</span>

<span><span>var</span></span> t4 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>new</span> <span>{</span> id <span>=</span> <span>1</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="åˆ é™¤æ¡ä»¶" tabindex="-1"> åˆ é™¤æ¡ä»¶</h2>
<blockquote>
<p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ²¡æœ‰æ¡ä»¶ä¸æ‰§è¡Œåˆ é™¤åŠ¨ä½œï¼Œé¿å…è¯¯åˆ é™¤å…¨è¡¨æ•°æ®ã€‚åˆ é™¤å…¨è¡¨æ•°æ®ï¼š<code>fsql.Delete&lt;T&gt;().Where(&quot;1=1&quot;).ExecuteAffrows()</code></p>
</blockquote>
<div><pre><code><span><span>var</span></span> t5 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1)</span>

<span><span>var</span></span> t6 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>"id = @id"</span><span>,</span> <span>new</span> <span>{</span> id <span>=</span> <span>1</span> <span>}</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (id = @id)</span>

<span><span>var</span></span> item <span>=</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span><span>,</span> Title <span>=</span> <span>"newtitle"</span> <span>}</span><span>;</span>
<span><span>var</span></span> t7 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>item<span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` = 1)</span>

<span><span>var</span></span> items <span>=</span> <span>new</span> <span>List<span>&lt;</span>Topic<span>></span></span><span>(</span><span>)</span><span>;</span>
<span>for</span> <span>(</span><span><span>var</span></span> a <span>=</span> <span>0</span><span>;</span> a <span>&lt;</span> <span>10</span><span>;</span> a<span>++</span><span>)</span> items<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> a <span>+</span> <span>1</span><span>,</span> Title <span>=</span> <span><span>$"newtitle</span><span><span>{</span><span>a</span><span>}</span></span><span>"</span></span><span>,</span> Clicks <span>=</span> a <span>*</span> <span>100</span> <span>}</span><span>)</span><span>;</span>
<span><span>var</span></span> t8 <span>=</span> fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>items<span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//DELETE FROM `Topic` WHERE (`Id` IN (1,2,3,4,5,6,7,8,9,10))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><h2 id="å­—å…¸åˆ é™¤" tabindex="-1"> å­—å…¸åˆ é™¤</h2>
<div><pre><code><span><span>var</span></span> dic <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"id"</span><span>,</span> <span>1</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"name"</span><span>,</span> <span>"xxxx"</span><span>)</span><span>;</span>

fsql<span>.</span><span>DeleteDict</span><span>(</span>dic<span>)</span><span>.</span><span>AsTable</span><span>(</span><span>"table1"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="iselect-todelete-é«˜çº§åˆ é™¤" tabindex="-1"> ISelect.ToDelete é«˜çº§åˆ é™¤</h2>
<p><code>IDelete</code> é»˜è®¤ä¸æ”¯æŒå¯¼èˆªå¯¹è±¡ï¼Œå¤šè¡¨å…³è”ç­‰ã€‚<code>ISelect.ToDelete</code> å¯å°†æŸ¥è¯¢è½¬ä¸º <code>IDelete</code>ï¼Œä»¥ä¾¿ä½¿ç”¨å¯¼èˆªå¯¹è±¡åˆ é™¤æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T1<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Options<span>.</span>xxx <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToDelete</span><span>(</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¸æ˜¯å°†æ•°æ®æŸ¥è¯¢åˆ°å†…å­˜å¾ªç¯åˆ é™¤ï¼Œä¸Šé¢çš„ä»£ç äº§ç”Ÿå¦‚ä¸‹ SQL æ‰§è¡Œï¼š</p>
<div><pre><code><span>DELETE</span> <span>FROM</span> <span><span>`</span>T1<span>`</span></span> <span>WHERE</span> id <span>in</span> <span>(</span><span>select</span> a<span>.</span>id <span>from</span> T1 a <span>left</span> <span>join</span> Options b <span>on</span> b<span>.</span>t1id <span>=</span> a<span>.</span>id <span>where</span> b<span>.</span>xxx <span>=</span> <span>1</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å¤æ‚åˆ é™¤ä½¿ç”¨æ­¤æ–¹æ³•çš„å¥½å¤„ï¼š</p>
<ul>
<li>åˆ é™¤å‰å¯é¢„è§ˆæµ‹è¯•æ•°æ®ï¼Œé˜²æ­¢é”™è¯¯åˆ é™¤æ“ä½œï¼›</li>
<li>æ”¯æŒå¤æ‚çš„åˆ é™¤æ“ä½œï¼Œä¾‹å¦‚ï¼š<code>ISelect</code> ä¸Šä½¿ç”¨ <code>Limit(10)</code> åˆ é™¤é™„åˆæ¡ä»¶çš„å‰ 10 æ¡è®°å½•ï¼›</li>
</ul>
<h2 id="ibaserepository-çº§è”åˆ é™¤" tabindex="-1"> IBaseRepository çº§è”åˆ é™¤</h2>
<p>1ã€ç¬¬ä¸€ç§ï¼šåŸºäºã€å¯¹è±¡ã€‘çº§è”åˆ é™¤</p>
<blockquote>
<p>æ¯”å¦‚ Include/IncludeMany æŸ¥è¯¢çš„å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•çº§è”åˆ é™¤å®ƒä»¬ã€‚</p>
</blockquote>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Group<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>true</span><span>;</span> <span>//å…³é”®è®¾ç½®</span>
repo<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>UserGroup</span>
<span>{</span>
    GroupName <span>=</span> <span>"group01"</span><span>,</span>
    Users <span>=</span> <span>new</span> <span>List<span>&lt;</span>User<span>></span></span>
    <span>{</span>
        <span>new</span> <span>User</span> <span>{</span> Username <span>=</span> <span>"admin01"</span><span>,</span> Password <span>=</span> <span>"pwd01"</span><span>,</span> UserExt <span>=</span> <span>new</span> <span>UserExt</span> <span>{</span> Remark <span>=</span> <span>"ç”¨æˆ·å¤‡æ³¨01"</span> <span>}</span> <span>}</span><span>,</span>
        <span>new</span> <span>User</span> <span>{</span> Username <span>=</span> <span>"admin02"</span><span>,</span> Password <span>=</span> <span>"pwd02"</span><span>,</span> UserExt <span>=</span> <span>new</span> <span>UserExt</span> <span>{</span> Remark <span>=</span> <span>"ç”¨æˆ·å¤‡æ³¨02"</span> <span>}</span> <span>}</span><span>,</span>
        <span>new</span> <span>User</span> <span>{</span> Username <span>=</span> <span>"admin03"</span><span>,</span> Password <span>=</span> <span>"pwd03"</span><span>,</span> UserExt <span>=</span> <span>new</span> <span>UserExt</span> <span>{</span> Remark <span>=</span> <span>"ç”¨æˆ·å¤‡æ³¨03"</span> <span>}</span> <span>}</span><span>,</span>
    <span>}</span>
<span>}</span><span>)</span><span>;</span> <span>//çº§è”æ·»åŠ æµ‹è¯•æ•°æ®</span>
<span>//INSERT INTO "usergroup"("groupname") VALUES('group01') RETURNING "id"</span>
<span>//INSERT INTO "user"("username", "password", "groupid") VALUES('admin01', 'pwd01', 1), ('admin02', 'pwd02', 1), ('admin03', 'pwd03', 1) RETURNING "id" as "Id", "username" as "Username", "password" as "Password", "groupid" as "GroupId"</span>
<span>//INSERT INTO "userext"("userid", "remark") VALUES(3, 'ç”¨æˆ·å¤‡æ³¨01'), (4, 'ç”¨æˆ·å¤‡æ³¨02'), (5, 'ç”¨æˆ·å¤‡æ³¨03')</span>

<span><span>var</span></span> groups <span>=</span> repo<span>.</span>Select
    <span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Users<span>,</span>
        then <span>=></span> then<span>.</span><span>Include</span><span>(</span>b <span>=></span> b<span>.</span>UserExt<span>)</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
repo<span>.</span><span>Delete</span><span>(</span>groups<span>)</span><span>;</span> <span>//çº§è”åˆ é™¤ï¼Œé€’å½’å‘ä¸‹éå† group OneToOne/OneToMany/ManyToMany å¯¼èˆªå±æ€§</span>
<span>//DELETE FROM "userext" WHERE ("userid" IN (3,4,5))</span>
<span>//DELETE FROM "user" WHERE ("id" IN (3,4,5))</span>
<span>//DELETE FROM "usergroup" WHERE ("id" = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br></div></div><p>2ã€ç¬¬äºŒç§ï¼šåŸºäºã€æ•°æ®åº“ã€‘çº§è”åˆ é™¤</p>
<blockquote>
<p>æ ¹æ®è®¾ç½®çš„å¯¼èˆªå±æ€§ï¼Œé€’å½’åˆ é™¤ OneToOne/OneToMany/ManyToMany å¯¹åº”æ•°æ®ï¼Œå¹¶è¿”å›å·²åˆ é™¤çš„æ•°æ®ã€‚æ­¤åŠŸèƒ½ä¸ä¾èµ–æ•°æ®åº“å¤–é”®</p>
</blockquote>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Group<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> ret <span>=</span> repo<span>.</span><span>DeleteCascadeByDatabase</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>;</span>
<span>//SELECT a."id", a."username", a."password", a."groupid" FROM "user" a WHERE (a."groupid" = 1)</span>
<span>//SELECT a."userid", a."remark" FROM "userext" a WHERE (a."userid" IN (3,4,5))</span>
<span>//DELETE FROM "userext" WHERE ("userid" IN (3,4,5))</span>
<span>//DELETE FROM "user" WHERE ("id" IN (3,4,5))</span>
<span>//DELETE FROM "usergroup" WHERE ("id" = 1)</span>

<span>//ret   Count = 7	System.Collections.Generic.List&lt;object></span>
<span>//  [0]	{UserExt}	object {UserExt}</span>
<span>//  [1]	{UserExt}	object {UserExt}</span>
<span>//  [2]	{UserExt}	object {UserExt}</span>
<span>//  [3]	{User}	    object {User}</span>
<span>//  [4]	{User}	    object {User}</span>
<span>//  [5]	{User}  	object {User}</span>
<span>//  [6]	{UserGroup}	object {UserGroup}</span>

<span>public</span> <span>class</span> <span>Group</span>
<span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> GroupName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>User<span>.</span>GroupId<span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>List<span>&lt;</span>User<span>></span></span> Users <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>User</span>
<span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Username <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Password <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> GroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>Id<span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>UserExt</span> UserExt <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>UserExt</span>
<span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> UserId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Remark <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>UserId<span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>User</span> User <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br></div></div><h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>è¡¨è¾¾å¼æ¡ä»¶ï¼Œä»…æ”¯æŒå®ä½“åŸºç¡€æˆå‘˜ï¼ˆä¸åŒ…å«å¯¼èˆªå¯¹è±¡ï¼‰</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>åŸç”Ÿ sql è¯­æ³•æ¡ä»¶ï¼ŒWhere(&quot;id = @id&quot;, new { id = 1 })</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>ä¼ å…¥å®ä½“æˆ–é›†åˆï¼Œå°†å…¶ä¸»é”®ä½œä¸ºæ¡ä»¶</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>å‘½ä»¤è¶…æ—¶è®¾ç½®(ç§’)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>è®¾ç½®äº‹åŠ¡å¯¹è±¡</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>è®¾ç½®è¿æ¥å¯¹è±¡</td>
</tr>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>long</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
</tr>
<tr>
<td>ExecuteDeleted</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›è¢«åˆ é™¤çš„è®°å½•</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">å®ä½“ç‰¹æ€§âœ¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/entity-attribute.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/entity-attribute.html"/>
    <updated>2022-06-01T06:25:44.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å®ä½“ç‰¹æ€§âœ¨" tabindex="-1"> å®ä½“ç‰¹æ€§âœ¨</h1>
<p>v1.4.0+ å·²è‡ªåŠ¨è¯†åˆ« EFCore å®ä½“ç‰¹æ€§ Key/Required/NotMapped/MaxLength/StringLength/DatabaseGenerated/Table/Column</p>
<h2 id="åç§°" tabindex="-1"> åç§°</h2>
<div><pre><code><span>[</span><span><span>Table</span><span><span>(</span>Name <span>=</span> <span>"tb_topic"</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>Topic</span> <span>{</span> <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>æ¶æ„ï¼š[Table(Name = &quot;dbo.tb_topic&quot;)]</p>
<p>æ³¨æ„ï¼šå¸¦ç‚¹çš„è¡¨åï¼Œä½¿ç”¨ [Table(Name = &quot;`sys.config`&quot;)] è§£å†³</p>
<blockquote>
<p>æŒ‡å®šè¡¨åçš„å‡ ç§æ–¹æ³•ï¼Œä¼˜å…ˆçº§ä»å°åˆ°å¤§ï¼š</p>
</blockquote>
<ul>
<li>1ã€å®ä½“ç±»å</li>
<li>2ã€Aop fsql.Aop.ConfigEntity += (_, e) =&gt; e.ModifyResult.Name = &quot;public.tabname&quot;</li>
<li>3ã€FluentApi fsql.CodeFirst.ConfigEntity(a =&gt; a.Name(&quot;public.tabname&quot;))</li>
<li>4ã€[Table(Name = &quot;public.tabname&quot;)]</li>
<li>5ã€AsTable fsql.Select&lt;T&gt;().AsTable((_, old) =&gt; &quot;public.tabname&quot;).ToList()</li>
</ul>
<blockquote>
<p>v3.2.660 å¯é€šè¿‡ UseMappingPriority è°ƒæ•´ä¼˜å…ˆçº§</p>
</blockquote>
<p>æ”¹åï¼šé¡»æŒ‡å®šæ—§çš„è¡¨åï¼š[Table(OldName = &quot;Topic&quot;)]</p>
<blockquote>
<p>å±æ€§åç§°ï¼š[Column(Name = &quot;xxx&quot;)]</p>
</blockquote>
<h2 id="ä¸»é”®-primary-key" tabindex="-1"> ä¸»é”®(Primary Key)</h2>
<div><pre><code><span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>çº¦å®šï¼š</p>
<ul>
<li>
<p>å½“æ²¡æœ‰æŒ‡æ˜ä¸»é”®æ—¶ï¼Œå‘½åä¸º id çš„å­—æ®µå°†æˆä¸ºä¸»é”®ï¼›ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰</p>
</li>
<li>
<p>å½“ä¸»é”®æ˜¯ Guid ç±»å‹æ—¶ï¼Œæ’å…¥æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼ˆæœ‰åºã€ä¸é‡å¤ï¼‰çš„å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦è‡ªå·±èµ‹å€¼ï¼›ï¼ˆæ”¯æŒåˆ†å¸ƒå¼ï¼‰</p>
</li>
</ul>
<h2 id="è‡ªå¢-identity" tabindex="-1"> è‡ªå¢(Identity)</h2>
<div><pre><code><span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>çº¦å®šï¼š</p>
<ul>
<li>å½“æ²¡æœ‰æŒ‡æ˜ä¸»é”®æ—¶ï¼Œæ ‡è®°è‡ªå¢çš„æˆå‘˜å°†æˆä¸ºä¸»é”®ï¼›</li>
</ul>
<h2 id="å”¯ä¸€é”®-unique-key-ã€ç´¢å¼•-index" tabindex="-1"> å”¯ä¸€é”®(Unique Key)ã€ç´¢å¼•ï¼ˆIndexï¼‰</h2>
<div><pre><code><span>[</span><span><span>Index</span><span><span>(</span><span>"uk_phone"</span><span>,</span> <span>"phone"</span><span>,</span> <span>true</span><span>)</span></span></span><span>]</span>
<span>[</span><span><span>Index</span><span><span>(</span><span>"uk_group_index"</span><span>,</span> <span>"group,index"</span><span>,</span> <span>true</span><span>)</span></span></span><span>]</span>
<span>[</span><span><span>Index</span><span><span>(</span><span>"uk_group_index22"</span><span>,</span> <span>"group, index22 desc"</span><span>,</span> <span>true</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>AddUniquesInfo</span> <span>{</span>
    <span>public</span> <span>Guid</span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> phone <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>string</span></span> <span>group</span> <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> index <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> index22 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><blockquote>
<p>ç¬¬ä¸‰ä¸ªå‚æ•° true çš„æ—¶å€™æ˜¯å”¯ä¸€é”®ï¼Œfalse çš„æ—¶å€™æ˜¯æ™®é€šç´¢å¼•ã€‚</p>
</blockquote>
<blockquote>
<p>åˆ†è¡¨åœºæ™¯çš„ç´¢å¼•å¯ä»¥è¿™æ ·ï¼š[Index(&quot;{tablename}_idx_01&quot;, &quot;phone&quot;)]</p>
</blockquote>
<h2 id="æ•°æ®åº“ç±»å‹-dbtype" tabindex="-1"> æ•°æ®åº“ç±»å‹(DbType)</h2>
<div><pre><code><span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(128) NOT NULL"</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å¯ä»¥åœ¨ç±»å‹ä¸ŠæŒ‡å®š NOT NULLï¼Œä¹Ÿå¯ä»¥é€šè¿‡ [Column(IsNullable = false)] è®¾ç½®ï¼›</p>
<blockquote>
<p>decimal æŒ‡å®šé•¿åº¦ [Column(DbType = &quot;decimal(10,2)&quot;)] æˆ–è€… [Column(Precision = 10, Scale = 2)]</p>
</blockquote>
<blockquote>
<p>string æŒ‡å®šé•¿åº¦ [Column(DbType = &quot;varchar(128)&quot;)] æˆ–è€… [MaxLength(128)] æˆ–è€… [Column(StringLength = 128)]ï¼Œå½“é•¿åº¦ -1 æ—¶äº§ç”Ÿçš„æ˜ å°„å¦‚ä¸‹ï¼š</p>
</blockquote>
<h2 id="textç±»å‹-column-stringlength-1" tabindex="-1"> Textç±»å‹ [Column(StringLength =-1)]</h2>
<p>å½“é•¿åº¦ -1 æ—¶äº§ç”Ÿçš„æ˜ å°„å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>MySql</th>
<th>PostgreSQL</th>
<th>SqlServer</th>
<th>Oracle</th>
<th>Sqlite</th>
<th>Firebird</th>
<th>MsAccess</th>
<th>è¾¾æ¢¦</th>
<th>é‡‘ä»“</th>
<th>ç¥é€š</th>
<th>å—é€š</th>
</tr>
</thead>
<tbody>
<tr>
<td>text</td>
<td>text</td>
<td>nvarchar(max)</td>
<td>nclob</td>
<td>text</td>
<td>blob sub_type 1</td>
<td>longtext</td>
<td>text</td>
<td>text</td>
<td>text</td>
<td>text</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ³¨æ„ï¼šOracle nclob éœ€è¦ v1.3.2+ ç‰ˆæœ¬æ‰æ”¯æŒï¼Œå¦åˆ™å°†æ˜ å°„ nvarchar2(4000)</p>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼šMySql [MaxLength(-2)] æˆ–è€… [Column(StringLength = -2)] æ˜ å°„ç±»å‹ longtextï¼Œå…¶ä»–æ•°æ®åº“çš„æ˜ å°„è§„åˆ™ä¸ -1 ç›¸åŒ</p>
</blockquote>
<h2 id="æœåŠ¡å™¨æ—¶é—´-servertime" tabindex="-1"> æœåŠ¡å™¨æ—¶é—´(ServerTime)</h2>
<div><pre><code><span>class</span> <span>Topic</span> <span>{</span>

    <span>[</span><span><span>Column</span><span><span>(</span>ServerTime <span>=</span> DateTimeKind<span>.</span>Utc<span>,</span> CanUpdate <span>=</span> <span>false</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    
    <span>[</span><span><span>Column</span><span><span>(</span>ServerTime <span>=</span> DateTimeKind<span>.</span>Utc<span>)</span></span></span><span>]</span>
    <span>public</span> <span>DateTime</span> UpdateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>ä½¿ç”¨æ•°æ®åº“æ—¶é—´æ‰§è¡Œæ’å…¥æ•°æ®ï¼Œæ³¨æ„ï¼š</p>
<p>1ã€ä¸€ä½†è®¾ç½®äº†è¿™ä¸ªç‰¹æ€§ï¼Œæ’å…¥çš„æ—¶å€™è®¾ç½®å±æ€§å€¼æ˜¯æ— æ•ˆçš„ï¼›</p>
<p>2ã€æ’å…¥å®ä½“æ‰§è¡ŒæˆåŠŸåï¼Œå®ä½“çš„å€¼è¿˜æ˜¯ c# æ—¶é—´ï¼›</p>
<blockquote>
<p>v1.1.0 - ServerTime ç‰¹æ€§ï¼Œå¯¹ Update æ–¹æ³•æ—¶ä¹Ÿèƒ½ç”Ÿæ•ˆ</p>
</blockquote>
<h2 id="å¯ç©º-nullable" tabindex="-1"> å¯ç©º(Nullable)</h2>
<div><pre><code><span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsNullable <span>=</span> <span>false</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>åœ¨ä¸æŒ‡å®š DbTypeã€IsNullable æ—¶ï¼ŒFreeSql æä¾›é»˜è®¤è®¾å®šï¼Œå¦‚ï¼š</p>
<ul>
<li>int -&gt; not nullï¼ˆä¸å¯ä¸ºç©ºï¼‰</li>
<li>int? -&gt; nullï¼ˆå¯ç©ºï¼‰</li>
</ul>
<p>ä¸€èˆ¬åœ¨ä½¿ç”¨ string ç±»å‹æ—¶ï¼Œæ‰éœ€è¦æ‰‹å·¥æŒ‡æ˜æ˜¯å¦å¯ç©ºï¼ˆstring é»˜è®¤å¯ç©ºï¼‰ï¼›</p>
<h2 id="å¿½ç•¥-ignore" tabindex="-1"> å¿½ç•¥(Ignore)</h2>
<div><pre><code><span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIgnore <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å½“å®ä½“æœ‰å±æ€§ä¸éœ€è¦æ˜ å°„çš„æ—¶å€™ä½¿ç”¨ï¼Œå†…éƒ¨è‡ªåŠ¨å¿½ç•¥äº†å¯¹è±¡çš„æ˜ å°„ï¼›</p>
<p>å½“å®ä½“å†…çš„å±æ€§ä¸æ˜¯å¯æ¥å—çš„ç±»å‹æ—¶ï¼Œå¯ä»¥ä¸ç”¨æŒ‡å®šè¯¥ç‰¹å®šï¼Œå¦‚ä¸‹ä¸å¿…è¦çš„æŒ‡å®šï¼š</p>
<div><pre><code><span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIgnore <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>Topic</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="ä¹è§‚é”-rowversion" tabindex="-1"> ä¹è§‚é”(RowVersion)</h2>
<div><pre><code><span>class</span> <span>Topic</span> <span>{</span>
    <span>public</span> <span>Guid</span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Column</span><span><span>(</span>IsVersion <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Version <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>æ›´æ–°æ•´ä¸ªå®ä½“æ•°æ®æ—¶ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹æå®¹æ˜“é€ æˆæ—§æ•°æ®å°†æ–°çš„è®°å½•æ›´æ–°ã€‚</p>
<p>ä¹è§‚é”çš„åŸç†ï¼Œæ˜¯åˆ©ç”¨å®ä½“æŸå­—æ®µï¼Œå¦‚ï¼šlong versionï¼Œæ›´æ–°å‰å…ˆæŸ¥è¯¢æ•°æ®ï¼Œæ­¤æ—¶ version ä¸º 1ï¼Œæ›´æ–°æ—¶äº§ç”Ÿçš„ SQL ä¼šé™„åŠ  where version = 1ï¼Œå½“ä¿®æ”¹å¤±è´¥æ—¶ï¼ˆå³ Affrows == 0ï¼‰æŠ›å‡ºå¼‚å¸¸ï¼ˆDbUpdateVersionExceptionï¼‰ã€‚</p>
<p>æ¯ä¸ªå®ä½“åªæ”¯æŒä¸€ä¸ªä¹è§‚é”å±æ€§ã€‚</p>
<blockquote>
<p>é€‚ç”¨ SetSource æ›´æ–°ï¼Œæ— è®ºä½¿ç”¨ä»€ä¹ˆæ–¹æ³•æ›´æ–° version çš„å€¼éƒ½ä¼šå¢åŠ  1</p>
</blockquote>
<h2 id="è‡ªå®šä¹‰ç±»å‹æ˜ å°„-maptype" tabindex="-1"> è‡ªå®šä¹‰ç±»å‹æ˜ å°„(MapType)</h2>
<div><pre><code><span>class</span> <span>EnumTestMap</span> <span>{</span>
    <span>public</span> <span>Guid</span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>ToStringMapEnum</span> enum_to_string <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>ToStringMapEnum<span>?</span></span> enumnullable_to_string <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>int</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>ToStringMapEnum</span> enum_to_int <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>int</span><span>?</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>ToStringMapEnum<span>?</span></span> enumnullable_to_int <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>BigInteger</span> biginteger_to_string <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>BigInteger<span>?</span></span> bigintegernullable_to_string <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>enum</span> <span>ToStringMapEnum</span> <span>{</span> ä¸­å›½äºº<span>,</span> abc<span>,</span> é¦™æ¸¯ <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><p>BigInteger ä¹Ÿå¯ä»¥æ˜ å°„ä½¿ç”¨ï¼Œä½†è¯·æ³¨æ„ï¼šä»…ä»…æ˜¯ CURD æ–¹ä¾¿ï¼Œ Equals == åˆ¤æ–­å¯ä»¥ä½¿ç”¨ï¼Œæ— æ³•å®ç° + - * / ç­‰æ“ä½œï¼›</p>
<p>v0.9.15 ç‰ˆæœ¬è¿˜å¯ä»¥å°†å€¼å¯¹è±¡æ˜ å°„æˆ typeof(string)ï¼Œå®‰è£…æ‰©å±•åŒ…ï¼š</p>
<blockquote>
<p>dotnet add package FreeSql.Extensions.JsonMap</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span>UseJsonMap</span><span>(</span><span>)</span><span>;</span> <span>//å¼€å¯åŠŸèƒ½</span>

<span>class</span> <span>TestConfig</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>[</span><span><span>Table</span><span><span>(</span>Name <span>=</span> <span>"sysconfig"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>class</span> <span>S_SysConfig</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>JsonMap</span></span><span>]</span>
    <span>public</span> <span>TestConfig</span> Config <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><h2 id="å­—æ®µä½ç½®-position" tabindex="-1"> å­—æ®µä½ç½®(Position)</h2>
<p>é€‚ç”¨åœºæ™¯ï¼šå½“å®ä½“ç±»ç»§æ‰¿æ—¶ï¼ŒCodeFirståˆ›å»ºè¡¨çš„å­—æ®µé¡ºåºå¯èƒ½ä¸æ˜¯æƒ³è¦çš„ï¼Œé€šè¿‡è¯¥ç‰¹æ€§å¯ä»¥è®¾ç½®é¡ºåºã€‚</p>
<p>åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­—æ®µä½ç½®ï¼Œå¦‚ï¼š[Column(Position = 1]ï¼Œå¯ä¸ºè´Ÿæ•°å³åæ–¹å‘ä½ç½®ï¼›</p>
<h2 id="å¯æ’å…¥-caninsert-ã€å¯æ›´æ–°-canupdate" tabindex="-1"> å¯æ’å…¥(CanInsert)ã€å¯æ›´æ–°(CanUpdate)</h2>
<p>è¯¥å­—æ®µæ˜¯å¦å¯ä»¥æ’å…¥æˆ–æ›´æ–°ï¼Œé»˜è®¤å€¼trueï¼ŒæŒ‡å®šä¸ºfalseæ’å…¥æˆ–æ›´æ–°æ—¶è¯¥å­—æ®µä¼šè¢«å¿½ç•¥ã€‚</p>
<p>å½“æŒ‡æ˜äº† InsertColumn/UpdateColumns ç­‰æ–¹æ³•æ—¶ï¼Œè¯¥ç‰¹æ€§ä½œç”¨å¯èƒ½å¤±æ•ˆã€‚ä¾‹å¦‚ CanInsert = false æ—¶ï¼ŒåˆæŒ‡æ˜äº† InsertColumns è¯¥å±æ€§ï¼Œåˆ™ä»ç„¶ä¼šæ’å…¥ã€‚</p>
<h2 id="è‡ªå®šä¹‰æ’å…¥å€¼-insertvaluesql" tabindex="-1"> è‡ªå®šä¹‰æ’å…¥å€¼(InsertValueSql)</h2>
<p>æ‰§è¡Œ Insert æ–¹æ³•æ—¶ä½¿ç”¨æ­¤å€¼ï¼Œå®ƒçš„è¯­æ³•æ˜¯ SQLã€‚</p>
<p>æ³¨æ„ï¼šå¦‚æœæ˜¯ getdate() è¿™ç§è¯·å¯è€ƒè™‘ä½¿ç”¨ ServerTimeï¼Œå› ä¸ºå®ƒå¯¹æ•°æ®åº“é—´ä½œäº†é€‚é…ã€‚</p>
<div><pre><code><span>class</span> <span>Type</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>InsertValueSql <span>=</span> <span>"'xxx'"</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

fsql<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Type</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `type`(`Name`) VALUES('xxx')</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="è‡ªå®šä¹‰é‡å†™-rewritesql-ã€é‡è¯»-rereadsql" tabindex="-1"> è‡ªå®šä¹‰é‡å†™(RewriteSql)ã€é‡è¯»(RereadSql)</h2>
<p>å†™å…¥æ—¶é‡å†™ SQLã€è¯»å–æ—¶é‡å†™ SQLï¼Œé€‚åˆ geography ç±»å‹çš„è¯»å†™åœºæ™¯ã€‚</p>
<div><pre><code><span>[</span><span><span>Column</span><span><span>(</span>
    DbType <span>=</span> <span>"geography"</span><span>,</span> 
    RewriteSql <span>=</span> <span>"geography::STGeomFromText({0}, 4236)"</span><span>,</span> 
    RereadSql <span>=</span> <span>"{0}.STAsText()"</span>
<span>)</span></span></span><span>]</span>
<span>public</span> <span><span>string</span></span> geo <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

<span>//æ’å…¥ï¼šINSERT INTO [ts_geocrud01]([id], [geo]) VALUES(@id_0, geography::STGeomFromText(@geo_0, 4236))</span>

<span>//æŸ¥è¯¢ï¼šSELECT TOP 1 a.[id], a.[geo].STAsText() </span>
<span>//FROM [ts_geocrud01] a </span>
<span>//WHERE (a.[id] = 'c7227d5e-0bcf-4b71-8f0f-d69a552fe84e')</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><h2 id="ç¦ç”¨è¿ç§»" tabindex="-1"> ç¦ç”¨è¿ç§»</h2>
<p>IFreeSql.CodeFirst.IsAutoSyncStructure å¯è®¾ç½®å…¨å±€ã€è‡ªåŠ¨è¿ç§»ç»“æ„ã€‘åŠŸèƒ½ï¼Œä¹Ÿå¯é€šè¿‡ FreeSqlBuilder.UseAutoSyncStructure(true) åˆ›å»º IFreeSql çš„æ—¶å€™è®¾ç½®åŠŸèƒ½ã€‚</p>
<p>å½“ã€å®ä½“ç±»ã€‘å¯¹åº”çš„æ˜¯æ•°æ®åº“ã€è§†å›¾ã€‘æˆ–è€…å…¶ä»–æ—¶ï¼Œå¯é€šè¿‡ [Table(DisableSyncStructure = true)] ç¦ç”¨æŒ‡å®šçš„å®ä½“è¿ç§»æ“ä½œã€‚</p>
<div><pre><code><span>[</span><span><span>Table</span><span><span>(</span>DisableSyncStructure <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>ModelDisableSyncStructure</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>false</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> pkid <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="å¤‡æ³¨" tabindex="-1"> å¤‡æ³¨</h2>
<p>FreeSql CodeFirst æ”¯æŒå°† c# ä»£ç å†…çš„æ³¨é‡Šï¼Œè¿ç§»è‡³æ•°æ®åº“çš„å¤‡æ³¨ã€‚å…ˆå†³æ¡ä»¶ï¼š</p>
<p>1ã€å®ä½“ç±»æ‰€åœ¨ç¨‹åºé›†ï¼Œéœ€è¦å¼€å¯ xml æ–‡æ¡£åŠŸèƒ½ï¼›</p>
<p>2ã€xml æ–‡ä»¶å¿…é¡»ä¸ç¨‹åºé›†åŒç›®å½•ï¼Œä¸”æ–‡ä»¶åï¼šxxx.dll -&gt; xxx.xmlï¼›</p>
<blockquote>
<p>v1.5.0+ ç‰ˆæœ¬å¢åŠ äº†å¯¹ Description ç‰¹æ€§çš„è§£æï¼Œä¼˜å…ˆçº§ä½äº c# ä»£ç æ³¨é‡Šï¼›</p>
</blockquote>
<h2 id="ä¼˜å…ˆçº§" tabindex="-1"> ä¼˜å…ˆçº§</h2>
<p>æ•°æ®åº“ç‰¹æ€§ &gt; å®ä½“ç‰¹æ€§ &gt; FluentApiï¼ˆé…ç½®ç‰¹æ€§ï¼‰ &gt; Aopï¼ˆé…ç½®ç‰¹æ€§ï¼‰</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">è¡¨è¾¾å¼å‡½æ•°</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/expression-function.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/expression-function.html"/>
    <updated>2022-05-31T14:08:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è¡¨è¾¾å¼å‡½æ•°" tabindex="-1"> è¡¨è¾¾å¼å‡½æ•°</h1>
<p>è¿™æ˜¯ <code>FreeSql</code> éå¸¸ç‰¹è‰²çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œæ·±å…¥ç»†åŒ–å‡½æ•°è§£æï¼Œæ‰€æ”¯æŒçš„ç±»å‹åŸºæœ¬éƒ½å¯ä»¥ä½¿ç”¨å¯¹åº”çš„è¡¨è¾¾å¼å‡½æ•°ï¼Œä¾‹å¦‚ æ—¥æœŸã€å­—ç¬¦ä¸²ã€<code>IN</code>æŸ¥è¯¢ã€æ•°ç»„ï¼ˆ<code>PostgreSQL</code>çš„æ•°ç»„ï¼‰ã€å­—å…¸ï¼ˆPostgreSQL HStore)ç­‰ç­‰ã€‚</p>
<h2 id="åŠ¨æ€lambdaè¡¨è¾¾å¼" tabindex="-1"> åŠ¨æ€Lambdaè¡¨è¾¾å¼</h2>
<ul>
<li><code>And</code>ã€<code>Or</code>æ‰©å±•æ–¹æ³• <a href="https://github.com/dotnetcore/FreeSql/blob/master/FreeSql/Extensions/LambadaExpressionExtensions.cs" target="_blank" rel="noopener noreferrer">LambadaExpressionExtensions.cs</a></li>
</ul>
<p>ç¤ºä¾‹</p>
<div><pre><code><span>Expression<span>&lt;</span>Func<span>&lt;</span>T<span>,</span> <span>bool</span><span>></span><span>></span></span> <span>where</span> <span>=</span> <span>null</span><span>;</span>
<span>where</span> <span>=</span> <span>where</span><span>.</span><span>And</span><span>(</span>b <span>=></span> b<span>.</span>num <span>></span> <span>0</span><span>)</span><span>;</span>
<span>where</span> <span>=</span> <span>where</span><span>.</span><span>Or</span><span>(</span>b <span>=></span> b<span>.</span>num <span>></span> <span>0</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>åŠ¨æ€æ‹¼æ¥<code>Or</code>,é€šè¿‡<code>Or</code>æ‰©å±•æ–¹æ³•åŠ¨æ€æ‹¼æ¥<code>Lambda</code>è¡¨è¾¾å¼</p>
<div><pre><code><span>Expression<span>&lt;</span>Func<span>&lt;</span>T<span>,</span> <span>bool</span><span>></span><span>></span></span> <span>where</span> <span>=</span> <span>null</span><span>;</span>
<span>if</span> <span>(</span>xxx<span>)</span>
<span>{</span>
   <span>where</span> <span>=</span> <span>where</span><span>.</span><span>Or</span><span>(</span>b <span>=></span> b<span>.</span>num <span>></span> <span>0</span><span>)</span><span>;</span>  
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="inæŸ¥è¯¢" tabindex="-1"> InæŸ¥è¯¢</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> <span>new</span><span>[</span><span>]</span> <span>{</span> <span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span> <span>}</span><span>.</span><span>Contains</span><span>(</span>a<span>.</span>Id<span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT .. FROM ..</span>
<span>//WHERE (a.`Id` in (1,2,3))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><blockquote>
<p>å·²ä¼˜åŒ–ï¼Œé˜²æ­¢ where in å…ƒç´ å¤šè¿‡çš„ SQL é”™è¯¯ï¼Œå¦‚ï¼š</p>
</blockquote>
<blockquote>
<p>[Err] ORA-01795: maximum number of expressions in a list a 1000</p>
</blockquote>
<p>åŸæ¥ï¼šwhere id in (1..1333)</p>
<p>ç°åœ¨ï¼šwhere id in (1..500) or id in (501..1000) or id in (1001..1333)</p>
<h2 id="inå¤šåˆ—æŸ¥è¯¢" tabindex="-1"> Inå¤šåˆ—æŸ¥è¯¢</h2>
<div><pre><code><span>//å…ƒç»„é›†åˆ</span>
<span>vae</span> lst <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>(</span>Guid<span>,</span> DateTime<span>)</span><span>></span></span><span>(</span><span>)</span><span>;</span>
lst<span>.</span><span>Add</span><span>(</span><span>(</span>Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>,</span> DateTime<span>.</span>Now<span>)</span><span>)</span><span>;</span>
lst<span>.</span><span>Add</span><span>(</span><span>(</span>Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>,</span> DateTime<span>.</span>Now<span>)</span><span>)</span><span>;</span>

<span><span>var</span></span> t2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> lst<span>.</span><span>Contains</span><span>(</span>a<span>.</span>Id<span>,</span> a<span>.</span>ct1<span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT .. FROM ..</span>
<span>//WHERE (a."Id" = '685ee1f6-bdf6-4719-a291-c709b8a1378f' AND a."ct1" = '2019-12-07 23:55:27' OR </span>
<span>//a."Id" = '5ecd838a-06a0-4c81-be43-1e77633b7404' AND a."ct1" = '2019-12-07 23:55:27')</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><blockquote>
<p>v3.2.650 ä½¿ç”¨ .Where(a =&gt; list.Any(b =&gt; b.Item1 == a.Id &amp;&amp; b.Item2 == a.ct1))</p>
</blockquote>
<blockquote>
<p>å®ç°ä»£ç ï¼š<a href="https://github.com/2881099/FreeSql/issues/243" target="_blank" rel="noopener noreferrer">https://github.com/2881099/FreeSql/issues/243</a></p>
</blockquote>
<h2 id="inå­è¡¨" tabindex="-1"> Inå­è¡¨</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>As</span><span>(</span><span>"b"</span><span>)</span><span>.</span><span>ToList</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>.</span><span>Contains</span><span>(</span>a<span>.</span>Id<span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (((a.`Id`) in (SELECT b.`Id`</span>
<span>//    FROM `Topic` b)))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="existså­è¡¨" tabindex="-1"> Existså­è¡¨</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>As</span><span>(</span><span>"b"</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Id <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Any</span><span>(</span><span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (exists(SELECT 1</span>
<span>//    FROM `Topic` b</span>
<span>//    WHERE (b.`Id` = a.`Id`)</span>
<span>//    limit 0,1))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="æŸ¥æ‰¾ä»Šå¤©åˆ›å»ºçš„æ•°æ®" tabindex="-1"> æŸ¥æ‰¾ä»Šå¤©åˆ›å»ºçš„æ•°æ®</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>.</span>Date <span>==</span> DateTime<span>.</span>Today<span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//è¿™è¡Œä»£ç è¯´æ˜ FreeSql è¡¨è¾¾å¼è§£æå¼ºå¤§ï¼Œä¸æ˜¯æ‰€æœ‰ ORM éƒ½æ”¯æŒ</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>.</span><span>Between</span><span>(</span>DateTime<span>.</span>Today<span>,</span> DateTime<span>.</span>Today<span>.</span><span>AddDays</span><span>(</span><span>1</span><span>)</span><span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//æ­£å¸¸ç”¨æ³•åº”è¯¥æ˜¯è¿™æ ·</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><blockquote>
<p>SqlServer nvarchar/varchar å·²å…¼å®¹è¡¨è¾¾å¼è§£æï¼Œåˆ†åˆ«è§£æä¸ºï¼šN'' å’Œ ''ï¼Œä¼˜åŒ–ç´¢å¼•æ‰§è¡Œè®¡åˆ’ï¼›</p>
</blockquote>
<h2 id="æ—¥æœŸæ ¼å¼åŒ–" tabindex="-1"> æ—¥æœŸæ ¼å¼åŒ–</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>First</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>.</span><span>ToString</span><span>(</span><span>"HH:mm:ss"</span><span>)</span><span>;</span>
<span>// SELECT date_format(a.`CreateTime`, '%H:%i:%s') as1 </span>
<span>// FROM `xxx` a </span>
<span>// limit 0,1</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><blockquote>
<p>v1.5.0 æ”¯æŒäº†å¸¸ç”¨ c# æ—¥æœŸæ ¼å¼åŒ–ï¼Œyyyy MM dd HH mm ss yy M d H hh h m s tt t</p>
</blockquote>
<blockquote>
<p>tt t ä¸º AM PM</p>
</blockquote>
<h2 id="å¼€çª—å‡½æ•°" tabindex="-1"> å¼€çª—å‡½æ•°</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T1<span>,</span> T2<span>></span></span></span><span>(</span><span>)</span>
<span>.</span><span>InnerJoin</span><span>(</span><span>(</span>a<span>,</span> b<span>)</span> <span>=></span> b<span>.</span>Id <span>==</span> a<span>.</span>Id<span>)</span>
<span>.</span><span>ToList</span><span>(</span><span>(</span>a<span>,</span> b<span>)</span> <span>=></span> <span>new</span>
<span>{</span>
    Id <span>=</span> a<span>.</span>Id<span>,</span>
    EdiId <span>=</span> b<span>.</span>Id<span>,</span>
    over1 <span>=</span> SqlExt<span>.</span><span>Rank</span><span>(</span><span>)</span><span>.</span><span>Over</span><span>(</span><span>)</span><span>.</span><span>OrderBy</span><span>(</span>a<span>.</span>Id<span>)</span><span>.</span><span>OrderByDescending</span><span>(</span>b<span>.</span>EdiId<span>)</span><span>.</span><span>ToValue</span><span>(</span><span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><blockquote>
<p>v1.6.0 åˆ©ç”¨è‡ªå®šä¹‰è§£æåŠŸèƒ½ï¼Œå¢åŠ  SqlExt.Rank().Over().PartitionBy(...)ã€MySql group_concat å¸¸ç”¨å‡½æ•°ï¼Œæ¬¢è¿ PR è¡¥å……</p>
</blockquote>
<h2 id="å­è¡¨exists" tabindex="-1"> å­è¡¨Exists</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>As</span><span>(</span><span>"b"</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Id <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Any</span><span>(</span><span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (exists(SELECT 1</span>
<span>//    FROM `Topic` b</span>
<span>//    WHERE (b.`Id` = a.`Id`)</span>
<span>//    limit 0,1))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><blockquote>
<p>æç¤ºï¼šç”±äºå­æŸ¥è¯¢çš„å®ä½“ç±»ä¸ä¸Šå±‚ç›¸åŒï¼Œä½¿ç”¨ As(&quot;b&quot;) æŒ‡æ˜åˆ«åï¼Œä»¥ä¾¿åŒºåˆ†</p>
</blockquote>
<h2 id="å­è¡¨in" tabindex="-1"> å­è¡¨In</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>As</span><span>(</span><span>"b"</span><span>)</span><span>.</span><span>ToList</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>.</span><span>Contains</span><span>(</span>a<span>.</span>Id<span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (((a.`Id`) in (SELECT b.`Id`</span>
<span>//    FROM `Topic` b)))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="å­è¡¨join" tabindex="-1"> å­è¡¨Join</h2>
<blockquote>
<p>v1.8.0+ string.Join + ToList å®ç°å°†å­æŸ¥è¯¢çš„å¤šè¡Œç»“æœï¼Œæ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚ï¼š&quot;1,2,3,4&quot;</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
  id <span>=</span> a<span>.</span>Id<span>,</span>
  concat <span>=</span> <span>string</span><span>.</span><span>Join</span><span>(</span><span>","</span><span>,</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>StringJoin01<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>)</span>
<span>}</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, (SELECT group_concat(b.`Id` separator ',') </span>
<span>//    FROM `StringJoin01` b) </span>
<span>//FROM `Topic` a</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><blockquote>
<p>æç¤ºï¼šå­æŸ¥è¯¢ string.Join + ToList é€‚é…äº† sqlserver/pgsql/oracle/mysql/sqlite/firebird/è¾¾æ¢¦/é‡‘ä»“/å—å¤§/ç¿°é«˜ <a href="https://github.com/dotnetcore/FreeSql/issues/405" target="_blank" rel="noopener noreferrer">#405</a></p>
</blockquote>
<h2 id="å­è¡¨first-count-sum-max-min-avg" tabindex="-1"> å­è¡¨First/Count/Sum/Max/Min/Avg</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Category<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span>  <span>{</span>
  all <span>=</span> a<span>,</span>
  first <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>First</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>,</span>
  count <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span>
  sum <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Sum</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span><span>,</span>
  max <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Max</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span><span>,</span>
  min <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Min</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span><span>,</span>
  avg <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Avg</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="å­è¡¨tolist" tabindex="-1"> å­è¡¨ToList</h2>
<blockquote>
<p>v3.2.650+ ä»¥ä¸‹æœ€å¤šæ‰§è¡Œ3æ¬¡ SQL</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span>
<span>{</span>
  all <span>=</span> a<span>,</span>
  list1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>,</span>
  list2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>TopicId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="è‡ªå®šä¹‰è§£æ" tabindex="-1"> è‡ªå®šä¹‰è§£æ</h2>
<div><pre><code><span>[</span><span><span>ExpressionCall</span></span><span>]</span>
<span>public</span> <span>static</span> <span>class</span> <span>DbFunc</span> <span>{</span>
  <span>//å¿…è¦å®šä¹‰ static + ThreadLocal</span>
  <span>static</span> <span>ThreadLocal<span>&lt;</span>ExpressionCallContext<span>></span></span> context <span>=</span> <span>new</span> <span>ThreadLocal<span>&lt;</span>ExpressionCallContext<span>></span></span><span>(</span><span>)</span><span>;</span>

  <span>public</span> <span>static</span> <span>DateTime</span> <span>FormatDateTime</span><span>(</span><span>this</span> <span>DateTime</span> that<span>,</span> <span><span>string</span></span> arg1<span>)</span>
  <span>{</span>
    <span><span>var</span></span> up <span>=</span> context<span>.</span>Value<span>;</span>
    <span>if</span> <span>(</span>up<span>.</span>DataType <span>==</span> FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>)</span> <span>//é‡å†™å†…å®¹</span>
      up<span>.</span>Result <span>=</span> <span><span>$"date_format(</span><span><span>{</span><span>up<span>.</span>ParsedContent<span>[</span><span>"that"</span><span>]</span></span><span>}</span></span><span>, </span><span><span>{</span><span>up<span>.</span>ParsedContent<span>[</span><span>"arg1"</span><span>]</span></span><span>}</span></span><span>)"</span></span><span>;</span>
    <span>return</span> that<span>;</span>
  <span>}</span>
<span>}</span>

<span><span>var</span></span> sql1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>SysModule<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>ToSql</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>.</span><span>FormatDateTime</span><span>(</span><span>"yyyy-MM-dd"</span><span>)</span><span>)</span><span>;</span>
<span>//SELECT date_format(a."CreateTime", 'yyyy-MM-dd') as1 </span>
<span>//FROM "SysModule" a</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><p>[ExpressionCall] ç‰¹æ€§å¯åœ¨é™æ€æ‰©å±•ç±»ä¸Šæ ‡è®°ï¼Œä¹Ÿå¯ä»¥åœ¨å•ä¸ªé™æ€æ–¹æ³•ä¸Šæ ‡è®°ï¼›</p>
<table>
<thead>
<tr>
<th>ExpressionCallContext å±æ€§</th>
<th>ç±»å‹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataType</td>
<td>FreeSql.DataType</td>
<td>ç”¨äºå®ç°ä¸åŒæ•°æ®åº“çš„é€‚é…åˆ¤æ–­æ¡ä»¶</td>
</tr>
<tr>
<td>ParsedContent</td>
<td>Dictionary&lt;string, string&gt;</td>
<td>å‡½æ•°çš„å„å‚æ•°è§£æç»“æœ</td>
</tr>
<tr>
<td>DbParameter</td>
<td>DbParameter</td>
<td>that è¢«å‚æ•°åŒ–çš„å¯¹è±¡ï¼ˆæœ‰å¯èƒ½ä¸º null)</td>
</tr>
<tr>
<td>UserParameters</td>
<td>List&lt;DbParameter&gt;</td>
<td>å¯é™„åŠ å‚æ•°åŒ–å¯¹è±¡</td>
</tr>
<tr>
<td>Result</td>
<td>string</td>
<td>è¿”å›è¡¨è¾¾å¼å‡½æ•°è¡¨ç¤ºçš„ SQL å­—ç¬¦ä¸²</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å½“æ‰©å±•æ–¹æ³•è¿”å›å€¼ä¸º string æ—¶ï¼Œå…¶è¿”å›å€¼ä¹Ÿå¯ä»¥å½“ä½œ context.Value.Result åŠŸèƒ½</p>
</blockquote>
<blockquote>
<p>å½“ä¸æƒ³è§£ææŒ‡å®šå‚æ•°æ—¶ï¼Œä½¿ç”¨ç‰¹æ€§ [RawValue] æ ‡è®°</p>
</blockquote>
<h2 id="å‚æ•°åŒ–" tabindex="-1"> å‚æ•°åŒ–</h2>
<p>åœ¨ä¹‹å‰ Where(lambda) è§£æå‡ºæ¥çš„æ˜¯çº¯æ–‡æœ¬ï¼Œåšäº†é˜²æ­¢æ³¨å…¥åŠŸèƒ½ï¼Œå¯¹æ•°æ®åº“æ‰§è¡Œè®¡åˆ’è¦æ±‚é«˜çš„ï¼Œç°åœ¨å¯ä»¥å¼€å¯ lambda å‚æ•°åŒ–åŠŸèƒ½ã€‚</p>
<div><pre><code><span><span>var</span></span> fsql <span>=</span> <span>new</span> <span>FreeSqlBuilder</span><span>(</span><span>)</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>
  <span>.</span><span>UseGenerateCommandParameterWithLambda</span><span>(</span><span>true</span><span>)</span>
  <span>..</span><span>.</span>

<span><span>var</span></span> id <span>=</span> <span>1</span><span>;</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> id<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT .. FROM `Song` a WHERE `Id` = @exp_0</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>ç”Ÿæˆçš„å‚æ•°å¯¹è±¡ï¼ŒDbTypeã€Sizeã€Precisionã€Scale å€¼è®¾ç½®é»˜è®¤å·²ä½œä¼˜åŒ–ï¼Œä¸å®ä½“å±æ€§å®šä¹‰ä¸€è‡´ã€‚</p>
<p>è¯¡å¼‚æ“ä½œï¼š</p>
<blockquote>
<p>å¦‚æœä¸å¸Œæœ› string å‚æ•°ä¸å®ä½“å±æ€§çš„ Size ç›¸åŒï¼Œå¯åˆ©ç”¨è‡ªå®šä¹‰è¡¨è¾¾å¼å‡½æ•°åŠŸèƒ½ï¼Œå¦‚ä¸‹ï¼š</p>
</blockquote>
<div><pre><code><span><span>var</span></span> name <span>=</span> <span>"testname"</span><span>;</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>TestMySqlStringIsNullable<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>varchar <span>==</span> name<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>TestMySqlStringIsNullable<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>varchar <span>==</span> name<span>.</span><span>SetDbParameter</span><span>(</span><span>10</span><span>)</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span>public</span> <span>class</span> <span>TestMySqlStringIsNullable</span> <span>{</span>
  <span>public</span> <span>Guid</span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(100)"</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span><span>string</span></span> varchar <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>[</span><span><span>ExpressionCall</span></span><span>]</span>
<span>public</span> <span>static</span> <span>class</span> <span>DbFunc</span> <span>{</span>
  <span>static</span> <span>ThreadLocal<span>&lt;</span>ExpressionCallContext<span>></span></span> context <span>=</span> <span>new</span> <span>ThreadLocal<span>&lt;</span>ExpressionCallContext<span>></span></span><span>(</span><span>)</span><span>;</span>

  <span>public</span> <span>static</span> <span><span>string</span></span> <span>SetDbParameter</span><span>(</span><span>this</span> <span><span>string</span></span> that<span>,</span> <span><span>int</span></span> size<span>)</span>
  <span>{</span>
    <span>if</span> <span>(</span>context<span>.</span>Value<span>.</span>DbParameter <span>!=</span> <span>null</span><span>)</span>
      context<span>.</span>Value<span>.</span>DbParameter<span>.</span>Size <span>=</span> size<span>;</span>
    <span>return</span> context<span>.</span>Value<span>.</span>ParsedContent<span>[</span><span>"that"</span><span>]</span><span>;</span>
  <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div><p>ç¬¬ä¸€æ¡è¯­å¥äº§ç”Ÿçš„å‚æ•°å¯¹è±¡ Size ä¸º 100ï¼Œç¬¬äºŒæ¡ä¸º 10ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/16286519/69433211-2c5fcf80-0d76-11ea-8eec-963eb37199c5.png" alt="image" loading="lazy"></p>
<h2 id="è¡¨è¾¾å¼å‡½æ•°å…¨è§ˆ" tabindex="-1"> è¡¨è¾¾å¼å‡½æ•°å…¨è§ˆ</h2>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>MySql</th>
<th>SqlServer</th>
<th>PostgreSQL</th>
<th>Oracle</th>
<th>åŠŸèƒ½è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>a ? b : c</td>
<td>case when a then b else c end</td>
<td>case when a then b else c end</td>
<td>case when a then b else c end</td>
<td>case when a then b else c end</td>
<td>aæˆç«‹æ—¶å–bå€¼ï¼Œå¦åˆ™å–cå€¼</td>
</tr>
<tr>
<td>a ?? b</td>
<td>ifnull(a, b)</td>
<td>isnull(a, b)</td>
<td>coalesce(a, b)</td>
<td>nvl(a, b)</td>
<td>å½“aä¸ºnullæ—¶ï¼Œå–bå€¼</td>
</tr>
<tr>
<td>æ•°å­— + æ•°å­—</td>
<td>a + b</td>
<td>a + b</td>
<td>a + b</td>
<td>a + b</td>
<td>æ•°å­—ç›¸åŠ </td>
</tr>
<tr>
<td>æ•°å­— + å­—ç¬¦ä¸²</td>
<td>concat(a, b)</td>
<td>cast(a as varchar) + cast(b as varchar)</td>
<td>case(a as varchar)|| b</td>
<td>a|| b</td>
<td>å­—ç¬¦ä¸²ç›¸åŠ ï¼Œaæˆ–bä»»æ„ä¸€ä¸ªä¸ºå­—ç¬¦ä¸²æ—¶</td>
</tr>
<tr>
<td>a - b</td>
<td>a - b</td>
<td>a - b</td>
<td>a - b</td>
<td>a - b</td>
<td>å‡</td>
</tr>
<tr>
<td>a * b</td>
<td>a * b</td>
<td>a * b</td>
<td>a * b</td>
<td>a * b</td>
<td>ä¹˜</td>
</tr>
<tr>
<td>a / b</td>
<td>a / b</td>
<td>a / b</td>
<td>a / b</td>
<td>a / b</td>
<td>é™¤</td>
</tr>
<tr>
<td>a / b</td>
<td>a div b</td>
<td>a / b</td>
<td>a / b</td>
<td>trunc(a / b)</td>
<td>æ•´é™¤(a,béƒ½ä¸ºæ•´æ•°)</td>
</tr>
<tr>
<td>a % b</td>
<td>a % b</td>
<td>a % b</td>
<td>a % b</td>
<td>mod(a,b)</td>
<td>æ¨¡</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ç­‰ç­‰...</p>
</blockquote>
<h3 id="æ•°ç»„" tabindex="-1"> æ•°ç»„</h3>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>MySql</th>
<th>SqlServer</th>
<th>PostgreSQL</th>
<th>Oracle</th>
<th>åŠŸèƒ½è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>a.Length</td>
<td>-</td>
<td>-</td>
<td>case when a is null then 0 else array_length(a,1) end</td>
<td>-</td>
<td>æ•°ç»„é•¿åº¦</td>
</tr>
<tr>
<td>å¸¸é‡æ•°ç»„.Length</td>
<td>-</td>
<td>-</td>
<td>array_length(array[å¸¸é‡æ•°ç»„å…ƒç´ é€—å·åˆ†å‰²],1)</td>
<td>-</td>
<td>æ•°ç»„é•¿åº¦</td>
</tr>
<tr>
<td>a.Any()</td>
<td>-</td>
<td>-</td>
<td>case when a is null then 0 else array_length(a,1) end &gt; 0</td>
<td>-</td>
<td>æ•°ç»„æ˜¯å¦ä¸ºç©º</td>
</tr>
<tr>
<td>å¸¸é‡æ•°ç»„.Contains(b)</td>
<td>b in (å¸¸é‡æ•°ç»„å…ƒç´ é€—å·åˆ†å‰²)</td>
<td>b in (å¸¸é‡æ•°ç»„å…ƒç´ é€—å·åˆ†å‰²)</td>
<td>b in (å¸¸é‡æ•°ç»„å…ƒç´ é€—å·åˆ†å‰²)</td>
<td>b in (å¸¸é‡æ•°ç»„å…ƒç´ é€—å·åˆ†å‰²)</td>
<td>INæŸ¥è¯¢</td>
</tr>
<tr>
<td>a.Contains(b)</td>
<td>-</td>
<td>-</td>
<td>a @&gt; array[b]</td>
<td>-</td>
<td>aæ•°ç»„æ˜¯å¦åŒ…å«bå…ƒç´ </td>
</tr>
<tr>
<td>a.Concat(b)</td>
<td>-</td>
<td>-</td>
<td>a || b</td>
<td>-</td>
<td>æ•°ç»„ç›¸è¿</td>
</tr>
<tr>
<td>a.Count()</td>
<td>-</td>
<td>-</td>
<td>åŒ Length</td>
<td>-</td>
<td>æ•°ç»„é•¿åº¦</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ä¸€ä¸ªç»†èŠ‚è¯æ˜ FreeSql åŒ å¿ƒåˆ¶ä½œ</p>
</blockquote>
<p>é€šç”¨çš„ in æŸ¥è¯¢ select.Where(a =&gt; new []{ 1,2,3 }.Contains(a.xxx))</p>
<p>å‡è®¾ xxxs æ˜¯ pgsql çš„æ•°ç»„å­—æ®µç±»å‹ï¼Œå…¶å®ä¼šä¸ä¸Šé¢çš„ in æŸ¥è¯¢èµ·å†²çªï¼ŒFreeSql è§£å†³äº†è¿™ä¸ªçŸ›ç›¾ select.Where(a =&gt; a.xxxs.Contains(1))</p>
<h3 id="å­—å…¸-dictionary-string-string" tabindex="-1"> å­—å…¸ Dictionary&lt;string, string&gt;</h3>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>MySql</th>
<th>SqlServer</th>
<th>PostgreSQL</th>
<th>Oracle</th>
<th>åŠŸèƒ½è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>a.Count</td>
<td>-</td>
<td>-</td>
<td>case when a is null then 0 else array_length(akeys(a),1) end</td>
<td>-</td>
<td>å­—å…¸é•¿åº¦</td>
</tr>
<tr>
<td>a.Keys</td>
<td>-</td>
<td>-</td>
<td>akeys(a)</td>
<td>-</td>
<td>è¿”å›å­—å…¸æ‰€æœ‰keyæ•°ç»„</td>
</tr>
<tr>
<td>a.Values</td>
<td>-</td>
<td>-</td>
<td>avals(a)</td>
<td>-</td>
<td>è¿”å›å­—å…¸æ‰€æœ‰valueæ•°ç»„</td>
</tr>
<tr>
<td>a.Contains(b)</td>
<td>-</td>
<td>-</td>
<td>a @&gt; b</td>
<td>-</td>
<td>å­—å…¸æ˜¯å¦åŒ…å«b</td>
</tr>
<tr>
<td>a.ContainsKey(b)</td>
<td>-</td>
<td>-</td>
<td>a? b</td>
<td>-</td>
<td>å­—å…¸æ˜¯å¦åŒ…å«key</td>
</tr>
<tr>
<td>a.Concat(b)</td>
<td>-</td>
<td>-</td>
<td>a || b</td>
<td>-</td>
<td>å­—å…¸ç›¸è¿</td>
</tr>
<tr>
<td>a.Count()</td>
<td>-</td>
<td>-</td>
<td>åŒ Count</td>
<td>-</td>
<td>å­—å…¸é•¿åº¦</td>
</tr>
</tbody>
</table>
<h3 id="json-jtoken-jobject-jarray" tabindex="-1"> JSON JToken/JObject/JArray</h3>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>MySql</th>
<th>SqlServer</th>
<th>PostgreSQL</th>
<th>Oracle</th>
<th>åŠŸèƒ½è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>a.Count</td>
<td>-</td>
<td>-</td>
<td>jsonb_array_length(coalesce(a, '[]))</td>
<td>-</td>
<td>jsonæ•°ç»„ç±»å‹çš„é•¿åº¦</td>
</tr>
<tr>
<td>a.Any()</td>
<td>-</td>
<td>-</td>
<td>jsonb_array_length(coalesce(a, '[])) &gt; 0</td>
<td>-</td>
<td>jsonæ•°ç»„ç±»å‹ï¼Œæ˜¯å¦ä¸ºç©º</td>
</tr>
<tr>
<td>a.Contains(b)</td>
<td>-</td>
<td>-</td>
<td>coalesce(a, '{}') @&gt; b::jsonb</td>
<td>-</td>
<td>jsonä¸­æ˜¯å¦åŒ…å«b</td>
</tr>
<tr>
<td>a.ContainsKey(b)</td>
<td>-</td>
<td>-</td>
<td>coalesce(a, '{}') ? b</td>
<td>-</td>
<td>jsonä¸­æ˜¯å¦åŒ…å«é”®b</td>
</tr>
<tr>
<td>a.Concat(b)</td>
<td>-</td>
<td>-</td>
<td>coalesce(a, '{}')</td>
<td></td>
<td>b::jsonb</td>
</tr>
<tr>
<td>Parse(a)</td>
<td>-</td>
<td>-</td>
<td>a::jsonb</td>
<td>-</td>
<td>è½¬åŒ–å­—ç¬¦ä¸²ä¸ºjsonç±»å‹</td>
</tr>
<tr>
<td>a.Field[&quot;x&quot;]</td>
<td>-</td>
<td>-</td>
<td>a.Field-&gt;x</td>
<td>-</td>
<td>jsonæˆå‘˜è®¿é—®</td>
</tr>
</tbody>
</table>
<h3 id="å­—ç¬¦ä¸²" tabindex="-1"> å­—ç¬¦ä¸²</h3>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>MySql</th>
<th>SqlServer</th>
<th>PostgreSQL</th>
<th>Oracle</th>
<th>Sqlite</th>
</tr>
</thead>
<tbody>
<tr>
<td>string.Empty</td>
<td>''</td>
<td>''</td>
<td>''</td>
<td>''</td>
<td></td>
</tr>
<tr>
<td>string.IsNullOrEmpty(a)</td>
<td>(a is null or a = '')</td>
<td>(a is null or a = '')</td>
<td>(a is null or a = '')</td>
<td>(a is null or a = '')</td>
<td>(a is null or a = '')</td>
</tr>
<tr>
<td>string.Concat(a,b,c...)</td>
<td>concat(a, b, c)</td>
<td>a + b + c</td>
<td>a || b || c</td>
<td>a || b || c</td>
<td>a || b || c</td>
</tr>
<tr>
<td>a.CompareTo(b)</td>
<td>strcmp(a, b)</td>
<td>-</td>
<td>case when a = b then 0 when a &gt; b then 1 else -1 end</td>
<td>case when a = b then 0 when a &gt; b then 1 else -1 end</td>
<td>case when a = b then 0 when a &gt; b then 1 else -1 end</td>
</tr>
<tr>
<td>a.Contains('b')</td>
<td>a like '%b%'</td>
<td>a like '%b%'</td>
<td>a ilike'%b%'</td>
<td>a like '%b%'</td>
<td>a like '%b%'</td>
</tr>
<tr>
<td>a.EndsWith('b')</td>
<td>a like '%b'</td>
<td>a like '%b'</td>
<td>a ilike'%b'</td>
<td>a like '%b'</td>
<td>a like '%b'</td>
</tr>
<tr>
<td>a.IndexOf(b)</td>
<td>locate(a, b) - 1</td>
<td>locate(a, b) - 1</td>
<td>strpos(a, b) - 1</td>
<td>instr(a, b, 1, 1) - 1</td>
<td>instr(a, b) - 1</td>
</tr>
<tr>
<td>a.Length</td>
<td>char_length(a)</td>
<td>len(a)</td>
<td>char_length(a)</td>
<td>length(a)</td>
<td>length(a)</td>
</tr>
<tr>
<td>a.PadLeft(b, c)</td>
<td>lpad(a, b, c)</td>
<td>-</td>
<td>lpad(a, b, c)</td>
<td>lpad(a, b, c)</td>
<td>lpad(a, b, c)</td>
</tr>
<tr>
<td>a.PadRight(b, c)</td>
<td>rpad(a, b, c)</td>
<td>-</td>
<td>rpad(a, b, c)</td>
<td>rpad(a, b, c)</td>
<td>rpad(a, b, c)</td>
</tr>
<tr>
<td>a.Replace(b, c)</td>
<td>replace(a, b, c)</td>
<td>replace(a, b, c)</td>
<td>replace(a, b, c)</td>
<td>replace(a, b, c)</td>
<td>replace(a, b, c)</td>
</tr>
<tr>
<td>a.StartsWith('b')</td>
<td>a like 'b%'</td>
<td>a like 'b%'</td>
<td>a ilike'b%'</td>
<td>a like 'b%'</td>
<td>a like 'b%'</td>
</tr>
<tr>
<td>a.Substring(b, c)</td>
<td>substr(a, b, c + 1)</td>
<td>substring(a, b, c + 1)</td>
<td>substr(a, b, c + 1)</td>
<td>substr(a, b, c + 1)</td>
<td>substr(a, b, c + 1)</td>
</tr>
<tr>
<td>a.ToLower</td>
<td>lower(a)</td>
<td>lower(a)</td>
<td>lower(a)</td>
<td>lower(a)</td>
<td>lower(a)</td>
</tr>
<tr>
<td>a.ToUpper</td>
<td>upper(a)</td>
<td>upper(a)</td>
<td>upper(a)</td>
<td>upper(a)</td>
<td>upper(a)</td>
</tr>
<tr>
<td>a.Trim</td>
<td>trim(a)</td>
<td>trim(a)</td>
<td>trim(a)</td>
<td>trim(a)</td>
<td>trim(a)</td>
</tr>
<tr>
<td>a.TrimEnd</td>
<td>rtrim(a)</td>
<td>rtrim(a)</td>
<td>rtrim(a)</td>
<td>rtrim(a)</td>
<td>rtrim(a)</td>
</tr>
<tr>
<td>a.TrimStart</td>
<td>ltrim(a)</td>
<td>ltrim(a)</td>
<td>ltrim(a)</td>
<td>ltrim(a)</td>
<td>ltrim(a)</td>
</tr>
<tr>
<td>a.FirstOrDefault</td>
<td>substr(a,1,1)</td>
<td>substring(a,1,1)</td>
<td>substr(a,1,1)</td>
<td>substr(a,1,1)</td>
<td>substr(a,1,1)</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ä½¿ç”¨å­—ç¬¦ä¸²å‡½æ•°å¯èƒ½ä¼šå‡ºç°æ€§èƒ½ç“¶é¢ˆï¼Œè™½ç„¶ä¸æ¨èä½¿ç”¨ï¼Œä½†æ˜¯ä½œä¸ºåŠŸèƒ½åº“è¿™ä¹Ÿæ˜¯ä¸å¯ç¼ºå°‘çš„åŠŸèƒ½ä¹‹ä¸€ã€‚</p>
</blockquote>
<h3 id="æ—¥æœŸ" tabindex="-1"> æ—¥æœŸ</h3>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>MySql</th>
<th>SqlServer</th>
<th>PostgreSQL</th>
<th>Oracle</th>
</tr>
</thead>
<tbody>
<tr>
<td>DateTime.Now</td>
<td>now()</td>
<td>getdate()</td>
<td>current_timestamp</td>
<td>systimestamp</td>
</tr>
<tr>
<td>DateTime.UtcNow</td>
<td>utc_timestamp()</td>
<td>getutcdate()</td>
<td>(current_timestamp at time zone 'UTC')</td>
<td>sys_extract_utc(systimestamp)</td>
</tr>
<tr>
<td>DateTime.Today</td>
<td>curdate</td>
<td>convert(char(10),getdate(),120)</td>
<td>current_date</td>
<td>trunc(systimestamp)</td>
</tr>
<tr>
<td>DateTime.MaxValue</td>
<td>cast('9999/12/31 23:59:59' as datetime)</td>
<td>'9999/12/31 23:59:59'</td>
<td>'9999/12/31 23:59:59'::timestamp</td>
<td>to_timestamp('9999-12-31 23:59:59','YYYY-MM-DD HH24:MI:SS.FF6')</td>
</tr>
<tr>
<td>DateTime.MinValue</td>
<td>cast('0001/1/1 0:00:00' as datetime)</td>
<td>'1753/1/1 0:00:00'</td>
<td>'0001/1/1 0:00:00'::timestamp</td>
<td>to_timestamp('0001-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS.FF6')</td>
</tr>
<tr>
<td>DateTime.Compare(a, b)</td>
<td>a - b</td>
<td>a - b</td>
<td>extract(epoch from a::timestamp-b::timestamp)</td>
<td>extract(day from (a-b))</td>
</tr>
<tr>
<td>DateTime.DaysInMonth(a, b)</td>
<td>dayofmonth(last_day(concat(a, '-', b, '-1')))</td>
<td>datepart(day, dateadd(day, -1, dateadd(month, 1, cast(a as varchar) + '-' + cast(b as varchar) + '-1')))</td>
<td>extract(day from (a</td>
<td></td>
</tr>
<tr>
<td>DateTime.Equals(a, b)</td>
<td>a = b</td>
<td>a = b</td>
<td>a = b</td>
<td>a = b</td>
</tr>
<tr>
<td>DateTime.IsLeapYear(a)</td>
<td>a%4=0 and a%100&lt;&gt;0 or a%400=0</td>
<td>a%4=0 and a%100&lt;&gt;0 or a%400=0</td>
<td>a%4=0 and a%100&lt;&gt;0 or a%400=0</td>
<td>mod(a,4)=0 AND mod(a,100)&lt;&gt;0 OR mod(a,400)=0</td>
</tr>
<tr>
<td>DateTime.Parse(a)</td>
<td>cast(a as datetime)</td>
<td>cast(a as datetime)</td>
<td>a::timestamp</td>
<td>to_timestamp(a,'YYYY-MM-DD HH24:MI:SS.FF6')</td>
</tr>
<tr>
<td>a.Add(b)</td>
<td>date_add(a, interval b microsecond)</td>
<td>dateadd(millisecond, b / 1000, a)</td>
<td>a::timestamp+(b</td>
<td></td>
</tr>
<tr>
<td>a.AddDays(b)</td>
<td>date_add(a, interval b day)</td>
<td>dateadd(day, b, a)</td>
<td>a::timestamp+(b</td>
<td></td>
</tr>
<tr>
<td>a.AddHours(b)</td>
<td>date_add(a, interval b hour)</td>
<td>dateadd(hour, b, a)</td>
<td>a::timestamp+(b</td>
<td></td>
</tr>
<tr>
<td>a.AddMilliseconds(b)</td>
<td>date_add(a, interval b*1000 microsecond)</td>
<td>dateadd(millisecond, b, a)</td>
<td>a::timestamp+(b</td>
<td></td>
</tr>
<tr>
<td>a.AddMinutes(b)</td>
<td>date_add(a, interval b minute)</td>
<td>dateadd(minute, b, a)</td>
<td>a::timestamp+(b</td>
<td></td>
</tr>
<tr>
<td>a.AddMonths(b)</td>
<td>date_add(a, interval b month)</td>
<td>dateadd(month, b, a)</td>
<td>a::timestamp+(b</td>
<td></td>
</tr>
<tr>
<td>a.AddSeconds(b)</td>
<td>date_add(a, interval b second)</td>
<td>dateadd(second, b, a)</td>
<td>a::timestamp+(b</td>
<td></td>
</tr>
<tr>
<td>a.AddTicks(b)</td>
<td>date_add(a, interval b/10 microsecond)</td>
<td>dateadd(millisecond, b / 10000, a)</td>
<td>a::timestamp+(b</td>
<td></td>
</tr>
<tr>
<td>a.AddYears(b)</td>
<td>date_add(a, interval b year)</td>
<td>dateadd(year, b, a)</td>
<td>a::timestamp+(b</td>
<td></td>
</tr>
<tr>
<td>a.Date</td>
<td>cast(date_format(a, '%Y-%m-%d') as datetime)</td>
<td>convert(char(10),a,120)</td>
<td>a::date</td>
<td>trunc(a)</td>
</tr>
<tr>
<td>a.Day</td>
<td>dayofmonth(a)</td>
<td>datepart(day, a)</td>
<td>extract(day from a::timestamp)</td>
<td>cast(to_char(a,'DD') as number)</td>
</tr>
<tr>
<td>a.DayOfWeek</td>
<td>dayofweek(a)</td>
<td>datepart(weekday, a) - 1</td>
<td>extract(dow from a::timestamp)</td>
<td>case when to_char(a)='7' then 0 else cast(to_char(a) as number) end</td>
</tr>
<tr>
<td>a.DayOfYear</td>
<td>dayofyear(a)</td>
<td>datepart(dayofyear, a)</td>
<td>extract(doy from a::timestamp)</td>
<td>cast(to_char(a,'DDD') as number)</td>
</tr>
<tr>
<td>a.Hour</td>
<td>hour(a)</td>
<td>datepart(hour, a)</td>
<td>extract(hour from a::timestamp)</td>
<td>cast(to_char(a,'HH24') as number)</td>
</tr>
<tr>
<td>a.Millisecond</td>
<td>floor(microsecond(a) / 1000)</td>
<td>datepart(millisecond, a)</td>
<td>extract(milliseconds from a::timestamp)-extract(second from a::timestamp)*1000</td>
<td>cast(to_char(a,'FF3') as number)</td>
</tr>
<tr>
<td>a.Minute</td>
<td>minute(a)</td>
<td>datepart(minute, a)</td>
<td>extract(minute from a::timestamp)</td>
<td>cast(to_char(a,'MI') as number)</td>
</tr>
<tr>
<td>a.Month</td>
<td>month(a)</td>
<td>datepart(month, a)</td>
<td>extract(month from a::timestamp)</td>
<td>cast(to_char(a,'FF3') as number)</td>
</tr>
<tr>
<td>a.Second</td>
<td>second(a)</td>
<td>datepart(second, a)</td>
<td>extract(second from a::timestamp)</td>
<td>cast(to_char(a,'SS') as number)</td>
</tr>
<tr>
<td>a.Subtract(b)</td>
<td>timestampdiff(microsecond, b, a)</td>
<td>datediff(millisecond, b, a) * 1000</td>
<td>(extract(epoch from a::timestamp-b::timestamp)*1000000)</td>
<td>a - b</td>
</tr>
<tr>
<td>a.Ticks</td>
<td>timestampdiff(microsecond, '0001-1-1', a) * 10</td>
<td>datediff(millisecond, '1970-1-1', a) * 10000 + 621355968000000000</td>
<td>extract(epoch from a::timestamp)*10000000+621355968000000000</td>
<td>cast(to_char(a,'FF7') as number)</td>
</tr>
<tr>
<td>a.TimeOfDay</td>
<td>timestampdiff(microsecond, date_format(a, '%Y-%m-%d'), a)</td>
<td>'1970-1-1 ' + convert(varchar, a, 14)</td>
<td>extract(epoch from a::time)*1000000</td>
<td>a - trunc(a)</td>
</tr>
<tr>
<td>a.Year</td>
<td>year(a)</td>
<td>datepart(year, a)</td>
<td>extract(year from a::timestamp)</td>
<td>å¹´</td>
</tr>
<tr>
<td>a.Equals(b)</td>
<td>a = b</td>
<td>a = b</td>
<td>a = b</td>
<td>a = b</td>
</tr>
<tr>
<td>a.CompareTo(b)</td>
<td>a - b</td>
<td>a - b</td>
<td>a - b</td>
<td>a - b</td>
</tr>
<tr>
<td>a.ToString()</td>
<td>date_format(a, '%Y-%m-%d %H:%i:%s.%f')</td>
<td>convert(varchar, a, 121)</td>
<td>to_char(a, 'YYYY-MM-DD HH24:MI:SS.US')</td>
<td>to_char(a,'YYYY-MM-DD HH24:MI:SS.FF6')</td>
</tr>
</tbody>
</table>
<h3 id="æ—¶é—´" tabindex="-1"> æ—¶é—´</h3>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>MySql(å¾®ç§’)</th>
<th>SqlServer(ç§’)</th>
<th>PostgreSQL(å¾®ç§’)</th>
<th>Oracle(Interval day(9) to second(7))</th>
</tr>
</thead>
<tbody>
<tr>
<td>TimeSpan.Zero</td>
<td>0</td>
<td>0</td>
<td>-</td>
<td>0å¾®ç§’</td>
</tr>
<tr>
<td>TimeSpan.MaxValue</td>
<td>922337203685477580</td>
<td>922337203685477580</td>
<td>-</td>
<td>numtodsinterval(233720368.5477580,'second')</td>
</tr>
<tr>
<td>TimeSpan.MinValue</td>
<td>-922337203685477580</td>
<td>-922337203685477580</td>
<td>-</td>
<td>numtodsinterval(-233720368.5477580,'second')</td>
</tr>
<tr>
<td>TimeSpan.Compare(a, b)</td>
<td>a - b</td>
<td>a - b</td>
<td>-</td>
<td>extract(day from (a-b))</td>
</tr>
<tr>
<td>TimeSpan.Equals(a, b)</td>
<td>a = b</td>
<td>a = b</td>
<td>-</td>
<td>a = b</td>
</tr>
<tr>
<td>TimeSpan.FromDays(a)</td>
<td>a * 1000000 * 60 * 60 * 24</td>
<td>a * 1000000 * 60 * 60 * 24</td>
<td>-</td>
<td>numtodsinterval(a*86400,'second')</td>
</tr>
<tr>
<td>TimeSpan.FromHours(a)</td>
<td>a * 1000000 * 60 * 60</td>
<td>a * 1000000 * 60 * 60</td>
<td>-</td>
<td>numtodsinterval(a*3600,'second')</td>
</tr>
<tr>
<td>TimeSpan.FromMilliseconds(a)</td>
<td>a * 1000</td>
<td>a * 1000</td>
<td>-</td>
<td>numtodsinterval(a/1000,'second')</td>
</tr>
<tr>
<td>TimeSpan.FromMinutes(a)</td>
<td>a * 1000000 * 60</td>
<td>a * 1000000 * 60</td>
<td>-</td>
<td>numtodsinterval(a*60,'second')</td>
</tr>
<tr>
<td>TimeSpan.FromSeconds(a)</td>
<td>a * 1000000</td>
<td>a * 1000000</td>
<td>-</td>
<td>numtodsinterval(a,'second')</td>
</tr>
<tr>
<td>TimeSpan.FromTicks(a)</td>
<td>a / 10</td>
<td>a / 10</td>
<td>-</td>
<td>numtodsinterval(a/10000000,'second')</td>
</tr>
<tr>
<td>a.Add(b)</td>
<td>a + b</td>
<td>a + b</td>
<td>-</td>
<td>a + b</td>
</tr>
<tr>
<td>a.Subtract(b)</td>
<td>a - b</td>
<td>a - b</td>
<td>-</td>
<td>a - b</td>
</tr>
<tr>
<td>a.CompareTo(b)</td>
<td>a - b</td>
<td>a - b</td>
<td>-</td>
<td>extract(day from (a-b))</td>
</tr>
<tr>
<td>a.Days</td>
<td>a div (1000000 * 60 * 60 * 24)</td>
<td>a div (1000000 * 60 * 60 * 24)</td>
<td>-</td>
<td>extract(day from a)</td>
</tr>
<tr>
<td>a.Hours</td>
<td>a div (1000000 * 60 * 60) mod 24</td>
<td>a div (1000000 * 60 * 60) mod 24</td>
<td>-</td>
<td>extract(hour from a)</td>
</tr>
<tr>
<td>a.Milliseconds</td>
<td>a div 1000 mod 1000</td>
<td>a div 1000 mod 1000</td>
<td>-</td>
<td>cast(substr(extract(second from a)-floor(extract(second from a)),2,3) as number)</td>
</tr>
<tr>
<td>a.Seconds</td>
<td>a div 1000000 mod 60</td>
<td>a div 1000000 mod 60</td>
<td>-</td>
<td>extract(second from a)</td>
</tr>
<tr>
<td>a.Ticks</td>
<td>a * 10</td>
<td>a * 10</td>
<td>-</td>
<td>(extract(day from a)*86400+extract(hour from a)*3600+extract(minute from a)*60+extract(second from a))*10000000</td>
</tr>
<tr>
<td>a.TotalDays</td>
<td>a / (1000000 * 60 * 60 * 24)</td>
<td>a / (1000000 * 60 * 60 * 24)</td>
<td>-</td>
<td>extract(day from a)</td>
</tr>
<tr>
<td>a.TotalHours</td>
<td>a / (1000000 * 60 * 60)</td>
<td>a / (1000000 * 60 * 60)</td>
<td>-</td>
<td>(extract(day from a)*24+extract(hour from a))</td>
</tr>
<tr>
<td>a.TotalMilliseconds</td>
<td>a / 1000</td>
<td>a / 1000</td>
<td>-</td>
<td>(extract(day from a)*86400+extract(hour from a)*3600+extract(minute from a)*60+extract(second from a))*1000</td>
</tr>
<tr>
<td>a.TotalMinutes</td>
<td>a / (1000000 * 60)</td>
<td>a / (1000000 * 60)</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>a.TotalSeconds</td>
<td>a / 1000000</td>
<td>a / 1000000</td>
<td>-</td>
<td>(extract(day from a)*86400+extract(hour from a)*3600+extract(minute from a)*60+extract(second from a))</td>
</tr>
<tr>
<td>a.Equals(b)</td>
<td>a = b</td>
<td>a = b</td>
<td>-</td>
<td>a = b</td>
</tr>
<tr>
<td>a.ToString()</td>
<td>cast(a as varchar)</td>
<td>cast(a as varchar)</td>
<td>-</td>
<td>to_char(a)</td>
</tr>
</tbody>
</table>
<h3 id="æ•°å­¦å‡½æ•°" tabindex="-1"> æ•°å­¦å‡½æ•°</h3>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>MySql</th>
<th>SqlServer</th>
<th>PostgreSQL</th>
<th>Oracle</th>
</tr>
</thead>
<tbody>
<tr>
<td>Math.Abs(a)</td>
<td>abs(a)</td>
<td>abs(a)</td>
<td>abs(a)</td>
<td></td>
</tr>
<tr>
<td>Math.Acos(a)</td>
<td>acos(a)</td>
<td>acos(a)</td>
<td>acos(a)</td>
<td>acos(a)</td>
</tr>
<tr>
<td>Math.Asin(a)</td>
<td>asin(a)</td>
<td>asin(a)</td>
<td>asin(a)</td>
<td>asin(a)</td>
</tr>
<tr>
<td>Math.Atan(a)</td>
<td>atan(a)</td>
<td>atan(a)</td>
<td>atan(a)</td>
<td>atan(a)</td>
</tr>
<tr>
<td>Math.Atan2(a, b)</td>
<td>atan2(a, b)</td>
<td>atan2(a, b)</td>
<td>atan2(a, b)</td>
<td>-</td>
</tr>
<tr>
<td>Math.Ceiling(a)</td>
<td>ceiling(a)</td>
<td>ceiling(a)</td>
<td>ceiling(a)</td>
<td>ceil(a)</td>
</tr>
<tr>
<td>Math.Cos(a)</td>
<td>cos(a)</td>
<td>cos(a)</td>
<td>cos(a)</td>
<td>cos(a)</td>
</tr>
<tr>
<td>Math.Exp(a)</td>
<td>exp(a)</td>
<td>exp(a)</td>
<td>exp(a)</td>
<td>exp(a)</td>
</tr>
<tr>
<td>Math.Floor(a)</td>
<td>floor(a)</td>
<td>floor(a)</td>
<td>floor(a)</td>
<td>floor(a)</td>
</tr>
<tr>
<td>Math.Log(a)</td>
<td>log(a)</td>
<td>log(a)</td>
<td>log(a)</td>
<td>log(e,a)</td>
</tr>
<tr>
<td>Math.Log10(a)</td>
<td>log10(a)</td>
<td>log10(a)</td>
<td>log10(a)</td>
<td>log(10,a)</td>
</tr>
<tr>
<td>Math.PI(a)</td>
<td>3.1415926535897931</td>
<td>3.1415926535897931</td>
<td>3.1415926535897931</td>
<td>3.1415926535897931</td>
</tr>
<tr>
<td>Math.Pow(a, b)</td>
<td>pow(a, b)</td>
<td>power(a, b)</td>
<td>pow(a, b)</td>
<td>power(a, b)</td>
</tr>
<tr>
<td>Math.Round(a, b)</td>
<td>round(a, b)</td>
<td>round(a, b)</td>
<td>round(a, b)</td>
<td>round(a, b)</td>
</tr>
<tr>
<td>Math.Sign(a)</td>
<td>sign(a)</td>
<td>sign(a)</td>
<td>sign(a)</td>
<td>sign(a)</td>
</tr>
<tr>
<td>Math.Sin(a)</td>
<td>sin(a)</td>
<td>sin(a)</td>
<td>sin(a)</td>
<td>sin(a)</td>
</tr>
<tr>
<td>Math.Sqrt(a)</td>
<td>sqrt(a)</td>
<td>sqrt(a)</td>
<td>sqrt(a)</td>
<td>sqrt(a)</td>
</tr>
<tr>
<td>Math.Tan(a)</td>
<td>tan(a)</td>
<td>tan(a)</td>
<td>tan(a)</td>
<td>tan(a)</td>
</tr>
<tr>
<td>Math.Truncate(a)</td>
<td>truncate(a, 0)</td>
<td>floor(a)</td>
<td>trunc(a, 0)</td>
<td>trunc(a, 0)</td>
</tr>
</tbody>
</table>
<h3 id="ç±»å‹è½¬æ¢" tabindex="-1"> ç±»å‹è½¬æ¢</h3>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>MySql</th>
<th>SqlServer</th>
<th>PostgreSQL</th>
<th>Oracle</th>
<th>Sqlite</th>
</tr>
</thead>
<tbody>
<tr>
<td>Convert.ToBoolean(a) | bool.Parse(a)</td>
<td>a not in ('0','false')</td>
<td>a not in ('0','false')</td>
<td>a::varchar not in ('0','false','f','no')</td>
<td>-</td>
<td>a not in ('0','false')</td>
</tr>
<tr>
<td>Convert.ToByte(a) | byte.Parse(a)</td>
<td>cast(a as unsigned)</td>
<td>cast(a as tinyint)</td>
<td>a::int2</td>
<td>cast(a as number)</td>
<td>cast(a as int2)</td>
</tr>
<tr>
<td>Convert.ToChar(a)</td>
<td>substr(cast(a as char),1,1)</td>
<td>substring(cast(a as nvarchar),1,1)</td>
<td>substr(a::char,1,1)</td>
<td>substr(to_char(a),1,1)</td>
<td>substr(cast(a as character),1,1)</td>
</tr>
<tr>
<td>Convert.ToDateTime(a) | DateTime.Parse(a)</td>
<td>cast(a as datetime)</td>
<td>cast(a as datetime)</td>
<td>a::timestamp</td>
<td>to_timestamp(a,'YYYY-MM-DD HH24:MI:SS.FF6')</td>
<td>datetime(a)</td>
</tr>
<tr>
<td>Convert.ToDecimal(a) | decimal.Parse(a)</td>
<td>cast(a as decimal(36,18))</td>
<td>cast(a as decimal(36,19))</td>
<td>a::numeric</td>
<td>cast(a as number)</td>
<td>cast(a as decimal(36,18))</td>
</tr>
<tr>
<td>Convert.ToDouble(a) | double.Parse(a)</td>
<td>cast(a as decimal(32,16))</td>
<td>cast(a as decimal(32,16))</td>
<td>a::float8</td>
<td>cast(a as number)</td>
<td>cast(a as double)</td>
</tr>
<tr>
<td>Convert.ToInt16(a) | short.Parse(a)</td>
<td>cast(a as signed)</td>
<td>cast(a as smallint)</td>
<td>a::int2</td>
<td>cast(a as number)</td>
<td>cast(a as smallint)</td>
</tr>
<tr>
<td>Convert.ToInt32(a) | int.Parse(a)</td>
<td>cast(a as signed)</td>
<td>cast(a as int)</td>
<td>a::int4</td>
<td>cast(a as number)</td>
<td>cast(a as smallint)</td>
</tr>
<tr>
<td>Convert.ToInt64(a) | long.Parse(a)</td>
<td>cast(a as signed)</td>
<td>cast(a as bigint)</td>
<td>a::int8</td>
<td>cast(a as number)</td>
<td>cast(a as smallint)</td>
</tr>
<tr>
<td>Convert.ToSByte(a) | sbyte.Parse(a)</td>
<td>cast(a as signed)</td>
<td>cast(a as tinyint)</td>
<td>a::int2</td>
<td>cast(a as number)</td>
<td>cast(a as smallint)</td>
</tr>
<tr>
<td>Convert.ToSingle(a) | float.Parse(a)</td>
<td>cast(a as decimal(14,7))</td>
<td>cast(a as decimal(14,7))</td>
<td>a::float4</td>
<td>cast(a as number)</td>
<td>cast(a as float)</td>
</tr>
<tr>
<td>Convert.ToString(a)</td>
<td>cast(a as char)</td>
<td>cast(a as nvarchar)</td>
<td>a::varchar</td>
<td>to_char(a)</td>
<td>cast(a as character)</td>
</tr>
<tr>
<td>Convert.ToUInt16(a) | ushort.Parse(a)</td>
<td>cast(a as unsigned)</td>
<td>cast(a as smallint)</td>
<td>a::int2</td>
<td>cast(a as number)</td>
<td>cast(a as unsigned)</td>
</tr>
<tr>
<td>Convert.ToUInt32(a) | uint.Parse(a)</td>
<td>cast(a as unsigned)</td>
<td>cast(a as int)</td>
<td>a::int4</td>
<td>cast(a as number)</td>
<td>cast(a as decimal(10,0))</td>
</tr>
<tr>
<td>Convert.ToUInt64(a) | ulong.Parse(a)</td>
<td>cast(a as unsigned)</td>
<td>cast(a as bigint)</td>
<td>a::int8</td>
<td>cast(a as number)</td>
<td>cast(a as decimal(21,0))</td>
</tr>
<tr>
<td>Guid.Parse(a)</td>
<td>substr(cast(a as char),1,36)</td>
<td>cast(a as uniqueidentifier)</td>
<td>a::uuid</td>
<td>substr(to_char(a),1,36)</td>
<td>substr(cast(a as character),1,36)</td>
</tr>
<tr>
<td>Guid.NewGuid()</td>
<td>-</td>
<td>newid()</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>new Random().NextDouble()</td>
<td>rand()</td>
<td>rand()</td>
<td>random()</td>
<td>dbms_random.value</td>
<td>random()</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">è¿‡æ»¤å™¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/filters.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/filters.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è¿‡æ»¤å™¨" tabindex="-1"> è¿‡æ»¤å™¨</h1>
<p>FreeSql åŸºç¡€å±‚å®ç°äº† Select/Update/Delete å¯è®¾ç½®çš„å…¨å±€è¿‡æ»¤å™¨åŠŸèƒ½ã€‚</p>
<div><pre><code><span>public</span> <span>static</span> <span>AsyncLocal<span>&lt;</span>Guid<span>></span></span> TenantId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>=</span> <span>new</span> <span>AsyncLocal<span>&lt;</span>Guid<span>></span></span><span>(</span><span>)</span><span>;</span>

fsql<span>.</span>GlobalFilter
    <span>.</span><span><span>Apply</span><span><span>&lt;</span>TestAddEnum<span>></span></span></span><span>(</span><span>"test1"</span><span>,</span> a <span>=></span> a<span>.</span>Id <span>==</span> TenantId<span>.</span>Value<span>)</span>
    <span>.</span><span><span>Apply</span><span><span>&lt;</span>AuthorTest<span>></span></span></span><span>(</span><span>"test2"</span><span>,</span> a <span>=></span> a<span>.</span>Id <span>==</span> <span>111</span><span>)</span>
    <span>.</span><span><span>Apply</span><span><span>&lt;</span>AuthorTest<span>></span></span></span><span>(</span><span>"test3"</span><span>,</span> a <span>=></span> a<span>.</span>Name <span>==</span> <span>"11"</span><span>)</span>
    <span>.</span><span><span>ApplyIf</span><span><span>&lt;</span>TestAddEnum<span>></span></span></span><span>(</span><span>"test4"</span><span>,</span> <span>(</span><span>)</span> <span>=></span> TenantId<span>.</span>Value <span>!=</span> Guid<span>.</span>Empty<span>,</span> a <span>=></span> a<span>.</span>Id <span>==</span> TenantId<span>.</span>Value<span>)</span><span>;</span>
    <span>//1.9.0 ApplyIf å§”æ‰˜çš„è¿”å›å€¼(ç¬¬äºŒä¸ªå‚æ•°) true æ‰ç”Ÿæ•ˆ</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>Apply æ³›å‹å‚æ•°å¯ä»¥è®¾ç½®ä¸ºä»»ä½•ç±»å‹ï¼Œå½“ä½¿ç”¨ Select/Update/Delete æ–¹æ³•æ—¶ä¼šè¿›è¡Œè¿‡æ»¤å™¨åŒ¹é…å°è¯•ï¼ˆtry catchï¼‰ï¼š</p>
<ul>
<li>åŒ¹é…æˆåŠŸçš„ï¼Œå°†é™„åŠ  where æ¡ä»¶ï¼›</li>
<li>åŒ¹é…å¤±è´¥çš„ï¼Œæ ‡è®°ä¸‹æ¬¡ä¸å†åŒ¹é…ï¼Œé¿å…æ€§èƒ½æŸè€—ï¼›</li>
</ul>
<p>å¦‚ä½•ç¦ç”¨ï¼Ÿ</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>TestAddEnum<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span> <span>//æ‰€æœ‰ç”Ÿæ•ˆ</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>TestAddEnum<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>DisableGlobalFilter</span><span>(</span><span>"test1"</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span> <span>//ç¦ç”¨ test1</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>TestAddEnum<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>DisableGlobalFilter</span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span> <span>//ç¦ç”¨æ‰€æœ‰</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>fsql.Update/Delete æ–¹æ³•æ•ˆæœåŒä¸Šã€‚</p>
<h2 id="ä»“å‚¨è¿‡æ»¤å™¨" tabindex="-1"> ä»“å‚¨è¿‡æ»¤å™¨</h2>
<blockquote>
<p>æ³¨æ„ï¼šä»“å‚¨è¿‡æ»¤å™¨å±äºæ—©æœŸåŠŸèƒ½ï¼Œå¦‚æœ fsql.GlobalFilter å¤Ÿç”¨çš„è¯ï¼Œå¯ä»¥è·³è¿‡ä»¥ä¸‹å†…å®¹ã€‚</p>
</blockquote>
<p>FreeSql.Repository ä¹Ÿå®ç°äº†è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œå®ƒåœ¨æŸ¥è¯¢æ—¶è¿‡æ»¤ï¼Œåˆ é™¤/ä¿®æ”¹/æ’å…¥ç¯‡è¿˜ä¼šè¿›è¡ŒéªŒè¯æ•°æ®ï¼Œé¿å…æ•°æ®å®‰å…¨é—®é¢˜ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä»“å‚¨çš„è¿‡æ»¤å™¨ä¸ IFreeSql.GlobalFilter ä¸æ˜¯ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥åŒæ—¶ç”Ÿæ•ˆã€‚</p>
</blockquote>
<blockquote>
<p>æ¨èä½¿ç”¨ IFreeSql.GlobalFilterã€‚ä»“å‚¨è¿‡æ»¤å™¨åœ¨æ—©æœŸå‡ºçš„åŠŸèƒ½ï¼Œä¼šä¸€ç›´ä¿ç•™ã€‚</p>
</blockquote>
<p>æ¯ä¸ªä»“å‚¨å®ä¾‹éƒ½æœ‰ IDataFilter å±æ€§ï¼Œå¯åˆ©ç”¨å…¶å®Œæˆè¿‡æ»¤å™¨ç®¡ç†ï¼Œå®ƒæ˜¯ç‹¬ç«‹çš„ä¿®æ”¹åä¸å½±å“å…¨å±€ã€‚</p>
<div><pre><code><span>public</span> <span>interface</span> <span>IDataFilter<span>&lt;</span>TEntity<span>></span></span> <span>where</span> <span>TEntity</span> <span>:</span> <span><span>class</span></span> <span>{</span>
    <span>IDataFilter<span>&lt;</span>TEntity<span>></span></span> <span>Apply</span><span>(</span><span><span>string</span></span> filterName<span>,</span> <span>Expression<span>&lt;</span>Func<span>&lt;</span>TEntity<span>,</span> <span>bool</span><span>></span><span>></span></span> filterAndValidateExp<span>)</span><span>;</span>

    <span>IDisposable</span> <span>Enable</span><span>(</span><span>params</span> <span><span>string</span><span>[</span><span>]</span></span> filterName<span>)</span><span>;</span>
    <span>IDisposable</span> <span>EnableAll</span><span>(</span><span>)</span><span>;</span>

    <span>IDisposable</span> <span>Disable</span><span>(</span><span>params</span> <span><span>string</span><span>[</span><span>]</span></span> filterName<span>)</span><span>;</span>
    <span>IDisposable</span> <span>DisableAll</span><span>(</span><span>)</span><span>;</span>

    <span><span>bool</span></span> <span>IsEnabled</span><span>(</span><span><span>string</span></span> filterName<span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="ä¸´æ—¶ç¦ç”¨" tabindex="-1"> ä¸´æ—¶ç¦ç”¨</h2>
<div><pre><code><span>using</span> <span>(</span>repo1<span>.</span>DataFilter<span>.</span><span>Disable</span><span>(</span><span>"test"</span><span>)</span><span>)</span> <span>{</span>
    <span>//åœ¨è¿™æ®µä¸­ï¼Œrepo1 ä¹‹ test è¿‡æ»¤å™¨å¤±æ•ˆ</span>
<span>}</span>

<span>//repo1 ä¹‹ test è¿‡æ»¤å™¨é‡æ–°ç”Ÿæ•ˆ</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="è¿‡æ»¤ä¸éªŒè¯" tabindex="-1"> è¿‡æ»¤ä¸éªŒè¯</h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰ User(ç”¨æˆ·)ã€Topic(ä¸»é¢˜)ä¸¤ä¸ªå®ä½“ï¼Œåœ¨é¢†åŸŸç±»ä¸­å®šä¹‰äº†ä¸¤ä¸ªä»“å‚¨ï¼š</p>
<div><pre><code><span><span>var</span></span> userRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> topicRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ€»æ˜¯æ‹…å¿ƒ topicRepository çš„æ•°æ®å®‰å…¨é—®é¢˜ï¼Œå³æœ‰å¯èƒ½æŸ¥è¯¢æˆ–æ“ä½œåˆ°å…¶ä»–ç”¨æˆ·çš„ä¸»é¢˜ã€‚å› æ­¤æˆ‘ä»¬åœ¨ v0.0.7 ç‰ˆæœ¬è¿›è¡Œäº†æ”¹è¿›ï¼Œå¢åŠ äº† filter lambda è¡¨è¾¾å¼å‚æ•°ã€‚</p>
<div><pre><code><span><span>var</span></span> userRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>;</span>
<span><span>var</span></span> topicRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span>a <span>=></span> a<span>.</span>UserId <span>==</span> <span>1</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><ul>
<li>åœ¨æŸ¥è¯¢/ä¿®æ”¹/åˆ é™¤æ—¶é™„åŠ æ­¤æ¡ä»¶ï¼Œä»è€Œè¾¾åˆ°ä¸ä¼šä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„æ•°æ®ï¼›</li>
<li>åœ¨æ·»åŠ æ—¶ï¼Œä½¿ç”¨è¡¨è¾¾å¼éªŒè¯æ•°æ®çš„åˆæ³•æ€§ï¼Œè‹¥ä¸åˆæ³•åˆ™æŠ›å‡ºå¼‚å¸¸ï¼›</li>
</ul>
<h2 id="å…¨å±€è¿‡æ»¤å™¨" tabindex="-1"> å…¨å±€è¿‡æ»¤å™¨</h2>
<p>å…¨å±€è¿‡æ»¤å™¨ï¼Œå¯å¸®åŠ©å®ç°â€œè½¯åˆ é™¤â€ã€â€œç§Ÿæˆ·â€ç­‰è®¾è®¡ï¼Œç›®å‰ä½¿ç”¨ AspNetCore æ³¨å…¥çš„æ–¹å¼å®ç°çš„å…¨å±€è¿‡æ»¤å™¨ã€‚</p>
<div><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span> <span>{</span>

    services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>Fsql<span>)</span><span>;</span>
    services<span>.</span><span>AddFreeRepository</span><span>(</span>filter <span>=></span> filter
        <span>.</span><span><span>Apply</span><span><span>&lt;</span>ISoftDelete<span>></span></span></span><span>(</span><span>"SoftDelete"</span><span>,</span> a <span>=></span> a<span>.</span>IsDeleted <span>==</span> <span>false</span><span>)</span>
        <span>.</span><span><span>Apply</span><span><span>&lt;</span>ITenant<span>></span></span></span><span>(</span><span>"Tenant"</span><span>,</span> a <span>=></span> a<span>.</span>TenantId <span>==</span> <span>1</span><span>)</span>
        <span>.</span><span><span>Apply</span><span><span>&lt;</span>ITenant<span>></span></span></span><span>(</span><span>"Song"</span><span>,</span> a <span>=></span> a<span>.</span>TenantId <span>==</span> <span>1</span><span>)</span>
        <span>,</span>
        <span>this</span><span>.</span><span>GetType</span><span>(</span><span>)</span><span>.</span>Assembly
    <span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>æ¯” abpvnext è¿˜è¦æ–¹ä¾¿ï¼Œå› ä¸º abp çš„ç›¸å…³å®ä½“éœ€è¦å®ç°æ¥å£ ISoftDeleteã€ITenantï¼›</p>
<p>æˆ‘ä»¬æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œåªè¦è¿‡æ»¤å™¨çš„è¡¨è¾¾å¼è§£ææˆåŠŸï¼Œå°±ç®—å¯ç”¨ï¼›</p>
<p>ä½¿ç”¨åœ¨ä»»ä½•å®ä½“ä¸Šçš„æ—¶å€™ï¼Œåªè¦ [å®ä½“].IsDeleted == false èƒ½è§£æèƒ½è¿‡ï¼Œå°±ç®—å¯ç”¨ï¼›</p>
<div><pre><code><span>public</span> <span>class</span> <span>xxxx</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>Song</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>//åœ¨æ§åˆ¶å™¨ä½¿ç”¨</span>
<span>public</span> <span>SongsController</span><span>(</span><span>IBaseRepository<span>&lt;</span>Song<span>></span></span> repo1<span>,</span> <span>IBaseRepository<span>&lt;</span>xxxx<span>></span></span> repos2<span>)</span> <span>{</span>
    <span>//åœ¨æ­¤æ‰“æ–­ç‚¹ï¼Œè°ƒè¯•</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p>ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼š</p>
<p>repo1.Select.ToSql()</p>
<div><pre><code><span>"SELECT a."</span>Id<span>", a."</span>Title<span>"  FROM "</span>Song<span>" a WHERE (a."</span>Title<span>" = strftime('%Y-%m-%d %H:%M.%f',datetime(current_timestamp,'localtime')) || 21)"</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>repos2.Select.ToSql()</p>
<div><pre><code><span>"SELECT a."</span>Id<span>"  FROM "</span>xxxx<span>" a"</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ç¬¬äºŒæ¬¡è¯·æ±‚ï¼š</p>
<p>repo1.Select.ToSql()</p>
<div><pre><code><span>"SELECT a."</span>Id<span>", a."</span>Title<span>"  FROM "</span>Song<span>" a  WHERE (a."</span>Title<span>" = strftime('%Y-%m-%d %H:%M.%f',datetime(current_timestamp,'localtime')) || 4)"</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>repos2.Select.ToSql()</p>
<div><pre><code><span>"SELECT a."</span>Id<span>"  FROM "</span>xxxx<span>" a"</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>//ç¦ç”¨è¿‡æ»¤å™¨
repo1.DataFilter.Disable(&quot;test&quot;)</p>
<p>repo1.Select.ToSql()</p>
<div><pre><code> <span>"SELECT a."</span>Id<span>", a."</span>Title<span>"  FROM "</span>Song<span>" a"</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>1ã€æ³¨å…¥çš„å˜é‡å€¼åœ¨ä½¿ç”¨æ—¶æœ‰äº†åŠ¨æ€å˜åŒ–ï¼Œæ¯æ¬¡è·å–æ—¶éƒ½æ˜¯æ–°çš„ï¼ˆThread.CurrentThread.ManagedThreadIdï¼‰ï¼›</p>
<p>2ã€è®¾å®šçš„å…¨å±€è¿‡æ»¤ï¼Œè‹¥æŸå®ä½“ä¸å­˜åœ¨è¡¨è¾¾å¼å‡½æ•°ä¸­çš„å­—æ®µæ—¶ï¼Œä¸ä¼šç”Ÿæ•ˆï¼ˆå¦‚ä¸Š xxxx ä¸å­˜åœ¨ Titleï¼‰ï¼›</p>
<p>3ã€ä½¿ç”¨ DataFilter.Disable(&quot;test&quot;) å¯ä¸´æ—¶å…³é—­è¿‡æ»¤å™¨çš„æ•ˆæœï¼Œä½¿ç”¨ DataFilter.Enable(&quot;test&quot;) å¯é‡æ–°å¼€å¯ï¼›</p>
<p>4ã€ä»“å‚¨å¯¹è±¡åˆ›å»ºæ—¶ï¼Œä»å…¨å±€è¿‡æ»¤å™¨ copy è¿›æ¥ï¼Œç„¶åè‡ªå·±ç®¡ç†è‡ªå·±ã€‚ä¿®æ”¹åä¸å½±å“å…¶ä»–æˆ–å…¨å±€è®¾ç½®ã€‚</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">æµå¼æ¥å£</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/fluent-api.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/fluent-api.html"/>
    <updated>2022-05-17T06:09:12.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æµå¼æ¥å£" tabindex="-1"> æµå¼æ¥å£</h1>
<h2 id="æ”¯æŒ-fluent-api" tabindex="-1"> æ”¯æŒ Fluent API</h2>
<p>FreeSql æä¾›äº† Fluent Api çš„æ–¹å¼,ä½¿ç”¨é“¾å¼è°ƒç”¨ï¼Œå¯åœ¨å¤–éƒ¨é…ç½®å®ä½“çš„æ•°æ®åº“ç‰¹æ€§ã€‚<code>Fluent Api</code> çš„æ–¹æ³•å‘½åä¸ç‰¹æ€§åä¿æŒä¸€è‡´ï¼Œå…±ä¸‰ç§ä½¿ç”¨æ–¹æ³•ï¼Œé€‰æ‹©<strong>ä¸€ç§å³å¯</strong>ï¼š</p>
<blockquote>
<p>fsql æ˜¯ä¸€ä¸ª IFreeSql å¯¹è±¡ã€é…ç½®å°½é‡åªæ‰§è¡Œä¸€æ¬¡ï¼Œé¿å…æ€§èƒ½æŸè€— å‚è€ƒï¼š<a href="/guide/entity-attribute.html">ã€Šå®ä½“ç‰¹æ€§è¯´æ˜ã€‹</a></p>
</blockquote>
<h2 id="configentity" tabindex="-1"> ConfigEntity</h2>
<div><pre><code>fsql<span>.</span>CodeFirst
    <span>.</span><span><span>ConfigEntity</span><span><span>&lt;</span>TestFluenttb1<span>></span></span></span><span>(</span>a <span>=></span>
    <span>{</span>
        a<span>.</span><span>Name</span><span>(</span><span>"xxdkdkdk1"</span><span>)</span><span>;</span>
        a<span>.</span><span>Property</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>.</span><span>Name</span><span>(</span><span>"Id22"</span><span>)</span><span>.</span><span>IsIdentity</span><span>(</span><span>true</span><span>)</span><span>;</span>
        a<span>.</span><span>Property</span><span>(</span>b <span>=></span> b<span>.</span>name<span>)</span><span>.</span><span>DbType</span><span>(</span><span>"varchar(100)"</span><span>)</span><span>.</span><span>IsNullable</span><span>(</span><span>true</span><span>)</span><span>;</span>
    <span>}</span><span>)</span>
    <span>.</span><span><span>ConfigEntity</span><span><span>&lt;</span>TestFluenttb2<span>></span></span></span><span>(</span>a <span>=></span>
    <span>{</span>
        a<span>.</span><span>Name</span><span>(</span><span>"xxdkdkdk2"</span><span>)</span><span>;</span>
        a<span>.</span><span>Property</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>.</span><span>Name</span><span>(</span><span>"Id22"</span><span>)</span><span>.</span><span>IsIdentity</span><span>(</span><span>true</span><span>)</span><span>;</span>
        a<span>.</span><span>Property</span><span>(</span>b <span>=></span> b<span>.</span>name<span>)</span><span>.</span><span>DbType</span><span>(</span><span>"varchar(100)"</span><span>)</span><span>.</span><span>IsNullable</span><span>(</span><span>true</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>

<span>//ä»¥ä¸‹ä¸ºå®ä½“ç±»</span>
<span>class</span> <span>TestFluenttb1</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>=</span> <span>"defaultValue"</span><span>;</span>
<span>}</span>

<span>[</span><span><span>Table</span><span><span>(</span>Name <span>=</span> <span>"cccccdddwww"</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>TestFluenttb2</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>=</span> <span>"defaultValue"</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div><blockquote>
<p>FreeSql.DbContext v1.4.0+ å®ç°äº† EfCore FluentApi 99% ç›¸ä¼¼çš„è¯­æ³•</p>
</blockquote>
<h2 id="entity" tabindex="-1"> Entity</h2>
<div><pre><code>fsql<span>.</span>CodeFirst<span>.</span><span><span>Entity</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span>eb <span>=></span> <span>{</span>
    eb<span>.</span><span>ToTable</span><span>(</span><span>"tb_song"</span><span>)</span><span>;</span>
    eb<span>.</span><span>Ignore</span><span>(</span>a <span>=></span> a<span>.</span>Field1<span>)</span><span>;</span>
    eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>)</span><span>.</span><span>HasColumnType</span><span>(</span><span>"varchar(50)"</span><span>)</span><span>.</span><span>IsRequired</span><span>(</span><span>)</span><span>;</span>
    eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>Url<span>)</span><span>.</span><span>HasMaxLength</span><span>(</span><span>100</span><span>)</span><span>;</span>

    eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>RowVersion<span>)</span><span>.</span><span>IsRowVersion</span><span>(</span><span>)</span><span>;</span>
    eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>)</span><span>.</span><span>HasDefaultValueSql</span><span>(</span><span>"current_timestamp"</span><span>)</span><span>;</span>

    eb<span>.</span><span>HasKey</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>;</span>
    eb<span>.</span><span>HasIndex</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Id<span>,</span> a<span>.</span>Title <span>}</span><span>)</span><span>.</span><span>IsUnique</span><span>(</span><span>)</span><span>.</span><span>HasName</span><span>(</span><span>"idx_xxx11"</span><span>)</span><span>;</span>

    <span>//ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€</span>
    eb<span>.</span><span>HasOne</span><span>(</span>a <span>=></span> a<span>.</span>Type<span>)</span><span>.</span><span>HasForeignKey</span><span>(</span>a <span>=></span> a<span>.</span>TypeId<span>)</span><span>.</span><span>WithMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>)</span><span>;</span>

    <span>//å¤šå¯¹å¤š</span>
    eb<span>.</span><span>HasMany</span><span>(</span>a <span>=></span> a<span>.</span>Tags<span>)</span><span>.</span><span>WithMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>,</span> <span>typeof</span><span>(</span><span>Song_tag</span><span>)</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

fsql<span>.</span>CodeFirst<span>.</span><span><span>Entity</span><span><span>&lt;</span>SongType<span>></span></span></span><span>(</span>eb <span>=></span> <span>{</span>
    eb<span>.</span><span>HasMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>)</span><span>.</span><span>WithOne</span><span>(</span>a <span>=></span> a<span>.</span>Type<span>)</span><span>.</span><span>HasForeignKey</span><span>(</span>a <span>=></span> a<span>.</span>TypeId<span>)</span><span>;</span>
    eb<span>.</span><span>HasData</span><span>(</span><span>new</span><span>[</span><span>]</span>
    <span>{</span>
        <span>new</span> <span>SongType</span>
        <span>{</span>
            Id <span>=</span> <span>1</span><span>,</span>
            Name <span>=</span> <span>"æµè¡Œ"</span><span>,</span>
            Songs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                <span>new</span> <span>Song</span><span>{</span> Title <span>=</span> <span>"çœŸçš„çˆ±ä½ "</span> <span>}</span><span>,</span>
                <span>new</span> <span>Song</span><span>{</span> Title <span>=</span> <span>"çˆ±ä½ ä¸€ä¸‡å¹´"</span> <span>}</span><span>,</span>
            <span>}</span><span>)</span>
        <span>}</span><span>,</span>
        <span>new</span> <span>SongType</span>
        <span>{</span>
            Id <span>=</span> <span>2</span><span>,</span>
            Name <span>=</span> <span>"ä¹¡æ‘"</span><span>,</span>
            Songs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span>
            <span>{</span>
                <span>new</span> <span>Song</span><span>{</span> Title <span>=</span> <span>"ä¹¡é‡Œä¹¡äº²"</span> <span>}</span><span>,</span>
            <span>}</span><span>)</span>
        <span>}</span><span>,</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

<span>public</span> <span>class</span> <span>SongType</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>List<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>Song</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Url <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> TypeId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>SongType</span> Type <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> Field1 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>long</span></span> RowVersion <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br></div></div><h2 id="ientitytypeconfiguration" tabindex="-1"> IEntityTypeConfiguration</h2>
<p>ä»¥ç»§æ‰¿æ¥å£<code>IEntityTypeConfiguration</code>å½¢å¼é…ç½®å®ä½“çš„ã€‚</p>
<ul>
<li>.NET Framework4.0 ä¸æ”¯æŒ</li>
</ul>
<h3 id="å®ä½“é…ç½®ç±»" tabindex="-1"> å®ä½“é…ç½®ç±»</h3>
<div><pre><code><span>public</span> <span>class</span> <span>SongConfiguration</span> <span>:</span> <span><span>IEntityTypeConfiguration<span>&lt;</span>Song<span>></span></span></span>
<span>{</span>
    <span>public</span> <span><span>void</span></span> <span>Configure</span><span>(</span><span>EfCoreTableFluent<span>&lt;</span>Song<span>></span></span> eb<span>)</span>
    <span>{</span>
        eb<span>.</span><span>ToTable</span><span>(</span><span>"tb_song1"</span><span>)</span><span>;</span>
        eb<span>.</span><span>Ignore</span><span>(</span>a <span>=></span> a<span>.</span>Field1<span>)</span><span>;</span>
        eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>)</span><span>.</span><span>HasColumnType</span><span>(</span><span>"varchar(50)"</span><span>)</span><span>.</span><span>IsRequired</span><span>(</span><span>)</span><span>;</span>
        eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>Url<span>)</span><span>.</span><span>HasMaxLength</span><span>(</span><span>100</span><span>)</span><span>;</span>

        eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>RowVersion<span>)</span><span>.</span><span>IsRowVersion</span><span>(</span><span>)</span><span>;</span>
        eb<span>.</span><span>Property</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>)</span><span>.</span><span>HasDefaultValueSql</span><span>(</span><span>"current_timestamp"</span><span>)</span><span>;</span>

        eb<span>.</span><span>HasKey</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>;</span>
        eb<span>.</span><span>HasIndex</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>)</span><span>.</span><span>IsUnique</span><span>(</span><span>)</span><span>.</span><span>HasName</span><span>(</span><span>"idx_tb_song1111"</span><span>)</span><span>;</span>

        <span>//ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€</span>
        eb<span>.</span><span>HasOne</span><span>(</span>a <span>=></span> a<span>.</span>Type<span>)</span><span>.</span><span>HasForeignKey</span><span>(</span>a <span>=></span> a<span>.</span>TypeId<span>)</span><span>.</span><span>WithMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>)</span><span>;</span>

        <span>//å¤šå¯¹å¤š</span>
        eb<span>.</span><span>HasMany</span><span>(</span>a <span>=></span> a<span>.</span>Tags<span>)</span><span>.</span><span>WithMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>,</span> <span>typeof</span><span>(</span><span>Song_tag</span><span>)</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br></div></div><h3 id="äºŒç§ä½¿ç”¨æ–¹å¼" tabindex="-1"> äºŒç§ä½¿ç”¨æ–¹å¼</h3>
<p>1.å•ä¸ªé…ç½®</p>
<div><pre><code>fsql<span>.</span>CodeFirst<span>.</span><span>ApplyConfiguration</span><span>(</span><span>new</span> <span>SongConfiguration</span><span>(</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>2.æ‰¹é‡é…ç½®</p>
<div><pre><code>fsql<span>.</span>CodeFirst<span>.</span><span>ApplyConfigurationsFromAssembly</span><span>(</span><span>typeof</span><span>(</span><span>SongConfiguration</span><span>)</span><span>.</span>Assembly<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="ä¼˜å…ˆçº§" tabindex="-1"> ä¼˜å…ˆçº§</h2>
<p>æ•°æ®åº“ç‰¹æ€§ &gt; å®ä½“ç‰¹æ€§ &gt; FluentApiï¼ˆé…ç½®ç‰¹æ€§ï¼‰ &gt; Aopï¼ˆé…ç½®ç‰¹æ€§ï¼‰</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">å…¥é—¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/getting-started.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/getting-started.html"/>
    <updated>2022-06-01T06:25:44.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å…¥é—¨" tabindex="-1"> å…¥é—¨</h1>
<h2 id="æ¨¡å‹" tabindex="-1"> æ¨¡å‹</h2>
<p><code>FreeSql</code> ä½¿ç”¨æ¨¡å‹æ‰§è¡Œæ•°æ®è®¿é—®ï¼Œæ¨¡å‹ç”±å®ä½“ç±»è¡¨ç¤ºæ•°æ®åº“è¡¨æˆ–è§†å›¾ï¼Œç”¨äºæŸ¥è¯¢å’Œä¿å­˜æ•°æ®ã€‚</p>
<p>å¯ä»ç°æœ‰æ•°æ®åº“ç”Ÿæˆå®ä½“æ¨¡å‹ï¼Œ<code>FreeSql</code> æä¾› <code>IDbFirst</code> æ¥å£å®ç°<a href="/guide/db-first.html">ç”Ÿæˆå®ä½“æ¨¡å‹</a>ã€‚</p>
<p>æˆ–è€…æ‰‹åŠ¨åˆ›å»ºæ¨¡å‹ï¼ŒåŸºäºæ¨¡å‹åˆ›å»ºæˆ–ä¿®æ”¹æ•°æ®åº“ï¼Œæä¾› <code>ICodeFirst</code> åŒæ­¥ç»“æ„çš„ <code>API</code>ï¼ˆç”šè‡³å¯ä»¥åšåˆ°å¼€å‘é˜¶æ®µè‡ªåŠ¨åŒæ­¥ï¼‰ã€‚</p>
<div><pre><code><span>using</span> <span>FreeSql<span>.</span>DataAnnotations</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>

<span>public</span> <span>class</span> <span>Blog</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Url <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Rating <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="å®‰è£…åŒ…" tabindex="-1"> å®‰è£…åŒ…</h2>
<p>FreeSql.Provider.xxx(<a href="/guide/install.html">å¯é€‰çš„é©±åŠ¨</a>)</p>
<CodeGroup>
<CodeGroupItem title=".NET CLI">
<div><pre><code>dotnet <span>add</span> packages FreeSql
dotnet <span>add</span> packages FreeSql.Provider.Sqlite
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div></CodeGroupItem>
<CodeGroupItem title="Package Manager">
<div><pre><code>Install-Package FreeSql
Install-Package FreeSql.Provider.Sqlite
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div></CodeGroupItem>
</CodeGroup>
<h2 id="å£°æ˜" tabindex="-1"> å£°æ˜</h2>
<div><pre><code><span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>@"Data Source=db1.db"</span><span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“ï¼ŒFreeSqlä¸ä¼šæ‰«æç¨‹åºé›†ï¼Œåªæœ‰CRUDæ—¶æ‰ä¼šç”Ÿæˆè¡¨ã€‚</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

    <span>//æ³¨æ„ï¼š IFreeSql åœ¨é¡¹ç›®ä¸­åº”ä»¥å•ä¾‹å£°æ˜ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™åˆ›å»ºã€‚</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><ul>
<li>.NET Core å•ä¾‹
Startup.cs</li>
</ul>
<div><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
    <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
      <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>@"Data Source=db1.db"</span><span>)</span>
      <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“ï¼ŒFreeSqlä¸ä¼šæ‰«æç¨‹åºé›†ï¼Œåªæœ‰CRUDæ—¶æ‰ä¼šç”Ÿæˆè¡¨ã€‚</span>
      <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
    services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>fsql<span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><ul>
<li><a href="https://github.com/dotnetcore/FreeSql/issues/44" target="_blank" rel="noopener noreferrer">.NET Core æ³¨å…¥å¤šä¸ª FreeSql å®ä¾‹</a></li>
<li>.NET Framework å•ä¾‹</li>
</ul>
<div><pre><code><span>public</span> <span>class</span> <span>DB</span>
<span>{</span>
   <span>static</span> Lazy<span>&lt;</span>IFreeSql<span>></span>sqliteLazy <span>=</span> <span>new</span> <span>Lazy<span>&lt;</span>IFreeSql<span>></span></span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
         <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>@"Data Source=db1.db"</span><span>)</span>
         <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“ï¼ŒFreeSqlä¸ä¼šæ‰«æç¨‹åºé›†ï¼Œåªæœ‰CRUDæ—¶æ‰ä¼šç”Ÿæˆè¡¨ã€‚</span>
         <span>.</span><span>Build</span><span>(</span><span>)</span><span>)</span><span>;</span>

    <span>public</span> <span>static</span> <span>IFreeSql</span> Sqlite <span>=></span> sqliteLazy<span>.</span>Value<span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><p><code>IFreeSql</code> æ˜¯ <code>ORM</code> æœ€é¡¶çº§å¯¹è±¡ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯ä½¿ç”¨å®ƒçš„æ–¹æ³•æˆ–è€…å±æ€§ï¼š</p>
<div><pre><code>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span> <span>//æŸ¥è¯¢</span>
fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span> <span>//æ’å…¥</span>
fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span> <span>//æ›´æ–°</span>
fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span> <span>//åˆ é™¤</span>
fsql<span>.</span><span><span>InsertOrUpdate</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>// æ’å…¥æˆ–æ›´æ–°</span>
fsql<span>.</span><span>Transaction</span><span>(</span><span>..</span><span>)</span><span>;</span> <span>//äº‹åŠ¡</span>

fsql<span>.</span>CodeFirst<span>;</span> <span>//CodeFirst å¯¹è±¡</span>
fsql<span>.</span>DbFirst<span>;</span> <span>//DbFirst å¯¹è±¡</span>
fsql<span>.</span>Ado<span>;</span> <span>//Ado å¯¹è±¡</span>
fsql<span>.</span>Aop<span>;</span> <span>//Aop å¯¹è±¡</span>
fsql<span>.</span>GlobalFilter<span>;</span> <span>//å…¨å±€è¿‡æ»¤å™¨å¯¹è±¡</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h2 id="è¿ç§»" tabindex="-1"> è¿ç§»</h2>
<p>ç¨‹åºè¿è¡Œä¸­<code>FreeSql</code>ä¼šæ£€æŸ¥<code>AutoSyncStructure</code>å‚æ•°ï¼Œä»¥æ­¤æ¡ä»¶åˆ¤æ–­æ˜¯å¦å¯¹æ¯”å®ä½“ä¸æ•°æ®åº“ç»“æ„ä¹‹é—´çš„å˜åŒ–ï¼Œè¾¾åˆ°è‡ªåŠ¨è¿ç§»çš„ç›®çš„,æ›´å¤šè¯·æŸ¥çœ‹<a href="/guide/code-first.html">CodeFirst</a>æ–‡æ¡£ï¼Œ</p>
<blockquote>
<p>æ³¨æ„ï¼šè°¨æ…ã€è°¨æ…ã€è°¨æ…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚</p>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼šè°¨æ…ã€è°¨æ…ã€è°¨æ…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚</p>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼šè°¨æ…ã€è°¨æ…ã€è°¨æ…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚</p>
</blockquote>
<h2 id="æŸ¥è¯¢" tabindex="-1"> æŸ¥è¯¢</h2>
<div><pre><code><span><span>var</span></span> blogs <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Rating <span>></span> <span>3</span><span>)</span>
    <span>.</span><span>OrderBy</span><span>(</span>b <span>=></span> b<span>.</span>Url<span>)</span>
    <span>.</span><span>Skip</span><span>(</span><span>100</span><span>)</span>
    <span>.</span><span>Limit</span><span>(</span><span>10</span><span>)</span> <span>//ç¬¬100è¡Œ-110è¡Œçš„è®°å½•</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="æ’å…¥" tabindex="-1"> æ’å…¥</h2>
<div><pre><code><span><span>var</span></span> blog <span>=</span> <span>new</span> <span>Blog</span> <span>{</span> Url <span>=</span> <span>"http://sample.com"</span> <span>}</span><span>;</span>
blog<span>.</span>BlogId <span>=</span> <span>(</span><span>int</span><span>)</span>fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>AppendData</span><span>(</span>blog<span>)</span>
    <span>.</span><span>ExecuteIdentity</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="æ›´æ–°" tabindex="-1"> æ›´æ–°</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Set</span><span>(</span>b <span>=></span> b<span>.</span>Url<span>,</span> <span>"http://sample2222.com"</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Url <span>==</span> <span>"http://sample.com"</span><span>)</span>
    <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="åˆ é™¤" tabindex="-1"> åˆ é™¤</h2>
<div><pre><code>fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Url <span>==</span> <span>"http://sample.com"</span><span>)</span>
    <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h1 id="freesqlbuilder" tabindex="-1"> FreeSqlBuilder</h1>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>UseConnectionString</td>
<td>this</td>
<td>è®¾ç½®è¿æ¥ä¸²</td>
</tr>
<tr>
<td>UseSlave</td>
<td>this</td>
<td>è®¾ç½®ä»æ•°æ®åº“ï¼Œæ”¯æŒå¤šä¸ª</td>
</tr>
<tr>
<td>UseConnectionFactory</td>
<td>this</td>
<td>è®¾ç½®è‡ªå®šä¹‰æ•°æ®åº“è¿æ¥å¯¹è±¡ï¼ˆæ”¾å¼ƒå†…ç½®å¯¹è±¡è¿æ¥æ± æŠ€æœ¯ï¼‰</td>
</tr>
<tr>
<td>UseAutoSyncStructure</td>
<td>this</td>
<td>ã€å¼€å‘ç¯å¢ƒå¿…å¤‡ã€‘è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“ï¼Œç¨‹åºè¿è¡Œä¸­æ£€æŸ¥å®ä½“åˆ›å»ºæˆ–ä¿®æ”¹è¡¨ç»“æ„</td>
</tr>
<tr>
<td>UseNoneCommandParameter</td>
<td>this</td>
<td>ä¸ä½¿ç”¨å‘½ä»¤å‚æ•°åŒ–æ‰§è¡Œï¼Œé’ˆå¯¹ Insert/Updateï¼Œä¹Ÿå¯ä¸´æ—¶ä½¿ç”¨ IInsert/IUpdate.NoneParameter()</td>
</tr>
<tr>
<td>UseGenerateCommandParameterWithLambda</td>
<td>this</td>
<td>ç”Ÿæˆå‘½ä»¤å‚æ•°åŒ–æ‰§è¡Œï¼Œé’ˆå¯¹ lambda è¡¨è¾¾å¼è§£æ</td>
</tr>
<tr>
<td>UseLazyLoading</td>
<td>this</td>
<td>å¼€å¯å»¶æ—¶åŠ è½½åŠŸèƒ½</td>
</tr>
<tr>
<td>UseMonitorCommand</td>
<td>this</td>
<td>ç›‘è§†å…¨å±€ SQL æ‰§è¡Œå‰å</td>
</tr>
<tr>
<td>UseMappingPriority</td>
<td>this</td>
<td>æŒ‡å®šæ˜ å°„ä¼˜å…ˆçº§ï¼ˆé»˜è®¤ Aop &lt; FluentApi &lt; Attributeï¼‰</td>
</tr>
<tr>
<td>UseNameConvert</td>
<td>this</td>
<td>è‡ªåŠ¨è½¬æ¢åç§° Entity -&gt; Db</td>
</tr>
<tr>
<td>UseExitAutoDisposePool</td>
<td>this</td>
<td>ç›‘å¬ AppDomain.CurrentDomain.ProcessExit/Console.CancelKeyPress äº‹ä»¶è‡ªåŠ¨é‡Šæ”¾è¿æ¥æ±  (é»˜è®¤ true)</td>
</tr>
<tr>
<td>Build&lt;T&gt;</td>
<td>IFreeSql&lt;T&gt;</td>
<td>åˆ›å»ºä¸€ä¸ª IFreeSql å¯¹è±¡ï¼Œæ³¨æ„ï¼šå•ä¾‹è®¾è®¡ï¼Œä¸è¦é‡å¤åˆ›å»º</td>
</tr>
</tbody>
</table>
<h1 id="connectionstrings" tabindex="-1"> ConnectionStrings</h1>
<table>
<thead>
<tr>
<th>DataType</th>
<th>ConnectionString</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataType.MySql</td>
<td>Data Source=127.0.0.1;Port=3306;User ID=root;Password=root; Initial Catalog=cccddd;Charset=utf8; SslMode=none;Min pool size=1</td>
</tr>
<tr>
<td>DataType.PostgreSQL</td>
<td>Host=192.168.164.10;Port=5432;Username=postgres;Password=123456; Database=tedb;Pooling=true;Minimum Pool Size=1</td>
</tr>
<tr>
<td>DataType.SqlServer</td>
<td>Data Source=.;User Id=sa;Password=123456;Initial Catalog=freesqlTest;TrustServerCertificate=true;Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.Oracle</td>
<td>user id=user1;password=123456; data source=//127.0.0.1:1521/XE;Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.Sqlite</td>
<td>Data Source=|DataDirectory|\document.db; Attachs=xxxtb.db; Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.Firebird</td>
<td>database=localhost:D:\fbdata\EXAMPLES.fdb;user=sysdba;password=123456</td>
</tr>
<tr>
<td>DataType.MsAccess</td>
<td>Provider=Microsoft.Jet.OleDb.4.0;Data Source=d:/accdb/2003.mdb</td>
</tr>
<tr>
<td>DataType.Dameng(è¾¾æ¢¦)</td>
<td>server=127.0.0.1;port=5236;user id=2user;password=123456789;database=2user;poolsize=5</td>
</tr>
<tr>
<td>DataType.ShenTong(ç¥é€š)</td>
<td>HOST=192.168.164.10;PORT=2003;DATABASE=OSRDB;USERNAME=SYSDBA;PASSWORD=szoscar55;MAXPOOLSIZE=2</td>
</tr>
<tr>
<td>DataType.KingbaseES(äººå¤§é‡‘ä»“) V008R003</td>
<td>Server=127.0.0.1;Port=54321;UID=USER2;PWD=123456789;database=TEST;MAXPOOLSIZE=2</td>
</tr>
<tr>
<td>DataType.Gbase(å—å¤§é€šç”¨)</td>
<td>Driver={GBase ODBC DRIVER (64-Bit)};Host=192.168.164.134;Service=9088;Server=gbase01;Database=testdb;Protocol=onsoctcp;Uid=gbasedbt;Pwd=GBase123;Db_locale=zh_CN.utf8;Client_locale=zh_CN.utf8</td>
</tr>
<tr>
<td>DataType.OdbcMySql</td>
<td>Driver={MySQL ODBC 8.0 Unicode Driver}; Server=127.0.0.1;Persist Security Info=False; Trusted_Connection=Yes;UID=root;PWD=root; DATABASE=cccddd_odbc;Charset=utf8; SslMode=none;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.OdbcSqlServer</td>
<td>Driver={SQL Server};Server=.;Persist Security Info=False; Trusted_Connection=Yes;Integrated Security=True; DATABASE=freesqlTest_odbc; Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.OdbcOracle</td>
<td>Driver={Oracle in XE};Server=//127.0.0.1:1521/XE; Persist Security Info=False; Trusted_Connection=Yes;UID=odbc1;PWD=123456; Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.OdbcPostgreSQL</td>
<td>Driver={PostgreSQL Unicode(x64)};Server=192.168.164.10; Port=5432;UID=postgres;PWD=123456; Database=tedb_odbc;Pooling=true;Min Pool Size=1</td>
</tr>
<tr>
<td>DataType.OdbcDameng (è¾¾æ¢¦)</td>
<td>Driver={DM8 ODBC DRIVER};Server=127.0.0.1:5236; Persist Security Info=False; Trusted_Connection=Yes; UID=USER1;PWD=123456789</td>
</tr>
<tr>
<td>DataType.OdbcKingbaseES (äººå¤§é‡‘ä»“) V008R003</td>
<td>Driver={KingbaseES 8.2 ODBC Driver ANSI};Server=127.0.0.1;Port=54321;UID=USER2;PWD=123456789;database=TEST</td>
</tr>
<tr>
<td>DataType.Odbc</td>
<td>Driver={SQL Server};Server=.;Persist Security Info=False; Trusted_Connection=Yes;Integrated Security=True; DATABASE=freesqlTest_odbc; Pooling=true;Min pool size=1</td>
</tr>
<tr>
<td><a href="https://github.com/2881099/FreeSql/tree/master/Providers/FreeSql.Provider.Custom" target="_blank" rel="noopener noreferrer">DataType.Custom</a></td>
<td>è‡ªå®šä¹‰è¿æ¥ä¸²ï¼Œè®¿é—®ä»»ä½•æ•°æ®åº“</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">æ–°å¢å’Œä¿®æ”¹</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/insert-or-update.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/insert-or-update.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æ–°å¢å’Œä¿®æ”¹" tabindex="-1"> æ–°å¢å’Œä¿®æ”¹</h1>
<h2 id="_1ã€ifreesql-insertorupdate" tabindex="-1"> 1ã€IFreeSql.InsertOrUpdate</h2>
<p>IFreeSql å®šä¹‰äº† InsertOrUpdate æ–¹æ³•å®ç°æ·»åŠ æˆ–ä¿®æ”¹çš„åŠŸèƒ½ï¼Œåˆ©ç”¨æ•°æ®åº“ç‰¹æ€§ï¼š(v1.5.0+)</p>
<table>
<thead>
<tr>
<th>Database</th>
<th>Features</th>
<th></th>
<th>Database</th>
<th>Features</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql</td>
<td>on duplicate key update</td>
<td></td>
<td>è¾¾æ¢¦</td>
<td>merge into</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>on conflict do update</td>
<td></td>
<td>äººå¤§é‡‘ä»“</td>
<td>on conflict do update</td>
</tr>
<tr>
<td>SqlServer</td>
<td>merge into</td>
<td></td>
<td>ç¥é€š</td>
<td>merge into</td>
</tr>
<tr>
<td>Oracle</td>
<td>merge into</td>
<td></td>
<td>å—å¤§é€šç”¨</td>
<td>merge into</td>
</tr>
<tr>
<td>Sqlite</td>
<td>replace into</td>
<td></td>
<td>MsAccess</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>Firebird</td>
<td>merge into</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div><pre><code>fsql<span>.</span><span><span>InsertOrUpdate</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>items<span>)</span> <span>//éœ€è¦æ“ä½œçš„æ•°æ®</span>
  <span>//.IfExistsDoNothing() //å¦‚æœæ•°æ®å­˜åœ¨ï¼Œå•¥äº‹ä¹Ÿä¸å¹²ï¼ˆç›¸å½“äºåªæœ‰ä¸å­˜åœ¨æ•°æ®æ—¶æ‰æ’å…¥ï¼‰</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å½“å®ä½“ç±»æœ‰è‡ªå¢å±æ€§æ—¶ï¼Œæ‰¹é‡ InsertOrUpdate æœ€å¤šå¯è¢«æ‹†æˆä¸¤æ¬¡æ‰§è¡Œï¼Œå†…éƒ¨è®¡ç®—å‡ºæœªè®¾ç½®è‡ªå¢å€¼ã€å’Œæœ‰è®¾ç½®è‡ªå¢å€¼çš„æ•°æ®ï¼Œåˆ†åˆ«æ‰§è¡Œ insert into å’Œ ä¸Šé¢è®²åˆ°çš„ merge into ä¸¤ç§å‘½ä»¤ï¼ˆé‡‡ç”¨äº‹åŠ¡æ‰§è¡Œï¼‰ã€‚</p>
<p>æ³¨æ„ï¼šFreeSql.Repository é€šç”¨ä»“å‚¨ä¹Ÿæœ‰ InsertOrUpdate æ–¹æ³•ï¼Œå®ƒä»¬çš„æœºåˆ¶ä¸ä¸€æ ·ã€‚</p>
<hr>
<h2 id="_2ã€å­—å…¸æ’å…¥æˆ–æ›´æ–°" tabindex="-1"> 2ã€å­—å…¸æ’å…¥æˆ–æ›´æ–°</h2>
<div><pre><code><span><span>var</span></span> dic <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"id"</span><span>,</span> <span>1</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"name"</span><span>,</span> <span>"xxxx"</span><span>)</span><span>;</span>

fsql<span>.</span><span>InsertOrUpdateDict</span><span>(</span>dic<span>)</span><span>.</span><span>AsTable</span><span>(</span><span>"table1"</span><span>)</span><span>.</span><span>WherePrimary</span><span>(</span><span>"id"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//ï¼ˆäº§ç”Ÿ SQL åŒä¸Šï¼‰</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><hr>
<h2 id="_3ã€freesql-repository-ä¹‹-insertorupdate" tabindex="-1"> 3ã€FreeSql.Repository ä¹‹ InsertOrUpdate</h2>
<p>ä½¿ç”¨æ­¤æ–¹æ³•éœ€è¦å¼•ç”¨ FreeSql.Repository æˆ– FreeSql.DbContext åŠŸèƒ½åŒ…ã€‚</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span><span>InsertOrUpdate</span><span>(</span>å®ä½“<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>å¦‚æœå†…éƒ¨çš„çŠ¶æ€ç®¡ç†å­˜åœ¨æ•°æ®ï¼Œåˆ™æ›´æ–°ã€‚</p>
<p>å¦‚æœå†…éƒ¨çš„çŠ¶æ€ç®¡ç†ä¸å­˜åœ¨æ•°æ®ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ã€‚</p>
<blockquote>
<p>å­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥</p>
</blockquote>
<p>ç¼ºç‚¹ï¼šä¸æ”¯æŒæ‰¹é‡æ“ä½œ</p>
<hr>
<h2 id="_4ã€beginedit-æ‰¹é‡ç¼–è¾‘" tabindex="-1"> 4ã€BeginEdit æ‰¹é‡ç¼–è¾‘</h2>
<div><pre><code><span>[</span><span><span>Fact</span></span><span>]</span>
<span>public</span> <span><span>void</span></span> <span>BeginEdit</span><span>(</span><span>)</span>
<span>{</span>
    fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>BeginEdit01<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>"1=1"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>BeginEdit01<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> cts <span>=</span> <span>new</span><span>[</span><span>]</span> <span>{</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»1"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»1_1"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»1_2"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»1_3"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»2"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»2_1"</span> <span>}</span><span>,</span>
        <span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»2_2"</span> <span>}</span>
    <span>}</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span><span>Insert</span><span>(</span>cts<span>)</span><span>;</span>

    repo<span>.</span><span>BeginEdit</span><span>(</span>cts<span>)</span><span>;</span> <span>//å¼€å§‹å¯¹ cts è¿›è¡Œç¼–è¾‘</span>

    cts<span>.</span><span>Add</span><span>(</span><span>new</span> <span>BeginEdit01</span> <span>{</span> Name <span>=</span> <span>"åˆ†ç±»2_3"</span> <span>}</span><span>)</span><span>;</span>
    cts<span>[</span><span>0</span><span>]</span><span>.</span>Name <span>=</span> <span>"123123"</span><span>;</span>
    cts<span>.</span><span>RemoveAt</span><span>(</span><span>1</span><span>)</span><span>;</span>

    Assert<span>.</span><span>Equal</span><span>(</span><span>3</span><span>,</span> repo<span>.</span><span>EndEdit</span><span>(</span><span>)</span><span>)</span><span>;</span>
<span>}</span>
<span>class</span> <span>BeginEdit01</span>
<span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br></div></div><p>ä¸Šé¢çš„ä»£ç  EndEdit æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™äº§ç”Ÿ 3 æ¡ SQL å¦‚ä¸‹ï¼š</p>
<div><pre><code><span>INSERT</span> <span>INTO</span> <span>"BeginEdit01"</span><span>(</span><span>"Id"</span><span>,</span> <span>"Name"</span><span>)</span> <span>VALUES</span><span>(</span><span>'5f26bf07-6ac3-cbe8-00da-7dd74818c3a6'</span><span>,</span> <span>'åˆ†ç±»2_3'</span><span>)</span>


<span>UPDATE</span> <span>"BeginEdit01"</span> <span>SET</span> <span>"Name"</span> <span>=</span> <span>'123123'</span>
<span>WHERE</span> <span>(</span><span>"Id"</span> <span>=</span> <span>'5f26bf00-6ac3-cbe8-00da-7dd01be76e26'</span><span>)</span>


<span>DELETE</span> <span>FROM</span> <span>"BeginEdit01"</span> <span>WHERE</span> <span>(</span><span>"Id"</span> <span>=</span> <span>'5f26bf00-6ac3-cbe8-00da-7dd11bcf54dc'</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>åœºæ™¯ï¼šwinform åŠ è½½è¡¨æ•°æ®åï¼Œä¸€é¡¿æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œä¹‹åï¼Œç‚¹å‡»ã€ä¿å­˜ã€‘</p>
<p>æé†’ï¼šè¯¥æ“ä½œåªå¯¹å˜é‡ cts æœ‰æ•ˆï¼Œä¸æ˜¯é’ˆå¯¹å…¨è¡¨å¯¹æ¯”æ›´æ–°ã€‚</p>
<h2 id="_5ã€mysql-ç‰¹æœ‰åŠŸèƒ½-on-duplicate-key-update" tabindex="-1"> 5ã€MySql ç‰¹æœ‰åŠŸèƒ½ On Duplicate Key Update</h2>
<p>FreeSql.Provider.MySql å’Œ FreeSql.Provider.MySqlConnector æ”¯æŒ MySql ç‰¹æœ‰çš„åŠŸèƒ½ï¼ŒOn Duplicate Key Updateã€‚</p>
<p>è¿™ä¸ªåŠŸèƒ½ä¹Ÿå¯ä»¥å®ç°æ’å…¥æˆ–æ›´æ–°æ•°æ®ï¼Œå¹¶ä¸”æ”¯æŒæ‰¹é‡æ“ä½œã€‚</p>
<div><pre><code><span>class</span> <span>TestOnDuplicateKeyUpdateInfo</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> time <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span><span>var</span></span> item <span>=</span> <span>new</span> <span>TestOnDuplicateKeyUpdateInfo</span> <span>{</span> id <span>=</span> <span>100</span><span>,</span> title <span>=</span> <span>"title-100"</span><span>,</span> time <span>=</span> DateTime<span>.</span><span>Parse</span><span>(</span><span>"2000-01-01"</span><span>)</span> <span>}</span><span>;</span>
fsql<span>.</span><span>Insert</span><span>(</span>item<span>)</span>
    <span>.</span><span>NoneParameter</span><span>(</span><span>)</span>
    <span>.</span><span>OnDuplicateKeyUpdate</span><span>(</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `TestOnDuplicateKeyUpdateInfo`(`id`, `title`, `time`) VALUES(100, 'title-100', '2000-01-01 00:00:00.000')</span>
<span>//ON DUPLICATE KEY UPDATE</span>
<span>//`title` = VALUES(`title`),</span>
<span>//`time` = VALUES(`time`)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>OnDuplicateKeyUpdate() ä¹‹åå¯ä»¥è°ƒç”¨çš„æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•å</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>IgnoreColumns</td>
<td>å¿½ç•¥æ›´æ–°çš„åˆ—ï¼Œæœºåˆ¶å’Œ IUpdate.IgnoreColumns ä¸€æ ·</td>
</tr>
<tr>
<td>UpdateColumns</td>
<td>æŒ‡å®šæ›´æ–°çš„åˆ—ï¼Œæœºåˆ¶å’Œ IUpdate.UpdateColumns ä¸€æ ·</td>
</tr>
<tr>
<td>Set</td>
<td>æ‰‹å·¥æŒ‡å®šæ›´æ–°çš„åˆ—ï¼Œä¸ IUpdate.Set åŠŸèƒ½ä¸€æ ·</td>
</tr>
<tr>
<td>SetRaw</td>
<td>ä½œä¸º Set æ–¹æ³•çš„è¡¥å……ï¼Œå¯ä¼ å…¥ SQL å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>ToSql</td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>æ‰§è¡Œï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
</tr>
</tbody>
</table>
<p>IInsert ä¸ OnDuplicateKeyUpdate éƒ½æœ‰ IgnoreColumnsã€UpdateColumns æ–¹æ³•ã€‚</p>
<p>å½“æ’å…¥å®ä½“/é›†åˆå®ä½“çš„æ—¶å€™ï¼Œå¿½ç•¥äº† time åˆ—ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div><pre><code>fsql<span>.</span><span>Insert</span><span>(</span>item<span>)</span>
    <span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> a<span>.</span>time<span>)</span>
    <span>.</span><span>NoneParameter</span><span>(</span><span>)</span>
    <span>.</span><span>OnDuplicateKeyUpdate</span><span>(</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `TestOnDuplicateKeyUpdateInfo`(`id`, `title`) VALUES(200, 'title-200')</span>
<span>//ON DUPLICATE KEY UPDATE</span>
<span>//`title` = VALUES(`title`),</span>
<span>//`time` = '2000-01-01 00:00:00.000'</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>æˆ‘ä»¬å‘ç°ï¼ŒUPDATE time éƒ¨åˆ†å˜æˆäº†å¸¸é‡ï¼Œè€Œä¸æ˜¯ VALUES(`time`)ï¼Œæœºåˆ¶å¦‚ä¸‹ï¼š</p>
<p>å½“ insert éƒ¨åˆ†ä¸­å­˜åœ¨çš„åˆ—ï¼Œåœ¨ update ä¸­å°†ä»¥ VALUES(`å­—æ®µ`) çš„å½¢å¼è®¾ç½®ï¼›</p>
<p>å½“ insert éƒ¨åˆ†ä¸­ä¸å­˜åœ¨çš„åˆ—ï¼Œåœ¨ update ä¸­å°†ä¸ºå¸¸é‡å½¢å¼è®¾ç½®ï¼Œå½“æ“ä½œå®ä½“æ•°ç»„çš„æ—¶å€™ï¼Œæ­¤å¸¸é‡ä¸º case when ... end æ‰§è¡Œï¼ˆä¸ IUpdate ä¸€æ ·ï¼‰ï¼›</p>
<hr>
<h2 id="_6ã€postgresql-ç‰¹æœ‰åŠŸèƒ½-on-conflict-do-update" tabindex="-1"> 6ã€PostgreSQL ç‰¹æœ‰åŠŸèƒ½ On Conflict Do Update</h2>
<p>FreeSql.Provider.PostgreSQL æ”¯æŒ PostgreSQL 9.5+ ç‰¹æœ‰çš„åŠŸèƒ½ï¼ŒOn Conflict(id) Do Updateã€‚</p>
<p>ä½¿ç”¨æ–¹æ³• MySql OnDuplicateKeyUpdate å¤§è‡´ç›¸åŒã€‚</p>
<div><pre><code><span>class</span> <span>TestOnConflictDoUpdateInfo</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime<span>?</span></span> time <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span><span>var</span></span> items <span>=</span> <span>new</span> <span>[</span><span>]</span> <span>{</span>
    <span>new</span> <span>TestOnConflictDoUpdateInfo</span> <span>{</span> id <span>=</span> <span>200</span><span>,</span> title <span>=</span> <span>"title-200"</span><span>,</span> time <span>=</span> DateTime<span>.</span><span>Parse</span><span>(</span><span>"2000-01-01"</span><span>)</span> <span>}</span><span>,</span>
    <span>new</span> <span>TestOnConflictDoUpdateInfo</span> <span>{</span> id <span>=</span> <span>201</span><span>,</span> title <span>=</span> <span>"title-201"</span><span>,</span> time <span>=</span> DateTime<span>.</span><span>Parse</span><span>(</span><span>"2000-01-01"</span><span>)</span> <span>}</span><span>,</span>
    <span>new</span> <span>TestOnConflictDoUpdateInfo</span> <span>{</span> id <span>=</span> <span>202</span><span>,</span> title <span>=</span> <span>"title-202"</span><span>,</span> time <span>=</span> DateTime<span>.</span><span>Parse</span><span>(</span><span>"2000-01-01"</span><span>)</span> <span>}</span>
<span>}</span><span>;</span>
fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span>
    <span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> a<span>.</span>time<span>)</span>
    <span>.</span><span>NoneParameter</span><span>(</span><span>)</span>
    <span>.</span><span>OnConflictDoUpdate</span><span>(</span><span>)</span><span>.</span><span>ToSql</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO ""testonconflictdoupdateinfo""(""id"", ""title"") VALUES(200, 'title-200'), (201, 'title-201'), (202, 'title-202')</span>
<span>//ON CONFLICT(""id"") DO UPDATE SET</span>
<span>//""title"" = EXCLUDED.""title"",</span>
<span>//""time"" = CASE EXCLUDED.""id""</span>
<span>//WHEN 200 THEN '2000-01-01 00:00:00.000000'</span>
<span>//WHEN 201 THEN '2000-01-01 00:00:00.000000'</span>
<span>//WHEN 202 THEN '2000-01-01 00:00:00.000000' END::timestamp</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br></div></div>]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">æ–°å¢</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/insert.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/insert.html"/>
    <updated>2022-05-17T06:09:12.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æ–°å¢" tabindex="-1"> æ–°å¢</h1>
<p><code>FreeSql</code> æä¾›å•æ¡å’Œæ‰¹é‡æ’å…¥æ•°æ®çš„æ–¹æ³•ï¼Œåœ¨ç‰¹å®šçš„æ•°æ®åº“æ‰§è¡Œè¿˜å¯ä»¥è¿”å›æ’å…¥åçš„è®°å½•ã€‚</p>
<div><pre><code><span><span>var</span></span> connectionString <span>=</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;"</span> <span>+</span>
    <span>"Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=10"</span><span>;</span>

<span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span><span>var</span></span> items <span>=</span> <span>new</span> <span>List<span>&lt;</span>Topic<span>></span></span><span>(</span><span>)</span><span>;</span>
<span>for</span> <span>(</span><span><span>var</span></span> a <span>=</span> <span>0</span><span>;</span> a <span>&lt;</span> <span>10</span><span>;</span> a<span>++</span><span>)</span> items<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> a <span>+</span> <span>1</span><span>,</span> Title <span>=</span> <span><span>$"newtitle</span><span><span>{</span><span>a</span><span>}</span></span><span>"</span></span><span>,</span> Clicks <span>=</span> a <span>*</span> <span>100</span> <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><h2 id="_1ã€å•æ¡æ’å…¥" tabindex="-1"> 1ã€å•æ¡æ’å…¥</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>.</span><span>First</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Clicks`, `Title`, `CreateTime`)</span>
<span>//VALUES(?Clicks0, ?Title0, ?CreateTime0)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>å¦‚æœè¡¨æœ‰è‡ªå¢åˆ—ï¼Œæ’å…¥æ•°æ®ååº”è¯¥è¦è¿”å› idã€‚</p>
<p>æ–¹æ³• 1ï¼š(åŸå§‹)</p>
<div><pre><code><span><span>long</span></span> id <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>blog<span>)</span><span>.</span><span>ExecuteIdentity</span><span>(</span><span>)</span><span>;</span>
blog<span>.</span>Id <span>=</span> id<span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>æ–¹æ³• 2ï¼š(ä¾èµ– FreeSql.Repository)</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span><span>Insert</span><span>(</span>blog<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><blockquote>
<p>å†…éƒ¨ä¼šå°†æ’å…¥åçš„è‡ªå¢å€¼å¡«å……ç»™ blog.Id</p>
</blockquote>
<h2 id="_2ã€æ‰¹é‡æ’å…¥" tabindex="-1"> 2ã€æ‰¹é‡æ’å…¥</h2>
<div><pre><code><span><span>var</span></span> t2 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Clicks`, `Title`, `CreateTime`)</span>
<span>//VALUES(?Clicks0, ?Title0, ?CreateTime0), (?Clicks1, ?Title1, ?CreateTime1),</span>
<span>//(?Clicks2, ?Title2, ?CreateTime2), (?Clicks3, ?Title3, ?CreateTime3),</span>
<span>//(?Clicks4, ?Title4, ?CreateTime4), (?Clicks5, ?Title5, ?CreateTime5),</span>
<span>//(?Clicks6, ?Title6, ?CreateTime6), (?Clicks7, ?Title7, ?CreateTime7),</span>
<span>//(?Clicks8, ?Title8, ?CreateTime8), (?Clicks9, ?Title9, ?CreateTime9)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><blockquote>
<p>è§£å†³äº† SqlServer æ‰¹é‡æ·»åŠ å®¹æ˜“å¯¼è‡´çš„é”™è¯¯ï¼šä¼ å…¥çš„è¯·æ±‚å…·æœ‰è¿‡å¤šçš„å‚æ•°ã€‚è¯¥æœåŠ¡å™¨æ”¯æŒæœ€å¤š 2100 ä¸ªå‚æ•°ã€‚è¯·å‡å°‘å‚æ•°çš„æ•°ç›®ï¼Œç„¶åé‡æ–°å‘é€è¯¥è¯·æ±‚ã€‚</p>
</blockquote>
<blockquote>
<p>åŸç†ä¸ºæ‹†æˆå¤šä¸ªåŒ…ç”¨äº‹åŠ¡æ‰§è¡Œï¼›</p>
</blockquote>
<p>å½“æ’å…¥å¤§æ‰¹é‡æ•°æ®æ—¶ï¼Œå†…éƒ¨é‡‡ç”¨åˆ†å‰²åˆ†æ‰¹æ‰§è¡Œçš„é€»è¾‘è¿›è¡Œã€‚åˆ†å‰²è§„åˆ™å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>æ•°é‡</th>
<th>å‚æ•°é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql</td>
<td>5000</td>
<td>3000</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>5000</td>
<td>3000</td>
</tr>
<tr>
<td>SqlServer</td>
<td>1000</td>
<td>2100</td>
</tr>
<tr>
<td>Oracle</td>
<td>500</td>
<td>999</td>
</tr>
<tr>
<td>Sqlite</td>
<td>5000</td>
<td>999</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ•°é‡ï¼šä¸ºæ¯æ‰¹åˆ†å‰²çš„å¤§å°ï¼Œå¦‚æ‰¹é‡æ’å…¥ 10000 æ¡æ•°æ®ï¼Œåœ¨ mysql æ‰§è¡Œæ—¶ä¼šåˆ†å‰²ä¸ºä¸¤æ‰¹ã€‚<br />
å‚æ•°é‡ï¼šä¸ºæ¯æ‰¹åˆ†å‰²çš„å‚æ•°é‡å¤§å°ï¼Œå¦‚æ‰¹é‡æ’å…¥ 10000 æ¡æ•°æ®ï¼Œæ¯è¡Œéœ€è¦ä½¿ç”¨ 5 ä¸ªå‚æ•°åŒ–ï¼Œåœ¨ mysql æ‰§è¡Œæ—¶ä¼šåˆ†å‰²ä¸ºæ¯æ‰¹ 3000 / 5ã€‚</p>
</blockquote>
<p>åˆ†å‰²æ‰§è¡Œåï¼Œå½“å¤–éƒ¨æœªæä¾›äº‹åŠ¡æ—¶ï¼Œå†…éƒ¨è‡ªå¼€äº‹åŠ¡ï¼Œå®ç°æ’å…¥å®Œæ•´æ€§ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ BatchOptions è®¾ç½®åˆé€‚çš„å€¼ã€‚</p>
<p>FreeSql é€‚é…äº†æ¯ä¸€ç§æ•°æ®ç±»å‹å‚æ•°åŒ–ï¼Œå’Œä¸å‚æ•°åŒ–çš„ä½¿ç”¨ã€‚æ‰¹é‡æ’å…¥å»ºè®®å…³é—­å‚æ•°åŒ–åŠŸèƒ½ï¼Œä½¿ç”¨ .NoneParameter() è¿›è¡Œæ‰§è¡Œã€‚</p>
<h2 id="_3ã€executesqlbulkcopyã€executepgcopyã€executemysqlbulkcopy" tabindex="-1"> 3ã€ExecuteSqlBulkCopyã€ExecutePgCopyã€ExecuteMySqlBulkCopy</h2>
<p>Bulk Copy æ“ä½œä»¥æ‰©å±•æ–¹æ³•çš„å½¢å¼å®ç°ï¼Œé’ˆå¯¹ SqlServer/PostgreSQL/MySql æ•°æ®åº“ï¼Œå¯ç”¨çš„åŒ…ï¼šFreeSql.Provider.SqlServer/FreeSql.Provider.PostgreSQL/FreeSql.Provider.MySqlConnectorã€‚</p>
<h3 id="æ‰¹é‡æ’å…¥æµ‹è¯•å‚è€ƒ-52-ä¸ªå­—æ®µ" tabindex="-1"> æ‰¹é‡æ’å…¥æµ‹è¯•å‚è€ƒ(52 ä¸ªå­—æ®µ)</h3>
<table>
<thead>
<tr>
<th></th>
<th>18W</th>
<th>1W</th>
<th>5K</th>
<th>2K</th>
<th>1K</th>
<th>500</th>
<th>100</th>
<th>50</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql 5.5 ExecuteAffrows</td>
<td>38,481</td>
<td>2,234</td>
<td>1,136</td>
<td>284</td>
<td>239</td>
<td>167</td>
<td>66</td>
<td>30</td>
</tr>
<tr>
<td>MySql 5.5 ExecuteMySqlBulkCopy</td>
<td>28,405</td>
<td>1,142</td>
<td>657</td>
<td>451</td>
<td>435</td>
<td>592</td>
<td>47</td>
<td>22</td>
</tr>
<tr>
<td>SqlServer Express ExecuteAffrows</td>
<td>402,355</td>
<td>24,847</td>
<td>11,465</td>
<td>4,971</td>
<td>2,437</td>
<td>915</td>
<td>138</td>
<td>88</td>
</tr>
<tr>
<td>SqlServer Express ExecuteSqlBulkCopy</td>
<td>21,065</td>
<td>578</td>
<td>326</td>
<td>139</td>
<td>105</td>
<td>79</td>
<td>60</td>
<td>48</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecuteAffrows</td>
<td>46,756</td>
<td>3,294</td>
<td>2,269</td>
<td>1,019</td>
<td>374</td>
<td>209</td>
<td>51</td>
<td>37</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecutePgCopy</td>
<td>10,090</td>
<td>583</td>
<td>337</td>
<td>136</td>
<td>88</td>
<td>61</td>
<td>30</td>
<td>25</td>
</tr>
</tbody>
</table>
<blockquote>
<p>18W è§£é‡Šï¼šæ’å…¥ 18 ä¸‡è¡Œè®°å½•ï¼Œè¡¨æ ¼ä¸­çš„æ•°å­—æ˜¯æ‰§è¡Œæ—¶é—´ï¼ˆå•ä½ msï¼‰</p>
</blockquote>
<h3 id="æ‰¹é‡æ’å…¥æµ‹è¯•å‚è€ƒ-10-ä¸ªå­—æ®µ" tabindex="-1"> æ‰¹é‡æ’å…¥æµ‹è¯•å‚è€ƒ(10 ä¸ªå­—æ®µ)</h3>
<table>
<thead>
<tr>
<th></th>
<th>18W</th>
<th>1W</th>
<th>5K</th>
<th>2K</th>
<th>1K</th>
<th>500</th>
<th>100</th>
<th>50</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql 5.5 ExecuteAffrows</td>
<td>11,171</td>
<td>866</td>
<td>366</td>
<td>80</td>
<td>83</td>
<td>50</td>
<td>24</td>
<td>34</td>
</tr>
<tr>
<td>MySql 5.5 ExecuteMySqlBulkCopy</td>
<td>6,504</td>
<td>399</td>
<td>257</td>
<td>116</td>
<td>87</td>
<td>100</td>
<td>16</td>
<td>16</td>
</tr>
<tr>
<td>SqlServer Express ExecuteAffrows</td>
<td>47,204</td>
<td>2,275</td>
<td>1,108</td>
<td>488</td>
<td>279</td>
<td>123</td>
<td>35</td>
<td>16</td>
</tr>
<tr>
<td>SqlServer Express ExecuteSqlBulkCopy</td>
<td>4,248</td>
<td>127</td>
<td>71</td>
<td>30</td>
<td>48</td>
<td>14</td>
<td>11</td>
<td>10</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecuteAffrows</td>
<td>9,786</td>
<td>568</td>
<td>336</td>
<td>157</td>
<td>102</td>
<td>34</td>
<td>9</td>
<td>6</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecutePgCopy</td>
<td>4,081</td>
<td>167</td>
<td>93</td>
<td>39</td>
<td>21</td>
<td>12</td>
<td>4</td>
<td>2</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æµ‹è¯•ç»“æœï¼Œæ˜¯åœ¨ç›¸åŒæ“ä½œç³»ç»Ÿä¸‹è¿›è¡Œçš„ï¼Œå¹¶ä¸”éƒ½æœ‰é¢„çƒ­</p>
</blockquote>
<h2 id="_4ã€æ’å…¥æŒ‡å®šçš„åˆ—" tabindex="-1"> 4ã€æ’å…¥æŒ‡å®šçš„åˆ—</h2>
<div><pre><code><span><span>var</span></span> t3 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>InsertColumns</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Title`)</span>
<span>//VALUES(?Title0), (?Title1), (?Title2), (?Title3), (?Title4),</span>
<span>//(?Title5), (?Title6), (?Title7), (?Title8), (?Title9)</span>

<span><span>var</span></span> t4 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>InsertColumns</span><span>(</span>a <span>=></span><span>new</span> <span>{</span> a<span>.</span>Title<span>,</span> a<span>.</span>Clicks <span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Clicks`, `Title`)</span>
<span>//VALUES(?Clicks0, ?Title0), (?Clicks1, ?Title1), (?Clicks2, ?Title2),</span>
<span>//(?Clicks3, ?Title3), (?Clicks4, ?Title4), (?Clicks5, ?Title5),</span>
<span>//(?Clicks6, ?Title6), (?Clicks7, ?Title7), (?Clicks8, ?Title8),</span>
<span>//(?Clicks9, ?Title9)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="_5ã€å¿½ç•¥åˆ—" tabindex="-1"> 5ã€å¿½ç•¥åˆ—</h2>
<div><pre><code><span><span>var</span></span> t5 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//INSERT INTO `Topic`(`Clicks`, `Title`)</span>
<span>//VALUES(?Clicks0, ?Title0), (?Clicks1, ?Title1), (?Clicks2, ?Title2),</span>
<span>//(?Clicks3, ?Title3), (?Clicks4, ?Title4), (?Clicks5, ?Title5),</span>
<span>//(?Clicks6, ?Title6), (?Clicks7, ?Title7), (?Clicks8, ?Title8),</span>
<span>//(?Clicks9, ?Title9)</span>

<span><span>var</span></span> t6 <span>=</span> fsql<span>.</span><span>Insert</span><span>(</span>items<span>)</span><span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Title<span>,</span> a<span>.</span>CreateTime <span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>///INSERT INTO `Topic`(`Clicks`)</span>
<span>//VALUES(?Clicks0), (?Clicks1), (?Clicks2), (?Clicks3), (?Clicks4),</span>
<span>//(?Clicks5), (?Clicks6), (?Clicks7), (?Clicks8), (?Clicks9)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="_6ã€åˆ—æ’å…¥ä¼˜å…ˆçº§" tabindex="-1"> 6ã€åˆ—æ’å…¥ä¼˜å…ˆçº§</h2>
<div><pre><code>å…¨éƒ¨åˆ— <span>&lt;</span> æŒ‡å®šåˆ—<span>(</span>InsertColumns<span>)</span> <span>&lt;</span> å¿½ç•¥åˆ—<span>(</span>IgnoreColumns<span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>åœ¨æ²¡æœ‰ä½¿ç”¨ <code>InsertColumns/IgnoreColumns</code> çš„æƒ…å†µä¸‹ï¼Œå®ä½“æ‰€æœ‰åˆ—å°†è¢«æ’å…¥æ•°æ®åº“ï¼›</p>
<p>åœ¨ä½¿ç”¨ <code>InsertColumns</code>ï¼Œæ²¡æœ‰ä½¿ç”¨ <code>IgnoreColumns</code> çš„æƒ…å†µä¸‹ï¼Œåªæœ‰æŒ‡å®šçš„åˆ—æ’å…¥æ•°æ®åº“ï¼›</p>
<p>åœ¨ä½¿ç”¨ <code>IgnoreColumns</code> çš„æƒ…å†µä¸‹ï¼Œåªæœ‰æœªè¢«æŒ‡å®šçš„åˆ—æ’å…¥æ•°æ®åº“ï¼›</p>
<h2 id="_7ã€å­—å…¸æ’å…¥" tabindex="-1"> 7ã€å­—å…¸æ’å…¥</h2>
<div><pre><code><span><span>var</span></span> dic <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"id"</span><span>,</span> <span>1</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"name"</span><span>,</span> <span>"xxxx"</span><span>)</span><span>;</span>

fsql<span>.</span><span>InsertDict</span><span>(</span>dic<span>)</span><span>.</span><span>AsTable</span><span>(</span><span>"table1"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="_8ã€å¯¼å…¥è¡¨æ•°æ®" tabindex="-1"> 8ã€å¯¼å…¥è¡¨æ•°æ®</h2>
<div><pre><code><span><span>int</span></span> affrows <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Limit</span><span>(</span><span>10</span><span>)</span>
  <span>.</span><span>InsertInto</span><span>(</span><span>null</span><span>,</span> a <span>=></span> <span>new</span> <span>Topic2</span>
  <span>{</span>
    Title <span>=</span> a<span>.</span>Title
  <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><div><pre><code><span>INSERT</span> <span>INTO</span> <span><span>`</span>Topic2<span>`</span></span><span>(</span><span><span>`</span>Title<span>`</span></span><span>,</span> <span><span>`</span>Clicks<span>`</span></span><span>,</span> <span><span>`</span>CreateTime<span>`</span></span><span>)</span>
<span>SELECT</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> <span>0</span><span>,</span> <span>'0001-01-01 00:00:00'</span>
<span>FROM</span> <span><span>`</span>Topic<span>`</span></span> a
<span>limit</span> <span>10</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>æ³¨æ„ï¼šå› ä¸º <code>Clicks</code>ã€<code>CreateTime</code> æ²¡æœ‰è¢«é€‰æ‹©ï¼Œæ‰€ä»¥ä½¿ç”¨ç›®æ ‡å®ä½“å±æ€§<code>[Column(InsertValueSql = xx)]</code> è®¾ç½®çš„å€¼ï¼Œæˆ–è€…ä½¿ç”¨ç›®æ ‡å®ä½“å±æ€§çš„ <code>c#</code>é»˜è®¤å€¼ã€‚</p>
<h2 id="_9ã€mysql-ç‰¹æœ‰åŠŸèƒ½-insert-ignore-into" tabindex="-1"> 9ã€MySql ç‰¹æœ‰åŠŸèƒ½ Insert Ignore Into</h2>
<div><pre><code>fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>MySqlIgnoreInto</span><span>(</span><span>)</span><span>.</span><span>AppendData</span><span>(</span>items<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>///INSERT IGNORE INTO `Topic`(`Clicks`)</span>
<span>//VALUES(?Clicks0), (?Clicks1), (?Clicks2), (?Clicks3), (?Clicks4),</span>
<span>//(?Clicks5), (?Clicks6), (?Clicks7), (?Clicks8), (?Clicks9)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="_10ã€mysql-ç‰¹æœ‰åŠŸèƒ½-on-duplicate-key-update" tabindex="-1"> 10ã€MySql ç‰¹æœ‰åŠŸèƒ½ <code>On Duplicate Key Update</code></h2>
<div><pre><code>fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>MySqlIgnoreInto</span><span>(</span><span>)</span><span>.</span><span>AppendData</span><span>(</span>items<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>///INSERT IGNORE INTO `Topic`(`Clicks`)</span>
<span>//VALUES(@Clicks0), (@Clicks1), (@Clicks2), (@Clicks3), (@Clicks4),</span>
<span>//(@Clicks5), (@Clicks6), (@Clicks7), (@Clicks8), (@Clicks9)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppendData</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>è¿½åŠ å‡†å¤‡æ’å…¥çš„å®ä½“</td>
</tr>
<tr>
<td>InsertIdentity</td>
<td>&lt;this&gt;</td>
<td>æ— </td>
<td>æŒ‡æ˜æ’å…¥è‡ªå¢åˆ—</td>
</tr>
<tr>
<td>InsertColumns</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>åªæ’å…¥çš„åˆ—</td>
</tr>
<tr>
<td>IgnoreColumns</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å¿½ç•¥çš„åˆ—</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>å‘½ä»¤è¶…æ—¶è®¾ç½®(ç§’)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>è®¾ç½®äº‹åŠ¡å¯¹è±¡</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>è®¾ç½®è¿æ¥å¯¹è±¡</td>
</tr>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
</tr>
<tr>
<td>OnDuplicateKeyUpdate</td>
<td>OnDuplicateKeyUpdate&lt;T1&gt;</td>
<td>æ— </td>
<td>MySql ç‰¹æœ‰çš„åŠŸèƒ½ï¼ŒOn Duplicate Key Update</td>
</tr>
<tr>
<td>OnConflictDoUpdate</td>
<td>OnConflictDoUpdate&lt;T1&gt;</td>
<td>æ— </td>
<td>PostgreSQL ç‰¹æœ‰çš„åŠŸèƒ½ï¼ŒOn Conflict Do Update</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>long</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
</tr>
<tr>
<td>ExecuteIdentity</td>
<td>long</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›è‡ªå¢å€¼</td>
</tr>
<tr>
<td>ExecuteInserted</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›æ’å…¥åçš„è®°å½•</td>
</tr>
<tr>
<td>ExecuteSqlBulkCopy</td>
<td>void</td>
<td></td>
<td>SqlServer ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œæ‰§è¡Œ SqlBulkCopy æ‰¹é‡æ’å…¥çš„å°è£…</td>
</tr>
<tr>
<td>ExecutePgCopy</td>
<td>void</td>
<td></td>
<td>PostgreSQL ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œæ‰§è¡Œ Copy æ‰¹é‡å¯¼å…¥æ•°æ®</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">å®‰è£…</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/install.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/install.html"/>
    <updated>2022-05-17T06:09:12.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å®‰è£…" tabindex="-1"> å®‰è£…</h1>
<h2 id="ç‰ˆæœ¬" tabindex="-1"> ç‰ˆæœ¬</h2>
<p>FreeSql æ˜¯ä¸€ä¸ª .NET Standard 2.0 åº“ï¼Œä»…æ”¯æŒ .NET Framework 4.0 æˆ– .NET Core æˆ–æ›´é«˜ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºã€‚</p>
<h2 id="å®‰è£…-1" tabindex="-1"> å®‰è£…</h2>
<div><pre><code>dotnet <span>add</span> package FreeSql
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="packages" tabindex="-1"> Packages</h2>
<table>
<thead>
<tr>
<th>Package Name</th>
<th>Version</th>
<th>è¯´æ˜</th>
<th>NUGET</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/guide/repository.html">FreeSql.Repository</a></td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>é€šç”¨ä»“å‚¨ + UnitOfWork å®ç°</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Repository" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Repository" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td><a href="/guide/db-context.html">FreeSql.DbContext</a></td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>EFCore çš„ä½¿ç”¨é£æ ¼å®ç°</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.DbContext" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.DbContext" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.MySql</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>åŸºäº MySql.Dataï¼ˆOracle å®˜æ–¹ï¼‰</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.MySql" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.MySql" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.MySqlConnector</td>
<td>NETStandard2.0ã€net45</td>
<td>åŸºäº MySqlConnector</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.MySqlConnector" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.MySqlConnector" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.PostgreSQL</td>
<td>NETStandard2.0ã€net45</td>
<td>åŸºäº PostgreSQL 9.5+</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.PostgreSQL" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.PostgreSQL" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.SqlServer</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>åŸºäº SqlServer 2005+</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.SqlServer" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.SqlServer" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.SqlServerForSystem</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>åŸºäº System.Data.SqlClient + SqlServer 2005+</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.SqlServerForSystem" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.SqlServerForSystem" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.Sqlite</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Sqlite" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Sqlite" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.Oracle</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Oracle" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Oracle" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.Firebird</td>
<td>NETStandard2.0ã€net452</td>
<td></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Firebird" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Firebird" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.MsAccess</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.MsAccess" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.MsAccess" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.Dameng</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>åŸºäº è¾¾æ¢¦æ•°æ®åº“</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Dameng" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Dameng" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.ShenTong</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>åŸºäº ç¥èˆŸé€šç”¨æ•°æ®åº“</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.ShenTong" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.ShenTong" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Provider.KingbaseES</td>
<td>NETStandard2.0ã€net461</td>
<td>åŸºäº äººå¤§é‡‘ä»“æ•°æ®åº“</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.KingbaseES" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.KingbaseES" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td><a href="https://github.com/2881099/FreeSql/tree/master/Providers/FreeSql.Provider.Odbc" target="_blank" rel="noopener noreferrer">FreeSql.Provider.Odbc</a></td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>åŸºäº ODBC</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Odbc" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Odbc" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td><a href="https://github.com/2881099/FreeSql/tree/master/Providers/FreeSql.Provider.Custom" target="_blank" rel="noopener noreferrer">FreeSql.Provider.Custom</a></td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>è‡ªå®šä¹‰æ•°æ®åº“è®¿é—®</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Provider.Custom" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Provider.Custom" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Extensions.LazyLoading</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>å»¶æ—¶å±æ€§æ‰©å±•åŒ…</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Extensions.LazyLoading" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Extensions.LazyLoading" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Extensions.JsonMap</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>Json åºåˆ—åŒ–æ‰©å±•åŒ…</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Extensions.JsonMap" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Extensions.JsonMap" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Extensions.Linq</td>
<td>NETStandard2.0ã€net45ã€net40</td>
<td>LinqToSql IQueryable æ‰©å±•åŒ…</td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Extensions.Linq" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Extensions.Linq" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Extensions.BaseEntity</td>
<td>NETStandard2.0</td>
<td></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Extensions.BaseEntity" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Extensions.BaseEntity" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
<tr>
<td>FreeSql.Generator</td>
<td>NETCoreapp3.1</td>
<td>ä»æ•°æ®åº“ç”Ÿæˆå®ä½“ç±»ï¼Œ<a href="https://www.cnblogs.com/igeekfan/p/freesql-generator.html" target="_blank" rel="noopener noreferrer">ç”Ÿæˆå™¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></td>
<td><strong><a href="https://www.nuget.org/packages/FreeSql.Generator" target="_blank" rel="noopener noreferrer"><img src="https://buildstats.info/nuget/FreeSql.Generator" alt="NuGet" loading="lazy"></a></strong></td>
</tr>
</tbody>
</table>
<h2 id="å­¦ä¹ æŒ‡å—" tabindex="-1"> å­¦ä¹ æŒ‡å—</h2>
<p>FreeSql é™¤äº†æ”¯æŒåŸºæœ¬çš„å¢åˆ æŸ¥æ”¹åŠŸèƒ½å¤–ï¼Œè¿˜æ”¯æŒåŸºäºç°æœ‰æ•°æ®åº“åˆ›å»ºæ¨¡å‹ï¼ˆ<a href="/guide/db-first.html">db-first</a>ï¼‰ï¼Œå’Œæ”¯æŒåŸºäºæ¨¡å‹åˆ›å»ºæ•°æ®åº“ï¼ˆ<a href="/guide/code-first.html">code-first</a>)ã€‚</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">LinqToSql</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/linq-to-sql.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/linq-to-sql.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="linqtosql" tabindex="-1"> LinqToSql</h1>
<p>åŸæœ¬ä¸æ”¯æŒ IQueryable ä¸»è¦å‡ºäºä½¿ç”¨ä¹ æƒ¯çš„è€ƒè™‘ï¼Œç¼–å†™ä»£ç çš„æ™ºèƒ½æ€»ä¼šæç¤ºå‡ºç°ä¸€å †ä½ ä¸æƒ³ä½¿ç”¨çš„æ–¹æ³•ï¼ˆå¯¹ä¸èµ·ï¼Œæˆ‘æœ‰å¼ºè¿«ç—‡ï¼‰ï¼ŒIQueryable è‡ªèº«æä¾›äº†ä¸€å †æ²¡æ³•å®ç°çš„æ–¹æ³•ï¼Œè¿˜æœ‰å¤–éƒ¨å…¥ä¾µçš„æ‰©å±•æ–¹æ³•ï¼Œä¸¥é‡å½±å“ç¼–ç ä½“éªŒã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://user-images.githubusercontent.com/16286519/57295126-5dd7bd00-70fc-11e9-99c0-d1c46423afa2.png" alt="image" loading="lazy"></p>
<p>v1.4.0+ ç‰ˆæœ¬è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼ˆè€ç‰ˆæœ¬ä¸éœ€è¦å®‰è£…ï¼‰ï¼š</p>
<blockquote>
<p>dotnet add package FreeSql.Extensions.Linq</p>
</blockquote>
<h2 id="ç‰¹åˆ«è¯´æ˜" tabindex="-1"> ç‰¹åˆ«è¯´æ˜</h2>
<ul>
<li>
<p>è¯·å°½é‡ä¸è¦åœ¨ ISelect æ¨¡å¼ä¸‹çš„ä½¿ç”¨ Linq æ–¹æ³•ï¼šGroupJoinã€Selectã€SelectManyã€Joinã€DefaultIfEmptyï¼›</p>
</li>
<li>
<p>å¦‚æœä¸€å®šè¦åœ¨ ISelect ä¸­ä½¿ç”¨ .Select() æ–¹æ³•ï¼Œè¯·åŠ¡å¿…åœ¨ .ToList() ä¹‹å‰è°ƒç”¨å®ƒï¼›</p>
</li>
</ul>
<h2 id="iqueryable" tabindex="-1"> IQueryable</h2>
<p>FreeSql æä¾›å¼ºå¤§çš„æ•°æ®æŸ¥è¯¢å¯¹è±¡ ISelectã€‚</p>
<p>FreeSql.Extensions.Linq v1.4.0+ å®ç°äº† IQueryable æŸ¥è¯¢å¯¹è±¡å¸¸ç”¨åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨å„æ¡†æ¶ä¸­äº¤äº’ä½¿ç”¨ã€‚</p>
<div><pre><code><span>//å°† ISelect è½¬ä¸º IQueryable</span>
<span>IQueryable<span>&lt;</span>Student<span>></span></span> queryable <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>AsQueryable</span><span>(</span><span>)</span><span>;</span>

<span>//Linq æ–¹æ³•æŸ¥è¯¢</span>
<span><span>var</span></span> t1 <span>=</span> queryable<span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>id <span>==</span> <span>1</span><span>)</span><span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span><span>;</span>

<span>//å°† IQueryable è¿˜åŸä¸º ISelect</span>
<span>ISelect<span>&lt;</span>Studeng<span>></span></span> <span>select</span> <span>=</span> queryable<span>.</span><span>RestoreToSelect</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>æ³¨æ„ï¼šIQueryable çš„å®ç°ç›®å‰ä¸æ”¯æŒ GroupByï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ RestoreSelect æ–¹æ³•è½¬å› ISelect è¿›è¡ŒæŸ¥è¯¢</p>
<h2 id="where" tabindex="-1"> Where</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> a
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="select-æŒ‡å®šå­—æ®µ" tabindex="-1"> Select(æŒ‡å®šå­—æ®µ)</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="casewhen" tabindex="-1"> CaseWhen</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span>
        a<span>.</span>id<span>,</span>
        a<span>.</span>name<span>,</span>
        testsub <span>=</span> <span>new</span> <span>{</span>
            time <span>=</span> a<span>.</span>age <span>></span> <span>10</span> <span>?</span> <span>"å¤§äº"</span> <span>:</span> <span>"å°äºæˆ–ç­‰äº"</span>
        <span>}</span>
    <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="join" tabindex="-1"> Join</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId
    <span>select</span> a
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t2 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> b<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t3 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> b<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><h2 id="leftjoin" tabindex="-1"> LeftJoin</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId <span>into</span> temp
    <span>from</span> tc <span>in</span> temp<span>.</span><span>DefaultIfEmpty</span><span>(</span><span>)</span>
    <span>select</span> a
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t2 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId <span>into</span> temp
    <span>from</span> tc <span>in</span> temp<span>.</span><span>DefaultIfEmpty</span><span>(</span><span>)</span>
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> tc<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t3 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>join</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span> <span>on</span> a<span>.</span>id equals b<span>.</span>StudentId <span>into</span> temp
    <span>from</span> tc <span>in</span> temp<span>.</span><span>DefaultIfEmpty</span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> tc<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><h2 id="from-å¤šè¡¨æŸ¥è¯¢" tabindex="-1"> From(å¤šè¡¨æŸ¥è¯¢)</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>from</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> b<span>.</span>StudentId
    <span>select</span> a
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t2 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>from</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> b<span>.</span>StudentId
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> b<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> t3 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>from</span> b <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>School<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> b<span>.</span>StudentId
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>select</span> <span>new</span> <span>{</span> a<span>.</span>id<span>,</span> bid <span>=</span> b<span>.</span>id <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><h2 id="groupby-åˆ†ç»„" tabindex="-1"> GroupBy(åˆ†ç»„)</h2>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> <span>(</span>
    <span>from</span> a <span>in</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Student<span>></span></span></span><span>(</span><span>)</span>
    <span>where</span> <span>a</span><span>.</span>id <span>==</span> item<span>.</span>id
    <span>group</span> a <span>by</span> <span>new</span> <span>{</span>a<span>.</span>id<span>,</span> a<span>.</span>name <span>}</span> <span>into</span> g
    <span>select</span> <span>new</span> <span>{</span>
        g<span>.</span>Key<span>.</span>id<span>,</span> g<span>.</span>Key<span>.</span>name<span>,</span>
        cou <span>=</span> g<span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span>
        avg <span>=</span> g<span>.</span><span>Avg</span><span>(</span>g<span>.</span>Value<span>.</span>age<span>)</span><span>,</span>
        sum <span>=</span> g<span>.</span><span>Sum</span><span>(</span>g<span>.</span>Value<span>.</span>age<span>)</span><span>,</span>
        max <span>=</span> g<span>.</span><span>Max</span><span>(</span>g<span>.</span>Value<span>.</span>age<span>)</span><span>,</span>
        min <span>=</span> g<span>.</span><span>Min</span><span>(</span>g<span>.</span>Value<span>.</span>age<span>)</span>
    <span>}</span>
<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div>]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">ä½ ä¸çŸ¥é“çš„åŠŸèƒ½ âœ¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/more.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/more.html"/>
    <updated>2022-05-31T14:08:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ä½ ä¸çŸ¥é“çš„åŠŸèƒ½-âœ¨" tabindex="-1"> ä½ ä¸çŸ¥é“çš„åŠŸèƒ½ âœ¨</h1>
<h2 id="_1ã€å¤‡æ³¨-è¿ç§»åˆ°æ•°æ®åº“" tabindex="-1"> 1ã€å¤‡æ³¨ -&gt; è¿ç§»åˆ°æ•°æ®åº“</h2>
<p>FreeSql CodeFirst æ”¯æŒå°† c# ä»£ç å†…çš„æ³¨é‡Šï¼Œè¿ç§»è‡³æ•°æ®åº“çš„å¤‡æ³¨ã€‚å…ˆå†³æ¡ä»¶ï¼š</p>
<p>1ã€å®ä½“ç±»æ‰€åœ¨ç¨‹åºé›†ï¼Œéœ€è¦å¼€å¯ xml æ–‡æ¡£åŠŸèƒ½ï¼›</p>
<p>2ã€xml æ–‡ä»¶å¿…é¡»ä¸ç¨‹åºé›†åŒç›®å½•ï¼Œä¸”æ–‡ä»¶åï¼šxxx.dll -&gt; xxx.xmlï¼›</p>
<blockquote>
<p>v1.5.0+ ç‰ˆæœ¬å¢åŠ äº†å¯¹ Description ç‰¹æ€§çš„è§£æï¼Œä¼˜å…ˆçº§ä½äº c# ä»£ç æ³¨é‡Šï¼›</p>
</blockquote>
<hr>
<h2 id="_2ã€noneparameter" tabindex="-1"> 2ã€NoneParameter</h2>
<p>è¿™ä¸ªæ–¹æ³•å¯ä»¥è®¾ç½®ä¸ä½¿ç”¨ å‚æ•°åŒ– æ‰§è¡Œ SQL å‘½ä»¤ï¼Œæ–¹ä¾¿å¼€å‘è°ƒè¯•ã€‚</p>
<div><pre><code><span>INSERT</span> <span>INTO</span> <span><span>`</span>tb_topic<span>`</span></span><span>(</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>VALUES</span><span>(</span>?Title0<span>)</span>

<span>INSERT</span> <span>INTO</span> <span><span>`</span>tb_topic<span>`</span></span><span>(</span><span><span>`</span>Title<span>`</span></span><span>)</span> <span>VALUES</span><span>(</span><span>'Title_1'</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>åœ¨ new FreeSqlBuilder().UseNoneParameter(true) å¯ä»¥å…¨å±€è®¾ç½®ã€‚</p>
<p>åœ¨ å•æ¬¡ IInsertã€IUpdate ä¸Šä½¿ç”¨ NoneParameter() è®¾ç½®å•æ¬¡ç”Ÿæ•ˆã€‚</p>
<hr>
<h2 id="_3ã€æ·»åŠ æˆ–ä¿®æ”¹" tabindex="-1"> 3ã€æ·»åŠ æˆ–ä¿®æ”¹</h2>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span><span>InsertOrUpdate</span><span>(</span>å®ä½“<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><blockquote>
<p>æ›´å¤šå†…å®¹å¯å‚é˜…ï¼š<a href="/guide/insert-or-update.html">æ·»åŠ æˆ–ä¿®æ”¹</a></p>
</blockquote>
<hr>
<h1 id="_4ã€å¼±ç±»å‹-curd" tabindex="-1"> 4ã€å¼±ç±»å‹ CURD</h1>
<div><pre><code>fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span><span>.</span><span>AsType</span><span>(</span>å®ä½“ç±»å‹<span>)</span>
  <span>.</span><span>AppendData</span><span>(</span>data<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span><span>.</span><span>AsType</span><span>(</span>å®ä½“ç±»å‹<span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>data<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span><span>.</span><span>AsType</span><span>(</span>å®ä½“ç±»å‹<span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> <span>(</span>a <span>as</span> <span>BaseEntity</span><span>)</span><span>.</span>Id <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>

<span>//æˆ–è€…ä»“å‚¨</span>
<span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span><span>object</span><span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span><span>AsType</span><span>(</span>å®ä½“ç±»å‹<span>)</span><span>;</span>

repo<span>.</span><span>Insert</span><span>(</span><span>..</span><span>)</span><span>;</span>
repo<span>.</span><span>Update</span><span>(</span><span>..</span><span>)</span><span>;</span>
repo<span>.</span><span>Delete</span><span>(</span><span>..</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><hr>
<h2 id="_5ã€withsql" tabindex="-1"> 5ã€WithSql</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>WithSql</span><span>(</span><span>"select * from Topic where clicks > @val"</span><span>,</span> <span>new</span> <span>{</span> val <span>=</span> <span>10</span> <span>}</span><span>)</span>
  <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span>
<span>//SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime` </span>
<span>//FROM (select * from Topic where clicks > @val) a </span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><blockquote>
<p>WithSql ä½¿ç”¨å¤šæ¬¡ä¸º UNION ALL æŸ¥è¯¢</p>
</blockquote>
<hr>
<h2 id="_6ã€ä½ ä¸çŸ¥é“çš„-æŒ‡å®šå­—æ®µè¿”å›" tabindex="-1"> 6ã€ä½ ä¸çŸ¥é“çš„ï¼ŒæŒ‡å®šå­—æ®µè¿”å›</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>t1<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    a<span>.</span>Id<span>,</span>
    a<span>.</span>Title<span>,</span>
    cstitle <span>=</span> <span>"substr(a.title, 0, 2)"</span><span>,</span> <span>//å°† substr(a.title, 0, 2) ä½œä¸ºæŸ¥è¯¢å­—æ®µ</span>
    csnow <span>=</span> Convert<span>.</span><span>ToDateTime</span><span>(</span><span>"now()"</span><span>)</span><span>,</span> <span>//å°† now() ä½œä¸ºæŸ¥è¯¢å­—æ®µ</span>
    <span>//å¥‡æ€å¦™æƒ³ï¼šæ€ä¹ˆæŸ¥è¯¢å¼€çª—å‡½æ•°çš„ç»“æœ</span>

    count <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span>
    max <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Max</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>,</span>
    min <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Min</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>,</span>
    name <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>First</span><span>(</span>b <span>=></span> b<span>.</span>name<span>)</span><span>,</span>

    <span>//å¯¼èˆªå±æ€§</span>
    t1Type <span>=</span> a<span>.</span>Type<span>,</span>

    <span>//å­æŸ¥è¯¢</span>
    childs <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>t1_id <span>==</span> a<span>.</span>id<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span>
  <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><hr>
<h2 id="_7ã€dto-æ˜ å°„æŸ¥è¯¢" tabindex="-1"> 7ã€Dto æ˜ å°„æŸ¥è¯¢</h2>
<p>æ˜ å°„æŸ¥è¯¢æ”¯æŒå•è¡¨/å¤šè¡¨ï¼Œåœ¨æŸ¥è¯¢æ•°æ®ä¹‹å‰æ˜ å°„ï¼ˆä¸æ˜¯å…ˆæŸ¥è¯¢æ‰€æœ‰å­—æ®µå†åˆ°å†…å­˜æ˜ å°„ï¼‰</p>
<p>è§„åˆ™ï¼šæŸ¥æ‰¾å±æ€§åï¼Œä¼šå¾ªç¯å†…éƒ¨å¯¹è±¡ _tablesï¼ˆå¤šè¡¨ä¼šå¢é•¿ï¼‰ï¼Œä»¥ ä¸»è¡¨ä¼˜å…ˆæŸ¥ï¼Œç›´åˆ°æŸ¥åˆ°ç›¸åŒçš„å­—æ®µã€‚</p>
<p>å¦‚ï¼š</p>
<p>A, B, C éƒ½æœ‰ idï¼ŒDto { id, a1, a2, b1, b2 }ï¼ŒA.id è¢«æ˜ å°„ã€‚ä¹Ÿå¯ä»¥æŒ‡å®š id = C.id æ˜ å°„ã€‚</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>ToList</span><span><span>&lt;</span>Dto<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span>//æƒ…å†µ1ï¼šDto ä¸ Song å±æ€§åç›¸åŒçš„å­—æ®µè¢«æŸ¥è¯¢ï¼Œè¿”å› List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span> <span>{</span> xxx <span>=</span> a<span>.</span>ext <span>}</span><span>)</span> 
<span>//æƒ…å†µ2ï¼šDto ä¸ Song å±æ€§åç›¸åŒçš„å­—æ®µè¢«æŸ¥è¯¢ï¼Œçº æ­£æ˜ å°„ extï¼Œè¿”å› List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span> <span>{</span> id <span>=</span> a<span>.</span>id <span>}</span><span>)</span> 
<span>//æƒ…å†µ3ï¼šLambda ä¸ Song ç±»å‹ä¸€æ ·ï¼ŒåªæŸ¥è¯¢æŒ‡å®šå­—æ®µ idï¼Œè¿”å› List&lt;Song></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> id <span>=</span> a<span>.</span>id <span>}</span><span>)</span> 
<span>//æƒ…å†µ4ï¼šLambda åŒ¿åç±»å‹ï¼ŒåªæŸ¥è¯¢æŒ‡å®šå­—æ®µ idï¼Œè¿”å› List&lt;åŒ¿åå¯¹è±¡></span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><blockquote>
<p>è¯·ä»”ç»†å¤„ç†åŒºåˆ«ï¼Œè¯·ä»”ç»†å¤„ç†åŒºåˆ«ï¼Œè¯·ä»”ç»†å¤„ç†åŒºåˆ«</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span><span>(</span>a<span>.</span>id<span>)</span><span>)</span>
<span>//æƒ…å†µ5ï¼šåªæŸ¥è¯¢ idï¼Œè¿”å› List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span><span>(</span>a<span>.</span>id<span>)</span> <span>{</span> xxx <span>=</span> a<span>.</span>ext <span>}</span><span>)</span>
<span>//æƒ…å†µ6ï¼šæŸ¥è¯¢ id, extï¼Œè¿”å› List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span><span>(</span>a<span>.</span>id<span>)</span><span>)</span>
<span>//æƒ…å†µ7ï¼šæŸ¥è¯¢ idï¼Œè¿”å› List&lt;Song></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span><span>(</span>a<span>.</span>id<span>)</span> <span>{</span> xxx <span>=</span> a<span>.</span>ext <span>}</span><span>)</span>
<span>//æƒ…å†µ8ï¼šæŸ¥è¯¢ id, extï¼Œè¿”å› List&lt;Song></span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><blockquote>
<p>GroupBy æ‰€æœ‰æ–¹æ³•ä¸ä½¿ç”¨ DTO æ˜ å°„è§„åˆ™</p>
</blockquote>
<hr>
<h2 id="_8ã€çˆ¶å­å…³ç³»è¡¨" tabindex="-1"> 8ã€çˆ¶å­å…³ç³»è¡¨</h2>
<div><pre><code><span>List<span>&lt;</span>Category<span>></span></span> t2 <span>=</span> fsql<span>.</span>Select<span>&lt;</span>Category<span>></span><span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span>
<span>List<span>&lt;</span>Category<span>></span></span> t3 <span>=</span> fsql<span>.</span>Select<span>&lt;</span>Category<span>></span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>=</span> <span>"å®¶ç”µ"</span><span>)</span><span>.</span><span>AsTreeCte</span><span>(</span><span>)</span><span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span>
<span>//v1.6.0 AsTreeCte() é€’å½’CTEæŸ¥è¯¢ å®¶ç”µ ä¸‹çš„æ‰€æœ‰å­åˆ†ç±»</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>ToTreeList æŸ¥è¯¢æ•°æ®ååŠ å·¥ä¸ºæ ‘å‹ï¼Œæ³¨æ„ï¼šå®ä½“éœ€è¦é…ç½®çˆ¶å­å¯¼èˆªå±æ€§</p>
<div><pre><code><span>//è¿”å› AsTreeCte() æ ‘çŠ¶å±‚çº§ä¿¡æ¯</span>
t4 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"ä¸­å›½"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>+</span> <span>"["</span> <span>+</span> a<span>.</span>Code <span>+</span> <span>"]"</span><span>)</span>
  <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Code<span>)</span>
  <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> item <span>=</span> a<span>,</span> level <span>=</span> Convert<span>.</span><span>ToInt32</span><span>(</span><span>"a.cte_level"</span><span>)</span><span>,</span> path <span>=</span> <span>"a.cte_path"</span> <span>}</span><span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>4</span><span>,</span> t4<span>.</span>Count<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"100000"</span><span>,</span> t4<span>[</span><span>0</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110000"</span><span>,</span> t4<span>[</span><span>1</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110100"</span><span>,</span> t4<span>[</span><span>2</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110101"</span><span>,</span> t4<span>[</span><span>3</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"ä¸­å›½[100000]"</span><span>,</span> t4<span>[</span><span>0</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"ä¸­å›½[100000] -> åŒ—äº¬[110000]"</span><span>,</span> t4<span>[</span><span>1</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"ä¸­å›½[100000] -> åŒ—äº¬[110000] -> åŒ—äº¬å¸‚[110100]"</span><span>,</span> t4<span>[</span><span>2</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"ä¸­å›½[100000] -> åŒ—äº¬[110000] -> ä¸œåŸåŒº[110101]"</span><span>,</span> t4<span>[</span><span>3</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><h2 id="_9ã€çº§è”åŠ è½½" tabindex="-1"> 9ã€çº§è”åŠ è½½</h2>
<p>æœ‰è®¾ç½®å¯¼èˆªå±æ€§å…³ç³»çš„ï¼ˆæ”¯æŒä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼‰ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Goods<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æœªè®¾ç½®å¯¼èˆªå±æ€§å…³ç³»çš„ï¼Œä¸´æ—¶æŒ‡å®šå…³ç³»ï¼ˆåªæ”¯æŒä¸€å¯¹å¤šï¼‰ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Goods<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Comment<span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>TagId <span>==</span> a<span>.</span>Id<span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>åªæŸ¥è¯¢æ¯é¡¹å­é›†åˆçš„å‰å‡ æ¡æ•°æ®ï¼Œé¿å…åƒ EfCore åŠ è½½æ‰€æœ‰æ•°æ®å¯¼è‡´ IO æ€§èƒ½ä½ä¸‹ï¼ˆæ¯”å¦‚æŸå•†å“ä¸‹æœ‰ 2000 æ¡è¯„è®ºï¼‰ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Goods<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Comment<span>.</span><span>Take</span><span>(</span><span>10</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>åœ¨ Dto ä¸Šåšæ˜ å°„ IncludeManyï¼š</p>
<div><pre><code><span>//å®šä¹‰ä¸´æ—¶ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯ Dto ç±»</span>
<span>class</span> <span>Dto</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> TypeId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>List<span>&lt;</span>Goods <span>></span></span> GoodsList <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>//æŸ¥è¯¢ Goods å•†å“è¡¨ï¼Œåˆ†ç±»1ã€åˆ†ç±»2ã€åˆ†ç±»3 å„10æ¡æ•°æ®</span>
<span><span>var</span></span> dto <span>=</span> <span>new</span> <span>[</span><span>]</span> <span>{</span> <span>1</span><span>,</span><span>2</span><span>,</span><span>3</span> <span>}</span><span>.</span><span>Select</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span> <span>{</span> TypeId <span>=</span> a <span>}</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
dto<span>.</span><span>IncludeMany</span><span>(</span>d <span>=></span> d<span>.</span>GoodsList<span>.</span><span>Take</span><span>(</span><span>10</span><span>)</span><span>.</span><span>Where</span><span>(</span>gd <span>=></span> gd<span>.</span>TypeId <span>==</span> d<span>.</span>TypeId<span>)</span><span>)</span><span>;</span>

<span>//æ‰§è¡Œåï¼Œdto æ¯ä¸ªå…ƒç´ .Vods å°†åªæœ‰ 10æ¡è®°å½•</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>æŸ¥è¯¢å­é›†åˆè¡¨çš„éƒ¨åˆ†å­—æ®µï¼Œé¿å…å­é›†åˆå­—æ®µè¿‡å¤šçš„é—®é¢˜ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Goods<span>.</span><span>Select</span><span>(</span>b <span>=></span> <span>new</span> <span>Goods</span> <span>{</span> Id <span>=</span> b<span>.</span>Id<span>,</span> Title <span>=</span> b<span>.</span>Title <span>}</span><span>)</span><span>)</span><span>;</span>
<span>//åªæŸ¥è¯¢ goods è¡¨ id, title å­—æ®µï¼Œå†ä½œå¡«å……</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><hr>
<h2 id="_10ã€wherecascade" tabindex="-1"> 10ã€WhereCascade</h2>
<p>å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œåƒ isdeleted æ¯ä¸ªè¡¨éƒ½ç»™æ¡ä»¶ï¼ŒæŒºéº»çƒ¦çš„ã€‚WhereCascade ä½¿ç”¨åç”Ÿæˆ sql æ—¶ï¼Œæ‰€æœ‰è¡¨éƒ½é™„ä¸Šè¿™ä¸ªæ¡ä»¶ã€‚</p>
<p>å¦‚ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>t1<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span><span>LeftJoin</span><span><span>&lt;</span>t2<span>></span></span></span><span>(</span><span>..</span><span>.</span><span>)</span>
    <span>.</span><span>WhereCascade</span><span>(</span>x <span>=></span> x<span>.</span>IsDeleted <span>==</span> <span>false</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å¾—åˆ°çš„ SQLï¼š</p>
<div><pre><code><span>SELECT</span> <span>.</span><span>.</span><span>.</span>
<span>FROM</span> t1
<span>LEFT</span> <span>JOIN</span> t2 <span>on</span> <span>.</span><span>.</span><span>.</span> <span>AND</span> <span>(</span>t2<span>.</span>IsDeleted <span>=</span> <span>0</span><span>)</span>
<span>WHERE</span> t1<span>.</span>IsDeleted <span>=</span> <span>0</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å®ä½“å¯é™„åŠ è¡¨è¾¾å¼æ—¶æ‰ç”Ÿæ•ˆï¼Œæ”¯æŒå­è¡¨æŸ¥è¯¢ã€‚å•æ¬¡æŸ¥è¯¢ä½¿ç”¨çš„è¡¨æ•°ç›®è¶Šå¤šæ”¶ç›Šè¶Šå¤§ã€‚</p>
<hr>
<h2 id="_11ã€wheredynamicfilter" tabindex="-1"> 11ã€WhereDynamicFilter</h2>
<p>ISelect.WhereDynamicFilter æ–¹æ³•å®ç°åŠ¨æ€è¿‡æ»¤æ¡ä»¶ï¼ˆä¸å‰ç«¯äº¤äº’ï¼‰ï¼Œæ”¯æŒçš„æ“ä½œç¬¦ï¼š</p>
<ul>
<li>Contains/StartsWith/EndsWith/NotContains/NotStartsWith/NotEndsWithï¼šåŒ…å«/ä¸åŒ…å«ï¼Œlike '%xx%'ï¼Œæˆ–è€… like 'xx%'ï¼Œæˆ–è€… like '%xx'</li>
<li>Equal/NotEqualï¼šç­‰äº/ä¸ç­‰äº</li>
<li>GreaterThan/GreaterThanOrEqualï¼šå¤§äº/å¤§äºç­‰äº</li>
<li>LessThan/LessThanOrEqualï¼šå°äº/å°äºç­‰äº</li>
<li>Rangeï¼šèŒƒå›´æŸ¥è¯¢</li>
<li>DateRangeï¼šæ—¥æœŸèŒƒå›´ï¼Œæœ‰ç‰¹æ®Šå¤„ç† value[1] + 1</li>
<li>Any/NotAnyï¼šæ˜¯å¦ç¬¦åˆ value ä¸­ä»»ä½•ä¸€é¡¹ï¼ˆç›´ç™½çš„è¯´æ˜¯ SQL INï¼‰</li>
<li>Customï¼šè‡ªå®šä¹‰è§£æ</li>
</ul>
<div><pre><code><span>DynamicFilterInfo</span> dyfilter <span>=</span> JsonConvert<span>.</span><span><span>DeserializeObject</span><span><span>&lt;</span>DynamicFilterInfo<span>></span></span></span><span>(</span><span>@"
{
  ""Logic"" : ""Or"",
  ""Filters"" :
  [
    {
      ""Field"" : ""Code"", ""Operator"" : ""NotContains"", ""Value"" : ""val1"", 
      ""Filters"" : [{ ""Field"" : ""Name"", ""Operator"" : ""NotStartsWith"", ""Value"" : ""val2"" }]
    },
    {
      ""Field"" : ""Parent.Code"", ""Operator"" : ""Equals"", ""Value"" : ""val11"",
      ""Filters"" : [{ ""Field"" : ""Parent.Name"", ""Operator"" : ""Contains"", ""Value"" : ""val22"" }]
    }
  ]
}"</span><span>)</span><span>;</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>VM_District_Parent<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>WhereDynamicFilter</span><span>(</span>dyfilter<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.""Code"", a.""Name"", a.""ParentCode"", a__Parent.""Code"" as4, a__Parent.""Name"" as5, a__Parent.""ParentCode"" as6</span>
<span>//FROM ""D_District"" a</span>
<span>//LEFT JOIN ""D_District"" a__Parent ON a__Parent.""Code"" = a.""ParentCode""</span>
<span>//WHERE (not((a.""Code"") LIKE '%val1%') AND not((a.""Name"") LIKE 'val2%') OR a__Parent.""Code"" = 'val11' AND (a__Parent.""Name"") LIKE '%val22%')</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><hr>
<h2 id="_12ã€iselect-todeleteã€iselect-toupdate" tabindex="-1"> 12ã€ISelect.ToDeleteã€ISelect.ToUpdate</h2>
<p>é»˜è®¤ IDelete ä¸æ”¯æŒå¯¼èˆªå¯¹è±¡ï¼Œå¤šè¡¨å…³è”ç­‰ã€‚ISelect.ToDelete å¯å°†æŸ¥è¯¢è½¬ä¸ºåˆ é™¤å¯¹è±¡ï¼Œä»¥ä¾¿æ”¯æŒå¯¼èˆªå¯¹è±¡æˆ–å…¶ä»–æŸ¥è¯¢åŠŸèƒ½åˆ é™¤æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T1<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Options<span>.</span>xxx <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToDelete</span><span>(</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¸æ˜¯å°†æ•°æ®æŸ¥è¯¢åˆ°å†…å­˜å¾ªç¯åˆ é™¤ï¼Œä¸Šé¢çš„ä»£ç äº§ç”Ÿå¦‚ä¸‹ SQL æ‰§è¡Œï¼š</p>
<div><pre><code><span>DELETE</span> <span>FROM</span> <span><span>`</span>T1<span>`</span></span> <span>WHERE</span> id <span>in</span> <span>(</span><span>select</span> a<span>.</span>id <span>from</span> T1 a <span>left</span> <span>join</span> Options b <span>on</span> b<span>.</span>t1id <span>=</span> a<span>.</span>id <span>where</span> b<span>.</span>xxx <span>=</span> <span>1</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å¤æ‚åˆ é™¤ä½¿ç”¨è¯¥æ–¹æ¡ˆçš„å¥½å¤„ï¼š</p>
<ul>
<li>åˆ é™¤å‰å¯é¢„è§ˆæµ‹è¯•æ•°æ®ï¼Œé˜²æ­¢é”™è¯¯åˆ é™¤æ“ä½œï¼›</li>
<li>æ”¯æŒæ›´åŠ å¤æ‚çš„åˆ é™¤æ“ä½œï¼ˆIDelete é»˜è®¤åªæ”¯æŒç®€å•çš„æ“ä½œï¼‰ï¼Œç”šè‡³åœ¨ ISelect ä¸Šä½¿ç”¨ Limit(10) å°†åªåˆ é™¤é™„åˆæ¡ä»¶çš„å‰ 10 æ¡è®°å½•ï¼›</li>
</ul>
<blockquote>
<p>ISelect.ToUpdate æ“ä½œç±»ä¼¼</p>
</blockquote>
<hr>
<h2 id="_13ã€ä¿å­˜å¤šå¯¹å¤šæ•°æ®-savemany" tabindex="-1"> 13ã€ä¿å­˜å¤šå¯¹å¤šæ•°æ® SaveMany</h2>
<p>ä¹‹å‰ï¼š</p>
<p>FreeSql.DbContext å’Œ ä»“å‚¨å®ç°ï¼Œå·²ç»å®ç°äº†è”çº§ä¿å­˜åŠŸèƒ½ï¼Œè”çº§ä¿å­˜åŠŸèƒ½å¯å®ç°ä¿å­˜å¯¹è±¡çš„æ—¶å€™ï¼Œå°†å…¶ã€OneToManyã€‘ã€ã€ManyToManyã€‘å¯¼èˆªå±æ€§é›†åˆä¹Ÿä¸€å¹¶ä¿å­˜ã€‚</p>
<p>å…¨å±€å…³é—­ï¼š</p>
<div><pre><code>fsql<span>.</span><span>SetDbContextOptions</span><span>(</span>opt <span>=></span> opt<span>.</span>EnableCascadeSave <span>=</span> <span>false</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å±€éƒ¨å…³é—­ï¼š</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>false</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="æœ¬åŠŸèƒ½" tabindex="-1"> æœ¬åŠŸèƒ½ï¼š</h3>
<p>ä¿å­˜å®ä½“çš„æŒ‡å®šã€ä¸€å¯¹å¤šã€‘ã€ã€å¤šå¯¹å¤šã€‘å¯¼èˆªå±æ€§ï¼ŒSaveMany æ–¹æ³•å®ç°åœ¨ BaseRepositoryã€DbContextã€‚</p>
<p>è§£å†³é—®é¢˜ï¼šå½“å®ä½“ç±»å¯¼èˆªæ•°æ®è¿‡äºå¤æ‚çš„æ—¶å€™ï¼Œé€‰æ‹©å…³é—­è”çº§ä¿å­˜çš„åŠŸèƒ½æ˜¯æ˜æ™ºä¹‹é€‰ï¼Œä½†æ˜¯æ­¤æ—¶ã€ä¸€å¯¹å¤šã€‘ã€ã€å¤šå¯¹å¤šã€‘æ•°æ®ä¿å­˜åŠŸèƒ½å†™èµ·æ¥éå¸¸ç¹çéº»çƒ¦ï¼ˆä¸ç°æœ‰æ•°æ®å¯¹æ¯”åä¿å­˜ï¼‰ã€‚</p>
<div><pre><code><span><span>var</span></span> song <span>=</span> <span>new</span> <span>Song</span> <span>{</span> Id <span>=</span> <span>1</span> <span>}</span><span>;</span>
song<span>.</span>Tags <span>=</span> <span>new</span> <span>List<span>&lt;</span>Tag<span>></span></span><span>(</span><span>)</span><span>;</span>
song<span>.</span>Tags<span>.</span><span>Add</span><span>(</span><span>new</span> Tag <span>..</span><span>.</span><span>)</span><span>;</span>
song<span>.</span>Tags<span>.</span><span>Add</span><span>(</span><span>new</span> Tag <span>..</span><span>.</span><span>)</span><span>;</span>
song<span>.</span>Tags<span>.</span><span>Add</span><span>(</span><span>new</span> Tag <span>..</span><span>.</span><span>)</span><span>;</span>
repo<span>.</span><span>SaveMany</span><span>(</span>song<span>,</span> <span>"Tags"</span><span>)</span><span>;</span>
<span>//è½»æ¾ä¿å­˜ song ä¸ tag è¡¨çš„å…³è”</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>SaveManyã€ä¸€å¯¹å¤šã€‘çš„æœºåˆ¶æ˜¯å®Œæ•´å¯¹æ¯”ä¿å­˜ã€‚</p>
<p>SaveManyã€å¤šå¯¹å¤šã€‘çš„æœºåˆ¶è§„åˆ™ä¸è”çº§ä¿å­˜çš„ä¸€æ ·ï¼Œå¦‚ä¸‹ï¼š</p>
<p>æˆ‘ä»¬å¯¹ä¸­é—´è¡¨çš„ä¿å­˜æ˜¯å®Œæ•´å¯¹æ¯”æ“ä½œï¼Œå¯¹å¤–éƒ¨å®ä½“çš„æ“ä½œåªä½œæ–°å¢ï¼ˆæ³¨æ„ä¸ä¼šæ›´æ–°ï¼‰</p>
<ul>
<li>å±æ€§é›†åˆä¸ºç©ºæ—¶ï¼Œåˆ é™¤ä»–ä»¬çš„æ‰€æœ‰å…³è”æ•°æ®ï¼ˆä¸­é—´è¡¨ï¼‰</li>
<li>å±æ€§é›†åˆä¸ä¸ºç©ºæ—¶ï¼Œä¸æ•°æ®åº“å­˜åœ¨çš„å…³è”æ•°æ®ï¼ˆä¸­é—´è¡¨ï¼‰å®Œå…¨å¯¹æ¯”ï¼Œè®¡ç®—å‡ºåº”è¯¥åˆ é™¤å’Œæ·»åŠ çš„è®°å½•</li>
</ul>
<hr>
<h2 id="_14ã€è‡ªå®šä¹‰è¡¨è¾¾å¼å‡½æ•°" tabindex="-1"> 14ã€è‡ªå®šä¹‰è¡¨è¾¾å¼å‡½æ•°</h2>
<div><pre><code><span>[</span><span><span>ExpressionCall</span></span><span>]</span>
<span>public</span> <span>static</span> <span>class</span> <span>DbFunc</span> <span>{</span>
  <span>//å¿…è¦å®šä¹‰ static + ThreadLocal</span>
  <span>static</span> <span>ThreadLocal<span>&lt;</span>ExpressionCallContext<span>></span></span> context <span>=</span> <span>new</span> <span>ThreadLocal<span>&lt;</span>ExpressionCallContext<span>></span></span><span>(</span><span>)</span><span>;</span>

  <span>public</span> <span>static</span> <span>DateTime</span> <span>FormatDateTime</span><span>(</span><span>this</span> <span>DateTime</span> that<span>,</span> <span><span>string</span></span> arg1<span>)</span>
  <span>{</span>
    <span><span>var</span></span> up <span>=</span> context<span>.</span>Value<span>;</span>
    <span>if</span> <span>(</span>up<span>.</span>DataType <span>==</span> FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>)</span> <span>//é‡å†™å†…å®¹</span>
      up<span>.</span>Result <span>=</span> <span><span>$"date_format(</span><span><span>{</span><span>up<span>.</span>ParsedContent<span>[</span><span>"that"</span><span>]</span></span><span>}</span></span><span>, </span><span><span>{</span><span>up<span>.</span>ParsedContent<span>[</span><span>"arg1"</span><span>]</span></span><span>}</span></span><span>)"</span></span><span>;</span>
    <span>return</span> that<span>;</span>
  <span>}</span>
<span>}</span>

<span><span>var</span></span> sql1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>SysModule<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>ToSql</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>.</span><span>FormatDateTime</span><span>(</span><span>"yyyy-MM-dd"</span><span>)</span><span>)</span><span>;</span>
<span>//SELECT date_format(a."CreateTime", 'yyyy-MM-dd') as1</span>
<span>//FROM "SysModule" a</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><p>[ExpressionCall] ç‰¹æ€§å¯åœ¨é™æ€æ‰©å±•ç±»ä¸Šæ ‡è®°ï¼Œä¹Ÿå¯ä»¥åœ¨å•ä¸ªé™æ€æ–¹æ³•ä¸Šæ ‡è®°ï¼›</p>
<table>
<thead>
<tr>
<th>ExpressionCallContext å±æ€§</th>
<th>ç±»å‹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataType</td>
<td>FreeSql.DataType</td>
<td>ç”¨äºå®ç°ä¸åŒæ•°æ®åº“çš„é€‚é…åˆ¤æ–­æ¡ä»¶</td>
</tr>
<tr>
<td>ParsedContent</td>
<td>Dictionary&lt;string, string&gt;</td>
<td>å‡½æ•°çš„å„å‚æ•°è§£æç»“æœ</td>
</tr>
<tr>
<td>DbParameter</td>
<td>DbParameter</td>
<td>that è¢«å‚æ•°åŒ–çš„å¯¹è±¡ï¼ˆæœ‰å¯èƒ½ä¸º null)</td>
</tr>
<tr>
<td>UserParameters</td>
<td>List&lt;DbParameter&gt;</td>
<td>å¯é™„åŠ å‚æ•°åŒ–å¯¹è±¡</td>
</tr>
<tr>
<td>Result</td>
<td>string</td>
<td>è¿”å›è¡¨è¾¾å¼å‡½æ•°è¡¨ç¤ºçš„ SQL å­—ç¬¦ä¸²</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å½“æ‰©å±•æ–¹æ³•è¿”å›å€¼ä¸º string æ—¶ï¼Œå…¶è¿”å›å€¼ä¹Ÿå¯ä»¥å½“ä½œ context.Value.Result åŠŸèƒ½</p>
</blockquote>
<blockquote>
<p>å½“ä¸æƒ³è§£ææŒ‡å®šå‚æ•°æ—¶ï¼Œä½¿ç”¨ç‰¹æ€§ [RawValue] æ ‡è®°</p>
</blockquote>
<hr>
<h1 id="_15ã€è‡ªå®šä¹‰å®ä½“ç‰¹æ€§ã€ä¸å…¶ä»–-orm-å…±ç”¨ç‰¹æ€§" tabindex="-1"> 15ã€è‡ªå®šä¹‰å®ä½“ç‰¹æ€§ã€ä¸å…¶ä»– ORM å…±ç”¨ç‰¹æ€§</h1>
<p>æœ¬åŠŸèƒ½å¯å®ç°ä¸å…¶ä»– ORM ä½¿ç”¨ä¸€å¥— Attributeï¼Œé¿å…ç»´æŠ¤ä¸¤ä»½å®ä½“ç‰¹æ€§çš„çƒ¦æ¼ï¼š</p>
<blockquote>
<p>v1.4.0+ å·²è‡ªåŠ¨è¯†åˆ« EFCore å®ä½“ç‰¹æ€§ Key/Required/NotMapped/MaxLength/StringLength/DatabaseGenerated/Table/Column</p>
</blockquote>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>ConfigEntity <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span> <span>{</span>
  <span><span>var</span></span> attr <span>=</span> e<span>.</span>EntityType<span>.</span><span>GetCustomAttributes</span><span>(</span><span>typeof</span><span>(</span><span>MyTableAttribute</span><span>)</span><span>,</span> <span>false</span><span>)</span><span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span> <span>as</span> <span>MyTableAttribute</span><span>;</span>
  <span>if</span> <span>(</span>attr <span>!=</span> <span>null</span><span>)</span>
    e<span>.</span>ModifyResult<span>.</span>Name <span>=</span> attr<span>.</span>Name<span>;</span> <span>//è¡¨å</span>
<span>}</span><span>;</span>
fsql<span>.</span>Aop<span>.</span>ConfigEntityProperty <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span> <span>{</span>
  <span><span>var</span></span> attr <span>=</span> e<span>.</span>Property<span>.</span><span>GetCustomAttributes</span><span>(</span><span>typeof</span><span>(</span><span>MyColumnAttribute</span><span>)</span><span>,</span> <span>false</span><span>)</span><span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span> <span>as</span> <span>MyColumnAttribute</span><span>;</span>
  <span>if</span> <span>(</span>attr <span>!=</span> <span>null</span><span>)</span>
    e<span>.</span>ModifyResult<span>.</span>Name <span>=</span> attr<span>.</span>Name<span>;</span> <span>//å­—æ®µå</span>
<span>}</span><span>;</span>

<span>[</span><span><span>MyTable</span><span><span>(</span><span>"xxx"</span><span>)</span></span></span><span>]</span>
<span>class</span> <span>YourEntity</span> <span>{</span>
  <span>[</span><span><span>MyColumn</span><span><span>(</span><span>"id"</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span><span>int</span></span> pkid <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>class</span> <span>MyTableAttribute</span> <span>:</span> <span><span>Attribute</span></span> <span>{</span>
  <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>}</span>
  <span>public</span> <span>MyTableAttribute</span><span>(</span><span><span>string</span></span> name<span>)</span>
  <span>{</span>
    <span>this</span><span>.</span>Name <span>=</span> name<span>;</span>
  <span>}</span>
<span>}</span>
<span>class</span> <span>MyColumnAttribute</span> <span>:</span> <span><span>Attribute</span></span> <span>{</span>
  <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>}</span>
  <span>public</span> <span>MyColumnAttribute</span><span>(</span><span><span>string</span></span> name<span>)</span>
  <span>{</span>
    <span>this</span><span>.</span>Name <span>=</span> name<span>;</span>
  <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br></div></div><hr>
<h1 id="_19ã€å®¡è®¡-curd" tabindex="-1"> 19ã€å®¡è®¡ CURD</h1>
<p>å¦‚æœå› ä¸ºæŸä¸ª sql éªšæ“ä½œè€—æ—¶å¾ˆé«˜ï¼Œæ²¡æœ‰ä¸€ä¸ªç›¸å…³çš„å®¡è®¡åŠŸèƒ½ï¼Œæ’æŸ¥èµ·æ¥å¯ä»¥è¯´æ— ä»ä¸‹æ‰‹ã€‚</p>
<p>FreeSql æ”¯æŒç®€å•çš„ç±»ä¼¼åŠŸèƒ½ï¼š</p>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>CurdAfter <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span> <span>{</span>
	<span>if</span> <span>(</span>e<span>.</span>ElapsedMilliseconds <span>></span> <span>200</span><span>)</span> <span>{</span>
		<span>//è®°å½•æ—¥å¿—</span>
		<span>//å‘é€çŸ­ä¿¡ç»™è´Ÿè´£äºº</span>
	<span>}</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>åªéœ€è¦ä¸€ä¸ªäº‹ä»¶ï¼Œå°±å¯ä»¥å¯¹å…¨å±€èµ·åˆ°ä½œç”¨ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ª CurdBefore åœ¨æ‰§è¡Œ sql ä¹‹å‰è§¦å‘ï¼Œå¸¸ç”¨äºè®°å½•æ—¥å¿—æˆ–å¼€å‘è°ƒè¯•ã€‚</p>
<hr>
<h1 id="_17ã€å®¡è®¡å±æ€§å€¼" tabindex="-1"> 17ã€å®¡è®¡å±æ€§å€¼</h1>
<p>å®ç°æ’å…¥/æ›´æ–°æ—¶ç»Ÿä¸€å¤„ç†æŸäº›å€¼ï¼Œæ¯”å¦‚æŸå±æ€§çš„é›ªèŠ±ç®—æ³•å€¼ã€åˆ›å»ºæ—¶é—´å€¼ã€ç”šè‡³æ˜¯ä¸šåŠ¡å€¼ã€‚</p>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>AuditValue <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span> <span>{</span>
  <span>if</span> <span>(</span>e<span>.</span>Column<span>.</span>CsType <span>==</span> <span>typeof</span><span>(</span><span><span>long</span></span><span>)</span> <span>&amp;&amp;</span> 
    e<span>.</span>Property<span>.</span><span><span>GetCustomAttribute</span><span><span>&lt;</span>SnowflakeAttribute<span>></span></span></span><span>(</span><span>false</span><span>)</span> <span>!=</span> <span>null</span> <span>&amp;&amp;</span> 
    e<span>.</span>Value<span>?.</span><span>ToString</span><span>(</span><span>)</span> <span>==</span> <span>"0"</span><span>)</span>
    e<span>.</span>Value <span>=</span> <span>new</span> <span>Snowflake</span><span>(</span><span>)</span><span>.</span><span>GetId</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>class</span> <span>Order</span> <span>{</span>
  <span>[</span><span><span>Snowflake</span></span><span>]</span>
  <span>public</span> <span><span>long</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>//...</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p>å½“å±æ€§çš„ç±»å‹æ˜¯ longï¼Œå¹¶ä¸”æ ‡è®°äº† [Snowflake]ï¼Œå¹¶ä¸”å½“å‰å€¼æ˜¯ 0ï¼Œé‚£ä¹ˆåœ¨æ’å…¥/æ›´æ–°æ—¶å®ƒçš„å€¼å°†è®¾ç½®ä¸ºé›ªèŠ±idå€¼ã€‚</p>
<p>è¯´æ˜ï¼šSnowflakeAttribute æ˜¯ä½¿ç”¨è€…æ‚¨æ¥å®šä¹‰ï¼Œnew Snowflake().GetId() ä¹Ÿæ˜¯ç”±ä½¿ç”¨è€…æ‚¨æ¥å®ç°</p>
<p>å¦‚æœå‘½åè§„èŒƒï¼Œå¯ä»¥åœ¨ aop é‡Œåˆ¤æ–­ï¼Œif (e.Property.Name == &quot;createtime&quot;) e.Value = DateTime.Now;</p>
<h1 id="_18ã€ado-net-æ‰©å±•æ–¹æ³•" tabindex="-1"> 18ã€Ado.Net æ‰©å±•æ–¹æ³•</h1>
<p>æä¾›äº†ç±»ä¼¼ Dapper çš„ä½¿ç”¨æ–¹æ³•ï¼ŒFreeSql å¢åŠ äº† IDbConnection/IDbTransaction å¯¹è±¡çš„æ‰©å±•æ–¹æ³• Select/Insert/Update/Delete å®ç° CRUDã€‚</p>
<div><pre><code><span>using</span> <span>FreeSql</span><span>;</span>

<span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> <span>new</span> <span>SqlConnection</span><span>(</span><span>..</span><span>.</span><span>)</span><span>)</span>
<span>{</span>
  <span>IFreeSql</span> fsql <span>=</span> conn<span>.</span><span>GetIFreeSql</span><span>(</span><span>)</span><span>;</span>
  fsql<span>.</span>CodeFirst<span>.</span>IsNoneCommandParameter <span>=</span> <span>true</span><span>;</span>
  fsql<span>.</span>CodeFirst<span>.</span>IsSyncStructureToUpper <span>=</span> <span>true</span><span>;</span>
  fsql<span>.</span>Aop<span>.</span>CommandBefore <span>+=</span> <span>(</span>_<span>,</span> e<span>)</span> <span>=></span> Trace<span>.</span><span>WriteLine</span><span>(</span>e<span>.</span>Command<span>.</span>CommandText<span>)</span><span>;</span>
  <span>//ä»¥ä¸Šæ•´ä¸ªç¨‹åºåªéœ€è¦è®¾ç½®ä¸€æ¬¡</span>

  conn<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>..</span><span>.</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

  conn<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>T</span> <span>{</span><span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
  conn<span>.</span><span>Update</span><span>(</span><span>)</span><span>.</span><span>SetSource</span><span>(</span><span>new</span> <span>T</span> <span>{</span><span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
  conn<span>.</span><span>InsertOrUpdate</span><span>(</span><span>)</span><span>.</span><span>SetSource</span><span>(</span><span>new</span> <span>T</span> <span>{</span><span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>

  conn<span>.</span><span><span>Delete</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>..</span><span>.</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><ul>
<li>æ¯ä¸ª SqlConnection GetFreeSql() è¿”å›çš„ IFreeSql å®ä¾‹ç›¸åŒï¼›</li>
<li>å¯ä»¥å¯¹ fsql è®¾ç½® Aop äº‹ä»¶ï¼Œæ¯”å¦‚ç›‘è§† SQLï¼›</li>
<li>IFreeSql è‡ªèº«çš„æˆå‘˜ IDbFirstã€Transaction ä¸å¯ç”¨ï¼›</li>
</ul>
<p>åˆ©ç”¨æœ¬åŠŸèƒ½å¯ä»¥å¿«é€Ÿå°† FreeSql ä½¿ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œåªéœ€è¦å¤„ç†å¥½å®ä½“ç±»çš„ç‰¹æ€§ã€‚</p>
<p>æç¤ºï¼šFreeSql å…¼å®¹ EFCore 99% çš„å®ä½“ç‰¹æ€§</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">å¤šç§Ÿæˆ·</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/multi-tenancy.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/multi-tenancy.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å¤šç§Ÿæˆ·" tabindex="-1"> å¤šç§Ÿæˆ·</h1>
<h3 id="ä»€ä¹ˆæ˜¯å¤šç§Ÿæˆ·" tabindex="-1"> ä»€ä¹ˆæ˜¯å¤šç§Ÿæˆ·</h3>
<p>ç»´åŸºç™¾ç§‘ï¼šâ€œè½¯ä»¶å¤šç§Ÿæˆ·æ˜¯æŒ‡ä¸€ç§è½¯ä»¶æ¶æ„ï¼Œåœ¨è¿™ç§è½¯ä»¶æ¶æ„ä¸­ï¼Œè½¯ä»¶çš„ä¸€ä¸ªå®ä¾‹è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šå¹¶ä¸”ä¸ºå¤šä¸ªç§Ÿæˆ·æœåŠ¡â€ã€‚ä¸€ä¸ªç§Ÿæˆ·æ˜¯ä¸€ç»„å…±äº«è¯¥è½¯ä»¶å®ä¾‹ç‰¹å®šæƒé™çš„ç”¨æˆ·ã€‚æœ‰äº†å¤šç§Ÿæˆ·æ¶æ„ï¼Œè½¯ä»¶åº”ç”¨è¢«è®¾è®¡æˆä¸ºæ¯ä¸ªç§Ÿæˆ·æä¾›ä¸€ä¸ª ä¸“ç”¨çš„å®ä¾‹åŒ…æ‹¬è¯¥å®ä¾‹çš„æ•°æ®çš„å…±äº«ï¼Œè¿˜å¯ä»¥å…±äº«é…ç½®ï¼Œç”¨æˆ·ç®¡ç†ï¼Œç§Ÿæˆ·è‡ªå·±çš„åŠŸèƒ½å’ŒéåŠŸèƒ½å±æ€§ã€‚å¤šç§Ÿæˆ·å’Œå¤šå®ä¾‹æ¶æ„ç›¸æ¯”ï¼Œå¤šç§Ÿæˆ·åˆ†ç¦»äº†ä»£è¡¨ä¸åŒçš„ç§Ÿæˆ·æ“ä½œçš„å¤šä¸ªå®ä¾‹ã€‚</p>
<p>å¤šç§Ÿæˆ·ç”¨äºåˆ›å»º Saasï¼ˆSoftware as-a serviceï¼‰åº”ç”¨ï¼ˆäº‘å¤„ç†ï¼‰ã€‚</p>
<h3 id="æ–¹æ¡ˆä¸€-æŒ‰ç§Ÿæˆ·å­—æ®µåŒºåˆ†" tabindex="-1"> æ–¹æ¡ˆä¸€ï¼šæŒ‰ç§Ÿæˆ·å­—æ®µåŒºåˆ†</h3>
<p>FreeSql.Repository å®ç°äº† filterï¼ˆè¿‡æ»¤ä¸éªŒè¯ï¼‰åŠŸèƒ½ï¼Œå¦‚ï¼š</p>
<div><pre><code><span><span>var</span></span> topicRepos <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span>t <span>=></span> t<span>.</span>TerantId <span>==</span> <span>1</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ä½¿ç”¨ topicRepos å¯¹è±¡è¿›è¡Œ CURD æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨æŸ¥è¯¢/ä¿®æ”¹/åˆ é™¤æ—¶é™„åŠ æ­¤æ¡ä»¶ï¼Œä»è€Œè¾¾åˆ°ä¸ä¼šä¿®æ”¹ TerantId != 1 çš„æ•°æ®ï¼›</li>
<li>åœ¨æ·»åŠ æ—¶ï¼Œä½¿ç”¨è¡¨è¾¾å¼éªŒè¯æ•°æ®çš„åˆæ³•æ€§ï¼Œè‹¥ä¸åˆæ³•åˆ™æŠ›å‡ºå¼‚å¸¸ï¼›</li>
</ul>
<p>åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°æ•°æ®åˆ†åŒºï¼Œè¾¾åˆ°ç§Ÿæˆ·çš„ç›®çš„ã€‚</p>
<h3 id="wherecascade" tabindex="-1"> WhereCascade</h3>
<p>å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œåƒ isdeleted æ¯ä¸ªè¡¨éƒ½ç»™æ¡ä»¶ï¼ŒæŒºéº»çƒ¦çš„ã€‚WhereCascade ä½¿ç”¨åç”Ÿæˆ sql æ—¶ï¼Œæ‰€æœ‰è¡¨éƒ½é™„ä¸Šè¿™ä¸ªæ¡ä»¶ã€‚å¤šè¡¨ç§Ÿæˆ·æ¡ä»¶ä¹Ÿå¯ä»¥è¿™æ ·è§£å†³ã€‚</p>
<p>å¦‚ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>t1<span>></span></span></span><span>(</span><span>)</span>
<span>.</span><span><span>LeftJoin</span><span><span>&lt;</span>t2<span>></span></span></span><span>(</span><span>..</span><span>.</span><span>)</span>
<span>.</span><span>WhereCascade</span><span>(</span>x <span>=></span> x<span>.</span>IsDeleted <span>==</span> <span>false</span><span>)</span>
<span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å¾—åˆ°çš„ SQLï¼š</p>
<div><pre><code><span>SELECT</span> <span>.</span><span>.</span><span>.</span>
<span>FROM</span> t1
<span>LEFT</span> <span>JOIN</span> t2 <span>on</span> <span>.</span><span>.</span><span>.</span> <span>AND</span> <span>(</span>t2<span>.</span>IsDeleted <span>=</span> <span>0</span><span>)</span>
<span>WHERE</span> t1<span>.</span>IsDeleted <span>=</span> <span>0</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å®ä½“å¯é™„åŠ è¡¨è¾¾å¼æ—¶æ‰ç”Ÿæ•ˆï¼Œæ”¯æŒå­è¡¨æŸ¥è¯¢ã€‚å•æ¬¡æŸ¥è¯¢ä½¿ç”¨çš„è¡¨æ•°ç›®è¶Šå¤šæ”¶ç›Šè¶Šå¤§ã€‚</p>
<p>å¯åº”ç”¨èŒƒå›´ï¼š</p>
<ul>
<li>å­æŸ¥è¯¢ï¼Œä¸€å¯¹å¤šã€å¤šå¯¹å¤šã€è‡ªå®šä¹‰çš„å­æŸ¥è¯¢ï¼›</li>
<li>Join æŸ¥è¯¢ï¼Œå¯¼èˆªå±æ€§ã€è‡ªå®šä¹‰çš„ Join æŸ¥è¯¢ï¼›</li>
<li>Include/IncludeMany çš„å­é›†åˆæŸ¥è¯¢ï¼›</li>
</ul>
<blockquote>
<p>æš‚æ—¶ä¸æ”¯æŒã€å»¶æ—¶å±æ€§ã€‘çš„å¹¿æ’­ï¼›</p>
</blockquote>
<blockquote>
<p>æ­¤åŠŸèƒ½å’Œã€è¿‡æ»¤å™¨ã€‘ä¸åŒï¼Œç”¨äºå•æ¬¡å¤šè¡¨æŸ¥è¯¢æ¡ä»¶çš„ä¼ æ’­ï¼›</p>
</blockquote>
<h3 id="æ–¹æ¡ˆäºŒ-æŒ‰ç§Ÿæˆ·åˆ†è¡¨" tabindex="-1"> æ–¹æ¡ˆäºŒï¼šæŒ‰ç§Ÿæˆ·åˆ†è¡¨</h3>
<p>FreeSql.Repository å®ç°äº† åˆ†è¡¨åŠŸèƒ½ï¼Œå¦‚ï¼š</p>
<div><pre><code><span><span>var</span></span> tenantId <span>=</span> <span>1</span><span>;</span>
<span><span>var</span></span> reposTopic <span>=</span> orm<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>null</span><span>,</span> oldname <span>=></span> <span><span>$"</span><span><span>{</span><span>oldname</span><span>}</span></span><span><span>{</span><span>tenantId</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>ä¸Šé¢æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªä»“å‚¨æŒ‰ç§Ÿæˆ·åˆ†è¡¨ï¼Œä½¿ç”¨å®ƒ CURD æœ€ç»ˆä¼šæ“ä½œ Topic_1 è¡¨ã€‚</p>
<blockquote>
<p>æ›´å¤šè¯´æ˜å‚è€ƒï¼š<a href="/guide/repository.html">ã€ŠFreeSql.Repository ä»“å‚¨ã€‹</a></p>
</blockquote>
<h3 id="æ–¹æ¡ˆä¸‰-æŒ‰ç§Ÿæˆ·åˆ†åº“" tabindex="-1"> æ–¹æ¡ˆä¸‰ï¼šæŒ‰ç§Ÿæˆ·åˆ†åº“</h3>
<p>ä¸æ–¹æ¡ˆäºŒç›¸åŒï¼Œåªæ˜¯è¡¨å­˜å‚¨çš„ä½ç½®ä¸åŒï¼Œè¯·æŸ¥çœ‹ <a href="/guide/repository.html">ã€ŠFreeSql.Repository ä»“å‚¨ã€‹</a>ã€<a href="/guide/sharding.html">ã€Šåˆ†è¡¨åˆ†åº“ã€‹</a>ã€‚</p>
<h3 id="å¤šè¡¨æŸ¥è¯¢" tabindex="-1"> å¤šè¡¨æŸ¥è¯¢</h3>
<p>åˆ†è¡¨ä¸‹çš„ç§Ÿæˆ·ä¹Ÿæ”¯æŒå¤šè¡¨æŸ¥è¯¢ï¼Œå¾—ç›Šäº FreeSql æä¾›çš„ä¼˜è‰¯åŸºç¡€ã€‚è¿™éƒ¨ä»½ä»ç„¶åœ¨ FreeSql.Repository æ‰©å±•åº“ä¸­å®ç°çš„ã€‚</p>
<div><pre><code><span><span>var</span></span> tenantId <span>=</span> <span>1</span><span>;</span>
<span>//è”è¡¨æŸ¥è¯¢ä¹Ÿæ”¯æŒ</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>AsTable</span><span>(</span><span>(</span>type<span>,</span> oldname<span>)</span> <span>=></span> <span><span>$"</span><span><span>{</span><span>oldname</span><span>}</span></span><span><span>{</span><span>tenantId</span><span>}</span></span><span>"</span></span><span>)</span>
    <span>.</span><span><span>LeftJoin</span><span><span>&lt;</span>TopicType<span>></span></span></span><span>(</span><span>(</span>a<span>,</span> b<span>)</span> <span>=></span> a<span>.</span>TypeId <span>==</span> b<span>.</span>Id<span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>ä¸Šè¿°ä»£ç çš„ä½¿ç”¨ï¼Œå°†ä¸¤ä¸ªè®¾ç½®å¥½çš„ç§Ÿæˆ·ä»“å‚¨åˆå¹¶èµ·æ¥æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ç§Ÿæˆ· 1 ä¸‹çš„ topic + topictype æ•°æ®ï¼Œæ‰§è¡Œçš„ SQL è¯­å¥ï¼š</p>
<div><pre><code><span>SELECT</span> <span>.</span><span>.</span><span>.</span>
<span>FROM</span> <span>"Topic_1"</span> a
<span>LEFT</span> <span>JOIN</span> <span>"TopicType_1"</span> b <span>ON</span> a<span>.</span><span>"TypeId"</span> <span>=</span> b<span>.</span><span>"Id"</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h3 id="å®ç°å…¨å±€æ§åˆ¶ç§Ÿæˆ·" tabindex="-1"> å®ç°å…¨å±€æ§åˆ¶ç§Ÿæˆ·</h3>
<p>FreeSql.Repository Autofac æ³¨å…¥æ–¹å¼å®ç°äº†å…¨å±€ã€è¿‡æ»¤ä¸éªŒè¯ã€‘çš„è®¾å®šï¼Œæ–¹ä¾¿ç§Ÿæˆ·åŠŸèƒ½çš„è®¾è®¡ï¼›</p>
<p>å…·ä½“å¯å‚è€ƒï¼š<a href="/guide/filters.html">ã€Šè¿‡æ»¤å™¨ã€‹</a></p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">å¯¼èˆªå±æ€§ âœ¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/navigate-attribute.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/navigate-attribute.html"/>
    <updated>2022-06-13T15:02:40.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å¯¼èˆªå±æ€§-âœ¨" tabindex="-1"> å¯¼èˆªå±æ€§ âœ¨</h1>
<p>å¯¼èˆªå±æ€§æ˜¯ FreeSql çš„ç‰¹è‰²åŠŸèƒ½ä¹‹ä¸€ï¼Œå¯é€šè¿‡çº¦å®šé…ç½®ã€æˆ–è‡ªå®šä¹‰é…ç½®å¯¹è±¡é—´çš„å…³ç³»ã€‚</p>
<p>å¯¼èˆªå±æ€§æœ‰ OneToMany, ManyToOne, ManyToMany, OneToOne, Parent, <a href="https://www.cnblogs.com/FreeSql/p/16351417.html" target="_blank" rel="noopener noreferrer">PgArrayToMany</a> å…­ç§é…ç½®å…³ç³»ã€‚</p>
<p>æœ‰äº†å¯¼èˆªå±æ€§ï¼Œå¤šè¡¨æŸ¥è¯¢ä¼šéå¸¸æ–¹ä¾¿ï¼Œlambda è¡¨è¾¾å¼ä¸­ç›´æ¥ä½¿ç”¨å¯¼èˆªå¯¹è±¡ç‚¹ç‚¹ç‚¹ï¼Œèˆ’æœï¼ï¼</p>
<ul>
<li>å¯çº¦å®šï¼ˆå‘½åçº¦å®šï¼‰ï¼Œå¯ä¸çº¦å®šï¼ˆéœ€æŒ‡å®š Navigate ç‰¹æ€§å…³è”ï¼‰ï¼›</li>
<li>æ— å…³è”çš„ï¼ŒæŸ¥è¯¢æ—¶å¯ä»¥æŒ‡æ˜ On æ¡ä»¶ï¼ŒLeftJoin(a =&gt; a.Parent.Id == a.ParentId)ï¼›</li>
<li>å·²å…³è”çš„ï¼Œç›´æ¥ä½¿ç”¨å¯¼èˆªå¯¹è±¡å°±è¡Œï¼ŒOn æ¡ä»¶ä¼šè‡ªåŠ¨é™„ä¸Šï¼›</li>
</ul>
<p><a href="https://www.cnblogs.com/kellynic/p/13575053.html" target="_blank" rel="noopener noreferrer">ã€Šå¯¼èˆªå±æ€§ã€åˆ°åº•ã€‘å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿã€‹</a></p>
<blockquote>
<p>é¢„çƒ­è¯´æ˜ï¼šå¯¼èˆªå±æ€§åŠ è½½ï¼Œå› ä¸ºè¦è§£å†³æ­»å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå½“å¼•ç”¨å…³ç³»å¾ˆå¤æ‚çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å¯¼è‡´é¦–æ¬¡ä½¿ç”¨å¯¼èˆªå±æ€§å¤±è´¥ï¼Œç¬¬äºŒæ¬¡å°±å¯ä»¥äº†ã€‚è§£å†³åŠæ³•å¯ä»¥ç¨‹åºå¯åŠ¨æ—¶å°±é¢„çƒ­æ‰€æœ‰å®ä½“ç±»ï¼Œå¾ªç¯æ‰§è¡Œ fsql.Select&lt;object&gt;().AsType(å®ä½“ç±»);</p>
</blockquote>
<h1 id="è‡ªå®šä¹‰å¯¼èˆªå…³ç³»" tabindex="-1"> è‡ªå®šä¹‰å¯¼èˆªå…³ç³»</h1>
<div><pre><code><span>//å¯¼èˆªå±æ€§ï¼ŒOneToMany</span>
<span>[</span><span>Navigate</span><span>(</span><span>nameof</span><span>(</span>song_tag<span>.</span>song_id<span>)</span><span>)</span><span>]</span>
<span>public</span> <span>virtual</span> <span>List<span>&lt;</span>song_tag<span>></span></span> Obj_song_tag <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>//åœ¨ song_tag æŸ¥æ‰¾ song_id å±æ€§ï¼Œä¸ æœ¬å®ä½“.ä¸»é”® å…³è”</span>

<span>//å¯¼èˆªå±æ€§ï¼ŒManyToOne/OneToOne</span>
<span>[</span><span>Navigate</span><span>(</span><span>nameof</span><span>(</span>song_id<span>)</span><span>)</span><span>]</span>
<span>public</span> <span>virtual</span> <span>Song</span> Obj_song <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>//åœ¨ æœ¬å®ä½“ æŸ¥æ‰¾ song_id å±æ€§ï¼Œä¸ Song.ä¸»é”® å…³è”</span>

<span>//å¯¼èˆªå±æ€§ï¼ŒManyToMany</span>
<span>[</span><span>Navigate</span><span>(</span>ManyToMany <span>=</span> <span>typeof</span><span>(</span><span>tag_song</span><span>)</span><span>)</span><span>]</span>
<span>public</span> <span>virtual</span> <span>List<span>&lt;</span>tag<span>></span></span> tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><hr>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ FluentApi åœ¨å¤–éƒ¨è®¾ç½®å¯¼èˆªå…³ç³»ï¼š</p>
<div><pre><code>fsql<span>.</span>CodeFirst<span>.</span><span><span>ConfigEntity</span><span><span>&lt;</span>å®ä½“ç±»<span>></span></span></span><span>(</span>a <span>=></span> a
    <span>.</span><span>Navigate</span><span>(</span>b <span>=></span> b<span>.</span>roles<span>,</span> <span>null</span><span>,</span> <span>typeof</span><span>(</span><span>å¤šå¯¹å¤šä¸­é—´å®ä½“ç±»</span><span>)</span><span>)</span>
    <span>.</span><span>Navigate</span><span>(</span>b <span>=></span> b<span>.</span>users<span>,</span> <span>"uid"</span><span>)</span>
<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>ä¼˜å…ˆçº§ï¼Œç‰¹æ€§ &gt; FluentApi</p>
<blockquote>
<p>æ³¨æ„ï¼š</p>
</blockquote>
<p>1ã€å±æ€§è®¾ç½® Column(IsIgnore = true) åï¼Œå¯¼èˆªå±æ€§ä¼šå¤±æ•ˆ</p>
<p>2ã€Navigate è®¾ç½®çš„å­—ç¬¦ä¸²æ˜¯ ç±»å±æ€§åï¼Œä¸æ˜¯è¡¨ å­—æ®µåï¼ï¼ï¼</p>
<h1 id="æ£€æµ‹å¯¼èˆªå±æ€§" tabindex="-1"> æ£€æµ‹å¯¼èˆªå±æ€§</h1>
<p>å¦‚ä½•æ£€æµ‹ä¸€ä¸ªå¯¼èˆªå±æ€§æ˜¯å¦é…ç½®ç”Ÿæ•ˆï¼š</p>
<div><pre><code><span><span>var</span></span> tbref <span>=</span> fsql<span>.</span>CodeFirst
    <span>.</span><span>GetTableByEntity</span><span>(</span><span>typeof</span><span>(</span><span>T</span><span>)</span><span>)</span>
    <span>.</span><span>GetTableRef</span><span>(</span><span>"Children"</span><span>,</span> <span>true</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>GetTableRef(string propertyName, bool isThrow);</p>
<h1 id="çº¦å®šå‘½å-æ— é¡»æŒ‡æ˜-navigate" tabindex="-1"> çº¦å®šå‘½åï¼ˆæ— é¡»æŒ‡æ˜ Navigateï¼‰</h1>
<h3 id="onetoone-ä¸€å¯¹ä¸€" tabindex="-1"> OneToOne ä¸€å¯¹ä¸€</h3>
<div><pre><code><span>class</span> <span>User</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Idã€UserIdã€User_id</span>

    <span>public</span> <span>UserExt</span> UserExt <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>class</span> <span>UserExt</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Idã€UserIdã€User_idã€UserExtIdã€UserExt_id</span>

    <span>public</span> <span>User</span> User <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p><a href="https://github.com/2881099/FreeSql/issues/45" target="_blank" rel="noopener noreferrer">ã€ŠOneToOne ä¸€å¯¹ä¸€ï¼Œæ€ä¹ˆæ·»åŠ æ•°æ®ï¼Ÿã€‹</a></p>
<h3 id="manytoone-å¤šå¯¹ä¸€" tabindex="-1"> ManyToOne å¤šå¯¹ä¸€</h3>
<div><pre><code><span>class</span> <span>Group</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Idã€GroupIdã€Group_id</span>
<span>}</span>

<span>class</span> <span>User</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Idã€UserIdã€User_id</span>


    <span>public</span> <span><span>int</span></span> AGroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Group</span> AGroup <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> BGroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Group</span> BGroup <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><h3 id="onetomany-ä¸€å¯¹å¤š" tabindex="-1"> OneToMany ä¸€å¯¹å¤š</h3>
<div><pre><code><span>class</span> <span>Group</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Idã€GroupIdã€Group_id</span>

    <span>public</span> <span>ICollection<span>&lt;</span>User<span>></span></span> AUsers <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>ICollection<span>&lt;</span>User<span>></span></span> BUsers <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>class</span> <span>User</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Idã€UserIdã€User_id</span>


    <span>public</span> <span><span>int</span></span> AGroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Group</span> AGroup <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> BGroupId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Group</span> BGroup <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><p><a href="https://github.com/2881099/FreeSql/issues/46" target="_blank" rel="noopener noreferrer">ã€ŠOneToMany ä¸€å¯¹å¤šï¼Œæ€ä¹ˆæ·»åŠ æ•°æ®ï¼Ÿã€‹</a></p>
<h3 id="parent-çˆ¶å­" tabindex="-1"> Parent çˆ¶å­</h3>
<div><pre><code><span>class</span> <span>Group</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//Idã€GroupIdã€Group_id</span>

    <span>public</span> <span><span>int</span></span> ParentId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>//ParentIdã€Parent_id</span>
    <span>public</span> <span>Group</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>ICollection<span>&lt;</span>Group<span>></span></span> Childs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>çˆ¶å­å…³ç³»ï¼Œä¸ä¸€å¯¹å¤šå…¶å®å·®ä¸å¤šï¼Œæ·»åŠ æ•°æ®å‚æ•°ä¸Šé¢çš„è¿æ¥ï¼›</p>
<h3 id="manytomany-å¤šå¯¹å¤š" tabindex="-1"> ManyToMany å¤šå¯¹å¤š</h3>
<div><pre><code><span>class</span> <span>Song</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>Song_tag</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Song_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Song</span> Song <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> Tag_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Tag</span> Tag <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>Tag</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span><span>?</span></span> Parent_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Tag</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div><p>Songã€Tagã€Song_tagï¼Œè¿™ä¸‰ä¸ªå®ä½“ä½¿ç”¨äº† OneToManyã€ManyToOneã€Parentã€ManyToMany 4 ç§å…³ç³»ã€‚</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">åˆ†é¡µæŸ¥è¯¢</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/paging.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/paging.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åˆ†é¡µæŸ¥è¯¢" tabindex="-1"> åˆ†é¡µæŸ¥è¯¢</h1>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=10"</span><span>)</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> CategoryId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h2 id="æ¯é¡µ-20-æ¡æ•°æ®-æŸ¥è¯¢ç¬¬-1-é¡µ" tabindex="-1"> æ¯é¡µ 20 æ¡æ•°æ®ï¼ŒæŸ¥è¯¢ç¬¬ 1 é¡µ</h2>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>></span> <span>10</span><span>)</span>
    <span>.</span><span>Count</span><span>(</span><span>out</span> <span><span>var</span></span> total<span>)</span> <span>//æ€»è®°å½•æ•°é‡</span>
    <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>20</span><span>)</span>
    <span>.</span><span>Tolist</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><blockquote>
<p>æ³¨æ„ï¼š ä¸Šè¿°ä¾‹å­æ˜¯å¯¹å•è¡¨è¿›è¡Œçš„æŸ¥è¯¢ã€‚å¦‚æœæ‚¨æ­£åœ¨å¯¹å¤šè¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œå¿…é¡»è¦åœ¨ Count ä¹‹å‰å…ˆè¿›è¡Œæ’åºï¼Œé˜²æ­¢å‡ºç°ä¸å¯ç†è§£çš„åˆ†é¡µæƒ…å†µã€‚å½“ç„¶ï¼Œå³ä½¿æ˜¯å•è¡¨ï¼Œä¸ºäº†é˜²æ­¢è®©åˆ†é¡µçš„æ¬¡åºæ˜ç¡®ï¼Œä¹Ÿå»ºè®®å…ˆæ’åºã€‚</p>
</blockquote>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>></span> <span>10</span><span>)</span>
    <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>MsgTime<span>)</span>
    <span>.</span><span>Count</span><span>(</span><span>out</span> <span><span>var</span></span> total<span>)</span> <span>//æ€»è®°å½•æ•°é‡</span>
    <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>20</span><span>)</span>
    <span>.</span><span>Tolist</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="ä¼˜åŒ–" tabindex="-1"> ä¼˜åŒ–</h2>
<p>SqlServer 2012 ä»¥å‰çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ row_number åˆ†é¡µï¼›</p>
<p>SqlServer 2012+ ç‰ˆæœ¬ï¼Œä½¿ç”¨æœ€æ–°çš„ fetch next rows åˆ†é¡µï¼›</p>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
</tr>
<tr>
<td>ToList</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å› T1 å®ä½“æ‰€æœ‰å­—æ®µçš„è®°å½•ï¼Œè‹¥å­˜åœ¨å¯¼èˆªå±æ€§åˆ™ä¸€èµ·æŸ¥è¯¢è¿”å›ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å›æŒ‡å®šå­—æ®µçš„è®°å½•ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>string field</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å› field æŒ‡å®šå­—æ®µçš„è®°å½•ï¼Œå¹¶ä»¥å…ƒç»„æˆ–åŸºç¡€ç±»å‹(int,string,long)æ¥æ”¶ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>ã€åˆ†é¡µã€‘</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Count</td>
<td>long</td>
<td></td>
<td>æŸ¥è¯¢çš„è®°å½•æ•°é‡</td>
</tr>
<tr>
<td>Count</td>
<td>&lt;this&gt;</td>
<td>out long</td>
<td>æŸ¥è¯¢çš„è®°å½•æ•°é‡ï¼Œä»¥å‚æ•° out å½¢å¼è¿”å›</td>
</tr>
<tr>
<td>Skip</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>æŸ¥è¯¢å‘ååç§»è¡Œæ•°</td>
</tr>
<tr>
<td>Offset</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>æŸ¥è¯¢å‘ååç§»è¡Œæ•°</td>
</tr>
<tr>
<td>Limit</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>æŸ¥è¯¢å¤šå°‘æ¡æ•°æ®</td>
</tr>
<tr>
<td>Take</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>æŸ¥è¯¢å¤šå°‘æ¡æ•°æ®</td>
</tr>
<tr>
<td>Page</td>
<td>&lt;this&gt;</td>
<td>int pageIndex, int pageSize</td>
<td>åˆ†é¡µ</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">æ€§èƒ½</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/performance.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/performance.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æ€§èƒ½" tabindex="-1"> æ€§èƒ½</h1>
<p>FreeSql å®ç°äº†å¼ºå¤§åŠŸèƒ½çš„åŒæ—¶ï¼Œæ€§èƒ½æ²¡æœ‰å—åˆ°å½±å“ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨åå°„æˆ–è€—æ—¶çš„æ“ä½œéƒ½ç»è¿‡äº†ç¼“å­˜å¤„ç†ã€‚è¯»å–æ•°æ®éƒ¨åˆ†é‡‡ç”¨äº† ExpressionTreeï¼Œä½¿å¾— FreeSql è§£æå®ä½“æ•°æ®çš„é€Ÿåº¦ä¸ Dapper éå¸¸æ¥è¿‘ã€‚</p>
<h1 id="æ’å…¥æµ‹è¯•" tabindex="-1"> æ’å…¥æµ‹è¯•</h1>
<h3 id="æµ‹è¯•ç»“æœ-52-ä¸ªå­—æ®µ" tabindex="-1"> æµ‹è¯•ç»“æœ(52 ä¸ªå­—æ®µ)</h3>
<table>
<thead>
<tr>
<th></th>
<th>18W</th>
<th>1W</th>
<th>5K</th>
<th>2K</th>
<th>1K</th>
<th>500</th>
<th>100</th>
<th>50</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql 5.5 ExecuteAffrows</td>
<td>38,481</td>
<td>2,234</td>
<td>1,136</td>
<td>284</td>
<td>239</td>
<td>167</td>
<td>66</td>
<td>30</td>
</tr>
<tr>
<td>MySql 5.5 ExecuteMySqlBulkCopy</td>
<td>28,405</td>
<td>1,142</td>
<td>657</td>
<td>451</td>
<td>435</td>
<td>592</td>
<td>47</td>
<td>22</td>
</tr>
<tr>
<td>SqlServer Express ExecuteAffrows</td>
<td>402,355</td>
<td>24,847</td>
<td>11,465</td>
<td>4,971</td>
<td>2,437</td>
<td>915</td>
<td>138</td>
<td>88</td>
</tr>
<tr>
<td>SqlServer Express ExecuteSqlBulkCopy</td>
<td>21,065</td>
<td>578</td>
<td>326</td>
<td>139</td>
<td>105</td>
<td>79</td>
<td>60</td>
<td>48</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecuteAffrows</td>
<td>46,756</td>
<td>3,294</td>
<td>2,269</td>
<td>1,019</td>
<td>374</td>
<td>209</td>
<td>51</td>
<td>37</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecutePgCopy</td>
<td>10,090</td>
<td>583</td>
<td>337</td>
<td>136</td>
<td>88</td>
<td>61</td>
<td>30</td>
<td>25</td>
</tr>
<tr>
<td>Oracle XE ExecuteAffrows</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>24,528</td>
<td>10,648</td>
<td>571</td>
<td>200</td>
</tr>
<tr>
<td>Sqlite ExecuteAffrows</td>
<td>28,554</td>
<td>1,149</td>
<td>701</td>
<td>327</td>
<td>155</td>
<td>91</td>
<td>44</td>
<td>35</td>
</tr>
</tbody>
</table>
<blockquote>
<p>18W è§£é‡Šï¼šæ’å…¥ 18 ä¸‡è¡Œè®°å½•ï¼Œè¡¨æ ¼ä¸­çš„æ•°å­—æ˜¯æ‰§è¡Œæ—¶é—´ï¼ˆå•ä½ msï¼‰</p>
</blockquote>
<blockquote>
<p>Oracle æ’å…¥æ€§èƒ½ä¸ç”¨æ€€ç–‘ï¼Œå¯èƒ½å®‰è£…å­¦ç”Ÿç‰ˆé™åˆ¶è¾ƒå¤§</p>
</blockquote>
<p>æé†’ï¼šå¼€æºæ•°æ®åº“æµ‹è¯•ç»“æœæ¯”è¾ƒæœ‰æ„ä¹‰ï¼Œå•†ä¸šæ•°æ®åº“ç‰ˆæœ¬ä¹‹é—´æ€§èƒ½å¯èƒ½æœ‰è¾ƒå¤§å·®è·</p>
<h3 id="æµ‹è¯•ç»“æœ-10-ä¸ªå­—æ®µ" tabindex="-1"> æµ‹è¯•ç»“æœ(10 ä¸ªå­—æ®µ)</h3>
<table>
<thead>
<tr>
<th></th>
<th>18W</th>
<th>1W</th>
<th>5K</th>
<th>2K</th>
<th>1K</th>
<th>500</th>
<th>100</th>
<th>50</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySql 5.5 ExecuteAffrows</td>
<td>11,171</td>
<td>866</td>
<td>366</td>
<td>80</td>
<td>83</td>
<td>50</td>
<td>24</td>
<td>34</td>
</tr>
<tr>
<td>MySql 5.5 ExecuteMySqlBulkCopy</td>
<td>6,504</td>
<td>399</td>
<td>257</td>
<td>116</td>
<td>87</td>
<td>100</td>
<td>16</td>
<td>16</td>
</tr>
<tr>
<td>SqlServer Express ExecuteAffrows</td>
<td>47,204</td>
<td>2,275</td>
<td>1,108</td>
<td>488</td>
<td>279</td>
<td>123</td>
<td>35</td>
<td>16</td>
</tr>
<tr>
<td>SqlServer Express ExecuteSqlBulkCopy</td>
<td>4,248</td>
<td>127</td>
<td>71</td>
<td>30</td>
<td>48</td>
<td>14</td>
<td>11</td>
<td>10</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecuteAffrows</td>
<td>9,786</td>
<td>568</td>
<td>336</td>
<td>157</td>
<td>102</td>
<td>34</td>
<td>9</td>
<td>6</td>
</tr>
<tr>
<td>PostgreSQL 10 ExecutePgCopy</td>
<td>4,081</td>
<td>167</td>
<td>93</td>
<td>39</td>
<td>21</td>
<td>12</td>
<td>4</td>
<td>2</td>
</tr>
<tr>
<td>Oracle XE ExecuteAffrows</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>2,394</td>
<td>731</td>
<td>67</td>
<td>33</td>
</tr>
<tr>
<td>Sqlite ExecuteAffrows</td>
<td>4,524</td>
<td>246</td>
<td>137</td>
<td>94</td>
<td>35</td>
<td>19</td>
<td>14</td>
<td>11</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æµ‹è¯•ç»“æœï¼Œæ˜¯åœ¨ç›¸åŒæ“ä½œç³»ç»Ÿä¸‹è¿›è¡Œçš„ï¼Œå¹¶ä¸”éƒ½æœ‰é¢„çƒ­</p>
</blockquote>
<blockquote>
<p>ExecuteMySqlBulkCopy æ–¹æ³•åœ¨ FreeSql.Provider.MySqlConnector ä¸­å®ç°çš„</p>
</blockquote>
<div><pre><code><span>//æµ‹è¯•å®ä½“ç±»</span>
<span>public</span> <span>class</span> <span>TestInsert10c</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>string</span></span> UserName0 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> PassWord0 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime0 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>string</span></span> UserName1 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> PassWord1 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime1 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>string</span></span> UserName2 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> PassWord2 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime2 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>//ç”Ÿæˆæµ‹è¯•æ•°æ®</span>
<span>IFreeSql</span> orm <span>=</span> <span>..</span><span>.</span><span>;</span>
<span><span>var</span></span> testCount <span>=</span> <span>10000</span><span>;</span>
<span><span>var</span></span> t10cs <span>=</span> <span>new</span> <span>List<span>&lt;</span>TestInsert10c<span>></span></span><span>(</span><span>)</span><span>;</span>
<span>for</span> <span>(</span><span><span>var</span></span> a <span>=</span> <span>0</span><span>;</span> a <span>&lt;</span> testCount<span>;</span> a<span>++</span><span>)</span> <span>{</span>
    <span><span>var</span></span> item <span>=</span> <span>new</span> <span>TestInsert10c</span><span>(</span><span>)</span><span>;</span>
    <span>for</span> <span>(</span><span><span>var</span></span> b <span>=</span> <span>0</span><span>;</span> b <span>&lt;=</span> <span>2</span><span>;</span> b<span>++</span><span>)</span>
    <span>{</span>
        orm<span>.</span><span>SetEntityValueWithPropertyName</span><span>(</span><span>typeof</span><span>(</span><span>TestInsert10c</span><span>)</span><span>,</span> item<span>,</span> <span>"UserName"</span> <span>+</span> b<span>,</span> Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>.</span><span>ToString</span><span>(</span><span>"N"</span><span>)</span><span>)</span><span>;</span>
        orm<span>.</span><span>SetEntityValueWithPropertyName</span><span>(</span><span>typeof</span><span>(</span><span>TestInsert10c</span><span>)</span><span>,</span> item<span>,</span> <span>"PassWord"</span> <span>+</span> b<span>,</span> Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>.</span><span>ToString</span><span>(</span><span>"N"</span><span>)</span><span>)</span><span>;</span>
        orm<span>.</span><span>SetEntityValueWithPropertyName</span><span>(</span><span>typeof</span><span>(</span><span>TestInsert10c</span><span>)</span><span>,</span> item<span>,</span> <span>"CreateTime"</span> <span>+</span> b<span>,</span> DateTime<span>.</span>Now<span>)</span><span>;</span>
    <span>}</span>
    t10cs<span>.</span><span>Add</span><span>(</span>item<span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br></div></div><h1 id="æŸ¥è¯¢æµ‹è¯•" tabindex="-1"> æŸ¥è¯¢æµ‹è¯•</h1>
<div><pre><code><span>IFreeSql</span> mysql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=100"</span><span>)</span>
    <span>//ç”±äºnullä¼šé»˜è®¤è¾“å‡ºæ—¥å¿—åˆ°æ§åˆ¶å°ï¼Œå½±å“æµ‹è¯•ç»“æœã€‚è¿™é‡Œä¼ å…¥ä¸€ä¸ªç©ºçš„æ—¥å¿—è¾“å‡ºå¯¹è±¡</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>false</span><span>)</span>
    <span>//å…³é—­è‡ªåŠ¨è¿ç§»åŠŸèƒ½</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span>class</span> <span>Song</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Url <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> Create_time <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>bool</span></span> Is_deleted <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>æµ‹è¯•æ–¹æ³•ï¼šè¿è¡Œä¸¤æ¬¡ï¼Œä»¥ç¬¬äºŒæ¬¡æ€§èƒ½æŠ¥å‘Šï¼Œé¿å…äº†é¦–ä¸ªè¿è¡Œæ…¢ä¸å…¬å¹³çš„æƒ…å†µã€‚</p>
<h3 id="æµ‹è¯•ç»“æœ" tabindex="-1"> æµ‹è¯•ç»“æœ</h3>
<table>
<thead>
<tr>
<th></th>
<th>æ•°é‡</th>
<th>Query&lt;Class&gt;</th>
<th>Query&lt;Tuple&gt;</th>
<th>Query&lt;dynamic&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dapper.Query(sql)</td>
<td>131072</td>
<td>623.4959ms</td>
<td>424.2411ms</td>
<td>644.8897ms</td>
</tr>
<tr>
<td>FreeSql.Query(sql)</td>
<td>131072</td>
<td>647.0552ms</td>
<td>577.3532ms</td>
<td>944.7454ms</td>
</tr>
<tr>
<td>FreeSql.ToList</td>
<td>131072</td>
<td>622.8980ms</td>
<td>435.3532ms</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>FreeSql ä»¥å¾®å°çš„æ€§èƒ½å·®è·è¾“äº†ï¼ŒåŸå› æ˜¯æ”¯æŒäº†æ›´å¤šçš„ç±»å‹ï¼ŒæŸäº›ç±»å‹è§£æéœ€è¦ Parseã€é€’å½’æˆ–å¾ªç¯å¤„ç†ã€‚</p>
<blockquote>
<p>ç”±äº Dapper æ²¡æœ‰æ‰¹é‡æ’å…¥/æ›´æ–°/åˆ é™¤çš„åŠŸèƒ½ï¼Œå¹¶ä¸”éƒ½æ˜¯æ‰§è¡Œä¸€æ¡ SQL å‘½ä»¤ï¼Œæµ‹è¯•ç»“æœæ²¡æœ‰æ„ä¹‰ã€‚</p>
</blockquote>
<blockquote>
<p>FreeSql æ‰¹é‡æ’å…¥ä½¿ç”¨çš„å‘½ä»¤ï¼šINSERT INTO Song (...) VALUES(...),VALUES(...),VALUES(...)...</p>
</blockquote>
<h3 id="æ‰§è¡Œ-sql-è¿”å›å®ä½“åˆ—è¡¨-dapper-query-class-vs-freesql-query-class" tabindex="-1"> æ‰§è¡Œ SQL è¿”å›å®ä½“åˆ—è¡¨ Dapper.Query&lt;Class&gt; VS FreeSql.Query&lt;Class&gt;</h3>
<div><pre><code><span>[</span><span><span>Fact</span></span><span>]</span>
<span>public</span> <span><span>void</span></span> <span>QueryEntity</span><span>(</span><span>)</span> <span>{</span>
    <span><span>var</span></span> sb <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> time <span>=</span> <span>new</span> <span>Stopwatch</span><span>(</span><span>)</span><span>;</span>

    time<span>.</span><span>Restart</span><span>(</span><span>)</span><span>;</span>
    <span>List<span>&lt;</span>Song<span>></span></span> dplist1 <span>=</span> <span>null</span><span>;</span>
    <span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> g<span>.</span>mysql<span>.</span>Ado<span>.</span>MasterPool<span>.</span><span>Get</span><span>(</span><span>)</span><span>)</span> <span>{</span>
        dplist1 <span>=</span> Dapper<span>.</span>SqlMapper<span>.</span><span><span>Query</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span>conn<span>.</span>Value<span>,</span> <span>"select * from song"</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
    time<span>.</span><span>Stop</span><span>(</span><span>)</span><span>;</span>
    sb<span>.</span><span>AppendLine</span><span>(</span><span><span>$"Elapsed: </span><span><span>{</span><span>time<span>.</span>Elapsed</span><span>}</span></span><span>; Query Entity Counts: </span><span><span>{</span><span>dplist1<span>.</span>Count</span><span>}</span></span><span>; ORM: Dapper"</span></span><span>)</span><span>;</span>

    time<span>.</span><span>Restart</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> t3 <span>=</span> g<span>.</span>mysql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>"select * from song"</span><span>)</span><span>;</span>
    time<span>.</span><span>Stop</span><span>(</span><span>)</span><span>;</span>
    sb<span>.</span><span>AppendLine</span><span>(</span><span><span>$"Elapsed: </span><span><span>{</span><span>time<span>.</span>Elapsed</span><span>}</span></span><span>; Query Entity Counts: </span><span><span>{</span><span>t3<span>.</span>Count</span><span>}</span></span><span>; ORM: FreeSql*"</span></span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><h3 id="æ‰§è¡Œ-sql-è¿”å›å…ƒç»„åˆ—è¡¨-dapper-query-tuple-vs-freesql-query-tuple" tabindex="-1"> æ‰§è¡Œ SQL è¿”å›å…ƒç»„åˆ—è¡¨ Dapper.Query&lt;Tuple&gt; VS FreeSql.Query&lt;Tuple&gt;</h3>
<div><pre><code><span>[</span><span><span>Fact</span></span><span>]</span>
<span>public</span> <span><span>void</span></span> <span>QueryTuple</span><span>(</span><span>)</span> <span>{</span>
    <span><span>var</span></span> sb <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> time <span>=</span> <span>new</span> <span>Stopwatch</span><span>(</span><span>)</span><span>;</span>

    time<span>.</span><span>Restart</span><span>(</span><span>)</span><span>;</span>
    <span>List<span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span><span>,</span> <span>string</span><span>)</span><span>></span></span> dplist2 <span>=</span> <span>null</span><span>;</span>
    <span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> g<span>.</span>mysql<span>.</span>Ado<span>.</span>MasterPool<span>.</span><span>Get</span><span>(</span><span>)</span><span>)</span> <span>{</span>
        dplist2 <span>=</span> Dapper<span>.</span>SqlMapper<span>.</span><span><span>Query</span><span><span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span><span>,</span> <span>string</span><span>)</span><span>></span></span></span><span>(</span>conn<span>.</span>Value<span>,</span> <span>"select * from song"</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
    time<span>.</span><span>Stop</span><span>(</span><span>)</span><span>;</span>
    sb<span>.</span><span>AppendLine</span><span>(</span><span><span>$"Elapsed: </span><span><span>{</span><span>time<span>.</span>Elapsed</span><span>}</span></span><span>; Query Tuple Counts: </span><span><span>{</span><span>dplist2<span>.</span>Count</span><span>}</span></span><span>; ORM: Dapper"</span></span><span>)</span><span>;</span>

    time<span>.</span><span>Restart</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> t4 <span>=</span> g<span>.</span>mysql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span><span>,</span> <span>string</span><span>)</span><span>></span></span></span><span>(</span><span>"select * from song"</span><span>)</span><span>;</span>
    time<span>.</span><span>Stop</span><span>(</span><span>)</span><span>;</span>
    sb<span>.</span><span>AppendLine</span><span>(</span><span><span>$"Elapsed: </span><span><span>{</span><span>time<span>.</span>Elapsed</span><span>}</span></span><span>; Query Tuple Counts: </span><span><span>{</span><span>t4<span>.</span>Count</span><span>}</span></span><span>; ORM: FreeSql*"</span></span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><h3 id="æ‰§è¡Œ-sql-è¿”å›-dynamic-åˆ—è¡¨-dapper-query-dynamic-vs-freesql-query-dynamic" tabindex="-1"> æ‰§è¡Œ SQL è¿”å› dynamic åˆ—è¡¨ Dapper.Query&lt;dynamic&gt; VS FreeSql.Query&lt;dynamic&gt;</h3>
<div><pre><code><span>[</span><span><span>Fact</span></span><span>]</span>
<span>public</span> <span><span>void</span></span> <span>QueryDynamic</span><span>(</span><span>)</span> <span>{</span>
    <span><span>var</span></span> sb <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> time <span>=</span> <span>new</span> <span>Stopwatch</span><span>(</span><span>)</span><span>;</span>

    time<span>.</span><span>Restart</span><span>(</span><span>)</span><span>;</span>
    <span>List<span>&lt;</span><span>dynamic</span><span>></span></span> dplist3 <span>=</span> <span>null</span><span>;</span>
    <span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> g<span>.</span>mysql<span>.</span>Ado<span>.</span>MasterPool<span>.</span><span>Get</span><span>(</span><span>)</span><span>)</span> <span>{</span>
        dplist3 <span>=</span> Dapper<span>.</span>SqlMapper<span>.</span><span><span>Query</span><span><span>&lt;</span><span>dynamic</span><span>></span></span></span><span>(</span>conn<span>.</span>Value<span>,</span> <span>"select * from song"</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
    time<span>.</span><span>Stop</span><span>(</span><span>)</span><span>;</span>
    sb<span>.</span><span>AppendLine</span><span>(</span><span><span>$"Elapsed: </span><span><span>{</span><span>time<span>.</span>Elapsed</span><span>}</span></span><span>; Query Dynamic Counts: </span><span><span>{</span><span>dplist3<span>.</span>Count</span><span>}</span></span><span>; ORM: Dapper"</span></span><span>)</span><span>;</span>

    time<span>.</span><span>Restart</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> t5 <span>=</span> g<span>.</span>mysql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span><span>dynamic</span><span>></span></span></span><span>(</span><span>"select * from song"</span><span>)</span><span>;</span>
    time<span>.</span><span>Stop</span><span>(</span><span>)</span><span>;</span>
    sb<span>.</span><span>AppendLine</span><span>(</span><span><span>$"Elapsed: </span><span><span>{</span><span>time<span>.</span>Elapsed</span><span>}</span></span><span>; Query Dynamic Counts: </span><span><span>{</span><span>t3<span>.</span>Count</span><span>}</span></span><span>; ORM: FreeSql*"</span></span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><h3 id="dapper-query-vs-freesql-tolist" tabindex="-1"> Dapper.Query VS FreeSql.ToList</h3>
<div><pre><code><span>[</span><span><span>Fact</span></span><span>]</span>
<span>public</span> <span><span>void</span></span> <span>QueryList</span><span>(</span><span>)</span> <span>{</span>
    <span><span>var</span></span> sb <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> time <span>=</span> <span>new</span> <span>Stopwatch</span><span>(</span><span>)</span><span>;</span>

    time<span>.</span><span>Restart</span><span>(</span><span>)</span><span>;</span>
    <span><span>var</span></span> t3 <span>=</span> g<span>.</span>mysql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
    time<span>.</span><span>Stop</span><span>(</span><span>)</span><span>;</span>
    sb<span>.</span><span>AppendLine</span><span>(</span><span><span>$"Elapsed: </span><span><span>{</span><span>time<span>.</span>Elapsed</span><span>}</span></span><span>; ToList Entity Counts: </span><span><span>{</span><span>t3<span>.</span>Count</span><span>}</span></span><span>; ORM: FreeSql*"</span></span><span>)</span><span>;</span>

    time<span>.</span><span>Restart</span><span>(</span><span>)</span><span>;</span>
    <span>List<span>&lt;</span>Song<span>></span></span> dplist1 <span>=</span> <span>null</span><span>;</span>
    <span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> g<span>.</span>mysql<span>.</span>Ado<span>.</span>MasterPool<span>.</span><span>Get</span><span>(</span><span>)</span><span>)</span> <span>{</span>
        dplist1 <span>=</span> Dapper<span>.</span>SqlMapper<span>.</span><span><span>Query</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span>conn<span>.</span>Value<span>,</span> <span>"select * from song"</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
    time<span>.</span><span>Stop</span><span>(</span><span>)</span><span>;</span>
    sb<span>.</span><span>AppendLine</span><span>(</span><span><span>$"Elapsed: </span><span><span>{</span><span>time<span>.</span>Elapsed</span><span>}</span></span><span>; Query Entity Counts: </span><span><span>{</span><span>dplist1<span>.</span>Count</span><span>}</span></span><span>; ORM: Dapper"</span></span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><blockquote>
<p>æ›´å¤šæµ‹è¯•æºç ï¼šFreeSql/FreeSql.Tests.PerformanceTests/MySqlAdoTest.cs</p>
</blockquote>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">è¯»å†™åˆ†ç¦»</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/read-write-splitting.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/read-write-splitting.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è¯»å†™åˆ†ç¦»" tabindex="-1"> è¯»å†™åˆ†ç¦»</h1>
<p>FreeSql æ”¯æŒæ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œæœ¬åŠŸèƒ½æ˜¯å®¢æˆ·ç«¯çš„è¯»å†™åˆ†ç¦»è¡Œä¸ºï¼Œæ•°æ®åº“æœåŠ¡å™¨è¯¥æ€ä¹ˆé…ç½®ä»ç„¶é‚£æ ·é…ç½®ï¼Œä¸å—æœ¬åŠŸèƒ½å½±å“ï¼Œä¸ºäº†æ–¹ä¾¿ææœ¯åé¢è®²åˆ°çš„ã€è¯»å†™åˆ†ç¦»ã€‘éƒ½æ˜¯æŒ‡å®¢æˆ·ç«¯çš„åŠŸèƒ½æ”¯æŒã€‚</p>
<p>å„ç§æ•°æ®åº“çš„è¯»å†™æ–¹æ¡ˆä¸ä¸€ï¼Œæ•°æ®åº“ç«¯å¼€å¯è¯»å†™åˆ†ç¦»åŠŸèƒ½åï¼Œè¯»å†™åˆ†ç¦»çš„å®ç°å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p>
<p>1ã€nginx ä»£ç†ï¼Œé…ç½®ç¹çä¸”å®¹æ˜“å‡ºé”™ï¼›</p>
<p>2ã€ä¸­ä»¶é—´ï¼Œå¦‚ MyCatï¼›</p>
<p>3ã€åœ¨ client ç«¯æ”¯æŒï¼›</p>
<p>FreeSql å®ç°äº†ç¬¬ 3 ç§æ–¹æ¡ˆï¼Œæ”¯æŒä¸€ä¸ªã€ä¸»åº“ã€‘å¤šä¸ªã€ä»åº“ã€‘ï¼Œã€ä»åº“ã€‘çš„æŸ¥è¯¢ç­–ç•¥ä¸ºéšæœºæ–¹å¼ã€‚</p>
<p>è‹¥æŸã€ä»åº“ã€‘å‘ç”Ÿæ•…éšœï¼Œå°†åˆ‡æ¢åˆ°å…¶ä»–å¯ç”¨ã€ä»åº“ã€‘ï¼Œè‹¥å·²å…¨éƒ¨ä¸å¯ç”¨åˆ™ä½¿ç”¨ã€ä¸»åº“ã€‘æŸ¥è¯¢ã€‚</p>
<p>å‡ºç°æ•…éšœã€ä»åº“ã€‘è¢«éš”ç¦»èµ·æ¥é—´éš”æ€§çš„æ£€æŸ¥å¯ç”¨çŠ¶æ€ï¼Œä»¥å¾…æ¢å¤ã€‚</p>
<div><pre><code><span><span>var</span></span> connstr <span>=</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;"</span> <span>+</span>
    <span>"Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=10"</span><span>;</span>

<span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connstr<span>)</span>
    <span>.</span><span>UseSlave</span><span>(</span><span>"connectionString1"</span><span>,</span> <span>"connectionString2"</span><span>)</span> <span>//ä½¿ç”¨ä»æ•°æ®åº“ï¼Œæ”¯æŒå¤šä¸ª</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span> <span>//è¯»ã€ä»åº“ã€‘ï¼ˆé»˜è®¤ï¼‰</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Master</span><span>(</span><span>)</span><span>.</span><span>WhereId</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span> <span>//å¼ºåˆ¶è¯»ã€ä¸»åº“ã€‘</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div>]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">ä»“å‚¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/repository.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/repository.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ä»“å‚¨" tabindex="-1"> ä»“å‚¨</h1>
<p>FreeSql.Repository ä½œä¸ºæ‰©å±•ï¼Œå®ç°äº†é€šç”¨ä»“å‚¨å±‚åŠŸèƒ½ã€‚ä¸å…¶ä»–è§„èŒƒæ ‡å‡†ä¸€æ ·ï¼Œä»“å‚¨å±‚ä¹Ÿæœ‰ç›¸åº”çš„è§„èŒƒå®šä¹‰ã€‚FreeSql.Repository å‚è€ƒ abp vnext æ¥å£ï¼Œå®šä¹‰å’Œå®ç°åŸºç¡€çš„ä»“å‚¨å±‚ï¼ˆCURDï¼‰ï¼Œåº”è¯¥ç®—æ¯”è¾ƒé€šç”¨çš„æ–¹æ³•å§ã€‚</p>
<h2 id="ç‰¹æ€§" tabindex="-1"> ç‰¹æ€§</h2>
<ul>
<li>Select/Attach å¿«ç…§å¯¹è±¡ï¼ŒUpdate åªæ›´æ–°å˜åŒ–çš„å­—æ®µï¼›</li>
<li>Insert æ’å…¥æ•°æ®ï¼Œé€‚é…å„æ•°æ®åº“ä¼˜åŒ–æ‰§è¡Œ ExecuteAffrows/ExecuteIdentity/ExecuteInsertedï¼›</li>
<li>InsertOrUpdate æ’å…¥æˆ–æ›´æ–°ï¼›</li>
<li>SaveMany æ–¹æ³•å¿«é€Ÿä¿å­˜å¯¼èˆªå¯¹è±¡ï¼ˆä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼‰ï¼›</li>
</ul>
<h2 id="å®‰è£…" tabindex="-1"> å®‰è£…</h2>
<div><pre><code> dotnet <span>add</span> package FreeSql.Repository
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ç¯å¢ƒ 2ã€.NET Framework</p>
<div><pre><code>Install-Package FreeSql.DbContext
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="å®šä¹‰" tabindex="-1"> å®šä¹‰</h2>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨è¿ç§»å®ä½“çš„ç»“æ„åˆ°æ•°æ®åº“</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span>public</span> <span>class</span> <span>Song</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h2 id="ä½¿ç”¨æ–¹æ³•" tabindex="-1"> ä½¿ç”¨æ–¹æ³•</h2>
<p>æ–¹æ³• 1ã€IFreeSql çš„æ‰©å±•æ–¹æ³•ï¼›</p>
<div><pre><code><span><span>var</span></span> curd <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><blockquote>
<p>æ³¨æ„ï¼šRepository å¯¹è±¡å¤šçº¿ç¨‹ä¸å®‰å…¨,å› æ­¤ä¸åº”åœ¨å¤šä¸ªçº¿ç¨‹ä¸ŠåŒæ—¶å¯¹å…¶æ‰§è¡Œå·¥ä½œã€‚</p>
</blockquote>
<ul>
<li>ä¸æ”¯æŒä»ä¸åŒçš„çº¿ç¨‹åŒæ—¶ä½¿ç”¨åŒä¸€ä»“å‚¨å®ä¾‹</li>
</ul>
<p>æ–¹æ³• 2ã€ç»§æ‰¿å®ç°ï¼›</p>
<div><pre><code><span>public</span> <span>class</span> <span>SongRepository</span> <span>:</span> <span><span>BaseRepository<span>&lt;</span>Song<span>,</span> <span>int</span><span>></span></span></span> <span>{</span>
    <span>public</span> <span>SongRepository</span><span>(</span><span>IFreeSql</span> fsql<span>)</span> <span>:</span> <span>base</span><span>(</span>fsql<span>,</span> <span>null</span><span>,</span> <span>null</span><span>)</span> <span>{</span><span>}</span>

    <span>//åœ¨è¿™é‡Œå¢åŠ  CURD ä»¥å¤–çš„æ–¹æ³•</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>æ–¹æ³• 3ã€ä¾èµ–æ³¨å…¥ï¼›</p>
<div><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span> <span>{</span>

    services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>Fsql<span>)</span><span>;</span>
    services<span>.</span><span>AddFreeRepository</span><span>(</span>filter <span>=></span> filter
        <span>.</span><span><span>Apply</span><span><span>&lt;</span>ISoftDelete<span>></span></span></span><span>(</span><span>"SoftDelete"</span><span>,</span> a <span>=></span> a<span>.</span>IsDeleted <span>==</span> <span>false</span><span>)</span>
        <span>.</span><span><span>Apply</span><span><span>&lt;</span>ITenant<span>></span></span></span><span>(</span><span>"Tenant"</span><span>,</span> a <span>=></span> a<span>.</span>TenantId <span>==</span> <span>1</span><span>)</span>
        <span>,</span>
        <span>this</span><span>.</span><span>GetType</span><span>(</span><span>)</span><span>.</span>Assembly
    <span>)</span><span>;</span>
<span>}</span>

<span>//åœ¨æ§åˆ¶å™¨ä½¿ç”¨</span>
<span>public</span> <span>SongsController</span><span>(</span><span>IBaseRepository<span>&lt;</span>Song<span>></span></span> repos1<span>)</span> <span>{</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><blockquote>
<p>ä¾èµ–æ³¨å…¥çš„æ–¹å¼å¯å®ç°å…¨å±€ã€è¿‡æ»¤ä¸éªŒè¯ã€‘çš„è®¾å®šï¼Œæ–¹ä¾¿ç§Ÿæˆ·åŠŸèƒ½çš„è®¾è®¡ï¼›</p>
</blockquote>
<p>æ›´å¤šèµ„æ–™ï¼š<a href="/guide/filters.html">ã€Šè¿‡æ»¤å™¨ã€å…¨å±€è¿‡æ»¤å™¨ã€‹</a></p>
<h2 id="çŠ¶æ€ç®¡ç†" tabindex="-1"> çŠ¶æ€ç®¡ç†</h2>
<p>åªæ›´æ–°å˜åŒ–çš„å±æ€§ï¼š</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> item <span>=</span> repo<span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>  <span>//æ­¤æ—¶å¿«ç…§ item</span>
item<span>.</span>Title <span>=</span> <span>"newtitle"</span><span>;</span>
repo<span>.</span><span>Update</span><span>(</span>item<span>)</span><span>;</span> <span>//å¯¹æ¯”å¿«ç…§æ—¶çš„å˜åŒ–</span>
<span>//UPDATE `tb_topic` SET `Title` = ?p_0</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>æ˜¯ä¸æ˜¯è§‰å¾—å…ˆæŸ¥è¯¢å†æ›´æ–°ï¼Œå•°å—¦ï¼Ÿ</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> item <span>=</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span> <span>}</span><span>;</span>
repo<span>.</span><span>Attach</span><span>(</span>item<span>)</span><span>;</span> <span>//æ­¤æ—¶å¿«ç…§ item</span>
item<span>.</span>Title <span>=</span> <span>"newtitle"</span><span>;</span>
repo<span>.</span><span>Update</span><span>(</span>item<span>)</span><span>;</span> <span>//å¯¹æ¯”å¿«ç…§æ—¶çš„å˜åŒ–</span>
<span>//UPDATE `tb_topic` SET `Title` = ?p_0</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="è¿‡æ»¤ä¸éªŒè¯" tabindex="-1"> è¿‡æ»¤ä¸éªŒè¯</h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰ User(ç”¨æˆ·)ã€Topic(ä¸»é¢˜)ä¸¤ä¸ªå®ä½“ï¼Œåœ¨é¢†åŸŸç±»ä¸­å®šä¹‰äº†ä¸¤ä¸ªä»“å‚¨ï¼š</p>
<div><pre><code><span><span>var</span></span> userRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> topicRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ€»æ˜¯æ‹…å¿ƒ topicRepository çš„æ•°æ®å®‰å…¨é—®é¢˜ï¼Œå³æœ‰å¯èƒ½æŸ¥è¯¢æˆ–æ“ä½œåˆ°å…¶ä»–ç”¨æˆ·çš„ä¸»é¢˜ã€‚å› æ­¤æˆ‘ä»¬åœ¨ v0.0.7 ç‰ˆæœ¬è¿›è¡Œäº†æ”¹è¿›ï¼Œå¢åŠ äº† filter lambda è¡¨è¾¾å¼å‚æ•°ã€‚</p>
<div><pre><code><span><span>var</span></span> userRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>;</span>
<span><span>var</span></span> topicRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span>a <span>=></span> a<span>.</span>UserId <span>==</span> <span>1</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><ul>
<li>åœ¨æŸ¥è¯¢/ä¿®æ”¹/åˆ é™¤æ—¶é™„åŠ æ­¤æ¡ä»¶ï¼Œä»è€Œè¾¾åˆ°ä¸ä¼šä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„æ•°æ®ï¼›</li>
<li>åœ¨æ·»åŠ æ—¶ï¼Œä½¿ç”¨è¡¨è¾¾å¼éªŒè¯æ•°æ®çš„åˆæ³•æ€§ï¼Œè‹¥ä¸åˆæ³•åˆ™æŠ›å‡ºå¼‚å¸¸ï¼›</li>
</ul>
<h2 id="åˆ†è¡¨ä¸åˆ†åº“" tabindex="-1"> åˆ†è¡¨ä¸åˆ†åº“</h2>
<p>FreeSql æä¾› AsTable åˆ†è¡¨çš„åŸºç¡€æ–¹æ³•ï¼ŒGuidRepository ä½œä¸ºåˆ†å­˜å¼ä»“å‚¨å°†å®ç°äº†åˆ†è¡¨ä¸åˆ†åº“ï¼ˆä¸æ”¯æŒè·¨æœåŠ¡å™¨åˆ†åº“ï¼‰çš„å°è£…ã€‚</p>
<div><pre><code><span><span>var</span></span> logRepository <span>=</span> fsql<span>.</span><span><span>GetGuidRepository</span><span><span>&lt;</span>Log<span>></span></span></span><span>(</span><span>null</span><span>,</span> oldname <span>=></span> <span><span>$"</span><span><span>{</span><span>oldname</span><span>}</span></span><span>_</span><span><span>{</span><span>DateTime<span>.</span>Now<span>.</span><span>ToString</span><span>(</span><span>"YYYYMM"</span><span>)</span></span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ä¸Šé¢æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæ—¥å¿—ä»“å‚¨æŒ‰å¹´æœˆåˆ†è¡¨ï¼Œä½¿ç”¨å®ƒ CURD æœ€ç»ˆä¼šæ“ä½œ Log_201903 è¡¨ã€‚</p>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>v0.11.12 ä»¥åçš„ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ CodeFirst è¿ç§»åˆ†è¡¨ï¼›</li>
<li>ä¸å¯åœ¨åˆ†è¡¨åˆ†åº“çš„å®ä½“ç±»å‹ä¸­ä½¿ç”¨ã€Šå»¶æ—¶åŠ è½½ã€‹ï¼›</li>
</ul>
<h2 id="å…¼å®¹é—®é¢˜" tabindex="-1"> å…¼å®¹é—®é¢˜</h2>
<p>SqlServer æä¾›çš„ output inserted ç‰¹æ€§ï¼Œåœ¨è¡¨ä½¿ç”¨äº†è‡ªå¢æˆ–æ•°æ®åº“å®šä¹‰äº†é»˜è®¤å€¼çš„æ—¶å€™ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿå°† insert çš„æ•°æ®è¿”å›ã€‚PostgreSQL ä¹Ÿæœ‰ç›¸åº”çš„åŠŸèƒ½ï¼Œå¦‚æ­¤æ–¹ä¾¿ä½†ä¸æ˜¯æ¯ä¸ªæ•°æ®åº“éƒ½æ”¯æŒã€‚</p>
<p>å½“é‡‡ç”¨äº†ä¸æ”¯æŒè¯¥ç‰¹æ€§çš„æ•°æ®åº“ï¼ˆSqlite/MySql/Oracle/è¾¾æ¢¦/å—å¤§é€šç”¨/MsAccessï¼‰ï¼Œå¹¶ä¸”å®ä½“ä½¿ç”¨äº†è‡ªå¢å±æ€§ï¼Œä»“å‚¨æ‰¹é‡æ’å…¥å°†å˜ä¸ºé€æ¡æ‰§è¡Œï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ”¹è¿›ï¼š</p>
<ul>
<li>ä½¿ç”¨ uuid ä½œä¸ºä¸»é”®ï¼ˆå³ Guidï¼‰ï¼›</li>
<li>é¿å…ä½¿ç”¨æ•°æ®åº“çš„é»˜è®¤å€¼åŠŸèƒ½ï¼›</li>
</ul>
<h2 id="è”çº§ä¿å­˜" tabindex="-1"> è”çº§ä¿å­˜</h2>
<p>è¯·ç§»æ­¥æ–‡æ¡£ <a href="/guide/cascade-saving.html">ã€Šè”çº§ä¿å­˜ã€‹</a></p>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¿”å›å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>EntityType</td>
<td>Type</td>
<td>ä»“å‚¨æ­£åœ¨æ“ä½œçš„å®ä½“ç±»å‹ï¼Œæ³¨æ„å®ƒä¸ä¸€å®šæ˜¯ TEntity</td>
</tr>
<tr>
<td>UnitOfWork</td>
<td>IUnitOfWork</td>
<td>æ­£åœ¨ä½¿ç”¨çš„å·¥ä½œå•å…ƒ</td>
</tr>
<tr>
<td>Orm</td>
<td>IFreeSql</td>
<td>æ­£åœ¨ä½¿ç”¨çš„ Orm</td>
</tr>
<tr>
<td>DbContextOptions</td>
<td>DbContextOptions</td>
<td>æ­£åœ¨ä½¿ç”¨çš„ DbContext è®¾ç½®ï¼Œä¿®æ”¹è®¾ç½®ä¸å½±å“å…¶ä»–</td>
</tr>
<tr>
<td>DataFilter</td>
<td>IDataFilter&lt;TEntity&gt;</td>
<td>ä»“å‚¨è¿‡æ»¤å™¨ï¼Œæœ¬å¯¹è±¡å†…ç”Ÿæ•ˆ</td>
</tr>
<tr>
<td>Select</td>
<td>ISelect&lt;TEntity&gt;</td>
<td>å‡†å¤‡æŸ¥è¯¢æ•°æ®</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>AsType</td>
<td>void</td>
<td>Type</td>
<td>æ”¹å˜ä»“å‚¨æ­£åœ¨æ“ä½œçš„å®ä½“ç±»å‹</td>
</tr>
<tr>
<td>Get</td>
<td>TEntity</td>
<td>TKey</td>
<td>æ ¹æ®ä¸»é”®ï¼ŒæŸ¥è¯¢æ•°æ®</td>
</tr>
<tr>
<td>Find</td>
<td>TEntity</td>
<td>TKey</td>
<td>æ ¹æ®ä¸»é”®ï¼ŒæŸ¥è¯¢æ•°æ®</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>TKey</td>
<td>æ ¹æ®ä¸»é”®åˆ é™¤æ•°æ®</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>Lambda</td>
<td>æ ¹æ® lambda æ¡ä»¶åˆ é™¤æ•°æ®</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>TEntity</td>
<td>åˆ é™¤æ•°æ®</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>æ‰¹é‡åˆ é™¤æ•°æ®</td>
</tr>
<tr>
<td>DeleteCascadeByDatabase</td>
<td>List&lt;object&gt;</td>
<td>Lambda</td>
<td>æ ¹æ®å¯¼èˆªå±æ€§é€’å½’æ•°æ®åº“åˆ é™¤æ•°æ®</td>
</tr>
<tr>
<td>Insert</td>
<td>-</td>
<td>TEntity</td>
<td>æ’å…¥æ•°æ®ï¼Œè‹¥å®ä½“æœ‰è‡ªå¢åˆ—ï¼Œæ’å…¥åçš„è‡ªå¢å€¼ä¼šå¡«å……åˆ°å®ä½“ä¸­</td>
</tr>
<tr>
<td>Insert</td>
<td>-</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>æ‰¹é‡æ’å…¥æ•°æ®</td>
</tr>
<tr>
<td>Update</td>
<td>-</td>
<td>TEntity</td>
<td>æ›´æ–°æ•°æ®</td>
</tr>
<tr>
<td>Update</td>
<td>-</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>æ‰¹é‡æ›´æ–°æ•°æ®</td>
</tr>
<tr>
<td>InsertOrUpdate</td>
<td>-</td>
<td>TEntity</td>
<td>æ’å…¥æˆ–æ›´æ–°æ•°æ®</td>
</tr>
<tr>
<td>FlushState</td>
<td>-</td>
<td>æ— </td>
<td>æ¸…é™¤çŠ¶æ€ç®¡ç†æ•°æ®</td>
</tr>
<tr>
<td>Attach</td>
<td>-</td>
<td>TEntity</td>
<td>é™„åŠ å®ä½“åˆ°çŠ¶æ€ç®¡ç†ï¼Œå¯ç”¨äºä¸æŸ¥è¯¢å°±æ›´æ–°æˆ–åˆ é™¤</td>
</tr>
<tr>
<td>Attach</td>
<td>-</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>æ‰¹é‡é™„åŠ å®ä½“åˆ°çŠ¶æ€ç®¡ç†</td>
</tr>
<tr>
<td>AttachOnlyPrimary</td>
<td>-</td>
<td>TEntity</td>
<td>åªé™„åŠ å®ä½“çš„ä¸»é”®æ•°æ®åˆ°çŠ¶æ€ç®¡ç†</td>
</tr>
<tr>
<td><a href="%E8%81%94%E7%BA%A7%E4%BF%9D%E5%AD%98#savemany">SaveMany</a></td>
<td>-</td>
<td>TEntity, string</td>
<td>ä¿å­˜å®ä½“çš„æŒ‡å®š ManyToMany/OneToMany å¯¼èˆªå±æ€§ï¼ˆå®Œæ•´å¯¹æ¯”ï¼‰</td>
</tr>
<tr>
<td><a href="%E6%B7%BB%E5%8A%A0%E6%88%96%E4%BF%AE%E6%94%B9#3beginedit-%E6%89%B9%E9%87%8F%E7%BC%96%E8%BE%91">BeginEdit</a></td>
<td>-</td>
<td>List&lt;TEntity&gt;</td>
<td>å‡†å¤‡ç¼–è¾‘ä¸€ä¸ª List å®ä½“</td>
</tr>
<tr>
<td>EndEdit</td>
<td>int</td>
<td>æ— </td>
<td>å®Œæˆç¼–è¾‘æ•°æ®ï¼Œè¿›è¡Œä¿å­˜åŠ¨ä½œ</td>
</tr>
</tbody>
</table>
<blockquote>
<p>çŠ¶æ€ç®¡ç†ï¼Œå¯å®ç° Update åªæ›´æ–°å˜åŒ–çš„å­—æ®µï¼ˆä¸æ›´æ–°æ‰€æœ‰å­—æ®µï¼‰ï¼Œçµæ´»ä½¿ç”¨ Attach å’Œ Update ç”¨èµ·æ¥éå¸¸èˆ’æœã€‚</p>
</blockquote>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">æ ‘å‹æŸ¥è¯¢ âœ¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/select-as-tree.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/select-as-tree.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æ ‘å‹æŸ¥è¯¢-âœ¨" tabindex="-1"> æ ‘å‹æŸ¥è¯¢ âœ¨</h1>
<p>æ— é™çº§åˆ†ç±»ï¼ˆçˆ¶å­ï¼‰æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸ç”¨çš„è¡¨è®¾è®¡ï¼Œæ¯ç§è®¾è®¡æ–¹å¼çªå‡ºä¼˜åŠ¿çš„åŒæ—¶ä¹Ÿå¸¦æ¥ç¼ºé™·ï¼Œå¦‚ï¼š</p>
<ul>
<li>æ–¹æ³• 1ï¼šè¡¨è®¾è®¡ä¸­åªæœ‰ parent_id å­—æ®µï¼Œå›°æ‰°ï¼šæŸ¥è¯¢éº»çƒ¦ï¼ˆæœ¬æ–‡å¯è§£å†³ï¼‰ï¼›</li>
<li>æ–¹æ³• 2ï¼šè¡¨è®¾è®¡ä¸­å†—ä½™å­çº§ id ä¾¿äºæŸ¥è¯¢ï¼Œå›°æ‰°ï¼šæ·»åŠ /æ›´æ–°/åˆ é™¤çš„æ—¶å€™éœ€è¦é‡æ–°è®¡ç®—ï¼›</li>
<li>æ–¹æ³• 3ï¼šè¡¨è®¾è®¡ä¸­å­˜å‚¨å·¦å³å€¼ç¼–ç ï¼Œå›°æ‰°ï¼šåŒä¸Šï¼›</li>
</ul>
<p>æ–¹æ³• 1 è®¾è®¡æœ€ç®€å•ï¼Œæœ¬æ–‡è§£å†³å®ƒçš„é€’å½’æŸ¥è¯¢é—®é¢˜ï¼Œè®©ä½¿ç”¨é€æ˜åŒ–ã€‚</p>
<h2 id="çˆ¶å­å¯¼èˆªå±æ€§" tabindex="-1"> çˆ¶å­å¯¼èˆªå±æ€§</h2>
<p>FreeSql å¯¼èˆªå±æ€§ä¹‹ä¸­ï¼Œæœ‰é’ˆå¯¹çˆ¶å­å…³ç³»çš„è®¾ç½®æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š</p>
<div><pre><code><span>public</span> <span>class</span> <span>Area</span>
<span>{</span>
  <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span><span>string</span></span> Code <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span><span>string</span></span> ParentCode <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>ParentCode<span>)</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span>Area</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>[</span><span><span>Navigate</span><span><span>(</span><span>nameof</span><span>(</span>ParentCode<span>)</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span>List<span>&lt;</span>Area<span>></span></span> Childs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><p>å®šä¹‰ Parent å±æ€§ï¼Œåœ¨è¡¨è¾¾å¼ä¸­å¯ä»¥è¿™æ ·ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Parent<span>.</span>Parent<span>.</span>Parent<span>.</span>Name <span>==</span> <span>"ä¸­å›½"</span><span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å®šä¹‰ Childs å±æ€§ï¼Œåœ¨è¡¨è¾¾å¼ä¸­å¯ä»¥è¿™æ ·ï¼ˆå­æŸ¥è¯¢ï¼‰ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Childs<span>.</span><span>Any</span><span>(</span>c <span>=></span> c<span>.</span>Name <span>==</span> <span>"åŒ—äº¬"</span><span>)</span><span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å®šä¹‰ Childs å±æ€§ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ã€çº§è”ä¿å­˜ã€‘ã€ã€è´ªå©ªåŠ è½½ã€‘ç­‰ç­‰æ“ä½œã€‚</p>
<div><pre><code>fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span><span>"1=1"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span>DbContextOptions<span>.</span>EnableCascadeSave <span>=</span> <span>true</span><span>;</span>
repo<span>.</span>DbContextOptions<span>.</span>NoneParameter <span>=</span> <span>true</span><span>;</span>
repo<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Area</span>
<span>{</span>
  Code <span>=</span> <span>"100000"</span><span>,</span>
  Name <span>=</span> <span>"ä¸­å›½"</span><span>,</span>
  Childs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Area<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span>
    <span>new</span> <span>Area</span>
    <span>{</span>
      Code <span>=</span> <span>"110000"</span><span>,</span>
      Name <span>=</span> <span>"åŒ—äº¬"</span><span>,</span>
      Childs <span>=</span> <span>new</span> <span>List<span>&lt;</span>Area<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span>
        <span>new</span> <span>Area</span><span>{</span> Code<span>=</span><span>"110100"</span><span>,</span> Name <span>=</span> <span>"åŒ—äº¬å¸‚"</span> <span>}</span><span>,</span>
        <span>new</span> <span>Area</span><span>{</span> Code<span>=</span><span>"110101"</span><span>,</span> Name <span>=</span> <span>"ä¸œåŸåŒº"</span> <span>}</span><span>,</span>
      <span>}</span><span>)</span>
    <span>}</span>
  <span>}</span><span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><h2 id="_1ã€totreelist" tabindex="-1"> 1ã€ToTreeList</h2>
<p>é…ç½®å¥½çˆ¶å­å±æ€§ä¹‹åï¼Œå°±å¯ä»¥è¿™æ ·ç”¨äº†ï¼š</p>
<div><pre><code><span><span>var</span></span> t1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span>
Assert<span>.</span><span>Single</span><span>(</span>t1<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"100000"</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Single</span><span>(</span>t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110000"</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>2</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span>Count<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110100"</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110101"</span><span>,</span> t1<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>1</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>æŸ¥è¯¢æ•°æ®æœ¬æ¥æ˜¯å¹³é¢çš„ï¼ŒToTreeList æ–¹æ³•å°†è¿”å›çš„å¹³é¢æ•°æ®åœ¨å†…å­˜ä¸­åŠ å·¥ä¸ºæ ‘å‹ List è¿”å›ã€‚</p>
<h2 id="_2ã€astreecte-é€’å½’åˆ é™¤" tabindex="-1"> 2ã€AsTreeCte é€’å½’åˆ é™¤</h2>
<p>å¾ˆå¸¸è§çš„æ— é™çº§åˆ†ç±»è¡¨åŠŸèƒ½ï¼Œåˆ é™¤æ ‘èŠ‚ç‚¹æ—¶ï¼ŒæŠŠå­èŠ‚ç‚¹ä¹Ÿå¤„ç†ä¸€ä¸‹ã€‚</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"ä¸­å›½"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span><span>)</span>
  <span>.</span><span>ToDelete</span><span>(</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//åˆ é™¤ ä¸­å›½ ä¸‹çš„æ‰€æœ‰è®°å½•</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>å¦‚æœè½¯åˆ é™¤ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"ä¸­å›½"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span><span>)</span>
  <span>.</span><span>ToUpdate</span><span>(</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>IsDeleted<span>,</span> <span>true</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//è½¯åˆ é™¤ ä¸­å›½ ä¸‹çš„æ‰€æœ‰è®°å½•</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="_3ã€astreecte-é€’å½’æŸ¥è¯¢" tabindex="-1"> 3ã€AsTreeCte é€’å½’æŸ¥è¯¢</h2>
<p>è‹¥ä¸åšæ•°æ®å†—ä½™çš„æ— é™çº§åˆ†ç±»è¡¨è®¾è®¡ï¼Œé€’å½’æŸ¥è¯¢å°‘ä¸äº†ï¼ŒAsTreeCte æ­£æ˜¯è§£å†³é€’å½’æŸ¥è¯¢çš„å°è£…ï¼Œæ–¹æ³•å‚æ•°è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>(å¯é€‰) pathSelector</td>
<td>è·¯å¾„å†…å®¹é€‰æ‹©ï¼Œå¯ä»¥è®¾ç½®æŸ¥è¯¢è¿”å›ï¼šä¸­å›½ -&gt; åŒ—äº¬ -&gt; ä¸œåŸåŒº</td>
</tr>
<tr>
<td>(å¯é€‰) up</td>
<td>false(é»˜è®¤)ï¼šç”±çˆ¶çº§å‘å­çº§çš„é€’å½’æŸ¥è¯¢ï¼Œtrueï¼šç”±å­çº§å‘çˆ¶çº§çš„é€’å½’æŸ¥è¯¢</td>
</tr>
<tr>
<td>(å¯é€‰) pathSeparator</td>
<td>è®¾ç½® pathSelector çš„è¿æ¥ç¬¦ï¼Œé»˜è®¤ï¼š-&gt;</td>
</tr>
<tr>
<td>(å¯é€‰) level</td>
<td>è®¾ç½®é€’å½’å±‚çº§</td>
</tr>
</tbody>
</table>
<blockquote>
<p>é€šè¿‡æµ‹è¯•çš„æ•°æ®åº“ï¼šMySql8.0ã€SqlServerã€PostgreSQLã€Oracleã€Sqliteã€Firebirdã€è¾¾æ¢¦ã€äººå¤§é‡‘ä»“ã€å—å¤§é€šç”¨ã€ç¿°é«˜</p>
</blockquote>
<p>å§¿åŠ¿ä¸€ï¼šAsTreeCte() + ToTreeList</p>
<div><pre><code><span><span>var</span></span> t2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"ä¸­å›½"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span><span>)</span> <span>//æŸ¥è¯¢ ä¸­å›½ ä¸‹çš„æ‰€æœ‰è®°å½•</span>
  <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Code<span>)</span>
  <span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span> <span>//éå¿…é¡»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ ToListï¼ˆè§å§¿åŠ¿äºŒï¼‰</span>
Assert<span>.</span><span>Single</span><span>(</span>t2<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"100000"</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Single</span><span>(</span>t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110000"</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>2</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>.</span>Count<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110100"</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110101"</span><span>,</span> t2<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>0</span><span>]</span><span>.</span>Childs<span>[</span><span>1</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
<span>// WITH "as_tree_cte"</span>
<span>// as</span>
<span>// (</span>
<span>// SELECT 0 as cte_level, a."Code", a."Name", a."ParentCode"</span>
<span>// FROM "Area" a</span>
<span>// WHERE (a."Name" = 'ä¸­å›½')</span>

<span>// union all</span>

<span>// SELECT wct1.cte_level + 1 as cte_level, wct2."Code", wct2."Name", wct2."ParentCode"</span>
<span>// FROM "as_tree_cte" wct1</span>
<span>// INNER JOIN "Area" wct2 ON wct2."ParentCode" = wct1."Code"</span>
<span>// )</span>
<span>// SELECT a."Code", a."Name", a."ParentCode"</span>
<span>// FROM "as_tree_cte" a</span>
<span>// ORDER BY a."Code"</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br></div></div><p>å§¿åŠ¿äºŒï¼šAsTreeCte() + ToList</p>
<div><pre><code><span><span>var</span></span> t3 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"ä¸­å›½"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span><span>)</span>
  <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Code<span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>4</span><span>,</span> t3<span>.</span>Count<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"100000"</span><span>,</span> t3<span>[</span><span>0</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110000"</span><span>,</span> t3<span>[</span><span>1</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110100"</span><span>,</span> t3<span>[</span><span>2</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110101"</span><span>,</span> t3<span>[</span><span>3</span><span>]</span><span>.</span>Code<span>)</span><span>;</span>
<span>//æ‰§è¡Œçš„ SQL ä¸å§¿åŠ¿ä¸€ç›¸åŒ</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>å§¿åŠ¿ä¸‰ï¼šAsTreeCte(pathSelector) + ToList</p>
<p>è®¾ç½® pathSelector å‚æ•°åï¼Œå¦‚ä½•è¿”å›éšè—å­—æ®µï¼Ÿ</p>
<div><pre><code><span><span>var</span></span> t4 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Area<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>==</span> <span>"ä¸­å›½"</span><span>)</span>
  <span>.</span><span>AsTreeCte</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>+</span> <span>"["</span> <span>+</span> a<span>.</span>Code <span>+</span> <span>"]"</span><span>)</span>
  <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Code<span>)</span>
  <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    item <span>=</span> a<span>,</span>
    level <span>=</span> Convert<span>.</span><span>ToInt32</span><span>(</span><span>"a.cte_level"</span><span>)</span><span>,</span>
    path <span>=</span> <span>"a.cte_path"</span>
  <span>}</span><span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>4</span><span>,</span> t4<span>.</span>Count<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"100000"</span><span>,</span> t4<span>[</span><span>0</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110000"</span><span>,</span> t4<span>[</span><span>1</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110100"</span><span>,</span> t4<span>[</span><span>2</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"110101"</span><span>,</span> t4<span>[</span><span>3</span><span>]</span><span>.</span>item<span>.</span>Code<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"ä¸­å›½[100000]"</span><span>,</span> t4<span>[</span><span>0</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"ä¸­å›½[100000] -> åŒ—äº¬[110000]"</span><span>,</span> t4<span>[</span><span>1</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"ä¸­å›½[100000] -> åŒ—äº¬[110000] -> åŒ—äº¬å¸‚[110100]"</span><span>,</span> t4<span>[</span><span>2</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span><span>"ä¸­å›½[100000] -> åŒ—äº¬[110000] -> ä¸œåŸåŒº[110101]"</span><span>,</span> t4<span>[</span><span>3</span><span>]</span><span>.</span>path<span>)</span><span>;</span>
<span>// WITH "as_tree_cte"</span>
<span>// as</span>
<span>// (</span>
<span>// SELECT 0 as cte_level, a."Name" || '[' || a."Code" || ']' as cte_path, a."Code", a."Name", a."ParentCode"</span>
<span>// FROM "Area" a</span>
<span>// WHERE (a."Name" = 'ä¸­å›½')</span>

<span>// union all</span>

<span>// SELECT wct1.cte_level + 1 as cte_level, wct1.cte_path || ' -> ' || wct2."Name" || '[' || wct2."Code" || ']' as cte_path, wct2."Code", wct2."Name", wct2."ParentCode"</span>
<span>// FROM "as_tree_cte" wct1</span>
<span>// INNER JOIN "Area" wct2 ON wct2."ParentCode" = wct1."Code"</span>
<span>// )</span>
<span>// SELECT a."Code" as1, a."Name" as2, a."ParentCode" as5, a.cte_level as6, a.cte_path as7</span>
<span>// FROM "as_tree_cte" a</span>
<span>// ORDER BY a."Code"</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br></div></div><blockquote>
<p>æ›´å¤šå§¿åŠ¿...è¯·æ ¹æ®ä»£ç æ³¨é‡Šè¿›è¡Œå°è¯•</p>
</blockquote>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">åˆ†ç»„èšåˆ</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/select-group-by.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/select-group-by.html"/>
    <updated>2022-05-23T02:38:02.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åˆ†ç»„èšåˆ" tabindex="-1"> åˆ†ç»„èšåˆ</h1>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=10"</span><span>)</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="groupbyåˆ†ç»„èšåˆ" tabindex="-1"> GroupByåˆ†ç»„èšåˆ</h2>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>GroupBy</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> tt2 <span>=</span> a<span>.</span>Title<span>.</span><span>Substring</span><span>(</span><span>0</span><span>,</span> <span>2</span><span>)</span><span>,</span> mod4 <span>=</span> a<span>.</span>Id <span>%</span> <span>4</span> <span>}</span><span>)</span>
    <span>.</span><span>Having</span><span>(</span>a <span>=></span> a<span>.</span><span>Count</span><span>(</span><span>)</span> <span>></span> <span>0</span> <span>&amp;&amp;</span> a<span>.</span><span>Avg</span><span>(</span>a<span>.</span>Key<span>.</span>mod4<span>)</span> <span>></span> <span>0</span> <span>&amp;&amp;</span> a<span>.</span><span>Max</span><span>(</span>a<span>.</span>Key<span>.</span>mod4<span>)</span> <span>></span> <span>0</span><span>)</span>
    <span>.</span><span>Having</span><span>(</span>a <span>=></span> a<span>.</span><span>Count</span><span>(</span><span>)</span> <span>&lt;</span> <span>300</span> <span>||</span> a<span>.</span><span>Avg</span><span>(</span>a<span>.</span>Key<span>.</span>mod4<span>)</span> <span>&lt;</span> <span>100</span><span>)</span>
    <span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Key<span>.</span>tt2<span>)</span>
    <span>.</span><span>OrderByDescending</span><span>(</span>a <span>=></span> a<span>.</span><span>Count</span><span>(</span><span>)</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Key<span>,</span> cou1 <span>=</span> a<span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span> arg1 <span>=</span> a<span>.</span><span>Avg</span><span>(</span>a<span>.</span>Value<span>.</span>Clicks<span>)</span> <span>}</span><span>)</span><span>;</span>
<span>//SELECT substr(a.`Title`, 1, 2) as1, count(1) as2, avg(a.`Id`) as3</span>
<span>//FROM `Topic` a</span>
<span>//GROUP BY substr(a.`Title`, 1, 2), (a.`Id` % 4)</span>
<span>//HAVING (count(1) > 0 AND avg((a.`Id` % 4)) > 0 AND max((a.`Id` % 4)) > 0) AND (count(1) &lt; 300 OR avg((a.`Id` % 4)) &lt; 100)</span>
<span>//ORDER BY substr(a.`Title`, 1, 2), count(1) DESC</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><blockquote>
<p>ä¸åˆ†ç»„æ±‚èšåˆå€¼ï¼Œè¯·ä½¿ç”¨ ToAggregate æ›¿ä»£ ToList</p>
</blockquote>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å›æŒ‡å®šå­—æ®µçš„è®°å½•ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>string field</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å› field æŒ‡å®šå­—æ®µçš„è®°å½•ï¼Œå¹¶ä»¥å…ƒç»„æˆ–åŸºç¡€ç±»å‹(int,string,long)æ¥æ”¶ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>ToAggregate&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å›æŒ‡å®šå­—æ®µçš„èšåˆç»“æœï¼ˆé€‚åˆä¸éœ€è¦ GroupBy çš„åœºæ™¯ï¼‰</td>
</tr>
<tr>
<td>Sum</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚å’Œ</td>
</tr>
<tr>
<td>Min</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚æœ€å°å€¼</td>
</tr>
<tr>
<td>Max</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚æœ€å¤§å€¼</td>
</tr>
<tr>
<td>Avg</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚å¹³å‡å€¼</td>
</tr>
<tr>
<td>ã€åˆ†ç»„ã€‘</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>æŒ‰é€‰æ‹©çš„åˆ—åˆ†ç»„ï¼ŒGroupBy(a =&gt; a.Name)</td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>æŒ‰åŸç”Ÿ sql è¯­æ³•åˆ†ç»„ï¼ŒGroupBy(&quot;concat(name, ?cc)&quot;, new { cc = 1 })</td>
</tr>
<tr>
<td>Having</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>æŒ‰åŸç”Ÿ sql è¯­æ³•èšåˆæ¡ä»¶è¿‡æ»¤ï¼ŒHaving(&quot;count(name) = ?cc&quot;, new { cc = 1 })</td>
</tr>
<tr>
<td>ã€æˆå‘˜ã€‘</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Key</td>
<td></td>
<td></td>
<td>è¿”å› GroupBy é€‰æ‹©çš„å¯¹è±¡</td>
</tr>
<tr>
<td>Value</td>
<td></td>
<td></td>
<td>è¿”å›ä¸»è¡¨ æˆ– From&lt;T2,T3....&gt; çš„å­—æ®µé€‰æ‹©å™¨</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">è´ªå©ªåŠ è½½ âœ¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/select-include.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/select-include.html"/>
    <updated>2022-06-11T16:06:05.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è´ªå©ªåŠ è½½-âœ¨" tabindex="-1"> è´ªå©ªåŠ è½½ âœ¨</h1>
<h2 id="_1ã€å¯¼èˆªå±æ€§-manytoone" tabindex="-1"> 1ã€å¯¼èˆªå±æ€§ ManyToOne</h2>
<p>ManyToOne å¯¼èˆªå±æ€§é€šè¿‡ ToList(includeNestedMembers: false) åŠ è½½ï¼Œå‚æ•°è¯´æ˜ï¼š</p>
<p>false: è¿”å› 2 çº§ Join çš„å¯¼èˆªæ•°æ®ï¼ˆé»˜è®¤ï¼‰ï¼›</p>
<p>true: è¿”å›æ‰€æœ‰å±‚çº§æ·±åº¦ Join çš„å¯¼èˆªæ•°æ®ï¼ˆæœªä½¿ç”¨çš„å¯¼èˆªæ•°æ®ä¸ä¼šè¿”å›ï¼‰ï¼›</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Include</span><span>(</span>a <span>=></span> a<span>.</span>Parent<span>.</span>Parent<span>)</span><span>.</span><span>ToList</span><span>(</span><span>true</span><span>)</span><span>;</span>

<span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Parent<span>.</span>Parent<span>.</span>Name <span>==</span> <span>"1"</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>true</span><span>)</span><span>;</span>
<span>//è¿™æ ·å†™ï¼Œä¸éœ€è¦å†æ ‡è®° Joinï¼Œè§£æè¡¨è¾¾å¼æ—¶è‡ªåŠ¨å¤„ç†æˆ LeftJoin</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="_2ã€å¯¼èˆªå±æ€§-onetomany-manytomany" tabindex="-1"> 2ã€å¯¼èˆªå±æ€§ OneToMany/ManyToMany</h2>
<p>IncludeMany è´ªå©ªåŠ è½½é›†åˆçš„å¯¼èˆªå±æ€§ï¼Œå…¶å®æ˜¯åˆ†ä¸¤æ¬¡æŸ¥è¯¢ï¼Œåœ¨ ToList åè¿›è¡Œäº†æ•°æ®é‡è£…ã€‚</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>IncludeMany æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯ä»¥è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢å‰çš„ä¿®é¥°å·¥ä½œã€‚</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>Songs<span>,</span>
    then <span>=></span> then<span>.</span><span>Where</span><span>(</span>song <span>=></span> song<span>.</span>User <span>==</span> <span>"admin"</span><span>)</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>å…¶å®åœ¨ then é‚£é‡Œï¼Œè¿˜å¯ä»¥ç»§ç»­è¿›è¡Œå‘ä¸‹ Include/IncludeManyã€‚åªè¦ä½ å–œæ¬¢ï¼Œå‘ä¸‹ 100 å±‚éƒ½æ²¡é—®é¢˜ã€‚</p>
<h2 id="_3ã€å˜å¼‚" tabindex="-1"> 3ã€å˜å¼‚</h2>
<p>æ²¡æœ‰é…ç½®å¯¼èˆªå…³ç³»ï¼Œä¹Ÿå¯ä»¥è´ªå©ªåŠ è½½ã€‚</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>TestManys<span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>TagId <span>==</span> a<span>.</span>Id<span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>åªæŸ¥è¯¢æ¯é¡¹å­é›†åˆçš„å‰å‡ æ¡æ•°æ®ï¼Œé¿å…åƒ EfCore åŠ è½½æ‰€æœ‰æ•°æ®å¯¼è‡´ IO æ€§èƒ½ä½ä¸‹ï¼ˆæ¯”å¦‚æŸå•†å“ä¸‹æœ‰ 2000 æ¡è¯„è®ºï¼‰ã€‚</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>TestManys<span>.</span><span>Take</span><span>(</span><span>10</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å­é›†åˆè¿”å›éƒ¨åˆ†å­—æ®µï¼Œé¿å…å­—æ®µè¿‡å¤šçš„é—®é¢˜ã€‚</p>
<div><pre><code><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>IncludeMany</span><span>(</span>a <span>=></span> a<span>.</span>TestManys<span>.</span><span>Select</span><span>(</span>b <span>=></span> <span>new</span> <span>TestMany</span> <span>{</span> Title <span>=</span> b<span>.</span>Title <span>..</span><span>.</span> <span>}</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="_4ã€includemany-æ‰©å±•æ–¹æ³•" tabindex="-1"> 4ã€IncludeMany æ‰©å±•æ–¹æ³•</h2>
<p>å½“ä¸»æ•°æ®å·²å­˜åœ¨å†…å­˜ä¸­ï¼Œå­æ•°æ®æ€ä¹ˆåŠ è½½ï¼Ÿæ‰€ä»¥æˆ‘ä»¬å¢åŠ äº† List&lt;T&gt; æ‰©å±•æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div><pre><code><span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span> song1<span>,</span> song2<span>,</span> song3 <span>}</span><span>)</span>
    <span>.</span><span>IncludeMany</span><span>(</span>fsql<span>,</span> a <span>=></span> a<span>.</span>Tags<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><div><pre><code><span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>new</span><span>[</span><span>]</span> <span>{</span> song1<span>,</span> song2<span>,</span> song3 <span>}</span><span>)</span>
    <span>.</span><span>IncludeByPropertyName</span><span>(</span>
        <span>orm</span><span>:</span> fsql<span>,</span>
        <span>property</span><span>:</span> <span>"Tags"</span><span>,</span>
        <span>where</span><span>:</span> <span>"ParentId=Code"</span><span>,</span>
        <span>take</span><span>:</span> <span>5</span><span>,</span>
        <span>select</span><span>:</span> <span>"id,name"</span>
    <span>)</span><span>;</span>
<span>//v3.2.605+</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="_5ã€å­æŸ¥è¯¢-tolist" tabindex="-1"> 5ã€å­æŸ¥è¯¢ ToList</h2>
<blockquote>
<p>v3.2.650+ ä»¥ä¸‹æœ€å¤šæ‰§è¡Œ3æ¬¡ SQL</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span>
<span>{</span>
    all <span>=</span> a<span>,</span>
    list1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Tag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>,</span>
    list2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>SongTag<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>SongId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="_6ã€includemany-ä¸¤ç§æ–¹å¼å¯¹æ¯”" tabindex="-1"> 6ã€IncludeMany ä¸¤ç§æ–¹å¼å¯¹æ¯”</h2>
<p>æ–¹å¼ä¸€ï¼ˆIncludeMany æ‰©å±•æ–¹æ³•ï¼‰ï¼š</p>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>SysModule<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> Id <span>=</span> a<span>.</span>Id <span>}</span><span>)</span> <span>//æŸ¥è¯¢æ•°æ® id</span>
    <span>.</span><span>Select</span><span>(</span>a <span>=></span> <span>new</span> <span>SysModule</span> <span>{</span> Id <span>=</span> a<span>.</span>Id <span>}</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span> <span>//å†…å­˜æ“ä½œ</span>
    <span>.</span><span>IncludeMany</span><span>(</span>fsql<span>,</span> a <span>=></span> a<span>.</span>Permissions<span>,</span> then <span>=></span> then<span>.</span><span>Include</span><span>(</span>a <span>=></span> a<span>.</span>Button<span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><div><pre><code><span>SELECT</span> a<span>.</span><span>"Id"</span> as1 
<span>FROM</span> <span>"SysModule"</span> a 
<span>limit</span> <span>0</span><span>,</span><span>10</span>

<span>SELECT</span> a<span>.</span><span>"Id"</span><span>,</span> a<span>.</span><span>"SysModuleId"</span><span>,</span> a<span>.</span><span>"SysModuleButtonId"</span><span>,</span> a<span>.</span><span>"Status"</span><span>,</span> 
a__Button<span>.</span><span>"Id"</span> as5<span>,</span> a__Button<span>.</span><span>"Name"</span><span>,</span> a__Button<span>.</span><span>"EventName"</span><span>,</span> a__Button<span>.</span><span>"EnCode"</span><span>,</span> a__Button<span>.</span><span>"Icon"</span><span>,</span> a__Button<span>.</span><span>"Sort"</span><span>,</span> a__Button<span>.</span><span>"CreateTime"</span> 
<span>FROM</span> <span>"SysModulePermission"</span> a 
<span>LEFT</span> <span>JOIN</span> <span>"SysModuleButton"</span> a__Button <span>ON</span> a__Button<span>.</span><span>"Id"</span> <span>=</span> a<span>.</span><span>"SysModuleButtonId"</span> 
<span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span>"SysModuleId"</span><span>)</span> <span>in</span> <span>(</span><span>'menu1'</span><span>,</span><span>'menu2'</span><span>)</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><hr>
<p>æ–¹å¼äºŒï¼ˆç›´æ¥ IncludeMany + ToListï¼‰ï¼š</p>
<div><pre><code><span><span>var</span></span> list <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>SysModule<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>IncludeMany</span><span>(</span>m <span>=></span> m<span>.</span>Permissions<span>,</span> then <span>=></span> then<span>.</span><span>Include</span><span>(</span>a <span>=></span> a<span>.</span>Button<span>)</span><span>)</span>
    <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
    <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span>SELECT</span> a<span>.</span><span>"Id"</span><span>,</span> a<span>.</span><span>"ParentId"</span><span>,</span> a<span>.</span><span>"Name"</span><span>,</span> a<span>.</span><span>"Icon"</span><span>,</span> a<span>.</span><span>"UrlAddress"</span><span>,</span> a<span>.</span><span>"IsShow"</span><span>,</span> a<span>.</span><span>"Sort"</span><span>,</span> a<span>.</span><span>"Description"</span><span>,</span> a<span>.</span><span>"CreateTime"</span>
<span>FROM</span> <span>"SysModule"</span> a
<span>limit</span> <span>0</span><span>,</span><span>10</span>

<span>SELECT</span> a<span>.</span><span>"Id"</span><span>,</span> a<span>.</span><span>"SysModuleId"</span><span>,</span> a<span>.</span><span>"SysModuleButtonId"</span><span>,</span> a<span>.</span><span>"Status"</span><span>,</span>
a__Button<span>.</span><span>"Id"</span> as5<span>,</span> a__Button<span>.</span><span>"Name"</span><span>,</span> a__Button<span>.</span><span>"EventName"</span><span>,</span> a__Button<span>.</span><span>"EnCode"</span><span>,</span> a__Button<span>.</span><span>"Icon"</span><span>,</span> a__Button<span>.</span><span>"Sort"</span><span>,</span> a__Button<span>.</span><span>"CreateTime"</span>
<span>FROM</span> <span>"SysModulePermission"</span> a
<span>LEFT</span> <span>JOIN</span> <span>"SysModuleButton"</span> a__Button <span>ON</span> a__Button<span>.</span><span>"Id"</span> <span>=</span> a<span>.</span><span>"SysModuleButtonId"</span>
<span>WHERE</span> <span>(</span><span>(</span>a<span>.</span><span>"SysModuleId"</span><span>)</span> <span>in</span> <span>(</span><span>'menu1'</span><span>,</span><span>'menu2'</span><span>)</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><p>æ¡ˆä¾‹ï¼šæŸ¥è¯¢ Vod è¡¨ï¼Œåˆ†ç±» 1ã€åˆ†ç±» 2ã€åˆ†ç±» 3 å„ 10 æ¡æ•°æ®</p>
<div><pre><code><span>class</span> <span>Vod</span> <span>{</span>
    <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> TypeId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>//å®šä¹‰ä¸´æ—¶ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯ Dto ç±»</span>
<span>class</span> <span>Dto</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> TypeId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>List<span>&lt;</span>Vod<span>></span></span> Vods <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span><span>var</span></span> dto <span>=</span> <span>new</span> <span>[</span><span>]</span> <span>{</span> <span>1</span><span>,</span><span>2</span><span>,</span><span>3</span> <span>}</span><span>.</span><span>Select</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span> <span>{</span> TypeId <span>=</span> a <span>}</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
dto<span>.</span><span>IncludeMany</span><span>(</span>fsql<span>,</span> d <span>=></span> d<span>.</span>Vods<span>.</span><span>Take</span><span>(</span><span>10</span><span>)</span><span>.</span><span>Where</span><span>(</span>vod <span>=></span> vod<span>.</span>TypeId <span>==</span> d<span>.</span>TypeId<span>)</span><span>)</span><span>;</span>

<span>//æ‰§è¡Œåï¼Œdto æ¯ä¸ªå…ƒç´ .Vods å°†åªæœ‰ 10æ¡è®°å½•</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div>]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">å»¶æ—¶åŠ è½½</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/select-lazy-loading.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/select-lazy-loading.html"/>
    <updated>2022-06-22T02:21:11.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å»¶æ—¶åŠ è½½" tabindex="-1"> å»¶æ—¶åŠ è½½</h1>
<p>FreeSql æ”¯æŒå¯¼èˆªå±æ€§å»¶æ—¶åŠ è½½ï¼Œå³å½“æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„æ—¶å€™æ‰è¿›è¡ŒåŠ è½½ï¼ˆè¯»å–ï¼‰ï¼Œæ”¯æŒ 1 å¯¹ 1ã€å¤šå¯¹ 1ã€1 å¯¹å¤šã€å¤šå¯¹å¤šå…³ç³»çš„å¯¼èˆªå±æ€§ã€‚</p>
<p>å½“æˆ‘ä»¬å¸Œæœ›æµè§ˆæŸæ¡è®¢å•ä¿¡æ¯çš„æ—¶å€™ï¼Œæ‰æ˜¾ç¤ºå…¶å¯¹åº”çš„è®¢å•è¯¦ç»†è®°å½•æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨å»¶è¿ŸåŠ è½½æ¥å®ç°ï¼Œè¿™æ ·ä¸ä»…åŠ å¿«çš„äº† è¯»å–çš„æ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿé¿å…åŠ è½½ä¸éœ€è¦çš„æ•°æ®ã€‚å»¶è¿ŸåŠ è½½é€šå¸¸ç”¨äº foreach å¾ªç¯è¯»å–æ•°æ®æ—¶ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬åœ¨å®šä¹‰ Model çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å±æ€§å‰é¢æ·»åŠ  virtual å…³é”®å­—ã€‚å¦‚ä¸‹</p>
<div><pre><code><span>public</span> <span>class</span> <span>Order</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> OrderID <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> OrderTitle <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> CustomerName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> TransactionDate <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>List<span>&lt;</span>OrderDetail<span>></span></span> OrderDetails <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>class</span> <span>OrderDetail</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> DetailId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> OrderId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Order</span> Order <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><blockquote>
<p>å»¶æ—¶åŠ è½½åŠŸèƒ½é»˜è®¤è¢«å…³é—­çš„ï¼Œä½¿ç”¨æ­¤åŠŸèƒ½è¯·æ—¶ï¼Œè¯·åœ¨å£°æ˜å¤„å¼€å¯ï¼›</p>
</blockquote>
<blockquote>
<p>å»¶æ—¶åŠ è½½åŠŸèƒ½ï¼Œä¾èµ– FreeSql.Extensions.LazyLoading åŒ…ï¼Œè¯·å‰å¾€ nuget ä¸‹è½½ï¼›</p>
</blockquote>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=10"</span><span>)</span>
    <span>.</span><span>UseLazyLoading</span><span>(</span><span>true</span><span>)</span> <span>//å¼€å¯å»¶æ—¶åŠ è½½åŠŸèƒ½</span>
    <span>.</span><span>UseMonitorCommand</span><span>(</span>
        cmd <span>=></span> Console<span>.</span><span>WriteLine</span><span>(</span>cmd<span>.</span>CommandText<span>)</span><span>)</span> <span>//ç›‘å¬SQLå‘½ä»¤å¯¹è±¡ï¼Œåœ¨æ‰§è¡Œå‰</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span><span>var</span></span> order <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Order<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>OrderID <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span> <span>//æŸ¥è¯¢è®¢å•è¡¨</span>
<span><span>var</span></span> orderDetail1 <span>=</span> order<span>.</span>OrderDetails<span>;</span> <span>//ç¬¬ä¸€æ¬¡è®¿é—®ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span>
<span><span>var</span></span> orderDetail2 <span>=</span> order<span>.</span>OrderDetails<span>;</span> <span>//ç¬¬äºŒæ¬¡è®¿é—®ï¼Œä¸æŸ¥</span>
<span><span>var</span></span> order1 <span>=</span> orderDetail1<span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span><span>;</span> <span>//è®¿é—®å¯¼èˆªå±æ€§ï¼Œæ­¤æ—¶ä¸æŸ¥æ•°æ®åº“ï¼Œå› ä¸º OrderDetails æŸ¥è¯¢å‡ºæ¥çš„æ—¶å€™å·²å¡«å……äº†è¯¥å±æ€§</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>æ§åˆ¶å°è¾“å‡ºå†…å®¹ï¼š</p>
<div><pre><code><span>SELECT</span> a<span>.</span><span><span>`</span>OrderID<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>OrderTitle<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>CustomerName<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>TransactionDate<span>`</span></span>
<span>FROM</span> <span><span>`</span>Order<span>`</span></span> a
<span>WHERE</span> <span>(</span>a<span>.</span><span><span>`</span>OrderID<span>`</span></span> <span>=</span> <span>1</span><span>)</span>
<span>limit</span> <span>0</span><span>,</span><span>1</span>

<span>SELECT</span> a<span>.</span><span><span>`</span>DetailId<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>OrderId<span>`</span></span>
<span>FROM</span> <span><span>`</span>OrderDetail<span>`</span></span> a
<span>WHERE</span> <span>(</span>a<span>.</span><span><span>`</span>OrderId<span>`</span></span> <span>=</span> <span>1</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>FreeSql å»¶æ—¶åŠ è½½æ”¯æŒ 1 å¯¹ 1ã€å¤šå¯¹ 1ã€1 å¯¹å¤šã€å¤šå¯¹å¤šå…³ç³»çš„å¯¼èˆªå±æ€§ï¼Œå‰ä¸‰è€…å¤§å°åŒå¼‚ï¼Œä»¥ä¸‹æˆ‘ä»¬å•ç‹¬ä»‹ç»å¤šå¯¹å¤šå…³ç³»ã€‚</p>
<h2 id="å¤šå¯¹å¤šå»¶æ—¶åŠ è½½" tabindex="-1"> å¤šå¯¹å¤šå»¶æ—¶åŠ è½½</h2>
<div><pre><code><span>public</span> <span>partial</span> <span>class</span> <span>Song</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime<span>?</span></span> Create_time <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>bool</span><span>?</span></span> Is_deleted <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Url <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Tag<span>></span></span> Tags <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>partial</span> <span>class</span> <span>Song_tag</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Song_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Song</span> Song <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> Tag_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Tag</span> Tag <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>partial</span> <span>class</span> <span>Tag</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span><span>?</span></span> Parent_id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>virtual</span> <span>Tag</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>decimal</span><span>?</span></span> Ddd <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>virtual</span> <span>ICollection<span>&lt;</span>Song<span>></span></span> Songs <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br></div></div><p>å¦‚ä¸Šæœ‰ä¸‰ä¸ªè¡¨ï¼ŒéŸ³ä¹ã€æ ‡ç­¾ï¼Œä»¥åŠä»–ä»¬çš„å…³ç³»è¡¨ã€‚</p>
<div><pre><code><span><span>var</span></span> songs <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Limit</span><span>(</span><span>10</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span> <span>//å–10æ¡éŸ³ä¹</span>
<span><span>var</span></span> songs1 <span>=</span> songs<span>.</span><span>First</span><span>(</span><span>)</span><span>.</span>Tags<span>;</span> <span>//ç¬¬ä¸€æ¬¡è®¿é—®ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span>
<span><span>var</span></span> songs2 <span>=</span> Songs<span>.</span><span>First</span><span>(</span><span>)</span><span>.</span>Tags<span>;</span> <span>//ç¬¬äºŒæ¬¡è®¿é—®ï¼Œä¸æŸ¥</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>æ§åˆ¶å°è¾“å‡ºå†…å®¹ï¼š</p>
<div><pre><code><span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Create_time<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Is_deleted<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Title<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Url<span>`</span></span>
<span>FROM</span> <span><span>`</span>Song<span>`</span></span> a
<span>limit</span> <span>0</span><span>,</span><span>10</span>

<span>SELECT</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Parent_id<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Ddd<span>`</span></span><span>,</span> a<span>.</span><span><span>`</span>Name<span>`</span></span>
<span>FROM</span> <span><span>`</span>Tag<span>`</span></span> a
<span>WHERE</span> <span>(</span><span>exists</span><span>(</span><span>SELECT</span> <span>1</span>
<span>FROM</span> <span><span>`</span>Song_tag<span>`</span></span> b
<span>WHERE</span> <span>(</span>b<span>.</span><span><span>`</span>Song_id<span>`</span></span> <span>=</span> <span>2</span> <span>AND</span> b<span>.</span><span><span>`</span>Tag_id<span>`</span></span> <span>=</span> a<span>.</span><span><span>`</span>Id<span>`</span></span><span>)</span>
<span>limit</span> <span>0</span><span>,</span><span>1</span><span>)</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h2 id="æ€»ç»“" tabindex="-1"> æ€»ç»“</h2>
<p>ä¼˜ç‚¹ï¼šåªåœ¨éœ€è¦çš„æ—¶å€™åŠ è½½æ•°æ®ï¼Œä¸éœ€è¦é¢„å…ˆè®¡åˆ’ï¼Œé¿å…äº†å„ç§å¤æ‚çš„å¤–è¿æ¥ã€ç´¢å¼•ã€è§†å›¾æ“ä½œå¸¦æ¥çš„ä½æ•ˆç‡é—®é¢˜ã€‚</p>
<p>ç¼ºé™·ï¼šå¤šæ¬¡ä¸ DB äº¤äº’ï¼Œæ€§èƒ½é™ä½ã€‚</p>
<p>å¦‚æœè¦åœ¨å¾ªç¯ä¸­ä½¿ç”¨æ•°æ®ï¼Œè¯·ä½¿ç”¨è´ªå©ªåŠ è½½ï¼Œå¦åˆ™ä½¿ç”¨æ‡’åŠ è½½ã€‚</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">å¤šè¡¨æŸ¥è¯¢</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/select-multi-table.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/select-multi-table.html"/>
    <updated>2022-05-01T07:36:16.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å¤šè¡¨æŸ¥è¯¢" tabindex="-1"> å¤šè¡¨æŸ¥è¯¢</h1>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=10"</span><span>)</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> CategoryId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>Category</span> Category <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>Category</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> ParentId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>CategoryType</span> Parent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>List<span>&lt;</span>Topic<span>></span></span> Topics <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>class</span> <span>CategoryType</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br></div></div><h2 id="_1ã€å¯¼èˆªå±æ€§è”è¡¨" tabindex="-1"> 1ã€å¯¼èˆªå±æ€§è”è¡¨</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> a<span>.</span>Category<span>.</span>Id <span>==</span> a<span>.</span>CategoryId<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> a<span>.</span>Category<span>.</span>Parent<span>.</span>Id <span>==</span> a<span>.</span>Category<span>.</span>ParentId<span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Category<span>.</span>Parent<span>.</span>Id <span>></span> <span>0</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`, a__Category.`Id` as6, a__Category.`Name`, a__Category.`ParentId`</span>
<span>//FROM `Topic` a</span>
<span>//LEFT JOIN `Category` a__Category ON a__Category.`Id` = a.`CategoryId`</span>
<span>//LEFT JOIN `CategoryType` a__Category__Parent ON a__Category__Parent.`Id` = a__Category.`ParentId`</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><blockquote>
<p>æç¤ºï¼šæ­£ç¡®é…ç½® ã€å¯¼èˆªå…³ç³»ã€‘åï¼Œä¸éœ€è¦æ‰‹å·¥è°ƒç”¨ LeftJoin</p>
</blockquote>
<h2 id="_2ã€å¤æ‚è”è¡¨" tabindex="-1"> 2ã€å¤æ‚è”è¡¨</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>,</span> Category<span>,</span> CategoryType<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> a<span>.</span>CategoryId <span>==</span> b<span>.</span>Id<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> b<span>.</span>ParentId <span>==</span> c<span>.</span>Id<span>)</span>
  <span>.</span><span>Where</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> c<span>.</span>Id <span>></span> <span>0</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> <span>new</span> <span>{</span> a<span>,</span>b<span>,</span>c <span>}</span><span>)</span><span>;</span>

<span>//æˆ–è€…</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>From</span><span><span>&lt;</span>Category<span>,</span> CategoryType<span>></span></span></span><span>(</span><span>(</span>s<span>,</span> b<span>,</span> c<span>)</span> <span>=></span> s
  <span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> a<span>.</span>CategoryId <span>==</span> b<span>.</span>Id<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> b<span>.</span>ParentId <span>==</span> c<span>.</span>Id<span>)</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> c<span>.</span>Id <span>></span> <span>0</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> <span>new</span> <span>{</span> a<span>,</span>b<span>,</span>c <span>}</span><span>)</span><span>;</span>
  
<span>//å‡å°‘å®šä¹‰ a,b,c å†™æ³•</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>,</span> Category<span>,</span> CategoryType<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>w <span>=></span> w<span>.</span>t1<span>.</span>CategoryId <span>==</span> w<span>.</span>t2<span>.</span>Id<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span>w <span>=></span> w<span>.</span>t2<span>.</span>ParentId <span>==</span> w<span>.</span>t3<span>.</span>Id<span>)</span>
  <span>.</span><span>Where</span><span>(</span>w <span>=></span> w<span>.</span>t3<span>.</span>Id <span>></span> <span>0</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span>w <span>=></span> <span>new</span> <span>{</span> w<span>.</span>t1<span>,</span>w<span>.</span>t2<span>,</span>w<span>.</span>t3 <span>}</span><span>)</span><span>;</span>
  
<span>//SELECT ...</span>
<span>//FROM `Topic` a</span>
<span>//LEFT JOIN `Category` b ON a.`CategoryId` = b.`Id`</span>
<span>//LEFT JOIN `CategoryType` c ON b.`ParentId` = c.`Id`</span>
<span>//WHERE c. `Id` > 0</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div><blockquote>
<p>ç»éªŒï¼š<a href="https://github.com/dotnetcore/FreeSql/issues/430" target="_blank" rel="noopener noreferrer">ä¸€å¯¹å¤šï¼Œåˆ†è¡¨åªå–æœ€åä¸€æ¡è®°å½•</a></p>
</blockquote>
<h2 id="_3ã€withsql" tabindex="-1"> 3ã€WithSql</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>,</span> Category<span>,</span> CategoryType<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>WithSql</span><span>(</span>
      <span>"select * from Topic where id=@id1"</span><span>,</span>
      <span>"select * from Category where id=@id2"</span><span>,</span>
      <span>null</span><span>,</span> <span>//ä¸è®¾ç½® CategoryType å¯¹åº”çš„ SQL</span>
      <span>new</span> <span>{</span> id1 <span>=</span> <span>10</span><span>,</span> id2 <span>=</span> <span>11</span><span>,</span> id3 <span>=</span> <span>13</span> <span>}</span>
  <span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> a<span>.</span>CategoryId <span>==</span> b<span>.</span>Id<span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span> <span>=></span> b<span>.</span>ParentId <span>==</span> c<span>.</span>Id<span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT ...</span>
<span>//FROM ( select * from Topic where id=@id1 ) a</span>
<span>//LEFT JOIN ( select * from Category where id=@id2 ) b ON a.`CategoryId` = b.`Id`</span>
<span>//LEFT JOIN `CategoryType` c ON b.`ParentId` = c.`Id`</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><blockquote>
<p>æç¤ºï¼šISelect.ToSql å¯ä¸ WithSql é…åˆä½¿ç”¨</p>
</blockquote>
<h2 id="_4ã€sqlè”è¡¨" tabindex="-1"> 4ã€SQLè”è¡¨</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>LeftJoin</span><span>(</span><span>"Category b on b.Id = a.CategoryId and b.Name = @bname"</span><span>,</span> <span>new</span> <span>{</span> bname <span>=</span> <span>"xxx"</span> <span>}</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//LEFT JOIN Category b on b.Id = a.CategoryId and b.Name = @bname</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>å»¶ä¼¸é—®é¢˜ï¼šSQLè”è¡¨ b è¡¨çš„å­—æ®µå¦‚ä½•åœ¨ ToList ä¸­æŒ‡å®šï¼Ÿ</p>
<div><pre><code><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
  bid <span>=</span> Convert<span>.</span><span>ToInt32</span><span>(</span><span>"b.Id"</span><span>)</span><span>,</span>
  bName <span>=</span> <span>"b.Name"</span>
<span>}</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="_5ã€å­è¡¨exists" tabindex="-1"> 5ã€å­è¡¨Exists</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>As</span><span>(</span><span>"b"</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>Id <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Any</span><span>(</span><span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (exists(SELECT 1</span>
<span>//    FROM `Topic` b</span>
<span>//    WHERE (b.`Id` = a.`Id`)</span>
<span>//    limit 0,1))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><blockquote>
<p>æç¤ºï¼šç”±äºå­æŸ¥è¯¢çš„å®ä½“ç±»ä¸ä¸Šå±‚ç›¸åŒï¼Œä½¿ç”¨ As(&quot;b&quot;) æŒ‡æ˜åˆ«åï¼Œä»¥ä¾¿åŒºåˆ†</p>
</blockquote>
<h2 id="_6ã€å­è¡¨in" tabindex="-1"> 6ã€å­è¡¨In</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>As</span><span>(</span><span>"b"</span><span>)</span><span>.</span><span>ToList</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>.</span><span>Contains</span><span>(</span>a<span>.</span>Id<span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Title`, a.`Clicks`, a.`CreateTime`, a.`CategoryId`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (((a.`Id`) in (SELECT b.`Id`</span>
<span>//    FROM `Topic` b)))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="_7ã€å­è¡¨join" tabindex="-1"> 7ã€å­è¡¨Join</h2>
<p>v1.8.0+ string.Join + ToList å®ç°å°†å­æŸ¥è¯¢çš„å¤šè¡Œç»“æœï¼Œæ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚ï¼š&quot;1,2,3,4&quot;</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
  id <span>=</span> a<span>.</span>Id<span>,</span>
  concat <span>=</span> <span>string</span><span>.</span><span>Join</span><span>(</span><span>","</span><span>,</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>StringJoin01<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>)</span>
<span>}</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, (SELECT group_concat(b.`Id` separator ',') </span>
<span>//    FROM `StringJoin01` b) </span>
<span>//FROM `Topic` a</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><blockquote>
<p>æç¤ºï¼šå­æŸ¥è¯¢ string.Join + ToList é€‚é…äº† sqlserver/pgsql/oracle/mysql/sqlite/firebird/è¾¾æ¢¦/é‡‘ä»“/å—å¤§/ç¿°é«˜ <a href="https://github.com/dotnetcore/FreeSql/issues/405" target="_blank" rel="noopener noreferrer">#405</a></p>
</blockquote>
<h2 id="_8ã€å­è¡¨first-count-sum-max-min-avg" tabindex="-1"> 8ã€å­è¡¨First/Count/Sum/Max/Min/Avg</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Category<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span>  <span>{</span>
  all <span>=</span> a<span>,</span>
  first <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>First</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>,</span>
  count <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span>
  sum <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Sum</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span><span>,</span>
  max <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Max</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span><span>,</span>
  min <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Min</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span><span>,</span>
  avg <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>CategoryId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>Avg</span><span>(</span>b <span>=></span> b<span>.</span>Clicks<span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="_9ã€é›†åˆå±æ€§" tabindex="-1"> 9ã€é›†åˆå±æ€§</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Category<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Topics<span>.</span><span>Any</span><span>(</span>b <span>=></span> b<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"xx"</span><span>)</span><span>)</span><span>)</span> <span>//v3.2.600 ä»¥ä¸‹ä½¿ç”¨ a.Topics.AsSelect()</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>æ•ˆæœç­‰åŒäºï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Category<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Any</span><span>(</span>b <span>=></span> b<span>.</span>Title<span>.</span><span>Contains</span><span>(</span><span>"xx"</span><span>)</span><span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>å°†é›†åˆå±æ€§å¿«é€Ÿè½¬æ¢ä¸º ISelect è¿›è¡Œå­æŸ¥è¯¢æ“ä½œã€‚</p>
<h2 id="_10ã€wherecascade" tabindex="-1"> 10ã€WhereCascade</h2>
<p>å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œåƒisdeletedæ¯ä¸ªè¡¨éƒ½ç»™æ¡ä»¶ï¼ŒæŒºéº»çƒ¦çš„ã€‚WhereCascadeä½¿ç”¨åç”Ÿæˆsqlæ—¶ï¼Œæ‰€æœ‰è¡¨éƒ½é™„ä¸Šè¿™ä¸ªæ¡ä»¶ã€‚</p>
<p>å¦‚ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>t1<span>></span></span></span><span>(</span><span>)</span>
<span>.</span><span><span>LeftJoin</span><span><span>&lt;</span>t2<span>></span></span></span><span>(</span><span>..</span><span>.</span><span>)</span>
<span>.</span><span>WhereCascade</span><span>(</span>x <span>=></span> x<span>.</span>IsDeleted <span>==</span> <span>false</span><span>)</span>
<span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å¾—åˆ°çš„ SQLï¼š</p>
<div><pre><code><span>SELECT</span> <span>.</span><span>.</span><span>.</span>
<span>FROM</span> t1
<span>LEFT</span> <span>JOIN</span> t2 <span>on</span> <span>.</span><span>.</span><span>.</span> <span>AND</span> <span>(</span>t2<span>.</span>IsDeleted <span>=</span> <span>0</span><span>)</span> 
<span>WHERE</span> t1<span>.</span>IsDeleted <span>=</span> <span>0</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å®ä½“å¯é™„åŠ è¡¨è¾¾å¼æ—¶æ‰ç”Ÿæ•ˆï¼Œæ”¯æŒå­è¡¨æŸ¥è¯¢ã€‚å•æ¬¡æŸ¥è¯¢ä½¿ç”¨çš„è¡¨æ•°ç›®è¶Šå¤šæ”¶ç›Šè¶Šå¤§ã€‚</p>
<p>å¯åº”ç”¨èŒƒå›´ï¼š</p>
<ul>
<li>å­æŸ¥è¯¢ï¼Œä¸€å¯¹å¤šã€å¤šå¯¹å¤šã€è‡ªå®šä¹‰çš„å­æŸ¥è¯¢ï¼›</li>
<li>Join æŸ¥è¯¢ï¼Œå¯¼èˆªå±æ€§ã€è‡ªå®šä¹‰çš„JoinæŸ¥è¯¢ï¼›</li>
<li>Include/IncludeMany çš„å­é›†åˆæŸ¥è¯¢ï¼›</li>
</ul>
<blockquote>
<p>æš‚æ—¶ä¸æ”¯æŒã€å»¶æ—¶å±æ€§ã€‘çš„å¹¿æ’­ï¼›</p>
</blockquote>
<blockquote>
<p>æ­¤åŠŸèƒ½å’Œã€è¿‡æ»¤å™¨ã€‘ä¸åŒï¼Œç”¨äºå•æ¬¡å¤šè¡¨æŸ¥è¯¢æ¡ä»¶çš„ä¼ æ’­ï¼›</p>
</blockquote>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">è¿”å›æ•°æ® âœ¨</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/select-return-data.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/select-return-data.html"/>
    <updated>2022-05-23T02:38:02.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è¿”å›æ•°æ®-âœ¨" tabindex="-1"> è¿”å›æ•°æ® âœ¨</h1>
<p>FreeSql é‡‡ç”¨ ExpressionTree ä¼˜åŒ–è¯»å–é€Ÿåº¦ï¼Œå¦‚æœæ‡‚æŠ€æœ¯çš„ä½ ä¸€å®šçŸ¥é“ .NET Core æŠ€æœ¯ä¸‹é™¤äº†åŸç”Ÿä»£ç ï¼Œæœ€å¿«å°±æ˜¯ Emit å’Œ ExpressionTreeã€‚é¡¹ç›®åœ¨åˆæœŸä½¿ç”¨çš„åå°„ + ç¼“å­˜ï¼Œè™½ç„¶ .NET Core ä¼˜åŒ–äº†åå°„æ€§èƒ½ï¼Œä½†ç»è¿‡ä¸ Dapper æ€§èƒ½æµ‹è¯•å¯¹æ¯”ä¹‹åï¼Œå‘ç°ä»ç„¶æœ‰ä¸€å®šå·®è·ï¼Œæ”¹æˆ ExpresstionTree åæ‰ä¸ Dapper æ€§èƒ½ç›¸å½“ã€‚FreeSql æ”¯æŒçš„ç±»å‹è¾ƒå¤šï¼Œå®ç° ExpressionTree çš„å¤æ‚åº¦è¾ƒå¤§ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥ç¿»é˜…æºä»£ç ã€‚</p>
<h2 id="_1ã€è¿”å›å•æ¡è®°å½•" tabindex="-1"> 1ã€è¿”å›å•æ¡è®°å½•</h2>
<div><pre><code><span>Topic</span> t1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><blockquote>
<p>FreeSql çº¦å®šï¼ŒToOne/First æ°¸è¿œè¿”å› null æˆ– æœ‰æ•°æ®çš„å®ä½“å¯¹è±¡ï¼ŒToList æ°¸è¿œè¿”å›é null çš„ List&lt;å®ä½“ç±»å‹&gt;</p>
</blockquote>
<h2 id="_2ã€è¿”å›-list" tabindex="-1"> 2ã€è¿”å› List</h2>
<div><pre><code><span>List<span>&lt;</span>Topic<span>></span></span> t1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="_3ã€è¿”å›-treelist" tabindex="-1"> 3ã€è¿”å› TreeList</h2>
<div><pre><code><span>List<span>&lt;</span>Category<span>></span></span> t2 <span>=</span> fsql<span>.</span>Select<span>&lt;</span>Category<span>></span><span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span>
<span>List<span>&lt;</span>Category<span>></span></span> t3 <span>=</span> fsql<span>.</span>Select<span>&lt;</span>Category<span>></span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name <span>=</span> <span>"å®¶ç”µ"</span><span>)</span><span>.</span><span>AsTreeCte</span><span>(</span><span>)</span><span>.</span><span>ToTreeList</span><span>(</span><span>)</span><span>;</span>
<span>//v1.6.0 AsTreeCte() é€’å½’CTEæŸ¥è¯¢ å®¶ç”µ ä¸‹çš„æ‰€æœ‰å­åˆ†ç±»</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><blockquote>
<p>æŸ¥è¯¢æ•°æ®åŠ å·¥ä¸ºæ ‘å‹ï¼Œæ³¨æ„ï¼šå®ä½“éœ€è¦é…ç½®çˆ¶å­å¯¼èˆªå±æ€§</p>
</blockquote>
<h2 id="_4ã€è¿”å›-list-å¯¼èˆªå±æ€§çš„æ•°æ®" tabindex="-1"> 4ã€è¿”å› List + å¯¼èˆªå±æ€§çš„æ•°æ®</h2>
<div><pre><code><span>List<span>&lt;</span>Topic<span>></span></span> t4 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>LeftJoin</span><span>(</span>a <span>=></span> a<span>.</span>Type<span>.</span>Id <span>==</span> a<span>.</span>TypeId<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//æ­¤æ—¶ä¼šæŸ¥è¯¢ Topicæ™®é€šå­—æ®µ + å¯¼èˆªå¯¹è±¡Type å­—æ®µ</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h2 id="_5ã€æŒ‡å®šå­—æ®µè¿”å›" tabindex="-1"> 5ã€æŒ‡å®šå­—æ®µè¿”å›</h2>
<div><pre><code><span>//è¿”å›ä¸€ä¸ªå­—æ®µ</span>
<span>List<span>&lt;</span><span>int</span><span>></span></span> t5 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>;</span>

<span>//è¿”å›åŒ¿åç±»</span>
<span>List<span>&lt;</span>åŒ¿åç±»<span>></span></span> t6 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Id<span>,</span> a<span>.</span>Title <span>}</span><span>)</span><span>;</span>

<span>//è¿”å›å…ƒç»„</span>
<span>List<span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span><span>)</span><span>></span></span> t7 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>ToList</span><span><span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span><span>)</span><span>></span></span></span><span>(</span><span>"id, title"</span><span>)</span><span>;</span>

<span>//è¿”å›å¯¼èˆªå±æ€§</span>
<span>List<span>&lt;</span>åŒ¿åç±»<span>></span></span> t8 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    a<span>.</span>Id<span>,</span> a<span>.</span>Title<span>,</span>
    a<span>.</span>Type <span>//å¯ä»¥ç›´æ¥è¿”å›å¯¼èˆªå±æ€§ Type</span>
<span>}</span><span>)</span><span>;</span>

<span>//è¿”å›SQLå­—æ®µ</span>
<span>List<span>&lt;</span>åŒ¿åç±»<span>></span></span> t9 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    cstitle <span>=</span> <span>"substr(a.title, 0, 2)"</span><span>,</span> <span>//å°† substr(a.title, 0, 2) ä½œä¸ºæŸ¥è¯¢å­—æ®µ</span>
    csnow <span>=</span> Convert<span>.</span><span>ToDateTime</span><span>(</span><span>"now()"</span><span>)</span><span>,</span> <span>//å°† now() ä½œä¸ºæŸ¥è¯¢å­—æ®µ</span>
    <span>//å¥‡æ€å¦™æƒ³ï¼šæ€ä¹ˆæŸ¥è¯¢å¼€çª—å‡½æ•°çš„ç»“æœ</span>
<span>}</span><span>)</span><span>;</span>

<span>//è¿”å›å­æŸ¥è¯¢çš„å­—æ®µ</span>
<span>List<span>&lt;</span>åŒ¿åç±»<span>></span></span> t10 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    a<span>.</span>Id<span>,</span>
    count <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Count</span><span>(</span><span>)</span><span>,</span>
    max <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Max</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>,</span>
    min <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Min</span><span>(</span>b <span>=></span> b<span>.</span>Id<span>)</span><span>,</span>
    name <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>First</span><span>(</span>b <span>=></span> b<span>.</span>name<span>)</span>
<span>}</span><span>)</span><span>;</span>

<span>//è¿”å›å­æŸ¥è¯¢é›†åˆ v3.2.650+</span>
<span>List<span>&lt;</span>åŒ¿åç±»<span>></span></span> t11 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span>
    a<span>.</span>Id<span>,</span>
    list1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>,</span>
    list2 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T2<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>b <span>=></span> b<span>.</span>TopicId <span>==</span> a<span>.</span>Id<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br></div></div><blockquote>
<p>å¸¸é‡æœºåˆ¶æ—©æœŸç•™ç»™äº†åŸç”Ÿ SQLï¼Œå¦‚æœçœŸçš„éœ€è¦è¿”å›è¯¥å­—ç¬¦ä¸²ï¼š&quot;'xxx'&quot;</p>
</blockquote>
<h2 id="_6ã€å¿½ç•¥å­—æ®µè¿”å›" tabindex="-1"> 6ã€å¿½ç•¥å­—æ®µè¿”å›</h2>
<p>å‚è€ƒå®ç°ï¼š<a href="https://github.com/dotnetcore/FreeSql/issues/528" target="_blank" rel="noopener noreferrer">https://github.com/dotnetcore/FreeSql/issues/528</a></p>
<h2 id="_7ã€tosql" tabindex="-1"> 7ã€ToSql</h2>
<p>æ¯ä¸ª ToList éƒ½å¯ä»¥ä½¿ç”¨ ToSql è¿”å› SQL Stringï¼Œæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š</p>
<ul>
<li>FieldAliasOptions.AsIndex(é»˜è®¤) è‡ªåŠ¨äº§ç”Ÿ as1, as2, as3 .... å­—æ®µåˆ«åï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦é˜²æ­¢å¤šè¡¨ï¼Œå­˜åœ¨ç›¸åŒå­—æ®µçš„é—®é¢˜ï¼›</li>
<li>FieldAliasOptions.AsProperty ä½¿ç”¨å±æ€§åä½œä¸ºå­—æ®µåˆ«åï¼Œåˆé€‚ä½¿ç”¨äºŒæ¬¡æ„é€  SQL å†æ¬¡æ‰§è¡Œï¼›</li>
</ul>
<h2 id="_8ã€æ‰§è¡Œ-sql" tabindex="-1"> 8ã€æ‰§è¡Œ SQL</h2>
<div><pre><code><span>class</span> <span>xxx</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Path <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title2 <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>

<span>List<span>&lt;</span>xxx<span>></span></span> t11 <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span>xxx<span>></span></span></span><span>(</span><span>"select * from song"</span><span>)</span><span>;</span>
<span>List<span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span> <span>,</span><span>string</span><span>)</span><span>></span></span> t12 <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span><span>(</span><span>int</span><span>,</span> <span>string</span><span>,</span> <span>string</span><span>)</span><span>></span></span></span><span>(</span><span>"select * from song"</span><span>)</span><span>;</span>
<span>List<span>&lt;</span><span>dynamic</span><span>></span></span> t13 <span>=</span> fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span><span>dynamic</span><span>></span></span></span><span>(</span><span>"select * from song"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><blockquote>
<p>æ³¨æ„ï¼šAdo.Query çš„å®ä½“ç‰¹æ€§æ˜¯æ— æ•ˆçš„ï¼Œæ¯”å¦‚ [Column(Name = &quot;xxx&quot;)] æ— æ•ˆ</p>
</blockquote>
<h2 id="_9ã€withsql" tabindex="-1"> 9ã€WithSql</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>WithSql</span><span>(</span><span>"select * from Topic where clicks > @val"</span><span>,</span> <span>new</span> <span>{</span> val <span>=</span> <span>10</span> <span>}</span><span>)</span>
  <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span>
<span>//SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime`</span>
<span>//FROM (select * from Topic where clicks > @val) a</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><blockquote>
<p>WithSql ä½¿ç”¨å¤šæ¬¡ä¸º UNION ALL æŸ¥è¯¢</p>
</blockquote>
<h2 id="_10ã€tochunk" tabindex="-1"> 10ã€ToChunk</h2>
<p>æ‰§è¡ŒæŸ¥è¯¢ï¼Œåˆ†å—è¿”å›æ•°æ®ï¼Œå¯å‡å°‘å†…å­˜å¼€é”€ã€‚æ¯”å¦‚è¯»å– 10 ä¸‡æ¡æ•°æ®ï¼Œæ¯æ¬¡è¿”å› 100 æ¡å¤„ç†ã€‚</p>
<div><pre><code><span><span>var</span></span> testlist1 <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> testlist2 <span>=</span> <span>new</span> <span>List<span>&lt;</span>Song<span>></span></span><span>(</span><span>)</span><span>;</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>OrderBy</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>.</span><span>ToChunk</span><span>(</span><span>100</span><span>,</span> done <span>=></span> <span>{</span>
    testlist2<span>.</span><span>AddRange</span><span>(</span>done<span>.</span>Object<span>)</span><span>;</span>
    <span>//done.IsBreak = true; v1.7.0 åœæ­¢è¯»å–</span>
<span>}</span><span>)</span><span>;</span>
<span>//è¿™é‡Œç¤ºèŒƒï¼Œæœ€ç»ˆ testlist1 ä¸ testlist2 è¿”å›çš„æ•°æ®ç›¸åŒã€‚</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="_11ã€dto-æ˜ å°„æŸ¥è¯¢" tabindex="-1"> 11ã€Dto æ˜ å°„æŸ¥è¯¢</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>ToList</span><span><span>&lt;</span>Dto<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span>//æƒ…å†µ1ï¼šDto ä¸ Song å±æ€§åç›¸åŒçš„å­—æ®µè¢«æŸ¥è¯¢ï¼Œè¿”å› List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span> <span>{</span> xxx <span>=</span> a<span>.</span>ext <span>}</span><span>)</span>
<span>//æƒ…å†µ2ï¼šDto ä¸ Song å±æ€§åç›¸åŒçš„å­—æ®µè¢«æŸ¥è¯¢ï¼Œçº æ­£æ˜ å°„ extï¼Œè¿”å› List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span> <span>{</span> id <span>=</span> a<span>.</span>id <span>}</span><span>)</span>
<span>//æƒ…å†µ3ï¼šLambda ä¸ Song ç±»å‹ä¸€æ ·ï¼ŒåªæŸ¥è¯¢æŒ‡å®šå­—æ®µ idï¼Œè¿”å› List&lt;Song></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> id <span>=</span> a<span>.</span>id <span>}</span><span>)</span>
<span>//æƒ…å†µ4ï¼šLambda åŒ¿åç±»å‹ï¼ŒåªæŸ¥è¯¢æŒ‡å®šå­—æ®µ idï¼Œè¿”å› List&lt;åŒ¿åå¯¹è±¡></span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><blockquote>
<p>è¯·ä»”ç»†å¤„ç†åŒºåˆ«ï¼Œè¯·ä»”ç»†å¤„ç†åŒºåˆ«ï¼Œè¯·ä»”ç»†å¤„ç†åŒºåˆ«</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span><span>(</span>a<span>.</span>id<span>)</span><span>)</span>
<span>//æƒ…å†µ5ï¼šåªæŸ¥è¯¢ idï¼Œè¿”å› List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Dto</span><span>(</span>a<span>.</span>id<span>)</span> <span>{</span> xxx <span>=</span> a<span>.</span>ext <span>}</span><span>)</span>
<span>//æƒ…å†µ6ï¼šæŸ¥è¯¢ id, extï¼Œè¿”å› List&lt;Dto></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span><span>(</span>a<span>.</span>id<span>)</span><span>)</span>
<span>//æƒ…å†µ7ï¼šæŸ¥è¯¢ idï¼Œè¿”å› List&lt;Song></span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ToList</span><span>(</span>a <span>=></span> <span>new</span> <span>Song</span><span>(</span>a<span>.</span>id<span>)</span> <span>{</span> xxx <span>=</span> a<span>.</span>ext <span>}</span><span>)</span>
<span>//æƒ…å†µ8ï¼šæŸ¥è¯¢ id, extï¼Œè¿”å› List&lt;Song></span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><blockquote>
<p>GroupBy æ‰€æœ‰æ–¹æ³•ä¸ä½¿ç”¨ DTO æ˜ å°„è§„åˆ™</p>
</blockquote>
<p>è¿™ç§æ˜ å°„æ”¯æŒå•è¡¨/å¤šè¡¨ï¼Œåœ¨æŸ¥è¯¢æ•°æ®ä¹‹å‰æ˜ å°„ï¼ˆä¸æ˜¯å…ˆæŸ¥è¯¢æ‰€æœ‰å­—æ®µå†åˆ°å†…å­˜æ˜ å°„ï¼‰</p>
<p>æŸ¥æ‰¾è§„åˆ™ï¼ŒæŸ¥æ‰¾å±æ€§åï¼Œä¼šå¾ªç¯å†…éƒ¨å¯¹è±¡ _tablesï¼ˆjoin æŸ¥è¯¢åä¼šå¢é•¿ï¼‰ï¼Œä»¥ ä¸»è¡¨ä¼˜å…ˆæŸ¥ï¼Œç›´åˆ°æŸ¥åˆ°ç›¸åŒçš„å­—æ®µã€‚</p>
<p>å¦‚ï¼š</p>
<p>A, B, C éƒ½æœ‰ idï¼ŒDto { id, a1, a2, b1, b2 }ï¼ŒA.id è¢«æ˜ å°„ã€‚ä¹Ÿå¯ä»¥æŒ‡å®š id = C.id æ˜ å°„ã€‚</p>
<blockquote>
<p>å‹æƒ…æé†’ï¼šåœ¨ dto å¯ä»¥ç›´æ¥æ˜ å°„ä¸€ä¸ªå¯¼èˆªå±æ€§</p>
</blockquote>
<h2 id="_12ã€api" tabindex="-1"> 12ã€API</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„SQLè¯­å¥</td>
</tr>
<tr>
<td>ToList</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œè¿”å› T1 å®ä½“æ‰€æœ‰å­—æ®µçš„è®°å½•ï¼Œè‹¥å­˜åœ¨å¯¼èˆªå±æ€§åˆ™ä¸€èµ·æŸ¥è¯¢è¿”å›ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>ToList&lt;Dto&gt;</td>
<td>List&lt;Dto&gt;</td>
<td>Lambda</td>
<td>æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œè¿”å›æŒ‡å®šå­—æ®µæˆ–Dtoæ˜ å°„çš„è®°å½•ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>string field</td>
<td>æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œè¿”å› field æŒ‡å®šå­—æ®µçš„è®°å½•ï¼Œå¹¶ä»¥å…ƒç»„æˆ–åŸºç¡€ç±»å‹(int,string,long)æ¥æ”¶ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>ToOne</td>
<td>T1</td>
<td></td>
<td>æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œè¿”å› T1 å®ä½“æ‰€æœ‰å­—æ®µçš„ç¬¬ä¸€æ¡è®°å½•ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› null</td>
</tr>
<tr>
<td>ToChunk</td>
<td>&lt;ç©º&gt;</td>
<td>int size, Action&lt;FetchCallbackArgs&lt;List&lt;T1&gt;&gt;&gt; done</td>
<td>æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œåˆ†å—è¿”å›æ•°æ®ï¼Œå¯å‡å°‘å†…å­˜å¼€é”€ã€‚æ¯”å¦‚è¯»å–10ä¸‡æ¡æ•°æ®ï¼Œæ¯æ¬¡è¿”å›100æ¡å¤„ç†ã€‚</td>
</tr>
<tr>
<td>Any</td>
<td>bool</td>
<td></td>
<td>æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œæ˜¯å¦æœ‰è®°å½•</td>
</tr>
<tr>
<td>Sum</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚å’Œ</td>
</tr>
<tr>
<td>Min</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚æœ€å°å€¼</td>
</tr>
<tr>
<td>Max</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚æœ€å¤§å€¼</td>
</tr>
<tr>
<td>Avg</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚å¹³å‡å€¼</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">å•è¡¨æŸ¥è¯¢</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/select-single-table.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/select-single-table.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å•è¡¨æŸ¥è¯¢" tabindex="-1"> å•è¡¨æŸ¥è¯¢</h1>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=10"</span><span>)</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span><span>int</span></span> CategoryId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h2 id="å•è¡¨" tabindex="-1"> å•è¡¨</h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>10</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>///SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (a.`Id` = 10)</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>10</span> <span>&amp;&amp;</span> a<span>.</span>Id <span>></span> <span>10</span> <span>||</span> a<span>.</span>Clicks <span>></span> <span>100</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>///SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (a.`Id` = 10 AND a.`Id` > 10 OR a.`Clicks` > 100)</span>

fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> <span>new</span> <span>[</span><span>]</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>.</span><span>Contains</span><span>(</span>a<span>.</span>Id<span>)</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime`</span>
<span>//FROM `Topic` a</span>
<span>//WHERE (a.`Id` in (1,2,3))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><h2 id="withsql" tabindex="-1"> <a href="/guide/WithSql.html">WithSql</a></h2>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>WithSql</span><span>(</span><span>"select * from Topic where clicks > ?val"</span><span>,</span> <span>new</span> <span>{</span> val <span>=</span> <span>10</span> <span>}</span><span>)</span>
  <span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span>
  <span>.</span><span>ToList</span><span>(</span><span>)</span>
<span>//SELECT a.`Id`, a.`Clicks`, a.`CategoryId`, a.`Title`, a.`CreateTime`</span>
<span>//FROM (select * from Topic where clicks > ?val) a</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><blockquote>
<p>å…³äº<a href="/guide/WithSql.html">WithSql</a>çš„è¯¦æƒ…æ–‡æ¡£ï¼Œ ä½¿ç”¨å¤šæ¬¡ä¸º UNION ALL æŸ¥è¯¢</p>
</blockquote>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">æŸ¥è¯¢</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/select.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/select.html"/>
    <updated>2022-05-17T06:09:12.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æŸ¥è¯¢" tabindex="-1"> æŸ¥è¯¢</h1>
<p>FreeSql åœ¨æŸ¥è¯¢æ•°æ®ä¸‹è¶³äº†åŠŸå¤«ï¼Œé“¾å¼æŸ¥è¯¢è¯­æ³•ã€å¤šè¡¨æŸ¥è¯¢ã€è¡¨è¾¾å¼å‡½æ•°æ”¯æŒå¾—éå¸¸åˆ°ä½ã€‚</p>
<ul>
<li>åˆ†é¡µæŸ¥è¯¢</li>
<li>å•è¡¨æŸ¥è¯¢</li>
<li>å¤šè¡¨æŸ¥è¯¢</li>
<li>åˆ†ç»„èšåˆæŸ¥è¯¢</li>
<li>è¿”å›æ•°æ®</li>
<li>LinqToSql</li>
<li>ä»“å‚¨å±‚ Repository</li>
<li>è¿‡æ»¤å™¨</li>
<li>å»¶æ—¶åŠ è½½</li>
<li>è´ªå©ªåŠ è½½</li>
<li>è¡¨è¾¾å¼å‡½æ•°</li>
<li>è¯»å†™åˆ†ç¦»</li>
<li>æ€§èƒ½</li>
<li>åˆ†è¡¨åˆ†åº“</li>
<li>å¤šç§Ÿæˆ·</li>
</ul>
<h2 id="ç‰¹åˆ«ä»‹ç»-wheredynamicfilter" tabindex="-1"> ç‰¹åˆ«ä»‹ç» WhereDynamicFilter</h2>
<p>ISelect.WhereDynamicFilter æ–¹æ³•å®ç°åŠ¨æ€è¿‡æ»¤æ¡ä»¶ï¼ˆä¸å‰ç«¯äº¤äº’ï¼‰ï¼Œæ”¯æŒçš„æ“ä½œç¬¦ï¼š</p>
<ul>
<li>Contains/StartsWith/EndsWith/NotContains/NotStartsWith/NotEndsWithï¼šåŒ…å«/ä¸åŒ…å«ï¼Œlike '%xx%'ï¼Œæˆ–è€… like 'xx%'ï¼Œæˆ–è€… like '%xx'</li>
<li>Equal/NotEqualï¼šç­‰äº/ä¸ç­‰äº</li>
<li>GreaterThan/GreaterThanOrEqualï¼šå¤§äº/å¤§äºç­‰äº</li>
<li>LessThan/LessThanOrEqualï¼šå°äº/å°äºç­‰äº</li>
<li>Rangeï¼šèŒƒå›´æŸ¥è¯¢</li>
<li>DateRangeï¼šæ—¥æœŸèŒƒå›´ï¼Œæœ‰ç‰¹æ®Šå¤„ç† value[1] + 1</li>
<li>Any/NotAnyï¼šæ˜¯å¦ç¬¦åˆ value ä¸­ä»»ä½•ä¸€é¡¹ï¼ˆç›´ç™½çš„è¯´æ˜¯ SQL INï¼‰</li>
</ul>
<div><pre><code><span>DynamicFilterInfo</span> dyfilter <span>=</span> JsonConvert<span>.</span><span><span>DeserializeObject</span><span><span>&lt;</span>DynamicFilterInfo<span>></span></span></span><span>(</span><span>@"
{
  ""Logic"" : ""Or"",
  ""Filters"" :
  [
    {
      ""Field"" : ""Code"",
      ""Operator"" : ""NotContains"",
      ""Value"" : ""val1"",
      ""Filters"" :
      [
        {
          ""Field"" : ""Name"",
          ""Operator"" : ""NotStartsWith"",
          ""Value"" : ""val2"",
        }
      ]
    },
    {
      ""Field"" : ""Parent.Code"",
      ""Operator"" : ""Equals"",
      ""Value"" : ""val11"",
      ""Filters"" :
      [
        {
          ""Field"" : ""Parent.Name"",
          ""Operator"" : ""Contains"",
          ""Value"" : ""val22"",
        }
      ]
    }
  ]
}
"</span><span>)</span><span>;</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>VM_District_Parent<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>WhereDynamicFilter</span><span>(</span>dyfilter<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT a.""Code"", a.""Name"", a.""ParentCode"", a__Parent.""Code"" as4, a__Parent.""Name"" as5, a__Parent.""ParentCode"" as6</span>
<span>//FROM ""D_District"" a</span>
<span>//LEFT JOIN ""D_District"" a__Parent ON a__Parent.""Code"" = a.""ParentCode""</span>
<span>//WHERE (not((a.""Code"") LIKE '%val1%') AND not((a.""Name"") LIKE 'val2%') OR a__Parent.""Code"" = 'val11' AND (a__Parent.""Name"") LIKE '%val22%')</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br></div></div><blockquote>
<p>åŠ¨æ€æ’åºï¼šISelect.OrderByPropertyName(&quot;Parent.Code&quot;)</p>
</blockquote>
<h2 id="api" tabindex="-1"> API</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
<td></td>
</tr>
<tr>
<td>ToList</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å› T1 å®ä½“æ‰€æœ‰å­—æ®µçš„è®°å½•ï¼Œè‹¥å­˜åœ¨å¯¼èˆªå±æ€§åˆ™ä¸€èµ·æŸ¥è¯¢è¿”å›ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
<td></td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å›æŒ‡å®šå­—æ®µçš„è®°å½•ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
<td></td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>string field</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å› field æŒ‡å®šå­—æ®µçš„è®°å½•ï¼Œå¹¶ä»¥å…ƒç»„æˆ–åŸºç¡€ç±»å‹(int,string,long)æ¥æ”¶ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
<td></td>
</tr>
<tr>
<td>ToOne</td>
<td>T1</td>
<td></td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å› T1 å®ä½“æ‰€æœ‰å­—æ®µçš„ç¬¬ä¸€æ¡è®°å½•ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› null</td>
<td></td>
</tr>
<tr>
<td>ToAggregate&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å›æŒ‡å®šå­—æ®µçš„èšåˆç»“æœï¼ˆé€‚åˆä¸éœ€è¦ GroupBy çš„åœºæ™¯ï¼‰</td>
<td></td>
</tr>
<tr>
<td>Any</td>
<td>bool</td>
<td></td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œæ˜¯å¦æœ‰è®°å½•</td>
<td></td>
</tr>
<tr>
<td>Sum</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚å’Œ</td>
<td></td>
</tr>
<tr>
<td>Min</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚æœ€å°å€¼</td>
<td></td>
</tr>
<tr>
<td>Max</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚æœ€å¤§å€¼</td>
<td></td>
</tr>
<tr>
<td>Avg</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚å¹³å‡å€¼</td>
<td></td>
</tr>
<tr>
<td>ã€åˆ†é¡µã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Count</td>
<td>long</td>
<td></td>
<td>æŸ¥è¯¢çš„è®°å½•æ•°é‡</td>
<td></td>
</tr>
<tr>
<td>Count</td>
<td>&lt;this&gt;</td>
<td>out long</td>
<td>æŸ¥è¯¢çš„è®°å½•æ•°é‡ï¼Œä»¥å‚æ•° out å½¢å¼è¿”å›</td>
<td></td>
</tr>
<tr>
<td>Skip</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>æŸ¥è¯¢å‘ååç§»è¡Œæ•°</td>
<td></td>
</tr>
<tr>
<td>Offset</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>æŸ¥è¯¢å‘ååç§»è¡Œæ•°</td>
<td></td>
</tr>
<tr>
<td>Limit</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>æŸ¥è¯¢å¤šå°‘æ¡æ•°æ®</td>
<td></td>
</tr>
<tr>
<td>Take</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>æŸ¥è¯¢å¤šå°‘æ¡æ•°æ®</td>
<td></td>
</tr>
<tr>
<td>Page</td>
<td>&lt;this&gt;</td>
<td>int pageIndex, int pageSize</td>
<td>åˆ†é¡µ</td>
<td></td>
</tr>
<tr>
<td>ã€æ¡ä»¶ã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>æ”¯æŒå¤šè¡¨æŸ¥è¯¢è¡¨è¾¾å¼ï¼Œå¤šæ¬¡ä½¿ç”¨ç›¸å½“äº AND</td>
<td></td>
</tr>
<tr>
<td>WhereIf</td>
<td>&lt;this&gt;</td>
<td>bool, Lambda</td>
<td>æ”¯æŒå¤šè¡¨æŸ¥è¯¢è¡¨è¾¾å¼</td>
<td></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>åŸç”Ÿ sql è¯­æ³•æ¡ä»¶ï¼ŒWhere(&quot;id = @id&quot;, new { id = 1 } ,<a href="/guide/ado.html#%E5%8F%82%E6%95%B0%E5%8C%96">æ³¨æ„å‰ç¼€@,æ ¹æ®å…·ä½“æ•°æ®åº“å†³å®š</a> å…¶ä»–åœ°æ–¹ä¸å†è¯´æ˜ã€‚åŒç† )</td>
<td></td>
</tr>
<tr>
<td>WhereIf</td>
<td>&lt;this&gt;</td>
<td>bool, string, parms</td>
<td>åŸç”Ÿ sql è¯­æ³•æ¡ä»¶ï¼ŒWhereIf(true, &quot;id = @id&quot;, new { id = 1 }</td>
<td></td>
</tr>
<tr>
<td>WhereCascade</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å®ç°å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œå‘æ¯ä¸ªè¡¨ä¸­é™„åŠ æ¡ä»¶</td>
<td></td>
</tr>
<tr>
<td>WhereDynamicFilter</td>
<td>&lt;this&gt;</td>
<td>DynamicFilterInfo</td>
<td>åŠ¨æ€è¿‡æ»¤æ¡ä»¶(ä¸å‰ç«¯äº¤äº’)</td>
<td></td>
</tr>
<tr>
<td>ã€åˆ†ç»„ã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>æŒ‰é€‰æ‹©çš„åˆ—åˆ†ç»„ï¼ŒGroupBy(a =&gt; a.Name)</td>
<td>GroupBy(a =&gt; new{a.Name,a.Time})</td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>æŒ‰åŸç”Ÿ sql è¯­æ³•åˆ†ç»„ï¼ŒGroupBy(&quot;concat(name, @cc)&quot;, new { cc = 1 })</td>
<td></td>
</tr>
<tr>
<td>Having</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>æŒ‰åŸç”Ÿ sql è¯­æ³•èšåˆæ¡ä»¶è¿‡æ»¤ï¼ŒHaving(&quot;count(name) = @cc&quot;, new { cc = 1 })</td>
<td></td>
</tr>
<tr>
<td>Disdinct</td>
<td>&lt;this&gt;</td>
<td></td>
<td>.Distinct().ToList(x =&gt; x.GroupName) æ˜¯å¯¹æŒ‡å®šå­—æ®µ</td>
<td></td>
</tr>
<tr>
<td>ã€æ’åºã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>OrderBy</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>æŒ‰åˆ—æ’åºï¼ŒOrderBy(a =&gt; a.Time)ï¼Œå¯å¤šæ¬¡ä½¿ç”¨</td>
<td></td>
</tr>
<tr>
<td>OrderByDescending</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>æŒ‰åˆ—å€’å‘æ’åºï¼ŒOrderByDescending(a =&gt; a.Time)</td>
<td></td>
</tr>
<tr>
<td>OrderBy</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>æŒ‰åŸç”Ÿ sql è¯­æ³•æ’åºï¼ŒOrderBy(&quot;count(name) + @cc&quot;, new { cc = 1 })</td>
<td></td>
</tr>
<tr>
<td>OrderByPropertyName</td>
<td>string, bool</td>
<td>æŒ‰å±æ€§åå­—ç¬¦ä¸²æ’åºï¼ˆæ”¯æŒå¯¼èˆªå±æ€§ï¼‰</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ã€è”è¡¨ã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>LeftJoin</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å·¦è”æŸ¥è¯¢ï¼Œå¯ä½¿ç”¨å¯¼èˆªå±æ€§ï¼Œæˆ–æŒ‡å®šå…³è”çš„å®ä½“ç±»å‹</td>
<td></td>
</tr>
<tr>
<td>InnerJoin</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>è”æ¥æŸ¥è¯¢ï¼Œå¯ä½¿ç”¨å¯¼èˆªå±æ€§ï¼Œæˆ–æŒ‡å®šå…³è”çš„å®ä½“ç±»å‹</td>
<td></td>
</tr>
<tr>
<td>RightJoin</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å³è”æŸ¥è¯¢ï¼Œå¯ä½¿ç”¨å¯¼èˆªå±æ€§ï¼Œæˆ–æŒ‡å®šå…³è”çš„å®ä½“ç±»å‹</td>
<td></td>
</tr>
<tr>
<td>LeftJoin</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>å·¦è”æŸ¥è¯¢ï¼Œä½¿ç”¨åŸç”Ÿ sql è¯­æ³•ï¼ŒLeftJoin(&quot;type b on b.id = a.id and b.clicks &gt; ?clicks&quot;, new { clicks = 1 })</td>
<td></td>
</tr>
<tr>
<td>InnerJoin</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>è”æ¥æŸ¥è¯¢ï¼Œä½¿ç”¨åŸç”Ÿ sql è¯­æ³•ï¼ŒInnerJoin(&quot;type b on b.id = a.id and b.clicks &gt; ?clicks&quot;, new { clicks = 1 })</td>
<td></td>
</tr>
<tr>
<td>RightJoin</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>å³è”æŸ¥è¯¢ï¼Œä½¿ç”¨åŸç”Ÿ sql è¯­æ³•ï¼ŒRightJoin(&quot;type b on b.id = a.id and b.clicks &gt; ?clicks&quot;, new { clicks = 1 })</td>
<td></td>
</tr>
<tr>
<td>From</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å¤šè¡¨æŸ¥è¯¢ï¼Œ3 ä¸ªè¡¨ä»¥ä¸Šä½¿ç”¨éå¸¸æ–¹ä¾¿ï¼Œç›®å‰è®¾è®¡æœ€å¤§æ”¯æŒ 10 ä¸ªè¡¨</td>
<td></td>
</tr>
<tr>
<td>ã€å…¶ä»–ã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>As</td>
<td>&lt;this&gt;</td>
<td>string alias = &quot;a&quot;</td>
<td>æŒ‡å®šåˆ«å</td>
<td></td>
</tr>
<tr>
<td>Master</td>
<td>&lt;this&gt;</td>
<td></td>
<td>æŒ‡å®šä»ä¸»åº“æŸ¥è¯¢ï¼ˆé»˜è®¤æŸ¥è¯¢ä»åº“ï¼‰</td>
<td></td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>å‘½ä»¤è¶…æ—¶è®¾ç½®(ç§’)</td>
<td></td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>è®¾ç½®äº‹åŠ¡å¯¹è±¡</td>
<td></td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>è®¾ç½®è¿æ¥å¯¹è±¡</td>
<td></td>
</tr>
<tr>
<td>WithLock</td>
<td>&lt;this&gt;</td>
<td>Enum</td>
<td>SqlServer NoLock ç­‰ç‰¹æœ‰çš„è®¾ç½®</td>
<td></td>
</tr>
<tr>
<td>ForUpdate</td>
<td>&lt;this&gt;</td>
<td>bool</td>
<td>æ’ä»–æ›´æ–°é”ï¼Œå¯¹ä¸åŒçš„æ•°æ®åº“å·²ä½œé€‚é…ï¼Œè¯¦ç»†è¯´æ˜è§æ³¨é‡Š</td>
<td></td>
</tr>
<tr>
<td>AsQueryable</td>
<td>IQueryable</td>
<td></td>
<td>å°† ISelect è½¬æ¢ä¸º IQueryableï¼Œæ­¤æ–¹æ³•ä¸»è¦ç”¨äºæ‰©å±•ï¼Œæ¯”å¦‚ï¼šabp IRepository GetAll() æ¥å£æ–¹æ³•éœ€è¦è¿”å› IQueryable å¯¹è±¡ã€‚æ³¨æ„ï¼šIQueryable æ–¹æ³•æ±¡æŸ“è¾ƒä¸ºä¸¥é‡ï¼Œè¯·å°½é‡é¿å…æ­¤è½¬æ¢</td>
<td></td>
</tr>
<tr>
<td>ToTreeList()</td>
<td>List&lt;TEntity&gt;</td>
<td>æ— </td>
<td>å°†çˆ¶å­å…³ç³»çš„æ•°æ®ä»¥ TreeList çš„å½¢å¼è¿”å›</td>
<td></td>
</tr>
<tr>
<td>AsTreeCte()</td>
<td>ISelect</td>
<td>(up, pathSelector, level)</td>
<td>é€’å½’æŸ¥è¯¢çˆ¶å­å…³ç³»è¡¨</td>
<td></td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">åˆ†è¡¨åˆ†åº“</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/sharding.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/sharding.html"/>
    <updated>2022-05-31T14:08:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åˆ†è¡¨åˆ†åº“" tabindex="-1"> åˆ†è¡¨åˆ†åº“</h1>
<h2 id="ç†è®ºçŸ¥è¯†" tabindex="-1"> ç†è®ºçŸ¥è¯†</h2>
<p>åˆ†è¡¨ - ä»è¡¨é¢æ„æ€ä¸Šçœ‹å‘¢ï¼Œå°±æ˜¯æŠŠä¸€å¼ è¡¨åˆ†æˆ N å¤šä¸ªå°è¡¨ï¼Œæ¯ä¸€ä¸ªå°è¡¨éƒ½æ˜¯å®Œæ•´çš„ä¸€å¼ è¡¨ã€‚åˆ†è¡¨åæ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨åˆ†è¡¨é‡Œï¼Œæ€»è¡¨åªæ˜¯ä¸€ä¸ªå¤–å£³ï¼Œå­˜å–æ•°æ®å‘ç”Ÿåœ¨ä¸€ä¸ªä¸€ä¸ªçš„åˆ†è¡¨é‡Œé¢ã€‚åˆ†è¡¨åå•è¡¨çš„å¹¶å‘èƒ½åŠ›æé«˜äº†ï¼Œç£ç›˜ I/O æ€§èƒ½ä¹Ÿæé«˜äº†ã€‚å¹¶å‘èƒ½åŠ›ä¸ºä»€ä¹ˆæé«˜äº†å‘¢ï¼Œå› ä¸ºæŸ¥å¯»ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´å˜çŸ­äº†ï¼Œå¦‚æœå‡ºç°é«˜å¹¶å‘çš„è¯ï¼Œæ€»è¡¨å¯ä»¥æ ¹æ®ä¸åŒ çš„æŸ¥è¯¢ï¼Œå°†å¹¶å‘å‹åŠ›åˆ†åˆ°ä¸åŒçš„å°è¡¨é‡Œé¢ã€‚</p>
<p>åˆ†åº“ - æŠŠåŸæœ¬å­˜å‚¨äºä¸€ä¸ªåº“çš„æ•°æ®åˆ†å—å­˜å‚¨åˆ°å¤šä¸ªåº“ä¸Šï¼ŒæŠŠåŸæœ¬å­˜å‚¨äºä¸€ä¸ªè¡¨çš„æ•°æ®åˆ†å—å­˜å‚¨åˆ°å¤šä¸ªè¡¨ä¸Šã€‚æ•°æ®åº“ä¸­çš„æ•°æ®é‡ä¸ä¸€å®šæ˜¯å¯æ§çš„ï¼Œåœ¨æœªè¿›è¡Œåˆ†è¡¨åˆ†åº“çš„æƒ…å†µä¸‹ï¼Œéšç€æ—¶é—´å’Œä¸šåŠ¡çš„å‘å±•ï¼Œåº“ä¸­çš„è¡¨ä¼šè¶Šæ¥è¶Šå¤šï¼Œè¡¨ä¸­çš„æ•°æ®é‡ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œç›¸åº”åœ°ï¼Œæ•°æ®æ“ä½œï¼Œå¢åˆ æ”¹æŸ¥çš„å¼€é”€ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼›å¦å¤–ï¼Œä¸€å°æœåŠ¡å™¨çš„èµ„æºï¼ˆCPUã€ç£ç›˜ã€å†…å­˜ã€IO ç­‰ï¼‰æ˜¯æœ‰é™çš„ï¼Œæœ€ç»ˆæ•°æ®åº“æ‰€èƒ½æ‰¿è½½çš„æ•°æ®é‡ã€æ•°æ®å¤„ç†èƒ½åŠ›éƒ½å°†é­é‡ç“¶é¢ˆã€‚</p>
<h2 id="åˆ†è¡¨-astable" tabindex="-1"> åˆ†è¡¨ AsTable</h2>
<p>FreeSql åŸç”Ÿç”¨æ³•ã€FreeSql.Repository ä»“å‚¨ç”¨æ³• éƒ½æä¾›äº† AsTable æ–¹æ³•å¯¹åˆ†è¡¨è¿›è¡Œ CRUD æ“ä½œï¼Œä¾‹å¦‚ï¼š</p>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Log<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repo<span>.</span><span>AsTable</span><span>(</span>oldname <span>=></span> <span><span>$"</span><span><span>{</span><span>oldname</span><span>}</span></span><span>_201903"</span></span><span>)</span><span>;</span> <span>//å¯¹ Log_201903 è¡¨ CRUD</span>

repo<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Log</span> <span>{</span> <span>..</span><span>.</span> <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>è·¨åº“ï¼Œä½†æ˜¯åœ¨åŒä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ AsTable(oldname =&gt; $&quot;db2.dbo.{oldname}&quot;)</p>
<div><pre><code><span>//è·¨è¡¨æŸ¥è¯¢</span>
<span><span>var</span></span> sql <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>AsTable</span><span>(</span><span>(</span>type<span>,</span> oldname<span>)</span> <span>=></span> <span>"table_1"</span><span>)</span>
    <span>.</span><span>AsTable</span><span>(</span><span>(</span>type<span>,</span> oldname<span>)</span> <span>=></span> <span>"table_2"</span><span>)</span>
    <span>.</span><span>ToSql</span><span>(</span>a <span>=></span> a<span>.</span>Id<span>)</span><span>;</span>

<span>//select * from (SELECT a."Id" as1 FROM "table_1" a) ftb</span>
<span>//UNION ALL</span>
<span>//select * from (SELECT a."Id" as1 FROM "table_2" a) ftb</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><p>åˆ†è¡¨æ€»ç»“ï¼š</p>
<ul>
<li>åˆ†è¡¨ã€ç›¸åŒæœåŠ¡å™¨è·¨åº“ å¯ä»¥ä½¿ç”¨ AsTable è¿›è¡Œ CRUDï¼›</li>
<li>AsTable CodeFirst ä¼šè‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„åˆ†è¡¨ï¼›</li>
<li>ä¸å¯åœ¨åˆ†è¡¨åˆ†åº“çš„å®ä½“ç±»å‹ä¸­ä½¿ç”¨ã€Šå»¶æ—¶åŠ è½½ã€‹ï¼›</li>
</ul>
<p>SqlServer è·¨åº“äº‹åŠ¡ å¯ä»¥ä½¿ç”¨ TransactionScopeï¼Œå¦‚ä¸‹ï¼š</p>
<div><pre><code><span><span>var</span></span> repoLog <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Log<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> repoComment <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Comment<span>></span></span></span><span>(</span><span>)</span><span>;</span>
repoLog<span>.</span><span>AsTable</span><span>(</span>oldname <span>=></span> <span><span>$"</span><span><span>{</span><span><span>201903</span></span><span>}</span></span><span>.dbo.</span><span><span>{</span><span>oldname</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>
repoComment<span>.</span><span>AsTable</span><span>(</span>oldname <span>=></span> <span><span>$"</span><span><span>{</span><span><span>201903</span></span><span>}</span></span><span>.dbo.</span><span><span>{</span><span>oldname</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>

<span>using</span> <span>(</span><span>TransactionScope</span> ts <span>=</span> <span>new</span> <span>TransactionScope</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
    repoComment<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Comment</span> <span>{</span> <span>..</span><span>.</span> <span>}</span><span>)</span><span>;</span>
    repoLog<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Log</span> <span>{</span> <span>..</span><span>.</span> <span>}</span><span>)</span><span>;</span>
    ts<span>.</span><span>Complete</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="åˆ†åº“-idlebus" tabindex="-1"> åˆ†åº“ IdleBus</h2>
<p>IFreeSql å¯¹åº”ä¸€ä¸ªæ•°æ®åº“ï¼Œåˆ†åº“æ˜¯ä¸æ˜¯è¦å®šä¹‰ N ä¸ª IFreeSqlï¼Ÿåˆ†åº“çš„ç§Ÿæˆ·åœºæ™¯ï¼Œé‚£ä¸è¦å®šä¹‰ 10000 ä¸ªï¼Ÿ</p>
<p>IdleBus ç©ºé—²å¯¹è±¡ç®¡ç†å®¹å™¨ï¼Œæœ‰æ•ˆç»„ç»‡å¯¹è±¡é‡å¤åˆ©ç”¨ï¼Œè‡ªåŠ¨åˆ›å»ºã€é”€æ¯ï¼Œè§£å†³ã€å®ä¾‹ã€‘è¿‡å¤šä¸”é•¿æ—¶é—´å ç”¨çš„é—®é¢˜ã€‚æœ‰æ—¶å€™æƒ³åšä¸€ä¸ªå•ä¾‹å¯¹è±¡é‡å¤ä½¿ç”¨æå‡æ€§èƒ½ï¼Œä½†æ˜¯å®šä¹‰å¤šäº†ï¼Œæœ‰çš„åˆå¯èƒ½ä¸€ç›´ç©ºé—²ç€å ç”¨èµ„æºã€‚ä¸“é—¨è§£å†³ï¼šåˆæƒ³é‡å¤åˆ©ç”¨ï¼Œåˆæƒ³å°‘å èµ„æºçš„åœºæ™¯ã€‚https://github.com/2881099/IdleBus</p>
<blockquote>
<p>dotnet add package IdleBus</p>
</blockquote>
<div><pre><code><span>static</span> <span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span> ib <span>=</span> <span>new</span> <span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span><span>(</span>TimeSpan<span>.</span><span>FromMinutes</span><span>(</span><span>10</span><span>)</span><span>)</span><span>;</span>

ib<span>.</span><span>Register</span><span>(</span><span>"db1"</span><span>,</span> <span>(</span><span>)</span> <span>=></span> <span>new</span> <span>FreeSqlBuilder</span><span>(</span><span>)</span><span>.</span><span>UseConnectionString</span><span>(</span>DataType<span>.</span>MySql<span>,</span> <span>"str1"</span><span>)</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>)</span><span>;</span>
ib<span>.</span><span>Register</span><span>(</span><span>"db2"</span><span>,</span> <span>(</span><span>)</span> <span>=></span> <span>new</span> <span>FreeSqlBuilder</span><span>(</span><span>)</span><span>.</span><span>UseConnectionString</span><span>(</span>DataType<span>.</span>MySql<span>,</span> <span>"str2"</span><span>)</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>)</span><span>;</span>
ib<span>.</span><span>Register</span><span>(</span><span>"db3"</span><span>,</span> <span>(</span><span>)</span> <span>=></span> <span>new</span> <span>FreeSqlBuilder</span><span>(</span><span>)</span><span>.</span><span>UseConnectionString</span><span>(</span>DataType<span>.</span>SqlServer<span>,</span> <span>"str3"</span><span>)</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>)</span><span>;</span>
<span>//...æ³¨å†Œå¾ˆå¤šä¸ª</span>

ib<span>.</span><span>Get</span><span>(</span><span>"db1"</span><span>)</span><span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Limit</span><span>(</span><span>10</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>IdleBus ä¹Ÿæ˜¯ã€å•ä¾‹ã€‘è®¾è®¡ï¼ä¸»è¦çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œæ³¨å†Œï¼Œè·å–ã€‚ä½¿ç”¨ IdleBus éœ€è¦å¼±åŒ– IFreeSql çš„å­˜åœ¨ï¼Œæ¯æ¬¡ä½¿ç”¨ ib.Get è·å–ã€‚</p>
<div><pre><code><span>public</span> <span>static</span> <span>class</span> <span>IdleBusExtesions</span>
<span>{</span>
    <span>static</span> <span>AsyncLocal<span>&lt;</span><span>string</span><span>></span></span> asyncLocalTenantId <span>=</span> <span>new</span> <span>AsyncLocal<span>&lt;</span><span>string</span><span>></span></span><span>(</span><span>)</span><span>;</span>
    <span>public</span> <span>static</span> <span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span> <span>ChangeTenant</span><span>(</span><span>this</span> <span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span> ib<span>,</span> <span><span>string</span></span> tenantId<span>)</span>
    <span>{</span>
        asyncLocalTenantId<span>.</span>Value <span>=</span> tenantId<span>;</span>
        <span>return</span> ib<span>;</span>
    <span>}</span>
    <span>public</span> <span>static</span> <span>IFreeSql</span> <span>Get</span><span>(</span><span>this</span> <span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span> ib<span>)</span> <span>=></span> ib<span>.</span><span>Get</span><span>(</span>asyncLocalTenantId<span>.</span>Value <span>??</span> <span>"db1"</span><span>)</span><span>;</span>
    <span>public</span> <span>static</span> <span>IBaseRepository<span>&lt;</span>T<span>></span></span> <span><span>GetRepository</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>this</span> <span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span> ib<span>)</span> <span>where</span> <span>T</span> <span>:</span> <span><span>class</span></span> <span>=></span> ib<span>.</span><span>Get</span><span>(</span><span>)</span><span>.</span><span><span>GetRepository</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>;</span>

    <span>//-------------------------------------------------------</span>

    <span>static</span> <span><span>void</span></span> <span>test</span><span>(</span><span>)</span>
    <span>{</span>
        <span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span> ib <span>=</span> <span>null</span><span>;</span> <span>//å•ä¾‹æ³¨å…¥</span>

        <span><span>var</span></span> fsql <span>=</span> ib<span>.</span><span>Get</span><span>(</span><span>)</span><span>;</span> <span>//è·å–å½“å‰ç§Ÿæˆ·å¯¹åº”çš„ IFreeSql</span>

        <span><span>var</span></span> fsql00102 <span>=</span> ib<span>.</span><span>ChangeTenant</span><span>(</span><span>"00102"</span><span>)</span><span>.</span><span>Get</span><span>(</span><span>)</span><span>;</span> <span>//åˆ‡æ¢ç§Ÿæˆ·ï¼Œåé¢çš„æ“ä½œéƒ½æ˜¯é’ˆå¯¹ 00102</span>

        <span><span>var</span></span> songRepository <span>=</span> ib<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
        <span><span>var</span></span> detailRepository <span>=</span> ib<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Detail<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>//-------------------------------------------------------</span>

    <span>public</span> <span>static</span> <span>IServiceCollection</span> <span>AddIdleBusRepository</span><span>(</span><span>this</span> <span>IServiceCollection</span> services<span>,</span> <span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span> ib<span>,</span> <span>params</span> <span>Assembly<span>[</span><span>]</span></span> assemblies<span>)</span>
    <span>{</span>
        services<span>.</span><span>AddSingleton</span><span>(</span>ib<span>)</span><span>;</span>
        services<span>.</span><span>AddScoped</span><span>(</span><span>typeof</span><span>(</span><span>IBaseRepository<span>&lt;</span><span>></span></span><span>)</span><span>,</span> <span>typeof</span><span>(</span><span>YourDefaultRepository<span>&lt;</span><span>></span></span><span>)</span><span>)</span><span>;</span>
        services<span>.</span><span>AddScoped</span><span>(</span><span>typeof</span><span>(</span><span>BaseRepository<span>&lt;</span><span>></span></span><span>)</span><span>,</span> <span>typeof</span><span>(</span><span>YourDefaultRepository<span>&lt;</span><span>></span></span><span>)</span><span>)</span><span>;</span>
        services<span>.</span><span>AddScoped</span><span>(</span><span>typeof</span><span>(</span><span>IBaseRepository<span>&lt;</span><span>,</span><span>></span></span><span>)</span><span>,</span> <span>typeof</span><span>(</span><span>YourDefaultRepository<span>&lt;</span><span>,</span><span>></span></span><span>)</span><span>)</span><span>;</span>
        services<span>.</span><span>AddScoped</span><span>(</span><span>typeof</span><span>(</span><span>BaseRepository<span>&lt;</span><span>,</span><span>></span></span><span>)</span><span>,</span> <span>typeof</span><span>(</span><span>YourDefaultRepository<span>&lt;</span><span>,</span><span>></span></span><span>)</span><span>)</span><span>;</span>

        <span>if</span> <span>(</span>assemblies<span>?.</span><span>Any</span><span>(</span><span>)</span> <span>==</span> <span>true</span><span>)</span>
            <span>foreach</span> <span>(</span><span><span>var</span></span> asse <span>in</span> assemblies<span>)</span> <span>//æ‰¹é‡æ³¨å†Œ</span>
                <span>foreach</span> <span>(</span><span><span>var</span></span> repo <span>in</span> asse<span>.</span><span>GetTypes</span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>IsAbstract <span>==</span> <span>false</span> <span>&amp;&amp;</span> <span>typeof</span><span>(</span><span>IBaseRepository</span><span>)</span><span>.</span><span>IsAssignableFrom</span><span>(</span>a<span>)</span><span>)</span><span>)</span>
                    services<span>.</span><span>AddScoped</span><span>(</span>repo<span>)</span><span>;</span>
        <span>return</span> services<span>;</span>
    <span>}</span>
<span>}</span>

<span>class</span> <span>YourDefaultRepository<span>&lt;</span>T<span>></span></span> <span>:</span> <span><span>BaseRepository<span>&lt;</span>T<span>></span></span></span> <span>where</span> <span>T</span> <span>:</span> <span><span>class</span></span>
<span>{</span>
    <span>public</span> <span>YourDefaultRepository</span><span>(</span><span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span> ib<span>)</span> <span>:</span> <span>base</span><span>(</span>ib<span>.</span><span>Get</span><span>(</span><span>)</span><span>,</span> <span>null</span><span>,</span> <span>null</span><span>)</span> <span>{</span> <span>}</span>
<span>}</span>
<span>class</span> <span>YourDefaultRepository<span>&lt;</span>T<span>,</span> TKey<span>></span></span> <span>:</span> <span><span>BaseRepository<span>&lt;</span>T<span>,</span> TKey<span>></span></span></span> <span>where</span> <span>T</span> <span>:</span> <span><span>class</span></span>
<span>{</span>
    <span>public</span> <span>YourDefaultRepository</span><span>(</span><span>IdleBus<span>&lt;</span>IFreeSql<span>></span></span> ib<span>)</span> <span>:</span> <span>base</span><span>(</span>ib<span>.</span><span>Get</span><span>(</span><span>)</span><span>,</span> <span>null</span><span>,</span> <span>null</span><span>)</span> <span>{</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br></div></div><p>åˆ†åº“æ€»ç»“ï¼š</p>
<ul>
<li>è·¨åº“ å¯ä»¥ä½¿ç”¨ ib.Get() è·å– IFreeSql è¿›è¡Œ CRUDï¼›</li>
<li>è·¨åº“ äº‹åŠ¡ä¸å¥½å¤„ç†ï¼Œæ³¨æ„äº†ï¼›</li>
<li>è·¨åº“ æŸ¥è¯¢ä¸å¥½å¤„ç†ï¼Œæ³¨æ„äº†ï¼›</li>
</ul>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">äº‹åŠ¡</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/transaction.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/transaction.html"/>
    <updated>2022-06-11T04:05:02.000Z</updated>
    <content type="html"><![CDATA[<h1 id="äº‹åŠ¡" tabindex="-1"> äº‹åŠ¡</h1>
<p>æœ¬æ–‡æ‰€æœ‰å†…å®¹åŸºäºå•æœºæ•°æ®åº“äº‹åŠ¡ï¼Œåˆ†å¸ƒå¼æ•°æ®åº“ TCC/SAGA æ–¹æ¡ˆè¯·ç§»æ­¥ï¼šhttps://github.com/2881099/FreeSql.Cloud</p>
<h2 id="_0ã€asp-net-core-é…ç½®-di-ä½¿ç”¨-unitofworkmanager-æ­¤æ–¹æ³•æ›´ç®€å•" tabindex="-1"> 0ã€<a href="https://github.com/dotnetcore/FreeSql/wiki/DI-UnitOfWorkManager%E4%BA%8B%E5%8A%A1" target="_blank" rel="noopener noreferrer">ASP.NET Core é…ç½® DI ä½¿ç”¨ UnitOfWorkManagerï¼Œæ­¤æ–¹æ³•æ›´ç®€å•</a></h2>
<h2 id="_1ã€unitofwork-äº‹åŠ¡" tabindex="-1"> 1ã€UnitOfWork äº‹åŠ¡</h2>
<div><pre><code><span>using</span> <span>(</span><span><span>var</span></span> uow <span>=</span> fsql<span>.</span><span>CreateUnitOfWork</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
  <span><span>var</span></span> songRepo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
  <span><span>var</span></span> userRepo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span><span>;</span>
  songRepo<span>.</span>UnitOfWork <span>=</span> uow<span>;</span> <span>//æ‰‹å·¥ç»‘å®šå·¥ä½œå•å…ƒ</span>
  userRepo<span>.</span>UnitOfWork <span>=</span> uow<span>;</span>

  songRepo<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Song</span><span>(</span><span>)</span><span>)</span><span>;</span>
  userRepo<span>.</span><span>Update</span><span>(</span><span>..</span><span>.</span><span>)</span><span>;</span>

  uow<span>.</span>Orm<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Song</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
  <span>//æ³¨æ„ï¼šuow.Orm å’Œ fsql éƒ½æ˜¯ IFreeSql</span>
  <span>//uow.Orm CRUD ä¸ uow æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼ˆç†è§£ä¸ºä¸´æ—¶ IFreeSqlï¼‰</span>
  <span>//fsql CRUD ä¸ uow ä¸åœ¨ä¸€ä¸ªäº‹åŠ¡</span>

  uow<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><p>å‚è€ƒï¼š<a href="https://github.com/dotnetcore/FreeSql/issues/289" target="_blank" rel="noopener noreferrer">åœ¨ asp.net core ä¸­ä½¿ç”¨ TransactionalAttribute + UnitOfWorkManager å®ç°å¤šç§äº‹åŠ¡ä¼ æ’­</a></p>
<h2 id="_2ã€dbcontext-äº‹åŠ¡" tabindex="-1"> 2ã€DbContext äº‹åŠ¡</h2>
<div><pre><code><span>using</span> <span>(</span><span><span>var</span></span> ctx <span>=</span> fsql<span>.</span><span>CreateDbContext</span><span>(</span><span>)</span><span>)</span> <span>{</span>
  <span><span>var</span></span> song <span>=</span> ctx<span>.</span><span><span>Set</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
  <span><span>var</span></span> user <span>=</span> ctx<span>.</span><span><span>Set</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span><span>;</span>

  song<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Song</span><span>(</span><span>)</span><span>)</span><span>;</span>
  user<span>.</span><span>Update</span><span>(</span><span>..</span><span>.</span><span>)</span><span>;</span>

  ctx<span>.</span><span>SaveChanges</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="_3ã€åŒçº¿ç¨‹äº‹åŠ¡" tabindex="-1"> 3ã€åŒçº¿ç¨‹äº‹åŠ¡</h2>
<p>åŒçº¿ç¨‹äº‹åŠ¡ï¼Œç”± fsql.Transaction ç®¡ç†äº‹åŠ¡æäº¤å›æ»šï¼ˆç¼ºç‚¹ï¼šä¸æ”¯æŒå¼‚æ­¥ï¼‰ï¼Œæ¯”è¾ƒé€‚åˆ WinForm/WPF UI ä¸»çº¿ç¨‹ä½¿ç”¨äº‹åŠ¡çš„åœºæ™¯ã€‚</p>
<p>ç”¨æˆ·è´­ä¹°äº†ä»·å€¼ 100 å…ƒçš„å•†å“ï¼šæ‰£ä½™é¢ã€æ‰£åº“å­˜ã€‚</p>
<div><pre><code>fsql<span>.</span><span>Transaction</span><span>(</span><span>(</span><span>)</span> <span>=></span>  <span>{</span>
  <span>//fsql.Ado.TransactionCurrentThread è·å¾—å½“å‰äº‹åŠ¡å¯¹è±¡</span>

  <span><span>var</span></span> affrows <span>=</span> fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Wealth <span>-</span> <span>100</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Wealth <span>>=</span> <span>100</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
    <span>//åˆ¤æ–­åˆ«è®©ç”¨æˆ·ä½™é¢æ‰£æˆè´Ÿæ•°</span>

  <span>if</span> <span>(</span>affrows <span>&lt;</span> <span>1</span><span>)</span>
    <span>throw</span> <span>new</span> <span>Exception</span><span>(</span><span>"ç”¨æˆ·ä½™é¢ä¸è¶³"</span><span>)</span><span>;</span>
    <span>//æŠ›å‡ºå¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡ï¼Œäº‹åŠ¡é€€å‡º</span>

  affrows <span>=</span> fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Goods<span>></span></span></span><span>(</span><span>)</span>
    <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Stock <span>-</span> <span>1</span><span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Stock <span>>=</span> <span>1</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
    <span>//åˆ¤æ–­åˆ«è®©ç”¨åº“å­˜æ‰£æˆè´Ÿæ•°</span>

  <span>if</span> <span>(</span>affrows <span>&lt;</span> <span>1</span><span>)</span>
    <span>throw</span> <span>new</span> <span>Exception</span><span>(</span><span>"å•†å“åº“å­˜ä¸è¶³"</span><span>)</span><span>;</span>
    <span>//æŠ›å‡ºå¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡ï¼Œäº‹åŠ¡é€€å‡º</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><p>åŒçº¿ç¨‹äº‹åŠ¡ä½¿ç”¨ç®€å•ï¼Œéœ€è¦æ³¨æ„çš„é™åˆ¶ï¼š</p>
<ul>
<li>
<p>äº‹åŠ¡å¯¹è±¡åœ¨çº¿ç¨‹æŒ‚è½½ï¼Œæ¯ä¸ªçº¿ç¨‹åªå¯å¼€å¯ä¸€ä¸ªäº‹åŠ¡è¿æ¥ï¼ŒåµŒå¥—ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ï¼›</p>
</li>
<li>
<p>äº‹åŠ¡ä½“å†…ä»£ç ä¸å¯ä»¥åˆ‡æ¢çº¿ç¨‹ï¼Œå› æ­¤ä¸å¯ä½¿ç”¨ä»»ä½•å¼‚æ­¥æ–¹æ³•ï¼ŒåŒ…æ‹¬ FreeSql æä¾›çš„æ•°æ®åº“å¼‚æ­¥æ–¹æ³•ï¼ˆå¯ä»¥ä½¿ç”¨ä»»ä½• Curd åŒæ­¥æ–¹æ³•ï¼‰ï¼›</p>
</li>
</ul>
<h2 id="_4ã€å¤–éƒ¨äº‹åŠ¡" tabindex="-1"> 4ã€å¤–éƒ¨äº‹åŠ¡</h2>
<p>åœ¨ä¸å…¶ä»–å¼€æºé¡¹ç›®ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œäº‹åŠ¡ç”±å¤–éƒ¨å¼€å¯ï¼Œä½¿ç”¨ WithTransaction å°†äº‹åŠ¡å¯¹è±¡ä¼ å…¥æ‰§è¡Œã€‚</p>
<div><pre><code><span>await</span> fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>xxx<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>WithTransaction</span><span>(</span>æŒ‡å®šäº‹åŠ¡<span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Clicks <span>+</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrowsAsync</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>ISelectã€IInsertã€IUpdateã€IDeleteï¼Œéƒ½æ”¯æŒ WithTransaction æ–¹æ³•ã€‚</p>
<h2 id="_5ã€æ›´æ–°æ’ä»–é”" tabindex="-1"> 5ã€æ›´æ–°æ’ä»–é”</h2>
<div><pre><code><span><span>var</span></span> user <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>ForUpdate</span><span>(</span><span>true</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT ... FROM User a for update nowait</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>for update åœ¨ Oracle/PostgreSQL/MySql æ˜¯é€šç”¨çš„å†™æ³•ï¼Œæˆ‘ä»¬å¯¹ SqlServer åšäº†ç‰¹åˆ«é€‚é…ï¼Œæ‰§è¡Œçš„ SQL è¯­å¥å¤§è‡´å¦‚ä¸‹ï¼š</p>
<div><pre><code><span>SELECT</span> <span>.</span><span>.</span><span>.</span> <span>FROM</span> <span>[</span><span>User</span><span>]</span> a <span>With</span><span>(</span>UpdLock<span>,</span> RowLock<span>,</span> NoWait<span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="_6ã€ç¤ºèŒƒä»£ç " tabindex="-1"> 6ã€ç¤ºèŒƒä»£ç </h2>
<div><pre><code><span>//ä½¿ç”¨ å…¨å±€çº¿ç¨‹äº‹åŠ¡</span>
fsql<span>.</span><span>Transaction</span><span>(</span><span>(</span><span>)</span> <span>=></span>
<span>{</span>
    fsql<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
    fsql<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>


<span>//ä½¿ç”¨ UnitOfWork äº‹åŠ¡</span>
<span>using</span> <span>(</span><span><span>var</span></span> uow <span>=</span> fsql<span>.</span><span>CreateUnitOfWork</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
    <span><span>var</span></span> repo <span>=</span> uow<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Products<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    repo<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>;</span>

    uow<span>.</span>Orm<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//æ­£å¸¸</span>
    fsql<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//é”™è¯¯ï¼Œæ²¡æœ‰ä¼ äº‹åŠ¡</span>
    fsql<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>WithTransaction</span><span>(</span>uow<span>.</span><span>GetOrBeginTransaction</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//æ­£å¸¸</span>

    uow<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
<span>}</span>


<span>//ä½¿ç”¨ DbContext äº‹åŠ¡</span>
<span>using</span> <span>(</span><span><span>var</span></span> ctx <span>=</span> fsql<span>.</span><span>CreateDbContext</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
    ctx<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>;</span>

    ctx<span>.</span>Orm<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//æ­£å¸¸</span>
    fsql<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//é”™è¯¯ï¼Œæ²¡æœ‰ä¼ äº‹åŠ¡</span>
    fsql<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>WithTransaction</span><span>(</span>ctx<span>.</span>UnitOfWork<span>.</span><span>GetOrBeginTransaction</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//æ­£å¸¸</span>

    ctx<span>.</span><span>SaveChanges</span><span>(</span><span>)</span><span>;</span>
<span>}</span>


<span>//ä½¿ç”¨ UnitOfWorkManager ç®¡ç†ç±»äº‹åŠ¡</span>
<span>using</span> <span>(</span><span><span>var</span></span> uowManager <span>=</span> <span>new</span> <span>UnitOfWorkManager</span><span>(</span>fsql<span>)</span><span>)</span>
<span>{</span>
    <span>using</span> <span>(</span><span><span>var</span></span> uow <span>=</span> uowManager<span>.</span><span>Begin</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        uow<span>.</span>Orm<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//æ­£å¸¸</span>
        fsql<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//é”™è¯¯ï¼Œæ²¡æœ‰ä¼ äº‹åŠ¡</span>
        fsql<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>.</span><span>WithTransaction</span><span>(</span>uow<span>.</span><span>GetOrBeginTransaction</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span> <span>//æ­£å¸¸</span>

        <span>using</span> <span>(</span><span><span>var</span></span> uow2 <span>=</span> uowManager<span>.</span><span>Begin</span><span>(</span><span>)</span><span>)</span> <span>//ä¸ uow åŒä¸€ä¸ªäº‹åŠ¡</span>
        <span>{</span>
            <span><span>var</span></span> repo1 <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Products<span>></span></span></span><span>(</span><span>)</span><span>;</span>
            repo1<span>.</span>UnitOfWork <span>=</span> uow2<span>;</span>
            repo1<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Products</span><span>(</span><span>)</span><span>)</span><span>;</span>

            uow2<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span> <span>//äº‹åŠ¡è¿˜æœªæäº¤</span>
        <span>}</span>

        uow<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span> <span>//äº‹åŠ¡æäº¤</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br></div></div><ul>
<li>IFreeSql Curd æ–¹æ³•è‹¥ä¸æ˜¯ä½¿ç”¨åŒçº¿ç¨‹äº‹åŠ¡ï¼Œéœ€è¦æŒ‡å®š WithTransaction ä¼ å…¥äº‹åŠ¡ï¼›</li>
<li>IUnitOfWork Orm ä¸å·¥ä½œå•å…ƒäº‹åŠ¡ä¸€è‡´ï¼›</li>
<li>FreeSql.IBaseRepository curd æ–¹æ³•éœ€è¦æŒ‡å®š UnitOfWork ä¼ é€’å·¥ä½œå•å…ƒäº‹åŠ¡ï¼›</li>
<li>FreeSql.DbContext è‡ªå¸¦äº‹åŠ¡ï¼›</li>
<li>UnitOfWorkManager é€‚åˆåšè·¨æ–¹æ³•äº‹åŠ¡ï¼›</li>
</ul>
<p><a href="https://github.com/dotnetcore/FreeSql/issues/322" target="_blank" rel="noopener noreferrer">æ‰©å±•é˜…è¯» 1ï¼šIFreeSql äº‹åŠ¡å¦ç±»ç©æ³•ï¼Œç†è§£ä¸Šé¢å„ç§äº‹åŠ¡åœºæ™¯ä¹‹åå†çœ‹ä¼šæ›´ä½³</a></p>
<p><a href="https://www.cnblogs.com/kellynic/p/13551855.html" target="_blank" rel="noopener noreferrer">æ‰©å±•é˜…è¯» 2ï¼šå¯¹ä»¥ä¸Šå„ç§äº‹åŠ¡çš„ç†è§£åŠæ¼”å˜</a></p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">ç±»å‹æ˜ å°„</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/type-mapping.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/type-mapping.html"/>
    <updated>2022-05-31T14:08:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ç±»å‹æ˜ å°„" tabindex="-1"> ç±»å‹æ˜ å°„</h1>
<h2 id="è‡ªå®šä¹‰ç±»å‹æ˜ å°„-maptype" tabindex="-1"> è‡ªå®šä¹‰ç±»å‹æ˜ å°„(MapType)</h2>
<div><pre><code><span>class</span> <span>EnumTestMap</span> <span>{</span>
    <span>public</span> <span>Guid</span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>ToStringMapEnum</span> enum_to_string <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>ToStringMapEnum<span>?</span></span> enumnullable_to_string <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>int</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>ToStringMapEnum</span> enum_to_int <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>int</span><span>?</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>ToStringMapEnum<span>?</span></span> enumnullable_to_int <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>BigInteger</span> biginteger_to_string <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span><span>Column</span><span><span>(</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>string</span></span><span>)</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>BigInteger<span>?</span></span> bigintegernullable_to_string <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>enum</span> <span>ToStringMapEnum</span> <span>{</span> ä¸­å›½äºº<span>,</span> abc<span>,</span> é¦™æ¸¯ <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><p>åº”è¯¥ä¸éœ€è¦è§£é‡Šäº†å§ï¼Ÿ</p>
<p>BigInteger éƒ½å¯ä»¥æ˜ å°„ä½¿ç”¨äº†ï¼Œä½†è¯·æ³¨æ„ï¼šä»…ä»…æ˜¯ CURD æ–¹ä¾¿ï¼Œ Equals == åˆ¤æ–­å¯ä»¥ä½¿ç”¨ï¼Œæ— æ³•å®ç° + - * / ç­‰æ“ä½œï¼›</p>
<p>v0.9.15 ç‰ˆæœ¬è¿˜å¯ä»¥å°†å€¼å¯¹è±¡æ˜ å°„æˆ typeof(string)ï¼Œå®‰è£…æ‰©å±•åŒ…ï¼š</p>
<blockquote>
<p>dotnet add package FreeSql.Extensions.JsonMap</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span>UseJsonMap</span><span>(</span><span>)</span><span>;</span> <span>//å¼€å¯åŠŸèƒ½</span>

<span>class</span> <span>TestConfig</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>[</span><span><span>Table</span><span><span>(</span>Name <span>=</span> <span>"sysconfig"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>class</span> <span>S_SysConfig</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>JsonMap</span></span><span>]</span>
    <span>public</span> <span>TestConfig</span> Config <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><h2 id="é»˜è®¤ç±»å‹æ˜ å°„" tabindex="-1"> é»˜è®¤ç±»å‹æ˜ å°„</h2>
<table>
<thead>
<tr>
<th>csharp</th>
<th>MySql</th>
<th>SqlServer</th>
<th>PostgreSQL</th>
<th>Oracle</th>
<th>Sqlite</th>
<th>è¾¾æ¢¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>bool | bool?</td>
<td>bit(1)</td>
<td>bit</td>
<td>bool</td>
<td>number(1)</td>
<td>boolean</td>
<td>number(1)</td>
</tr>
<tr>
<td>sbyte | sbyte?</td>
<td>tinyint(3)</td>
<td>smallint</td>
<td>int2</td>
<td>number(4)</td>
<td>smallint</td>
<td>number(4)</td>
</tr>
<tr>
<td>short | short?</td>
<td>smallint(6)</td>
<td>smallint</td>
<td>int2</td>
<td>number(6)</td>
<td>smallint</td>
<td>number(6)</td>
</tr>
<tr>
<td>int | int?</td>
<td>int(11)</td>
<td>int</td>
<td>int4</td>
<td>number(11)</td>
<td>integer</td>
<td>number(11)</td>
</tr>
<tr>
<td>long | long?</td>
<td>bigint(20)</td>
<td>bigint</td>
<td>int8</td>
<td>number(21)</td>
<td>integer</td>
<td>number(21)</td>
</tr>
<tr>
<td>byte | byte?</td>
<td>tinyint(3) unsigned</td>
<td>tinyint</td>
<td>int2</td>
<td>number(3)</td>
<td>int2</td>
<td>number(3)</td>
</tr>
<tr>
<td>ushort | ushort?</td>
<td>smallint(5) unsigned</td>
<td>int</td>
<td>int4</td>
<td>number(5)</td>
<td>unsigned</td>
<td>number(5)</td>
</tr>
<tr>
<td>uint | uint?</td>
<td>int(10) unsigned</td>
<td>bigint</td>
<td>int8</td>
<td>number(10)</td>
<td>decimal(10,0)</td>
<td>number(10)</td>
</tr>
<tr>
<td>ulong | ulong?</td>
<td>bigint(20) unsigned</td>
<td>decimal(20,0)</td>
<td>numeric(20,0)</td>
<td>number(20)</td>
<td>decimal(21,0)</td>
<td>number(20)</td>
</tr>
<tr>
<td>double | double?</td>
<td>double</td>
<td>float</td>
<td>float8</td>
<td>float(126)</td>
<td>double</td>
<td>double</td>
</tr>
<tr>
<td>float | float?</td>
<td>float</td>
<td>real</td>
<td>float4</td>
<td>float(63)</td>
<td>float</td>
<td>real</td>
</tr>
<tr>
<td>decimal | decimal?</td>
<td>decimal(10,2)</td>
<td>decimal(10,2)</td>
<td>numeric(10,2)</td>
<td>number(10,2)</td>
<td>decimal(10,2)</td>
<td>number(10,2)</td>
</tr>
<tr>
<td>Guid | Guid?</td>
<td>char(36)</td>
<td>uniqueidentifier</td>
<td>uuid</td>
<td>char(36 CHAR)</td>
<td>character(36)</td>
<td>char(36)</td>
</tr>
<tr>
<td>TimeSpan | TimeSpan?</td>
<td>time</td>
<td>time</td>
<td>time</td>
<td>interval day(2) to second(6)</td>
<td>bigint</td>
<td>-</td>
</tr>
<tr>
<td>DateTime | DateTime?</td>
<td>datetime</td>
<td>datetime</td>
<td>timestamp</td>
<td>timestamp(6)</td>
<td>datetime</td>
<td>timestamp(6)</td>
</tr>
<tr>
<td>DateTimeOffset | DateTimeOffset?</td>
<td>-</td>
<td>datetimeoffset</td>
<td>-</td>
<td>timestamp(6) with local time zone</td>
<td>-</td>
<td>timestamp(6)</td>
</tr>
<tr>
<td>Enum | Enum?</td>
<td>enum</td>
<td>int</td>
<td>int4</td>
<td>number(16)</td>
<td>mediumint</td>
<td>number(16)</td>
</tr>
<tr>
<td>FlagsEnum | FlagsEnum?</td>
<td>set</td>
<td>bigint</td>
<td>int8</td>
<td>number(32)</td>
<td>bigint</td>
<td>number(32)</td>
</tr>
<tr>
<td>byte[]</td>
<td>varbinary(255)</td>
<td>varbinary(255)</td>
<td>bytea</td>
<td>blob</td>
<td>blob</td>
<td>blob</td>
</tr>
<tr>
<td>string</td>
<td>varchar(255)</td>
<td>nvarchar(255)</td>
<td>varchar(255)</td>
<td>nvarchar2(255)</td>
<td>nvarchar(255)</td>
<td>nvarchar2(255)</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ä»¥ä¸Šç±»å‹å’Œé•¿åº¦æ˜¯é»˜è®¤å€¼ï¼Œå¯æ‰‹å·¥è®¾ç½® Column ç‰¹æ€§ DbType å€¼</p>
</blockquote>
<blockquote>
<p>string æŒ‡å®šé•¿åº¦ [Column(DbType = &quot;varchar(max)&quot;)] æˆ–è€… [MaxLength(-1)] æˆ–è€… [Column(StringLength = -1)]ï¼Œå½“é•¿åº¦ -1 æ—¶äº§ç”Ÿçš„æ˜ å°„å¦‚ä¸‹ï¼š</p>
</blockquote>
<table>
<thead>
<tr>
<th>MySql</th>
<th>PostgreSQL</th>
<th>SqlServer</th>
<th>Oracle</th>
<th>Sqlite</th>
<th>Firebird</th>
<th>MsAccess</th>
<th>è¾¾æ¢¦</th>
<th>é‡‘ä»“</th>
<th>ç¥é€š</th>
</tr>
</thead>
<tbody>
<tr>
<td>text</td>
<td>text</td>
<td>varchar(max)</td>
<td>nclob</td>
<td>text</td>
<td>blob sub_type 1</td>
<td>longtext</td>
<td>text</td>
<td>text</td>
<td>text</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ³¨æ„ï¼šOracle nclob éœ€è¦ v1.3.2+ ç‰ˆæœ¬æ‰æ”¯æŒï¼Œå¦åˆ™å°†æ˜ å°„ nvarchar2(4000)</p>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼šMySql [MaxLength(-2)] æˆ–è€… [Column(StringLength = -2)] æ˜ å°„ç±»å‹ longtextï¼Œå…¶ä»–æ•°æ®åº“çš„æ˜ å°„è§„åˆ™ä¸ -1 ç›¸åŒ</p>
</blockquote>
<blockquote>
<p>decimal æŒ‡å®šé•¿åº¦ [Column(Precision = 10, Scale = 2)]</p>
</blockquote>
<h2 id="mysql-ç‰¹åˆ«ç±»å‹æ˜ å°„" tabindex="-1"> MySql ç‰¹åˆ«ç±»å‹æ˜ å°„</h2>
<table>
<thead>
<tr>
<th>csharp</th>
<th>MySql</th>
</tr>
</thead>
<tbody>
<tr>
<td>MygisPoint</td>
<td>point</td>
</tr>
<tr>
<td>MygisLineString</td>
<td>linestring</td>
</tr>
<tr>
<td>MygisPolygon</td>
<td>polygon</td>
</tr>
<tr>
<td>MygisMultiPoint</td>
<td>multipoint</td>
</tr>
<tr>
<td>MygisMultiLineString</td>
<td>multilinestring</td>
</tr>
<tr>
<td>MygisMultiPolygon</td>
<td>multipolygon</td>
</tr>
</tbody>
</table>
<h2 id="mysqlæ³¨æ„äº‹é¡¹" tabindex="-1"> Mysqlæ³¨æ„äº‹é¡¹</h2>
<p>å¦‚æœ<code>intã€byte</code>ç±»å‹ï¼ŒæŒ‡å®šäº† <code>DbType=&quot;tinyint(1)&quot;</code>,è¯·æ³¨æ„ï¼Œ<code>tinyint(1)</code>åœ¨ado.netä¸­é»˜è®¤å°†æ­¤å€¼æ˜ å°„ä¸º<code>bool</code>ç±»å‹ï¼Œå¯åœ¨é“¾æ¥ä¸²ä¸­æŒ‡å®š<code>TreatTinyAsBoolean=false</code>,ä½¿æ˜ å°„ <code>tinyint(1) </code>ä¸º <code>SByte</code> è€Œé <code>bool</code>ã€‚</p>
<h2 id="postgresql-ç‰¹åˆ«ç±»å‹æ˜ å°„" tabindex="-1"> PostgreSQL ç‰¹åˆ«ç±»å‹æ˜ å°„</h2>
<table>
<thead>
<tr>
<th>csharp</th>
<th>PostgreSQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>BitArray</td>
<td>varbit(64)</td>
</tr>
<tr>
<td>NpgsqlPoint | NpgsqlPoint?</td>
<td>point</td>
</tr>
<tr>
<td>NpgsqlLine | NpgsqlLine?</td>
<td>line</td>
</tr>
<tr>
<td>NpgsqlLSeg | NpgsqlLSeg?</td>
<td>lseg</td>
</tr>
<tr>
<td>NpgsqlBox | NpgsqlBox?</td>
<td>box</td>
</tr>
<tr>
<td>NpgsqlPath | NpgsqlPath?</td>
<td>path</td>
</tr>
<tr>
<td>NpgsqlPolygon | NpgsqlPolygon?</td>
<td>polygon</td>
</tr>
<tr>
<td>NpgsqlCircle | NpgsqlCircle?</td>
<td>circle</td>
</tr>
<tr>
<td>(IPAddress Address, int Subnet) | (IPAddress Address, int Subnet)?</td>
<td>cidr</td>
</tr>
<tr>
<td>IPAddress</td>
<td>inet</td>
</tr>
<tr>
<td>PhysicalAddress</td>
<td>macaddr</td>
</tr>
<tr>
<td>NpgsqlRange&lt;int&gt; | NpgsqlRange&lt;int&gt;?</td>
<td>int4range</td>
</tr>
<tr>
<td>NpgsqlRange&lt;long&gt; | NpgsqlRange&lt;long&gt;?</td>
<td>int8range</td>
</tr>
<tr>
<td>NpgsqlRange&lt;decimal&gt; | NpgsqlRange&lt;decimal&gt;?</td>
<td>numrange</td>
</tr>
<tr>
<td>NpgsqlRange&lt;DateTime&gt; | NpgsqlRange&lt;DateTime&gt;?</td>
<td>tsrange</td>
</tr>
<tr>
<td>PostgisPoint</td>
<td>geometry</td>
</tr>
<tr>
<td>PostgisLineString</td>
<td>geometry</td>
</tr>
<tr>
<td>PostgisPolygon</td>
<td>geometry</td>
</tr>
<tr>
<td>PostgisMultiPoint</td>
<td>geometry</td>
</tr>
<tr>
<td>PostgisMultiLineString</td>
<td>geometry</td>
</tr>
<tr>
<td>PostgisMultiPolygon</td>
<td>geometry</td>
</tr>
<tr>
<td>PostgisGeometry</td>
<td>geometry</td>
</tr>
<tr>
<td>PostgisGeometryCollection</td>
<td>geometry</td>
</tr>
<tr>
<td>Dictionary&lt;string, string&gt;</td>
<td>hstore</td>
</tr>
<tr>
<td>JToken</td>
<td>jsonb</td>
</tr>
<tr>
<td>JObject</td>
<td>jsonb</td>
</tr>
<tr>
<td>JArray</td>
<td>jsonb</td>
</tr>
<tr>
<td>æ•°ç»„</td>
<td>ä»¥ä¸Šæ‰€æœ‰ç±»å‹éƒ½æ”¯æŒï¼ŒåŒ…æ‹¬é»˜è®¤ç±»å‹</td>
</tr>
</tbody>
</table>
<h2 id="ä¼˜å…ˆçº§" tabindex="-1"> ä¼˜å…ˆçº§</h2>
<p>ä»æ•°æ®åº“å¯¼å…¥ç‰¹æ€§ &gt; å®ä½“ç‰¹æ€§ &gt; FluentApi &gt; Aop</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">UnitOfWork</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/unit-of-work.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/unit-of-work.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="unitofwork" tabindex="-1"> UnitOfWork</h1>
<p>UnitOfWork å¯å°†å¤šä¸ªä»“å‚¨æ”¾åœ¨ä¸€ä¸ªå•å…ƒç®¡ç†æ‰§è¡Œï¼Œæœ€ç»ˆé€šç”¨ Commit æ‰§è¡Œæ‰€æœ‰æ“ä½œï¼Œå†…éƒ¨é‡‡ç”¨äº†æ•°æ®åº“äº‹åŠ¡ï¼›</p>
<div><pre><code><span><span>var</span></span> connstr <span>=</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;"</span> <span>+</span>
  <span>"Initial Catalog=cccddd;Charset=utf8;SslMode=none;Max pool size=10"</span><span>;</span>

<span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
  <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connstr<span>)</span>
  <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“</span>
  <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"> å¦‚ä½•ä½¿ç”¨</h2>
<div><pre><code><span>using</span> <span>(</span><span><span>var</span></span> uow <span>=</span> fsql<span>.</span><span>CreateUnitOfWork</span><span>(</span><span>)</span><span>)</span> 
<span>{</span>
  <span><span>var</span></span> songRepo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>)</span><span>;</span>
  songRepo<span>.</span>UnitOfWork <span>=</span> uow<span>;</span>
  <span><span>var</span></span> userRepo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span><span>;</span>
  userRepo<span>.</span>UnitOfWork <span>=</span> uow<span>;</span>

  songRepo<span>.</span><span>Insert</span><span>(</span><span>new</span> <span>Song</span><span>(</span><span>)</span><span>)</span><span>;</span>
  userRepo<span>.</span><span>Update</span><span>(</span><span>..</span><span>.</span><span>)</span><span>;</span>

  uow<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p>å‚è€ƒï¼š<a href="https://github.com/dotnetcore/FreeSql/issues/289" target="_blank" rel="noopener noreferrer">åœ¨ asp.net core ä¸­ä½¿ç”¨ TransactionalAttribute + UnitOfWorkManager å®ç°å¤šç§äº‹åŠ¡ä¼ æ’­</a></p>
<h2 id="æ¥å£å®šä¹‰" tabindex="-1"> æ¥å£å®šä¹‰</h2>
<p>uow.GetOrBeginTransaction() æ–¹æ³•å¯è·å–äº‹åŠ¡å¯¹è±¡ã€‚</p>
<div><pre><code><span>public</span> <span>interface</span> <span>IUnitOfWork</span> <span>:</span> <span><span>IDisposable</span></span> <span>{</span>

  <span>DbTransaction</span> <span>GetOrBeginTransaction</span><span>(</span><span><span>bool</span></span> isCreate <span>=</span> <span>true</span><span>)</span><span>;</span>

  <span>IsolationLevel<span>?</span></span> IsolationLevel <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// æ˜¯å¦å¯ç”¨å·¥ä½œå•å…ƒ</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span><span>bool</span></span> Enable <span>{</span> <span>get</span><span>;</span> <span>}</span>

  <span><span>void</span></span> <span>Commit</span><span>(</span><span>)</span><span>;</span>

  <span><span>void</span></span> <span>Rollback</span><span>(</span><span>)</span><span>;</span>

  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// ç¦ç”¨å·¥ä½œå•å…ƒ</span>
  <span>/// <span><span><span>&lt;</span>exception</span> <span>cref</span><span><span>=</span><span>"</span>Exception<span>"</span></span><span>></span></span><span><span><span>&lt;/</span>exception</span><span>></span></span></span>
  <span>/// <span><span><span>&lt;</span>para</span><span>></span></span><span><span><span>&lt;/</span>para</span><span>></span></span></span>
  <span>/// è‹¥å·²å¼€å¯äº‹åŠ¡ï¼ˆå·²æœ‰Insert/Update/Deleteæ“ä½œï¼‰ï¼Œè°ƒç”¨æ­¤æ–¹æ³•å°†å‘ç”Ÿå¼‚å¸¸ï¼Œå»ºè®®åœ¨æ‰§è¡Œé€»è¾‘å‰è°ƒç”¨</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span><span>void</span></span> <span>Close</span><span>(</span><span>)</span><span>;</span>

  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// å¼€å¯å·¥ä½œå•å…ƒ</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span><span>void</span></span> <span>Open</span><span>(</span><span>)</span><span>;</span>

  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// æ­¤å·¥ä½œå•å…ƒå†…çš„å®ä½“å˜åŒ–è·Ÿè¸ª</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span>DbContext<span>.</span>EntityChangeReport</span> EntityChangeReport <span>{</span> <span>get</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br></div></div><h2 id="å®ä½“å˜åŒ–äº‹ä»¶" tabindex="-1"> å®ä½“å˜åŒ–äº‹ä»¶</h2>
<p>å…¨å±€è®¾ç½®ï¼š</p>
<div><pre><code>fsql<span>.</span><span>SetDbContextOptions</span><span>(</span>opt <span>=></span> <span>{</span>
  opt<span>.</span>OnEntityChange <span>=</span> report <span>=></span> <span>{</span>
    Console<span>.</span><span>WriteLine</span><span>(</span>report<span>)</span><span>;</span>
  <span>}</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>å•ç‹¬è®¾ç½®ï¼š</p>
<div><pre><code><span><span>var</span></span> uow <span>=</span> fsql<span>.</span><span>CreateUnitOfWork</span><span>(</span><span>)</span><span>;</span>
uow<span>.</span>OnEntityChange <span>=</span> report <span>=></span> <span>{</span>
  Console<span>.</span><span>WriteLine</span><span>(</span>report<span>)</span><span>;</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å‚æ•° report æ˜¯ä¸€ä¸ª List é›†åˆï¼Œé›†åˆå…ƒç´ çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div><pre><code><span>public</span> <span>class</span> <span>ChangeInfo</span> <span>{</span>
  <span>public</span> <span><span>object</span></span> Object <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>EntityChangeType</span> Type <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
  <span>/// Type = Update çš„æ—¶å€™ï¼Œè·å–æ›´æ–°ä¹‹å‰çš„å¯¹è±¡</span>
  <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
  <span>public</span> <span><span>object</span></span> BeforeObject <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>public</span> <span>enum</span> <span>EntityChangeType</span> <span>{</span> Insert<span>,</span> Update<span>,</span> Delete<span>,</span> SqlRaw <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><table>
<thead>
<tr>
<th>å˜åŒ–ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Insert</td>
<td>å®ä½“å¯¹è±¡è¢«æ’å…¥</td>
</tr>
<tr>
<td>Update</td>
<td>å®ä½“å¯¹è±¡è¢«æ›´æ–°</td>
</tr>
<tr>
<td>Delete</td>
<td>å®ä½“å¯¹è±¡è¢«åˆ é™¤</td>
</tr>
<tr>
<td>SqlRaw</td>
<td>æ‰§è¡Œäº† SQL è¯­å¥</td>
</tr>
</tbody>
</table>
<p>SqlRaw ç›®å‰æœ‰ä¸¤å¤„åœ°æ–¹æ¯”è¾ƒç‰¹æ®Šï¼š</p>
<ul>
<li>å¤šå¯¹å¤šè”çº§æ›´æ–°å¯¼èˆªå±æ€§çš„æ—¶å€™ï¼Œå¯¹ä¸­é—´è¡¨çš„å…¨éƒ¨åˆ é™¤æ“ä½œï¼›</li>
<li>é€šç”¨ä»“å‚¨ç±» BaseRepository æœ‰ä¸€ä¸ª Delete æ–¹æ³•ï¼Œå‚æ•°ä¸ºè¡¨è¾¾å¼ï¼Œè€Œå¹¶éå®ä½“ï¼›</li>
</ul>
<div><pre><code><span><span>int</span></span> <span>Delete</span><span>(</span><span>Expression<span>&lt;</span>Func<span>&lt;</span>TEntity<span>,</span> <span>bool</span><span>></span><span>></span></span> predicate<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>DbContext.SaveChangesï¼Œæˆ–è€… Repository å¯¹å®ä½“çš„ Insert/Update/Deleteï¼Œæˆ–è€… UnitOfWork.Commit æ“ä½œéƒ½ä¼šæœ€å¤šè§¦å‘ä¸€æ¬¡è¯¥äº‹ä»¶ã€‚</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">ä¿®æ”¹</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/guide/update.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/guide/update.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ä¿®æ”¹" tabindex="-1"> ä¿®æ”¹</h1>
<p><code>FreeSql</code> æä¾›ä¸°å¯Œçš„æ•°æ®åº“æ›´æ–°åŠŸèƒ½ï¼Œæ”¯æŒå•æ¡æˆ–æ‰¹é‡æ›´æ–°ï¼Œåœ¨ç‰¹å®šçš„æ•°æ®åº“æ‰§è¡Œè¿˜å¯ä»¥è¿”å›æ›´æ–°åçš„è®°å½•ã€‚</p>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
    <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> connectionString<span>)</span>
    <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span> <span>//è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“</span>
    <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>//è¯·åŠ¡å¿…å®šä¹‰æˆ Singleton å•ä¾‹æ¨¡å¼</span>

<span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>int</span></span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>int</span></span> Clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><h2 id="åŠ¨æ€æ¡ä»¶" tabindex="-1"> åŠ¨æ€æ¡ä»¶</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span><span>object</span></span> dywhere<span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p><code>dywhere</code> æ”¯æŒï¼š</p>
<ul>
<li>ä¸»é”®å€¼</li>
<li><code>new[] { ä¸»é”®å€¼1, ä¸»é”®å€¼2 }</code></li>
<li>Topic å¯¹è±¡</li>
<li><code>new[] { Topicå¯¹è±¡1, Topicå¯¹è±¡2 }</code></li>
<li><code>new { id = 1 }</code></li>
</ul>
<h2 id="_1ã€æ›´æ–°æŒ‡å®šåˆ—" tabindex="-1"> 1ã€æ›´æ–°æŒ‡å®šåˆ—</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>1</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>,</span> DateTime<span>.</span>Now<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `CreateTime` = '2018-12-08 00:04:59'</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><blockquote>
<p>æ”¯æŒ <code>Set()</code> å¤šæ¬¡ï¼Œç›¸å½“äºæ‹¼æ¥</p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>1</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Clicks <span>+</span> <span>1</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Time <span>==</span> DateTime<span>.</span>Now<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Clicks` = ifnull(`Clicks`,0) + 1, `Time` = now()</span>
<span>//WHERE (`Id` = 1)</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>1</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> <span>new</span> <span>Topic</span>
  <span>{</span>
    Clicks <span>=</span> a<span>.</span>Clicks <span>+</span> <span>1</span><span>,</span>
    Time <span>=</span> DateTime<span>.</span>Now
  <span>}</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Clicks` = ifnull(`Clicks`,0) + 1, `Time` = now()</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></div></div><h2 id="_2ã€æ›´æ–°æ¡ä»¶" tabindex="-1"> 2ã€æ›´æ–°æ¡ä»¶</h2>
<blockquote>
<p>é™¤äº†ä¸Šé¢ä»‹ç»çš„ <code>dywhere</code> æ„é€ å‚æ•°å¤–ï¼Œè¿˜æ”¯æŒ <code>Where lambda/sql</code> æ–¹æ³•</p>
</blockquote>
<blockquote>
<p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ²¡æœ‰æ¡ä»¶ä¸æ‰§è¡Œæ›´æ–°åŠ¨ä½œï¼Œé¿å…è¯¯æ›´æ–°å…¨è¡¨æ•°æ®ã€‚æ›´æ–°å…¨è¡¨æ•°æ®ï¼š<code>fsql.Update&lt;T&gt;().Where(&quot;1=1&quot;).Set(a =&gt; a.Xxx == xxx).ExecuteAffrows()</code></p>
</blockquote>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>,</span> <span>"æ–°æ ‡é¢˜"</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Time<span>,</span> DateTime<span>.</span>Now<span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = @p_0, `Time` = @p_1</span>
<span>//WHERE (Id = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="_3ã€æ›´æ–°å®ä½“" tabindex="-1"> 3ã€æ›´æ–°å®ä½“</h2>
<p>æ–¹æ³• 1ï¼š(æ¨è)</p>
<blockquote>
<p>åªæ›´æ–°å˜åŒ–çš„å±æ€§ï¼Œä¾èµ– <code>FreeSql.Repository</code></p>
</blockquote>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> item <span>=</span> repo<span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>  <span>//æ­¤æ—¶å¿«ç…§ item</span>
item<span>.</span>Title <span>=</span> <span>"newtitle"</span><span>;</span>
repo<span>.</span><span>Update</span><span>(</span>item<span>)</span><span>;</span> <span>//å¯¹æ¯”å¿«ç…§æ—¶çš„å˜åŒ–</span>
<span>//UPDATE `Topic` SET `Title` = @p_0</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><blockquote>
<p>æ˜¯ä¸æ˜¯è§‰å¾—å…ˆæŸ¥è¯¢å†æ›´æ–°ï¼Œå•°å—¦ï¼Ÿ</p>
</blockquote>
<div><pre><code><span><span>var</span></span> repo <span>=</span> fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> item <span>=</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span> <span>}</span><span>;</span>
repo<span>.</span><span>Attach</span><span>(</span>item<span>)</span><span>;</span> <span>//æ­¤æ—¶å¿«ç…§ item</span>
item<span>.</span>Title <span>=</span> <span>"newtitle"</span><span>;</span>
repo<span>.</span><span>Update</span><span>(</span>item<span>)</span><span>;</span> <span>//å¯¹æ¯”å¿«ç…§æ—¶çš„å˜åŒ–</span>
<span>//UPDATE `Topic` SET `Title` = @p_0</span>
<span>//WHERE (`Id` = 1)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>æ–¹æ³• 2ï¼š(åŸå§‹)</p>
<div><pre><code><span>//v1.5.0 å¿½ç•¥æ›´æ–° null å€¼çš„å±æ€§</span>
fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSourceIgnore</span><span>(</span>item<span>,</span> col <span>=></span> col <span>==</span> <span>null</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code><span><span>var</span></span> item <span>=</span> <span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> <span>1</span><span>,</span> Title <span>=</span> <span>"newtitle"</span> <span>}</span><span>;</span>
fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>item<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Clicks` = @p_0, `Title` = @p_1, `CreateTime` = @p_2</span>
<span>//WHERE (`Id` = 1)</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>item<span>)</span>
  <span>.</span><span>UpdateColumns</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Title<span>,</span> a<span>.</span>CreateTime <span>}</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = @p_0, `CreateTime` = @p_1</span>
<span>//WHERE (`Id` = 1)</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>item<span>)</span>
  <span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Clicks<span>,</span> a<span>.</span>CreateTime <span>}</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = @p_0</span>
<span>//WHERE (`Id` = 1)</span>

<span><span>var</span></span> items <span>=</span> <span>new</span> <span>List<span>&lt;</span>Topic<span>></span></span><span>(</span><span>)</span><span>;</span>
<span>for</span> <span>(</span><span><span>var</span></span> a <span>=</span> <span>0</span><span>;</span> a <span>&lt;</span> <span>10</span><span>;</span> a<span>++</span><span>)</span> items<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Topic</span> <span>{</span> Id <span>=</span> a <span>+</span> <span>1</span><span>,</span> Title <span>=</span> <span><span>$"newtitle</span><span><span>{</span><span>a</span><span>}</span></span><span>"</span></span><span>,</span> Clicks <span>=</span> a <span>*</span> <span>100</span> <span>}</span><span>)</span><span>;</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>items<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Clicks` = CASE `Id` WHEN 1 THEN @p_0 WHEN 2 THEN @p_1 WHEN 3 THEN @p_2 WHEN 4 THEN @p_3 WHEN 5 THEN @p_4 WHEN 6 THEN @p_5 WHEN 7 THEN @p_6 WHEN 8 THEN @p_7 WHEN 9 THEN @p_8 WHEN 10 THEN @p_9 END,</span>
<span>//`Title` = CASE `Id` WHEN 1 THEN @p_10 WHEN 2 THEN @p_11 WHEN 3 THEN @p_12 WHEN 4 THEN @p_13 WHEN 5 THEN @p_14 WHEN 6 THEN @p_15 WHEN 7 THEN @p_16 WHEN 8 THEN @p_17 WHEN 9 THEN @p_18 WHEN 10 THEN @p_19 END,</span>
<span>//`CreateTime` = CASE `Id` WHEN 1 THEN @p_20 WHEN 2 THEN @p_21 WHEN 3 THEN @p_22 WHEN 4 THEN @p_23 WHEN 5 THEN @p_24 WHEN 6 THEN @p_25 WHEN 7 THEN @p_26 WHEN 8 THEN @p_27 WHEN 9 THEN @p_28 WHEN 10 THEN @p_29 END</span>
<span>//WHERE (`Id` IN (1,2,3,4,5,6,7,8,9,10))</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>items<span>)</span>
  <span>.</span><span>IgnoreColumns</span><span>(</span>a <span>=></span> <span>new</span> <span>{</span> a<span>.</span>Clicks<span>,</span> a<span>.</span>CreateTime <span>}</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = CASE `Id` WHEN 1 THEN @p_0 WHEN 2 THEN @p_1 WHEN 3 THEN @p_2 WHEN 4 THEN @p_3 WHEN 5 THEN @p_4 WHEN 6 THEN @p_5 WHEN 7 THEN @p_6 WHEN 8 THEN @p_7 WHEN 9 THEN @p_8 WHEN 10 THEN @p_9 END</span>
<span>//WHERE (`Id` IN (1,2,3,4,5,6,7,8,9,10))</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetSource</span><span>(</span>items<span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>CreateTime<span>,</span> DateTime<span>.</span>Now<span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `CreateTime` = @p_0</span>
<span>//WHERE (`Id` IN (1,2,3,4,5,6,7,8,9,10))</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br></div></div><blockquote>
<p>æŒ‡å®š <code>Set</code> åˆ—æ›´æ–°åï¼Œ<code>SetSource</code> å°†å¤±æ•ˆ</p>
</blockquote>
<h2 id="_4ã€è‡ªå®šä¹‰-sql" tabindex="-1"> 4ã€è‡ªå®šä¹‰ SQL</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Topic<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetRaw</span><span>(</span><span>"Title = @title"</span><span>,</span> <span>new</span> <span>{</span> title <span>=</span> <span>"æ–°æ ‡é¢˜"</span> <span>}</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span><span>"Id = @id"</span><span>,</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET Title = @title WHERE (Id = @id)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="_5ã€æ ¹æ®-dto-æ›´æ–°" tabindex="-1"> 5ã€æ ¹æ® Dto æ›´æ–°</h2>
<div><pre><code>fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetDto</span><span>(</span><span>new</span> <span>{</span> title <span>=</span> <span>"xxx"</span><span>,</span> clicks <span>=</span> <span>2</span> <span>}</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>//UPDATE `Topic` SET `Title` = @p_0, `Clicks` = @p_1 WHERE (Id = 1)</span>

fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>SetDto</span><span>(</span><span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span> <span>{</span> <span>[</span><span>"title"</span><span>]</span> <span>=</span> <span>"xxx"</span><span>,</span> <span>[</span><span>"clicks"</span><span>]</span> <span>=</span> <span>2</span> <span>}</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h2 id="_6ã€set-setsource-setdto-åŒºåˆ«" tabindex="-1"> 6ã€Set/SetSource/SetDto åŒºåˆ«</h2>
<p>ä»–ä»¬ä¸‰ä¸ªæ˜¯å¹³çº§åŠŸèƒ½ï¼Œåˆ†åˆ«å¯¹åº”ï¼š</p>
<ul>
<li>
<p><code>Set/SetRaw</code> åœ¨çŸ¥é“å®ä½“çš„æ—¶å€™ä½¿ç”¨ï¼Œå¯¹åº” <code>update t set x = x</code></p>
</li>
<li>
<p><code>SetSource</code> æ›´æ–°æ•´ä¸ªå®ä½“ï¼Œå¯ä»¥é…åˆ <code>UpdateColumns</code> æˆ– <code>IgnoreColumns</code> æŒ‡å®šæˆ–å¿½ç•¥å­—æ®µ</p>
</li>
<li>
<p><code>SetDto</code> æ˜¯ <code>Set</code> çš„æ‰¹é‡æ“ä½œ</p>
</li>
</ul>
<h2 id="_7ã€å­—å…¸æ›´æ–°" tabindex="-1"> 7ã€å­—å…¸æ›´æ–°</h2>
<div><pre><code><span><span>var</span></span> dic <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>object</span><span>></span></span><span>(</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"id"</span><span>,</span> <span>1</span><span>)</span><span>;</span>
dic<span>.</span><span>Add</span><span>(</span><span>"name"</span><span>,</span> <span>"xxxx"</span><span>)</span><span>;</span>

fsql<span>.</span><span>UpdateDict</span><span>(</span>dic<span>)</span><span>.</span><span>AsTable</span><span>(</span><span>"table1"</span><span>)</span><span>.</span><span>WherePrimary</span><span>(</span><span>"id"</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="_8ã€ä¹è§‚é”" tabindex="-1"> 8ã€ä¹è§‚é”</h2>
<p>æ›´æ–°æ•´ä¸ªå®ä½“æ•°æ®æ—¶ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹æå®¹æ˜“é€ æˆæ—§æ•°æ®å°†æ–°çš„è®°å½•æ›´æ–°ã€‚</p>
<p>ä¹è§‚é”çš„åŸç†ï¼Œæ˜¯åˆ©ç”¨å®ä½“æŸå­—æ®µï¼Œå¦‚ï¼š<code>long version</code>ï¼Œæ›´æ–°å‰å…ˆæŸ¥è¯¢æ•°æ®ï¼Œæ­¤æ—¶ <code>version</code> ä¸º <code>1</code>ï¼Œæ›´æ–°æ—¶äº§ç”Ÿçš„ SQL ä¼šé™„åŠ  <code>where version = 1</code>ï¼Œå½“ä¿®æ”¹å¤±è´¥æ—¶ï¼ˆå³ <code>Affrows == 0</code>ï¼‰æŠ›å‡ºå¼‚å¸¸ï¼ˆDbUpdateVersionExceptionï¼‰ã€‚</p>
<p>æ¯ä¸ªå®ä½“åªæ”¯æŒä¸€ä¸ªä¹è§‚é”å±æ€§ï¼Œåœ¨å±æ€§å‰æ ‡è®°ç‰¹æ€§ï¼š<code>[Column(IsVersion = true)]</code> å³å¯ã€‚</p>
<blockquote>
<p>é€‚ç”¨ <code>SetSource</code> æ›´æ–°ï¼Œæ¯æ¬¡æ›´æ–° <code>version</code> çš„å€¼éƒ½ä¼šå¢åŠ  <code>1</code></p>
</blockquote>
<h2 id="_9ã€æ‚²è§‚é”" tabindex="-1"> 9ã€æ‚²è§‚é”</h2>
<div><pre><code><span><span>var</span></span> user <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>User<span>></span></span></span><span>(</span><span>)</span>
  <span>.</span><span>ForUpdate</span><span>(</span><span>true</span><span>)</span>
  <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
<span>//SELECT ... FROM User a for update nowait</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p><code>ForUpdate</code> åœ¨ Oracle/PostgreSQL/MySql æ˜¯é€šç”¨çš„å†™æ³•ï¼Œæˆ‘ä»¬å¯¹ SqlServer åšäº†ç‰¹åˆ«é€‚é…ï¼Œæ‰§è¡Œçš„ SQL è¯­å¥å¤§è‡´å¦‚ä¸‹ï¼š</p>
<div><pre><code><span>SELECT</span> <span>.</span><span>.</span><span>.</span> <span>FROM</span> <span>[</span><span>User</span><span>]</span> a <span>With</span><span>(</span>UpdLock<span>,</span> RowLock<span>,</span> NoWait<span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="_10ã€iselect-toupdate-é«˜çº§æ›´æ–°" tabindex="-1"> 10ã€ISelect.ToUpdate é«˜çº§æ›´æ–°</h2>
<p><code>IUpdate</code> é»˜è®¤ä¸æ”¯æŒå¯¼èˆªå¯¹è±¡ï¼Œå¤šè¡¨å…³è”ç­‰ã€‚<code>ISelect.ToUpdate</code> å¯å°†æŸ¥è¯¢è½¬ä¸º <code>IUpdate</code>ï¼Œä»¥ä¾¿ä½¿ç”¨å¯¼èˆªå¯¹è±¡æ›´æ–°æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p>
<div><pre><code>fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T1<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Options<span>.</span>xxx <span>==</span> <span>1</span><span>)</span>
  <span>.</span><span>ToUpdate</span><span>(</span><span>)</span>
  <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>Title<span>,</span> <span>"111"</span><span>)</span>
  <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¸æ˜¯å°†æ•°æ®æŸ¥è¯¢åˆ°å†…å­˜å†æ›´æ–°ï¼Œä¸Šé¢çš„ä»£ç äº§ç”Ÿå¦‚ä¸‹ SQL æ‰§è¡Œï¼š</p>
<div><pre><code><span>UPDATE</span> <span><span>`</span>T1<span>`</span></span> <span>SET</span> Title <span>=</span> <span>'111'</span> <span>WHERE</span> id <span>in</span> <span>(</span><span>select</span> a<span>.</span>id <span>from</span> T1 a <span>left</span> <span>join</span> Options b <span>on</span> b<span>.</span>t1id <span>=</span> a<span>.</span>id <span>where</span> b<span>.</span>xxx <span>=</span> <span>1</span><span>)</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å¤æ‚æ›´æ–°ä½¿ç”¨è¯¥æ–¹æ¡ˆçš„å¥½å¤„ï¼š</p>
<ul>
<li>æ›´æ–°å‰å¯é¢„è§ˆæµ‹è¯•æ•°æ®ï¼Œé˜²æ­¢é”™è¯¯æ›´æ–°æ“ä½œï¼›</li>
<li>æ”¯æŒå¤æ‚çš„æ›´æ–°æ“ä½œï¼Œä¾‹å¦‚ï¼š<code>ISelect</code> ä¸Šä½¿ç”¨ <code>Limit(10)</code> æ›´æ–°é™„åˆæ¡ä»¶çš„å‰ 10 æ¡è®°å½•ï¼›</li>
</ul>
<h1 id="api" tabindex="-1"> API</h1>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>SetSource</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>æ›´æ–°æ•°æ®ï¼Œè®¾ç½®æ›´æ–°çš„å®ä½“</td>
</tr>
<tr>
<td>IgnoreColumns</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å¿½ç•¥çš„åˆ—</td>
</tr>
<tr>
<td>Set</td>
<td>&lt;this&gt;</td>
<td>Lambda, value</td>
<td>è®¾ç½®åˆ—çš„æ–°å€¼ï¼Œ<code>Set(a =&gt; a.Name, &quot;newvalue&quot;)</code></td>
</tr>
<tr>
<td>Set</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>è®¾ç½®åˆ—çš„çš„æ–°å€¼ä¸ºåŸºç¡€ä¸Šå¢åŠ ï¼Œ<code>Set(a =&gt; a.Clicks + 1)</code>ï¼Œç›¸å½“äº clicks=clicks+1</td>
</tr>
<tr>
<td>SetDto</td>
<td>&lt;this&gt;</td>
<td>object</td>
<td>æ ¹æ® DTO æ›´æ–°çš„æ–¹æ³•</td>
</tr>
<tr>
<td>SetRaw</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>è®¾ç½®å€¼ï¼Œè‡ªå®šä¹‰ SQL è¯­æ³•ï¼Œ<code>SetRaw(&quot;title = @title&quot;, new { title = &quot;newtitle&quot; })</code></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>è¡¨è¾¾å¼æ¡ä»¶ï¼Œä»…æ”¯æŒå®ä½“åŸºç¡€æˆå‘˜ï¼ˆä¸åŒ…å«å¯¼èˆªå¯¹è±¡ï¼‰</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>åŸç”Ÿ sql è¯­æ³•æ¡ä»¶ï¼Œ<code>Where(&quot;id = @id&quot;, new { id = 1 })</code></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>ä¼ å…¥å®ä½“æˆ–é›†åˆï¼Œå°†å…¶ä¸»é”®ä½œä¸ºæ¡ä»¶</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>å‘½ä»¤è¶…æ—¶è®¾ç½®(ç§’)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>è®¾ç½®äº‹åŠ¡å¯¹è±¡</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>è®¾ç½®è¿æ¥å¯¹è±¡</td>
</tr>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>long</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
</tr>
<tr>
<td>ExecuteUpdated</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›æ›´æ–°åçš„è®°å½•</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">API æ–‡æ¡£</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/reference/api.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/reference/api.html"/>
    <updated>2022-05-19T13:04:10.000Z</updated>
    <content type="html"><![CDATA[<h1 id="api-æ–‡æ¡£" tabindex="-1"> API æ–‡æ¡£</h1>
<ul>
<li><a href="http://124.70.130.97:8082/api/FreeSql.html" target="_blank" rel="noopener noreferrer">http://124.70.130.97:8082/api/FreeSql.html</a></li>
</ul>
<h2 id="freesqlbuilder" tabindex="-1"> FreeSqlBuilder</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>UseConnectionString</td>
<td>this</td>
<td>è®¾ç½®è¿æ¥ä¸²</td>
</tr>
<tr>
<td>UseSlave</td>
<td>this</td>
<td>è®¾ç½®ä»æ•°æ®åº“ï¼Œæ”¯æŒå¤šä¸ª</td>
</tr>
<tr>
<td>UseConnectionFactory</td>
<td>this</td>
<td>è®¾ç½®è‡ªå®šä¹‰æ•°æ®åº“è¿æ¥å¯¹è±¡ï¼ˆæ”¾å¼ƒå†…ç½®å¯¹è±¡è¿æ¥æ± æŠ€æœ¯ï¼‰</td>
</tr>
<tr>
<td>UseAutoSyncStructure</td>
<td>this</td>
<td>ã€å¼€å‘ç¯å¢ƒå¿…å¤‡ã€‘è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“ï¼Œç¨‹åºè¿è¡Œä¸­æ£€æŸ¥å®ä½“åˆ›å»ºæˆ–ä¿®æ”¹è¡¨ç»“æ„</td>
</tr>
<tr>
<td>UseNoneCommandParameter</td>
<td>this</td>
<td>ä¸ä½¿ç”¨å‘½ä»¤å‚æ•°åŒ–æ‰§è¡Œï¼Œé’ˆå¯¹ Insert/Updateï¼Œä¹Ÿå¯ä¸´æ—¶ä½¿ç”¨ IInsert/IUpdate.NoneParameter()</td>
</tr>
<tr>
<td>UseGenerateCommandParameterWithLambda</td>
<td>this</td>
<td>ç”Ÿæˆå‘½ä»¤å‚æ•°åŒ–æ‰§è¡Œï¼Œé’ˆå¯¹ lambda è¡¨è¾¾å¼è§£æ</td>
</tr>
<tr>
<td>UseLazyLoading</td>
<td>this</td>
<td>å¼€å¯å»¶æ—¶åŠ è½½åŠŸèƒ½</td>
</tr>
<tr>
<td>UseMonitorCommand</td>
<td>this</td>
<td>ç›‘è§†å…¨å±€ SQL æ‰§è¡Œå‰å</td>
</tr>
<tr>
<td><strong>UseNameConvert</strong></td>
<td>this</td>
<td>è½¬æ¢å®ä½“ã€å±æ€§åç§° Entity Property -&gt; Db Filed</td>
</tr>
<tr>
<td>Build&lt;T&gt;</td>
<td>IFreeSql&lt;T&gt;</td>
<td>åˆ›å»ºä¸€ä¸ª IFreeSql å¯¹è±¡ï¼Œæ³¨æ„ï¼šå•ä¾‹è®¾è®¡ï¼Œä¸è¦é‡å¤åˆ›å»º</td>
</tr>
</tbody>
</table>
<h2 id="ifreesql" tabindex="-1"> IFreeSql</h2>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¿”å›å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/guide/ado.html">Ado</a></td>
<td>IAdo</td>
<td>æ•°æ®åº“è®¿é—®å¯¹è±¡ï¼Œå°è£…äº†ç±»ä¼¼ SqlHelper æ“ä½œï¼šExecuteNonQuery/ExecuteScalar/ExecuteConnectTest ç­‰</td>
</tr>
<tr>
<td><a href="/guide/aop.html">Aop</a></td>
<td>IAop</td>
<td>æ‰€æœ‰ AOP æ‹¦æˆªæ–¹æ³•éƒ½åœ¨è¿™é‡Œ</td>
</tr>
<tr>
<td><a href="/guide/code-first.html">CodeFirst</a></td>
<td>ICodeFirst</td>
<td>å°è£… CodeFirst æ¨¡å¼å¼€å‘ç›¸å…³æ–¹æ³•</td>
</tr>
<tr>
<td><a href="/guide/db-first.html">DbFirst</a></td>
<td>IDbFirst</td>
<td>å°è£… DbFirst æ¨¡å¼å¼€å‘ç›¸å…³æ–¹æ³•</td>
</tr>
<tr>
<td><a href="/guide/filters.html">GlobalFilter</a></td>
<td>GlobalFilter</td>
<td>å…¨å±€è¿‡æ»¤è®¾ç½®ï¼Œå¯é»˜è®¤é™„åŠ ä¸º Select/Update/Delete æ¡ä»¶</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Select&lt;TEntity&gt;</td>
<td>ISelect&lt;TEntity&gt;</td>
<td>æ— </td>
<td>å‡†å¤‡æŸ¥è¯¢æ•°æ®</td>
</tr>
<tr>
<td>Insert&lt;TEntity&gt;</td>
<td>IInsert&lt;TEntity&gt;</td>
<td>æ— /TEntity/TEntity[]</td>
<td>å‡†å¤‡æ’å…¥</td>
</tr>
<tr>
<td>Update&lt;TEntity&gt;</td>
<td>IUpdate&lt;TEntity&gt;</td>
<td>æ— </td>
<td>å‡†å¤‡æ›´æ–°æ•°æ®</td>
</tr>
<tr>
<td>Delete&lt;TEntity&gt;</td>
<td>IDelete&lt;TEntity&gt;</td>
<td>æ— </td>
<td>å‡†å¤‡åˆ é™¤</td>
</tr>
<tr>
<td>InsertOrUpdate&lt;TEntity&gt;</td>
<td>IInsertOrUpdate&lt;TEntity&gt;</td>
<td>æ— </td>
<td>æ’å…¥æˆ–æ›´æ–°æ•°æ®</td>
</tr>
<tr>
<td>Transaction</td>
<td>void</td>
<td>Action</td>
<td>å¼€å¯äº‹åŠ¡ï¼ˆä¸æ”¯æŒå¼‚æ­¥ï¼‰ï¼Œ<a href="/guide/transaction.html">å…¶ä»–äº‹åŠ¡</a></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>æ‰©å±•æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Select&lt;T1, T2, ... T10&gt;</td>
<td>ISelect</td>
<td>æ— </td>
<td>å‡†å¤‡å¤šè¡¨æŸ¥è¯¢</td>
</tr>
<tr>
<td><a href="/guide/db-context.html">CreateDbContext</a></td>
<td>DbContext</td>
<td>æ— </td>
<td>åˆ›å»ºæ™®é€šæ•°æ®ä¸Šä¸‹æ–‡æ¡£å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŠŸèƒ½ç±»ä¼¼äº EFCore</td>
</tr>
<tr>
<td>SetDbContextOptions</td>
<td>-</td>
<td>Action</td>
<td>è®¾ç½®æ­¤ IFreeSql ä¸‹ DbContext é€‰é¡¹è®¾ç½®</td>
</tr>
<tr>
<td><a href="/guide/repository.html">GetRepository</a>&lt;TEntity, TKey&gt;</td>
<td>BaseRepository</td>
<td>æ— </td>
<td>è¿”å›é»˜è®¤ä»“åº“åŠŸèƒ½å®ç°</td>
</tr>
<tr>
<td><a href="/guide/unit-of-work.html">CreateUnitOfWork</a></td>
<td>IUnitOfWork</td>
<td>æ— </td>
<td>åˆ›å»ºåŸºäºä»“å‚¨åŠŸèƒ½çš„å·¥ä½œå•å…ƒï¼ŒåŠ¡å¿…ä½¿ç”¨ using åŒ…å«ä½¿ç”¨</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="baserepository-tentity-tkey" tabindex="-1"> BaseRepository&lt;TEntity, TKey&gt;</h2>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¿”å›å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>EntityType</td>
<td>Type</td>
<td>ä»“å‚¨æ­£åœ¨æ“ä½œçš„å®ä½“ç±»å‹ï¼Œæ³¨æ„å®ƒä¸ä¸€å®šæ˜¯ TEntity</td>
</tr>
<tr>
<td>UnitOfWork</td>
<td>IUnitOfWork</td>
<td>æ­£åœ¨ä½¿ç”¨çš„å·¥ä½œå•å…ƒ</td>
</tr>
<tr>
<td>Orm</td>
<td>IFreeSql</td>
<td>æ­£åœ¨ä½¿ç”¨çš„ Orm</td>
</tr>
<tr>
<td>DbContextOptions</td>
<td>DbContextOptions</td>
<td>æ­£åœ¨ä½¿ç”¨çš„ DbContext è®¾ç½®ï¼Œä¿®æ”¹è®¾ç½®ä¸å½±å“å…¶ä»–</td>
</tr>
<tr>
<td>DataFilter</td>
<td>IDataFilter&lt;TEntity&gt;</td>
<td>ä»“å‚¨è¿‡æ»¤å™¨ï¼Œæœ¬å¯¹è±¡å†…ç”Ÿæ•ˆ</td>
</tr>
<tr>
<td>Select</td>
<td>ISelect&lt;TEntity&gt;</td>
<td>å‡†å¤‡æŸ¥è¯¢æ•°æ®</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>AsType</td>
<td>void</td>
<td>Type</td>
<td>æ”¹å˜ä»“å‚¨æ­£åœ¨æ“ä½œçš„å®ä½“ç±»å‹</td>
</tr>
<tr>
<td>Get</td>
<td>TEntity</td>
<td>TKey</td>
<td>æ ¹æ®ä¸»é”®ï¼ŒæŸ¥è¯¢æ•°æ®</td>
</tr>
<tr>
<td>Find</td>
<td>TEntity</td>
<td>TKey</td>
<td>æ ¹æ®ä¸»é”®ï¼ŒæŸ¥è¯¢æ•°æ®</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>TKey</td>
<td>æ ¹æ®ä¸»é”®åˆ é™¤æ•°æ®</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>Lambda</td>
<td>æ ¹æ® lambda æ¡ä»¶åˆ é™¤æ•°æ®</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>TEntity</td>
<td>åˆ é™¤æ•°æ®</td>
</tr>
<tr>
<td>Delete</td>
<td>int</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>æ‰¹é‡åˆ é™¤æ•°æ®</td>
</tr>
<tr>
<td>Insert</td>
<td>-</td>
<td>TEntity</td>
<td>æ’å…¥æ•°æ®ï¼Œè‹¥å®ä½“æœ‰è‡ªå¢åˆ—ï¼Œæ’å…¥åçš„è‡ªå¢å€¼ä¼šå¡«å……åˆ°å®ä½“ä¸­</td>
</tr>
<tr>
<td>Insert</td>
<td>-</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>æ‰¹é‡æ’å…¥æ•°æ®</td>
</tr>
<tr>
<td>Update</td>
<td>-</td>
<td>TEntity</td>
<td>æ›´æ–°æ•°æ®</td>
</tr>
<tr>
<td>Update</td>
<td>-</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>æ‰¹é‡æ›´æ–°æ•°æ®</td>
</tr>
<tr>
<td>InsertOrUpdate</td>
<td>-</td>
<td>TEntity</td>
<td>æ’å…¥æˆ–æ›´æ–°æ•°æ®</td>
</tr>
<tr>
<td>FlushState</td>
<td>-</td>
<td>æ— </td>
<td>æ¸…é™¤çŠ¶æ€ç®¡ç†æ•°æ®</td>
</tr>
<tr>
<td>Attach</td>
<td>-</td>
<td>TEntity</td>
<td>é™„åŠ å®ä½“åˆ°çŠ¶æ€ç®¡ç†ï¼Œå¯ç”¨äºä¸æŸ¥è¯¢å°±æ›´æ–°æˆ–åˆ é™¤</td>
</tr>
<tr>
<td>Attach</td>
<td>-</td>
<td>IEnumerable&lt;TEntity&gt;</td>
<td>æ‰¹é‡é™„åŠ å®ä½“åˆ°çŠ¶æ€ç®¡ç†</td>
</tr>
<tr>
<td>AttachOnlyPrimary</td>
<td>-</td>
<td>TEntity</td>
<td>åªé™„åŠ å®ä½“çš„ä¸»é”®æ•°æ®åˆ°çŠ¶æ€ç®¡ç†</td>
</tr>
<tr>
<td>SaveMany</td>
<td>-</td>
<td>TEntity, string</td>
<td>ä¿å­˜å®ä½“çš„æŒ‡å®š ManyToMany/OneToMany å¯¼èˆªå±æ€§ï¼ˆå®Œæ•´å¯¹æ¯”ï¼‰</td>
</tr>
<tr>
<td>BeginEdit</td>
<td>-</td>
<td>List&lt;TEntity&gt;</td>
<td>å‡†å¤‡ç¼–è¾‘ä¸€ä¸ª List å®ä½“</td>
</tr>
<tr>
<td>EndEdit</td>
<td>int</td>
<td>æ— </td>
<td>å®Œæˆç¼–è¾‘æ•°æ®ï¼Œè¿›è¡Œä¿å­˜åŠ¨ä½œ</td>
</tr>
</tbody>
</table>
<blockquote>
<p>çŠ¶æ€ç®¡ç†ï¼Œå¯å®ç° Update åªæ›´æ–°å˜åŒ–çš„å­—æ®µï¼ˆä¸æ›´æ–°æ‰€æœ‰å­—æ®µï¼‰ï¼Œçµæ´»ä½¿ç”¨ Attach å’Œ Update ç”¨èµ·æ¥éå¸¸èˆ’æœã€‚</p>
</blockquote>
<p>DbContext ä¸ BaseRepository åŠŸèƒ½å¤§è‡´ç±»ä¼¼ã€‚</p>
<p>DbContext è‡ªèº« = å®Œæ•´äº‹åŠ¡ï¼ŒBaseRepository ä¸ä¸€å®šæœ‰äº‹åŠ¡ï¼ˆå¯é€šè¿‡è®¾ç½®å…¶ UnitOfWork å±æ€§ï¼‰ã€‚</p>
<hr>
<h2 id="icodefirst" tabindex="-1"> ICodeFirst</h2>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¿”å›å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>IsAutoSyncStructure</td>
<td>bool</td>
<td>ã€å¼€å‘ç¯å¢ƒå¿…å¤‡ã€‘è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“ï¼Œç¨‹åºè¿è¡Œä¸­æ£€æŸ¥å®ä½“è¡¨æ˜¯å¦å­˜åœ¨ï¼Œç„¶ååˆ›å»ºæˆ–ä¿®æ”¹</td>
</tr>
<tr>
<td>IsSyncStructureToLower</td>
<td>bool</td>
<td>æ˜¯å¦è½¬å°å†™æ˜ å°„ï¼Œé€‚åˆ pgsql</td>
</tr>
<tr>
<td>IsSyncStructureToUpper</td>
<td>bool</td>
<td>æ˜¯å¦è½¬å¤§å†™æ˜ å°„ï¼Œé€‚åˆ oracleã€dameng</td>
</tr>
<tr>
<td>IsNoneCommandParameter</td>
<td>bool</td>
<td>æ˜¯å¦ä¸ä½¿ç”¨å‘½ä»¤å‚æ•°åŒ–æ‰§è¡Œï¼Œé’ˆå¯¹ Insert/Update</td>
</tr>
<tr>
<td>IsGenerateCommandParameterWithLambda</td>
<td>bool</td>
<td>æ˜¯å¦ç”Ÿæˆå‘½ä»¤å‚æ•°åŒ–æ‰§è¡Œï¼Œé’ˆå¯¹ where lambda è¡¨è¾¾å¼è§£æ</td>
</tr>
<tr>
<td>IsLazyLoading</td>
<td>bool</td>
<td>æ˜¯å¦å¼€å¯å»¶æ—¶åŠ è½½å¯¼èˆªå±æ€§å¯¹è±¡ï¼Œå¯¼èˆªå±æ€§éœ€è¦å£°æ˜ virtual</td>
</tr>
<tr>
<td>IsConfigEntityFromDbFirst</td>
<td>bool</td>
<td>å°†æ•°æ®åº“çš„ä¸»é”®ã€è‡ªå¢ã€ç´¢å¼•è®¾ç½®å¯¼å…¥ï¼Œé€‚åˆ DbFirst æ¨¡å¼ï¼Œæ— é¡»åœ¨å®ä½“ç±»å‹ä¸Šè®¾ç½® [Column(IsPrimary)]ã€‚æ­¤åŠŸèƒ½ç›®å‰å¯ç”¨äº mysql/sqlserver/postgresql/oracleï¼Œæ­¤åŠŸèƒ½ä¼šå½±å“ IFreeSql é¦–æ¬¡è®¿é—®çš„é€Ÿåº¦ã€‚è‹¥ä½¿ç”¨ CodeFirst åˆ›å»ºç´¢å¼•åï¼Œåˆç›´æ¥åœ¨æ•°æ®åº“ä¸Šå»ºäº†ç´¢å¼•ï¼Œè‹¥æ— æœ¬åŠŸèƒ½ä¸‹ä¸€æ¬¡ CodeFirst è¿ç§»æ—¶æ•°æ®åº“ä¸Šåˆ›å»ºçš„ç´¢å¼•å°†è¢«åˆ é™¤</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>GetComparisonDDLStatements&lt;TEntity&gt;</td>
<td>string</td>
<td>æ— </td>
<td>å°†å®ä½“ç±»å‹ä¸æ•°æ®åº“å¯¹æ¯”ï¼Œè¿”å› DDL è¯­å¥</td>
</tr>
<tr>
<td>GetComparisonDDLStatements</td>
<td>string</td>
<td>Type[]</td>
<td>å°†å¤šä¸ªå®ä½“ç±»å‹ä¸æ•°æ®åº“å¯¹æ¯”ï¼Œè¿”å› DDL è¯­å¥</td>
</tr>
<tr>
<td>GetComparisonDDLStatements</td>
<td>string</td>
<td>Type, string</td>
<td>å°†å®ä½“ç±»å‹ä¸æ•°æ®åº“å¯¹æ¯”ï¼Œè¿”å› DDL è¯­å¥(æŒ‡å®šè¡¨å)</td>
</tr>
<tr>
<td>SyncStructure&lt;TEntity&gt;</td>
<td>bool</td>
<td>æ— </td>
<td>åŒæ­¥å®ä½“ç±»å‹åˆ°æ•°æ®åº“</td>
</tr>
<tr>
<td>SyncStructure</td>
<td>bool</td>
<td>Type[]</td>
<td>åŒæ­¥å®ä½“ç±»å‹é›†åˆåˆ°æ•°æ®åº“</td>
</tr>
<tr>
<td>SyncStructure</td>
<td>bool</td>
<td>Type, string</td>
<td>åŒæ­¥å®ä½“ç±»å‹åˆ°æ•°æ®åº“ï¼ˆæŒ‡å®šè¡¨åï¼‰</td>
</tr>
<tr>
<td>ConfigEntity</td>
<td>ICodeFirst</td>
<td>Action&lt;TableFluent&lt;T&gt;&gt;</td>
<td>FluentAPI é…ç½®å®ä½“çš„ç‰¹æ€§</td>
</tr>
<tr>
<td>GetTableByEntity</td>
<td>TableInfo</td>
<td>Type</td>
<td>è·å–ç±»å‹åœ¨ ORM å†…éƒ¨çš„å…ƒæ•°æ®</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="idbfirst" tabindex="-1"> IDbFirst</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>GetDatabases</td>
<td>List&lt;string&gt;</td>
<td>æ— </td>
<td>è·å–æ‰€æœ‰æ•°æ®åº“</td>
</tr>
<tr>
<td>GetTablesByDatabase</td>
<td>List&lt;DbTableInfo&gt;</td>
<td>string[]</td>
<td>è·å–æŒ‡å®šæ•°æ®åº“çš„è¡¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨ã€åˆ—è¯¦æƒ…ã€ä¸»é”®ã€å”¯ä¸€é”®ã€ç´¢å¼•ã€å¤–é”®ã€å¤‡æ³¨</td>
</tr>
<tr>
<td>GetTableByName</td>
<td>DbTableInfo</td>
<td>string</td>
<td>è·å–æŒ‡å®šå•è¡¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬åˆ—è¯¦æƒ…ã€ä¸»é”®ã€å”¯ä¸€é”®ã€ç´¢å¼•ã€å¤‡æ³¨</td>
</tr>
<tr>
<td>ExistsTable</td>
<td>bool</td>
<td>string</td>
<td>åˆ¤æ–­è¡¨åæ˜¯å¦å­˜åœ¨</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="iselect" tabindex="-1"> ISelect</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
<td></td>
</tr>
<tr>
<td>ToList</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å› T1 å®ä½“æ‰€æœ‰å­—æ®µçš„è®°å½•ï¼Œè‹¥å­˜åœ¨å¯¼èˆªå±æ€§åˆ™ä¸€èµ·æŸ¥è¯¢è¿”å›ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
<td></td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>Lambda</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å›æŒ‡å®šå­—æ®µçš„è®°å½•ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
<td></td>
</tr>
<tr>
<td>ToList&lt;T&gt;</td>
<td>List&lt;T&gt;</td>
<td>string field</td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å› field æŒ‡å®šå­—æ®µçš„è®°å½•ï¼Œå¹¶ä»¥å…ƒç»„æˆ–åŸºç¡€ç±»å‹(int,string,long)æ¥æ”¶ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› Count ä¸º 0 çš„åˆ—è¡¨</td>
<td></td>
</tr>
<tr>
<td>ToOne</td>
<td>T1</td>
<td></td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œè¿”å› T1 å®ä½“æ‰€æœ‰å­—æ®µçš„ç¬¬ä¸€æ¡è®°å½•ï¼Œè®°å½•ä¸å­˜åœ¨æ—¶è¿”å› null</td>
<td></td>
</tr>
<tr>
<td>Any</td>
<td>bool</td>
<td></td>
<td>æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œæ˜¯å¦æœ‰è®°å½•</td>
<td></td>
</tr>
<tr>
<td>Sum</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚å’Œ</td>
<td></td>
</tr>
<tr>
<td>Min</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚æœ€å°å€¼</td>
<td></td>
</tr>
<tr>
<td>Max</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚æœ€å¤§å€¼</td>
<td></td>
</tr>
<tr>
<td>Avg</td>
<td>T</td>
<td>Lambda</td>
<td>æŒ‡å®šä¸€ä¸ªåˆ—æ±‚å¹³å‡å€¼</td>
<td></td>
</tr>
<tr>
<td>ã€åˆ†é¡µã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Count</td>
<td>long</td>
<td></td>
<td>æŸ¥è¯¢çš„è®°å½•æ•°é‡</td>
<td></td>
</tr>
<tr>
<td>Count</td>
<td>&lt;this&gt;</td>
<td>out long</td>
<td>æŸ¥è¯¢çš„è®°å½•æ•°é‡ï¼Œä»¥å‚æ•° out å½¢å¼è¿”å›</td>
<td></td>
</tr>
<tr>
<td>Skip</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>æŸ¥è¯¢å‘ååç§»è¡Œæ•°</td>
<td></td>
</tr>
<tr>
<td>Offset</td>
<td>&lt;this&gt;</td>
<td>int offset</td>
<td>æŸ¥è¯¢å‘ååç§»è¡Œæ•°</td>
<td></td>
</tr>
<tr>
<td>Limit</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>æŸ¥è¯¢å¤šå°‘æ¡æ•°æ®</td>
<td></td>
</tr>
<tr>
<td>Take</td>
<td>&lt;this&gt;</td>
<td>int limit</td>
<td>æŸ¥è¯¢å¤šå°‘æ¡æ•°æ®</td>
<td></td>
</tr>
<tr>
<td>Page</td>
<td>&lt;this&gt;</td>
<td>int pageIndex, int pageSize</td>
<td>åˆ†é¡µ</td>
<td></td>
</tr>
<tr>
<td>ã€æ¡ä»¶ã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>æ”¯æŒå¤šè¡¨æŸ¥è¯¢è¡¨è¾¾å¼ï¼Œå¤šæ¬¡ä½¿ç”¨ç›¸å½“äº AND</td>
<td></td>
</tr>
<tr>
<td>WhereIf</td>
<td>&lt;this&gt;</td>
<td>bool, Lambda</td>
<td>æ”¯æŒå¤šè¡¨æŸ¥è¯¢è¡¨è¾¾å¼</td>
<td></td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>åŸç”Ÿ sql è¯­æ³•æ¡ä»¶ï¼ŒWhere(&quot;id = ?id&quot;, new { id = 1 })</td>
<td></td>
</tr>
<tr>
<td>WhereIf</td>
<td>&lt;this&gt;</td>
<td>bool, string, parms</td>
<td>åŸç”Ÿ sql è¯­æ³•æ¡ä»¶ï¼ŒWhereIf(true, &quot;id = ?id&quot;, new { id = 1 })</td>
<td></td>
</tr>
<tr>
<td>WhereCascade</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å®ç°å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œå‘æ¯ä¸ªè¡¨ä¸­é™„åŠ æ¡ä»¶</td>
<td></td>
</tr>
<tr>
<td>ã€åˆ†ç»„ã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>æŒ‰é€‰æ‹©çš„åˆ—åˆ†ç»„ï¼ŒGroupBy(a =&gt; a.Name)</td>
<td>GroupBy(a =&gt; new{a.Name,a.Time})</td>
</tr>
<tr>
<td>GroupBy</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>æŒ‰åŸç”Ÿ sql è¯­æ³•åˆ†ç»„ï¼ŒGroupBy(&quot;concat(name, ?cc)&quot;, new { cc = 1 })</td>
<td></td>
</tr>
<tr>
<td>Having</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>æŒ‰åŸç”Ÿ sql è¯­æ³•èšåˆæ¡ä»¶è¿‡æ»¤ï¼ŒHaving(&quot;count(name) = ?cc&quot;, new { cc = 1 })</td>
<td></td>
</tr>
<tr>
<td>Distinct</td>
<td>&lt;this&gt;</td>
<td></td>
<td>.Distinct().ToList(x =&gt; x.GroupName) æ˜¯å¯¹æŒ‡å®šå­—æ®µ</td>
<td></td>
</tr>
<tr>
<td>ã€æ’åºã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>OrderBy</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>æŒ‰åˆ—æ’åºï¼ŒOrderBy(a =&gt; a.Time)ï¼Œå¯å¤šæ¬¡ä½¿ç”¨</td>
<td></td>
</tr>
<tr>
<td>OrderByDescending</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>æŒ‰åˆ—å€’å‘æ’åºï¼ŒOrderByDescending(a =&gt; a.Time)</td>
<td></td>
</tr>
<tr>
<td>OrderBy</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>æŒ‰åŸç”Ÿ sql è¯­æ³•æ’åºï¼ŒOrderBy(&quot;count(name) + ?cc&quot;, new { cc = 1 })</td>
<td></td>
</tr>
<tr>
<td>OrderByPropertyName</td>
<td>string, bool</td>
<td>æŒ‰å±æ€§åå­—ç¬¦ä¸²æ’åºï¼ˆæ”¯æŒå¯¼èˆªå±æ€§ï¼‰</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ã€è”è¡¨ã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>LeftJoin</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å·¦è”æŸ¥è¯¢ï¼Œå¯ä½¿ç”¨å¯¼èˆªå±æ€§ï¼Œæˆ–æŒ‡å®šå…³è”çš„å®ä½“ç±»å‹</td>
<td></td>
</tr>
<tr>
<td>InnerJoin</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>è”æ¥æŸ¥è¯¢ï¼Œå¯ä½¿ç”¨å¯¼èˆªå±æ€§ï¼Œæˆ–æŒ‡å®šå…³è”çš„å®ä½“ç±»å‹</td>
<td></td>
</tr>
<tr>
<td>RightJoin</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å³è”æŸ¥è¯¢ï¼Œå¯ä½¿ç”¨å¯¼èˆªå±æ€§ï¼Œæˆ–æŒ‡å®šå…³è”çš„å®ä½“ç±»å‹</td>
<td></td>
</tr>
<tr>
<td>LeftJoin</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>å·¦è”æŸ¥è¯¢ï¼Œä½¿ç”¨åŸç”Ÿ sql è¯­æ³•ï¼ŒLeftJoin(&quot;type b on b.id = a.id and b.clicks &gt; ?clicks&quot;, new { clicks = 1 })</td>
<td></td>
</tr>
<tr>
<td>InnerJoin</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>è”æ¥æŸ¥è¯¢ï¼Œä½¿ç”¨åŸç”Ÿ sql è¯­æ³•ï¼ŒInnerJoin(&quot;type b on b.id = a.id and b.clicks &gt; ?clicks&quot;, new { clicks = 1 })</td>
<td></td>
</tr>
<tr>
<td>RightJoin</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>å³è”æŸ¥è¯¢ï¼Œä½¿ç”¨åŸç”Ÿ sql è¯­æ³•ï¼ŒRightJoin(&quot;type b on b.id = a.id and b.clicks &gt; ?clicks&quot;, new { clicks = 1 })</td>
<td></td>
</tr>
<tr>
<td>From</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å¤šè¡¨æŸ¥è¯¢ï¼Œ3 ä¸ªè¡¨ä»¥ä¸Šä½¿ç”¨éå¸¸æ–¹ä¾¿ï¼Œç›®å‰è®¾è®¡æœ€å¤§æ”¯æŒ 10 ä¸ªè¡¨</td>
<td></td>
</tr>
<tr>
<td>ã€å…¶ä»–ã€‘</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>As</td>
<td>&lt;this&gt;</td>
<td>string alias = &quot;a&quot;</td>
<td>æŒ‡å®šåˆ«å</td>
<td></td>
</tr>
<tr>
<td>Master</td>
<td>&lt;this&gt;</td>
<td></td>
<td>æŒ‡å®šä»ä¸»åº“æŸ¥è¯¢ï¼ˆé»˜è®¤æŸ¥è¯¢ä»åº“ï¼‰</td>
<td></td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>å‘½ä»¤è¶…æ—¶è®¾ç½®(ç§’)</td>
<td></td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>è®¾ç½®äº‹åŠ¡å¯¹è±¡</td>
<td></td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>è®¾ç½®è¿æ¥å¯¹è±¡</td>
<td></td>
</tr>
<tr>
<td>WithLock</td>
<td>&lt;this&gt;</td>
<td>Enum</td>
<td>SqlServer NoLock ç­‰ç‰¹æœ‰çš„è®¾ç½®</td>
<td></td>
</tr>
<tr>
<td>ForUpdate</td>
<td>&lt;this&gt;</td>
<td>bool</td>
<td>æ’ä»–æ›´æ–°é”ï¼Œå¯¹ä¸åŒçš„æ•°æ®åº“å·²ä½œé€‚é…ï¼Œè¯¦ç»†è¯´æ˜è§æ³¨é‡Š</td>
<td></td>
</tr>
<tr>
<td>AsQueryable</td>
<td>IQueryable</td>
<td></td>
<td>å°† ISelect è½¬æ¢ä¸º IQueryableï¼Œæ­¤æ–¹æ³•ä¸»è¦ç”¨äºæ‰©å±•ï¼Œæ¯”å¦‚ï¼šabp IRepository GetAll() æ¥å£æ–¹æ³•éœ€è¦è¿”å› IQueryable å¯¹è±¡ã€‚æ³¨æ„ï¼šIQueryable æ–¹æ³•æ±¡æŸ“è¾ƒä¸ºä¸¥é‡ï¼Œè¯·å°½é‡é¿å…æ­¤è½¬æ¢</td>
<td></td>
</tr>
<tr>
<td>ToTreeList()</td>
<td>List&lt;TEntity&gt;</td>
<td>æ— </td>
<td>å°†çˆ¶å­å…³ç³»çš„æ•°æ®ä»¥ TreeList çš„å½¢å¼è¿”å›</td>
<td></td>
</tr>
<tr>
<td>AsTreeCte()</td>
<td>ISelect</td>
<td>(up, pathSelector, level)</td>
<td>é€’å½’æŸ¥è¯¢çˆ¶å­å…³ç³»è¡¨</td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="iinsert" tabindex="-1"> IInsert</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppendData</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>è¿½åŠ å‡†å¤‡æ’å…¥çš„å®ä½“</td>
</tr>
<tr>
<td>InsertIdentity</td>
<td>&lt;this&gt;</td>
<td>æ— </td>
<td>æŒ‡æ˜æ’å…¥è‡ªå¢åˆ—</td>
</tr>
<tr>
<td>InsertColumns</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>åªæ’å…¥çš„åˆ—</td>
</tr>
<tr>
<td>IgnoreColumns</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å¿½ç•¥çš„åˆ—</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>å‘½ä»¤è¶…æ—¶è®¾ç½®(ç§’)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>è®¾ç½®äº‹åŠ¡å¯¹è±¡</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>è®¾ç½®è¿æ¥å¯¹è±¡</td>
</tr>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
</tr>
<tr>
<td>OnDuplicateKeyUpdate</td>
<td>OnDuplicateKeyUpdate&lt;T1&gt;</td>
<td>æ— </td>
<td>MySql ç‰¹æœ‰çš„åŠŸèƒ½ï¼ŒOn Duplicate Key Update</td>
</tr>
<tr>
<td>OnConflictDoUpdate</td>
<td>OnConflictDoUpdate&lt;T1&gt;</td>
<td>æ— </td>
<td>PostgreSQL ç‰¹æœ‰çš„åŠŸèƒ½ï¼ŒOn Conflict Do Update</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>long</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
</tr>
<tr>
<td>ExecuteIdentity</td>
<td>long</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›è‡ªå¢å€¼</td>
</tr>
<tr>
<td>ExecuteInserted</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›æ’å…¥åçš„è®°å½•</td>
</tr>
<tr>
<td>ExecuteSqlBulkCopy</td>
<td>void</td>
<td></td>
<td>SqlServer ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œæ‰§è¡Œ SqlBulkCopy æ‰¹é‡æ’å…¥çš„å°è£…</td>
</tr>
<tr>
<td>ExecutePgCopy</td>
<td>void</td>
<td></td>
<td>PostgreSQL ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œæ‰§è¡Œ Copy æ‰¹é‡å¯¼å…¥æ•°æ®</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="iupdate" tabindex="-1"> IUpdate</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>SetSource</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>æ›´æ–°æ•°æ®ï¼Œè®¾ç½®æ›´æ–°çš„å®ä½“</td>
</tr>
<tr>
<td>IgnoreColumns</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>å¿½ç•¥çš„åˆ—</td>
</tr>
<tr>
<td>Set</td>
<td>&lt;this&gt;</td>
<td>Lambda, value</td>
<td>è®¾ç½®åˆ—çš„æ–°å€¼ï¼ŒSet(a =&gt; a.Name, &quot;newvalue&quot;)</td>
</tr>
<tr>
<td>Set</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>è®¾ç½®åˆ—çš„çš„æ–°å€¼ä¸ºåŸºç¡€ä¸Šå¢åŠ ï¼ŒSet(a =&gt; a.Clicks + 1)ï¼Œç›¸å½“äº clicks=clicks+1</td>
</tr>
<tr>
<td>SetDto</td>
<td>&lt;this&gt;</td>
<td>object</td>
<td>æ ¹æ® dto æ›´æ–°çš„æ–¹æ³•</td>
</tr>
<tr>
<td>SetRaw</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>è®¾ç½®å€¼ï¼Œè‡ªå®šä¹‰ SQL è¯­æ³•ï¼ŒSetRaw(&quot;title = ?title&quot;, new { title = &quot;newtitle&quot; })</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>è¡¨è¾¾å¼æ¡ä»¶ï¼Œä»…æ”¯æŒå®ä½“åŸºç¡€æˆå‘˜ï¼ˆä¸åŒ…å«å¯¼èˆªå¯¹è±¡ï¼‰</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>åŸç”Ÿ sql è¯­æ³•æ¡ä»¶ï¼ŒWhere(&quot;id = ?id&quot;, new { id = 1 })</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>ä¼ å…¥å®ä½“æˆ–é›†åˆï¼Œå°†å…¶ä¸»é”®ä½œä¸ºæ¡ä»¶</td>
</tr>
<tr>
<td>WhereExists</td>
<td>&lt;this&gt;</td>
<td>ISelect</td>
<td>å­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>å‘½ä»¤è¶…æ—¶è®¾ç½®(ç§’)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>è®¾ç½®äº‹åŠ¡å¯¹è±¡</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>è®¾ç½®è¿æ¥å¯¹è±¡</td>
</tr>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>long</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
</tr>
<tr>
<td>ExecuteUpdated</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›æ›´æ–°åçš„è®°å½•</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="idelete" tabindex="-1"> IDelete</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¿”å›å€¼</th>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>Lambda</td>
<td>è¡¨è¾¾å¼æ¡ä»¶ï¼Œä»…æ”¯æŒå®ä½“åŸºç¡€æˆå‘˜ï¼ˆä¸åŒ…å«å¯¼èˆªå¯¹è±¡ï¼‰</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>string, parms</td>
<td>åŸç”Ÿ sql è¯­æ³•æ¡ä»¶ï¼ŒWhere(&quot;id = ?id&quot;, new { id = 1 })</td>
</tr>
<tr>
<td>Where</td>
<td>&lt;this&gt;</td>
<td>T1 | IEnumerable&lt;T1&gt;</td>
<td>ä¼ å…¥å®ä½“æˆ–é›†åˆï¼Œå°†å…¶ä¸»é”®ä½œä¸ºæ¡ä»¶</td>
</tr>
<tr>
<td>WhereExists</td>
<td>&lt;this&gt;</td>
<td>ISelect</td>
<td>å­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>CommandTimeout</td>
<td>&lt;this&gt;</td>
<td>int</td>
<td>å‘½ä»¤è¶…æ—¶è®¾ç½®(ç§’)</td>
</tr>
<tr>
<td>WithTransaction</td>
<td>&lt;this&gt;</td>
<td>DbTransaction</td>
<td>è®¾ç½®äº‹åŠ¡å¯¹è±¡</td>
</tr>
<tr>
<td>WithConnection</td>
<td>&lt;this&gt;</td>
<td>DbConnection</td>
<td>è®¾ç½®è¿æ¥å¯¹è±¡</td>
</tr>
<tr>
<td>ToSql</td>
<td>string</td>
<td></td>
<td>è¿”å›å³å°†æ‰§è¡Œçš„ SQL è¯­å¥</td>
</tr>
<tr>
<td>ExecuteAffrows</td>
<td>long</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
</tr>
<tr>
<td>ExecuteDeleted</td>
<td>List&lt;T1&gt;</td>
<td></td>
<td>æ‰§è¡Œ SQL è¯­å¥ï¼Œè¿”å›è¢«åˆ é™¤çš„è®°å½•</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">æ›´æ–°æ—¥å¿—</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/reference/change-log.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/reference/change-log.html"/>
    <updated>2022-06-13T14:31:03.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æ›´æ–°æ—¥å¿—" tabindex="-1"> æ›´æ–°æ—¥å¿—</h1>
<p>å¤§çº¦æ¯ä¸‰ä¸ªæœˆä¸€æ¬¡ç‰ˆæœ¬å·ï¼Œæš‚æ—¶ä»¥ä¿®å¤ bug ä¸ºä¸»</p>
<blockquote>
<p>preview é¢„è§ˆç‰ˆ æ·»åŠ  nuget æºï¼šhttps://www.myget.org/F/ncc/api/v3/index.json</p>
</blockquote>
<h2 id="v3-2-663" tabindex="-1"> v3.2.663</h2>
<ul>
<li><strong>ä¿®å¤ UseGenerateCommandParameterWithLambda å­æŸ¥è¯¢å¹¶å‘ bugï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1155" target="_blank" rel="noopener noreferrer">#1155</a> ï¼ˆé‡è¦ï¼‰</strong></li>
<li>ä¿®å¤ pgsql Dto æ˜ å°„ä½¿ç”¨å¸¸é‡ false è½¬æ¢å¤±è´¥ï¼›</li>
<li>ä¿®å¤ IIF ä¸‰å…ƒè¡¨è¾¾å¼æ ‘è§£æ bool HasValue é—®é¢˜ï¼›</li>
<li>ä¿®å¤ MySqlConnector BulkCopy æ˜ å°„é¡ºåºé—®é¢˜ï¼›</li>
<li>ä¼˜åŒ– XML æ³¨é‡Šè¯»å–æ”¯æŒ interfaceï¼›</li>
<li>support providerã€Extensions Exceptions å¤šè¯­è¨€</li>
</ul>
<h2 id="v3-2-662" tabindex="-1"> v3.2.662</h2>
<ul>
<li><strong>è°ƒæ•´ pgsql10 è‡ªå¢æ˜ å°„ä½¿ç”¨ GENERATED BY DEFAULT AS IDENTITYï¼Œä½ç‰ˆæœ¬ä»ç„¶ä½¿ç”¨ serialï¼›</strong></li>
<li><strong>å¢åŠ  PgArrayToMany ä¸“å±å¯¼èˆªå±æ€§ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1145" target="_blank" rel="noopener noreferrer">#1145</a></strong></li>
<li>å¢åŠ  ObservableCollection çº§è”åŠ è½½å’Œä¿å­˜ï¼›</li>
<li>ä¼˜åŒ– FluentApi ç»§æ‰¿å…³ç³»å¯ç›´æ¥ ConfigEntity&lt;BaseEntity&gt; ç”Ÿæ•ˆï¼›#1144</li>
<li>ä¿®å¤ è¾¾æ¢¦ min pool size é¢„çƒ­æ•°é‡åŒ¹é… bugï¼›</li>
<li>ä¿®å¤ v3.2.620 - v3.2.661 å­æŸ¥è¯¢ sum/min/max/avg é»˜è®¤åŠ  isnull é˜²æ­¢ä¸º NULL æƒ…å†µï¼Œæ—¥æœŸç±»å‹å¤„ç†é”™è¯¯ #1140 1b84a0069679c92ccaff9aa8c33023e4d34262cd</li>
<li>ä¿®å¤ AsTable å­æŸ¥è¯¢æœªä¼ æ’­çš„é—®é¢˜ï¼›#1103</li>
<li>ä¿®å¤ IncludeByPropertyName fromFirstTable åˆ¤æ–­é”™è¯¯ï¼›#278</li>
<li>ä¿®å¤ GroupBy ç‰¹æ®Šæƒ…å†µä¸‹ AsProperty æ— æ•ˆçš„ bugï¼›#1141</li>
<li>ä¿®å¤ MySql CodeFirst OldName + Comment è¿ç§»é—®é¢˜ï¼›#1147</li>
<li>ä¿®å¤ pgsql DbFirst æœªæ­£ç¡®è·å– Position å€¼ï¼›#1154</li>
</ul>
<h2 id="v3-2-661" tabindex="-1"> v3.2.661</h2>
<ul>
<li>å¢åŠ  UseMappingPriority æŒ‡å®šæ˜ å°„ä¼˜å…ˆçº§ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/387" target="_blank" rel="noopener noreferrer">#387</a> <a href="https://github.com/dotnetcore/FreeSql/issues/69" target="_blank" rel="noopener noreferrer">#69</a> <a href="https://github.com/dotnetcore/FreeSql/issues/99" target="_blank" rel="noopener noreferrer">#99</a></li>
<li>å¢åŠ  AuditValueEventArgs Object å‚æ•°ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1128" target="_blank" rel="noopener noreferrer">#1128</a></li>
<li>ä¿®å¤ pgsql varchar(120) CodeFirst è¿ç§»ä¸ä¿®æ”¹é•¿åº¦ï¼›</li>
<li>ä¿®å¤ ISelect.InsertInto æœªæ‰§è¡Œè‡ªåŠ¨è¿ç§»ï¼›</li>
<li>ä¿®å¤ UseCommandParameterWithLambda IN å‚æ•°åŒ–åˆ¤æ–­ çš„é€»è¾‘ bugï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1137" target="_blank" rel="noopener noreferrer">#1137</a></li>
<li>ä¼˜åŒ– è¿æ¥æ± ä¸å¯ç”¨ã€å®šæ—¶æ£€æŸ¥ï¼›</li>
<li>ä¼˜åŒ– Limit + Sum/Avg/Max/Min ä¸ºåµŒå¥—æŸ¥è¯¢ï¼›</li>
<li>ä¼˜åŒ– GroupBy Page æœªæ’åºçš„æŸ¥è¯¢ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1126" target="_blank" rel="noopener noreferrer">#1126</a></li>
</ul>
<h2 id="v3-2-651" tabindex="-1"> v3.2.651</h2>
<ul>
<li><strong>å¢åŠ  DTO æ˜ å°„éå¯¼èˆªå±æ€§çš„å­è¡¨æŸ¥è¯¢ ToListï¼Œå¯ç›´æ¥è¿”å›é›†åˆï¼›</strong></li>
<li>å¢åŠ  Array.Any(x =&gt; x.id == a.Id &amp;&amp; ..) è¡¨è¾¾å¼æ ‘è§£æï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/243" target="_blank" rel="noopener noreferrer">#243</a></li>
<li>å¢åŠ  pgsql numeric -&gt; BigInteger æ˜ å°„ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1100" target="_blank" rel="noopener noreferrer">#1100</a></li>
<li>å¢åŠ  <a href="https://github.com/dotnetcore/FreeSql/issues/1108" target="_blank" rel="noopener noreferrer">#1108</a> Exception å›½é™…åŒ–ï¼›</li>
<li>å¢åŠ  DynamicFilterCustom å‚æ•° object senderï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1113" target="_blank" rel="noopener noreferrer">#1113</a></li>
<li>å¢åŠ  Fluent API ä»¥ç»§æ‰¿æ¥å£çš„å½¢å¼é…ç½®å®ä½“ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/937" target="_blank" rel="noopener noreferrer">#937</a></li>
<li>ä¿®å¤ Oracle AsTable åˆ†è¡¨åµŒå¥— SQL æ‹¼é”™é”™è¯¯ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1098" target="_blank" rel="noopener noreferrer">#1098</a></li>
<li>ä¿®å¤ AsTable ManyToMany IncludeMany æ— æ•ˆçš„é—®é¢˜ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1103" target="_blank" rel="noopener noreferrer">#1103</a></li>
<li>ä¿®å¤ AsTable åˆ†è¡¨ ToAggregate æ— æ³•å¾—åˆ°æ±‡æ€»ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1115" target="_blank" rel="noopener noreferrer">#1115</a></li>
<li>ä¿®å¤ Repository.DataFilter å¯¹ GlobalFilter æ§åˆ¶æ— æ•ˆçš„ bugï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1028" target="_blank" rel="noopener noreferrer">#1028</a> <a href="https://github.com/dotnetcore/FreeSql/issues/846" target="_blank" rel="noopener noreferrer">#846</a></li>
<li>ä¿®å¤ IN æŸ¥è¯¢åŒºåˆ† varchar/nvarcharï¼›</li>
<li>ä¿®å¤ Oracle clob å‚æ•°åŒ–ç±»å‹è®¾ç½®é—®é¢˜ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1116" target="_blank" rel="noopener noreferrer">#1116</a></li>
<li>ä¿®å¤ MySql å­æŸ¥è¯¢ Enum MapType(int) è¡¨è¾¾å¼åˆ¤æ–­è§£æ bugï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1118" target="_blank" rel="noopener noreferrer">#1118</a></li>
<li>ä¼˜åŒ– AsTable è‡ªåŠ¨åˆ†è¡¨ Where Equal åˆ¤æ–­ï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1104" target="_blank" rel="noopener noreferrer">#1104</a></li>
<li>ä¼˜åŒ– å­æŸ¥è¯¢ sum/min/max/avg é»˜è®¤åŠ  isnull é˜²æ­¢ä¸º NULL æƒ…å†µï¼›</li>
<li>ä¼˜åŒ– EnableCascadeSave çº§è”ä¿å­˜æ‰§è¡Œé€»è¾‘ï¼Œæå‡æ€§èƒ½ï¼›</li>
<li>ä¼˜åŒ– RawJoin æ”¯æŒ FULL JOIN ç­‰è‡ªå®šä¹‰è”è¡¨æ˜ å°„ï¼›</li>
<li>ä¼˜åŒ– IncludeMany ä¸‰çº§å¯¼èˆªå¯¹è±¡è‡ªåŠ¨ _includedï¼›<a href="https://github.com/dotnetcore/FreeSql/issues/1113" target="_blank" rel="noopener noreferrer">#1113</a></li>
</ul>
<h2 id="v3-2-100-v3-2-640" tabindex="-1"> v3.2.100 - v3.2.640</h2>
<ul>
<li><strong>å¢åŠ  InsertDict/UpdateDict/DeleteDict/InsertOrUpdateDict é’ˆå¯¹å­—å…¸çš„ CUD æ–¹æ³•ï¼›#481</strong></li>
<li>å¢åŠ  UseSlaveWeight è¯»æƒé‡è®¾ç½®ï¼›#1046</li>
<li><strong>å¢åŠ  [Table(AsTable = xx)] è‡ªåŠ¨åˆ†è¡¨ç‰¹æ€§ï¼Œå¾…å®Œå–„ï¼›#1066</strong></li>
<li>å¢åŠ  <a href="http://freesql.net/guide/freesql-provider-sqlitecore.html" target="_blank" rel="noopener noreferrer">FreeSql.Provider.SqliteCore</a> æ”¯æŒ Sqlite åŠ å¯†ï¼›</li>
<li>å¢åŠ  IList&lt;T&gt; IncludeByPropertyName æ‰©å±•æ–¹æ³•ï¼Œæ”¯æŒå­—ç¬¦ä¸²å‚æ•°ï¼›</li>
<li><strong>å¢åŠ  DbSet/Repository DeleteCascadeByDatabase çº§è”åˆ é™¤(åŸºäºæ•°æ®åº“)</strong>ï¼›</li>
<li>è°ƒæ•´ DbSet/Repository EnableAddOrUpdateNavigateList æ”¯æŒ OneToOne çº§è”ä¿å­˜ã€çº§è”åˆ é™¤(åŸºäºå¯¹è±¡)ï¼›</li>
<li>ä¿®å¤ Delete.Where in æŸ¥è¯¢ä¸ºç©ºæ—¶ï¼Œå¼‚æ­¥æ“ä½œä»ç„¶æ‰§è¡Œåˆ é™¤ï¼›#1068 <strong>ã€å—å½±å“ç‰ˆæœ¬ v3.2.302ã€‘</strong></li>
<li>ä¿®å¤ InsertOrUpdateDict å¼‚å¸¸ï¼›#1067 <strong>ã€å—å½±å“ç‰ˆæœ¬ v3.2.301ã€v3.2.300ã€v3.2.200ã€‘</strong></li>
<li>ä¿®å¤ InsertDict éƒ¨åˆ†æ–°åŠŸèƒ½é—ç•™é—®é¢˜(ç‰¹åˆ«æ˜¯ Oracle)ï¼›<strong>ã€å—å½±å“ç‰ˆæœ¬ v3.2.301ã€v3.2.300ã€v3.2.200ã€‘</strong></li>
<li>ä¿®å¤ InsertDict/UpdateDict ç­‰å­—å…¸æ“ä½œåœ¨ DbContext.Orm ä¸‹æ— æ³•ä½¿ç”¨çš„ bugï¼›#1064 <strong>ã€å—å½±å“ç‰ˆæœ¬ v3.2.300ã€v3.2.200ã€‘</strong></li>
<li>ä¿®å¤ MapType å¤æ‚è¡¨è¾¾å¼æ ‘è§£æ bugï¼›#1062</li>
<li>ä¿®å¤ UseGenerateCommandParameterWithLambda å¯¹ä¸å¯å‚æ•°åŒ–çš„æ•°æ®ç±»å‹å†²çªçš„ bugï¼›#1061 #900</li>
<li>ä¿®å¤ MySql Set ç±»å‹ç©ºæ ¼å¤„ç†é—®é¢˜ï¼›#1059</li>
<li>ä¿®å¤ SaveManyAsync å¤šå¯¹å¤šå†å²æ¼æ”¹çš„é—®é¢˜ï¼ˆåŒæ­¥æ— é—®é¢˜ï¼‰ï¼›</li>
<li>ä¿®å¤ OR è¡¨è¾¾å¼å¤„ç†æƒ…å†µï¼›#1047</li>
<li>ä¿®å¤ ClickHouse è®¾ç½® NoneParameter ä¼šæŠ¥é”™é—®é¢˜ï¼›</li>
<li>ä¿®å¤ Clickhouse è¿æ¥æ± ä½¿ç”¨é—®é¢˜ï¼›#646 #968 #969 #943</li>
<li>ä¿®å¤ pgsql IList -&gt; JArray æ˜ å°„ï¼›#1092</li>
<li>ä¿®å¤ pgsql DbFirst IsPrimary bugï¼›</li>
<li>ä¿®å¤ JsonMap ä¸å¯¼èˆªå±æ€§çš„è”è¡¨æŸ¥è¯¢æŠ¥é”™çš„ bugï¼›#996</li>
<li>ä¿®å¤ å­æŸ¥è¯¢ WhereIf å¯èƒ½å¤±è´¥çš„ bugï¼›</li>
<li>ä¿®å¤ StringLength è®¾ç½®å IsNullable = false æ— ç”Ÿæ•ˆçš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ UseConnectionFactory å‚æ•°åŒ–é—®é¢˜ï¼›</li>
<li>ä¿®å¤ å‚æ•°å€¼ä¸ºåŸå§‹ DbParameter æ—¶è½¬æ¢ç±»å‹æŠ¥é”™ï¼›</li>
<li>ä¿®å¤ UseGenerateCommandParameterWithLambda å­æŸ¥è¯¢ IN bugï¼›#900</li>
<li>ä¿®å¤ InsertValueSql åœ¨ä»“å‚¨æ’å…¥åä¸è¿”å›æœ€æ–°å€¼ï¼›</li>
<li>å®Œå–„ SqlServer BulkCopy æ’å…¥ DateTime æœ€å°å€¼é—®é¢˜ï¼›</li>
<li><strong>ä¼˜åŒ– å¯¼èˆªé›†åˆå±æ€§è®¿é—®ï¼Œå¯çœç•¥ AsSelectï¼›</strong></li>
<li>ä¼˜åŒ– DbContext/Repository Update å®ä½“æœ‰ ServerTime æ—¢ä½¿æ— çŠ¶æ€å˜åŒ–ä¹Ÿå¿…ç„¶æ›´æ–°çš„é€»è¾‘ï¼›</li>
<li>ä¼˜åŒ– DbContext/Repository æ’å…¥éä¸»é”®è‡ªå¢å›å¡«ï¼›</li>
<li>ä¼˜åŒ– ToList&lt;Dto&gt; jsonb æ˜ å°„ï¼›</li>
<li>ä¼˜åŒ– dywhere IN æŸ¥è¯¢æŒ‰ 500 å…ƒç´ åˆ†å‰²ï¼›#1091</li>
<li>ä¼˜åŒ– IIF è¡¨è¾¾å¼è§£æï¼›</li>
</ul>
<h2 id="v3-0-100" tabindex="-1"> v3.0.100</h2>
<ul>
<li><strong>å¢åŠ  å—å¤§é€šç”¨ Gbase å›½äº§æ•°æ®åº“æ”¯æŒï¼›</strong></li>
<li><strong>å¢åŠ  ClickHouse æ•°æ®åº“è¯­æ³•æ”¯æŒï¼›</strong></li>
<li>å¢åŠ  DbContext/Repository æ¯”è¾ƒå˜åŒ–æ–¹æ³• CompareStateï¼›</li>
<li><strong>å¢åŠ  DynamicFilter Custom è‡ªå®šä¹‰è§£æï¼›</strong></li>
<li>å¢åŠ  ToDataTableByPropertyName åŠ¨æ€æŸ¥è¯¢åŠŸèƒ½ï¼›</li>
<li>ä¼˜åŒ– å…¼å®¹æ’åº OrderBy(a =&gt; new {}) è¯­æ³•ï¼›</li>
<li>ä¼˜åŒ– pgsql jsonb æ˜ å°„ï¼Œæ”¯æŒ Listï¼Œmysql limit in å­æŸ¥è¯¢ï¼›</li>
<li>ä¼˜åŒ– InsertOrUpdate&lt;&gt; ä½¿ç”¨ InsertOrUpdate&lt;list&lt;&gt;&gt;æ—¶ï¼Œæç¤ºå‹å¥½å¼‚å¸¸ã€‚</li>
<li>ä¿®å¤ BulkCopy ä¸çº¿ç¨‹äº‹åŠ¡æœªä¼ æ’­çš„ bugï¼›#962</li>
<li>ä¿®å¤ AsTreeCte + RereadSql ä¸èƒ½åŒæ—¶ä½¿ç”¨çš„ bugï¼›#964</li>
<li>ä¿®å¤ FreeSql.Generator å·¥å…·ç”Ÿæˆ model å¤±è´¥ <a href="https://github.com/dotnetcore/FreeSql/issues/882" target="_blank" rel="noopener noreferrer">#882</a></li>
</ul>
<h2 id="v2-6-100" tabindex="-1"> v2.6.100</h2>
<ul>
<li>ä¿®å¤ fix sqlite AddMinutes seconds-&gt;minutes <a href="https://github.com/dotnetcore/FreeSql/issues/774" target="_blank" rel="noopener noreferrer">#774</a></li>
<li>ä¿®å¤ Update æ“ä½œçš„æ—¶å€™ CanUpdate=false æœªç”Ÿæ•ˆ <a href="https://github.com/dotnetcore/FreeSql/issues/803" target="_blank" rel="noopener noreferrer">#803</a></li>
<li>ä¼˜åŒ– å°† Freesql çš„ dynamicfilterinfo æ ‡è®°ä¸º[serialable] <a href="https://github.com/dotnetcore/FreeSql/issues/802" target="_blank" rel="noopener noreferrer">#802</a></li>
<li>ä¿®å¤ Sqlite where.And(x =&gt; x.PublishTime.Year == 2021); æŸ¥è¯¢é—®é¢˜ <a href="https://github.com/dotnetcore/FreeSql/issues/802" target="_blank" rel="noopener noreferrer">#804</a></li>
<li>å¢åŠ  æ”¯æŒç¬¦å·è°ƒè¯• <a href="https://github.com/dotnetcore/FreeSql/issues/679" target="_blank" rel="noopener noreferrer">#679</a></li>
<li>å¢åŠ  IUnitOfWork.States è‡ªå®šä¹‰çŠ¶æ€ç®¡ç†ï¼Œä¾¿äºæ‰©å±•ï¼›</li>
</ul>
<h2 id="v2-5-300" tabindex="-1"> v2.5.300</h2>
<ul>
<li>ä¿®å¤ ISelect.AsTable å .ToUpdate/ToDelete æ— æ•ˆçš„ bugï¼›#815</li>
<li>ä¿®å¤ MERGE INTO åˆ«åä¸ SQL å…³é”®å­—å†²çªçš„ bugï¼›#816</li>
<li>ä¿®å¤ Oracle IncludeMany IN å…ƒç´ è¶…è¿‡ 500 æ•°ç›®çš„é—®é¢˜ï¼›#843</li>
<li>fix IgnoreColumns CanUpdate false not work #803</li>
<li>fix sqlite where datetime year,month æŸ¥ä¸å‡ºæ¥æ•°æ®,Ticks ç²¾åº¦åˆ°æ¯«ç§’ï¼Œå¤„ç† Millisecond æ— å€¼çš„æƒ…å†µ #804</li>
<li>Add Serializable #802</li>
<li>Add string.Concat è¿”å› string.Empty</li>
</ul>
<h2 id="v2-5-200" tabindex="-1"> v2.5.200</h2>
<ul>
<li>ä¿®å¤ Repository/DbContext æ‰¹é‡ä¿®æ”¹å¯èƒ½æ— æ•ˆçš„ bugï¼›#709</li>
<li>fix sqlite AddMinutes seconds -&gt; minutes #774</li>
<li>fix ExecuteMySqlBulkCopyAsync .net core 3.1 Method not found #783</li>
</ul>
<h2 id="v2-5-100" tabindex="-1"> v2.5.100</h2>
<ul>
<li>å¢åŠ  ISelect.Page(BasePagingInfo pagingInfo) æ–¹æ³•é‡è½½ï¼›</li>
<li>ä¿®å¤ IncludeMany + AsTreeCte ä¸èƒ½ç»„åˆä½¿ç”¨çš„é—®é¢˜ï¼›#760</li>
<li>ä¿®å¤ Ado.CommandFluent å­˜å‚¨è¿‡ç¨‹å‚æ•°åŒ–é—®é¢˜ï¼›#739</li>
<li>ä¿®å¤ IUpdate.SetDto bugï¼›#754</li>
<li>ä¿®å¤ pgsql ä¸­ hstore ä¸­ value é”™è¯¯èµ‹å€¼ä¸º key çš„é—®é¢˜ï¼Œå¹¶å…è®¸ value å€¼ä¸º NULLï¼›</li>
<li>ä¿®å¤ byte[]ç±»å‹çš„ä¹è§‚é”åˆå§‹åŒ–é—®é¢˜ï¼›</li>
</ul>
<h2 id="v2-3-200" tabindex="-1"> v2.3.200</h2>
<ul>
<li>ä¿®å¤ Repository/DbContext æ‰¹é‡ä¿®æ”¹å¯èƒ½æ— æ•ˆçš„ bugï¼›#709</li>
<li>ä¿®å¤ Oracle/Dameng åˆ†ç»„æŸ¥è¯¢ååˆ†é¡µçš„ bugï¼›#710</li>
<li>ä¼˜åŒ– fsql.Transaction çº¿ç¨‹äº‹åŠ¡ï¼›</li>
</ul>
<h2 id="v2-3-106" tabindex="-1"> v2.3.106</h2>
<ul>
<li>ä¿®å¤ v2.3.100 GlobalFilter åœ¨ Repository å¤±æ•ˆçš„ bugï¼›</li>
<li>ä¼˜åŒ– BaseDbProviderã€AdoNetExtensions å†…éƒ¨å®šä¹‰ï¼›</li>
<li>å¢åŠ  IUpdate.SetSource æ‰¹é‡æ›´æ–°æ—¶æŒ‡å®šä¸»é”®ï¼›#337</li>
</ul>
<h2 id="v2-3-100" tabindex="-1"> v2.3.100</h2>
<ul>
<li><strong>å¢åŠ  FreeSql.Provider.Custom è‡ªå®šä¹‰é€‚é…è®¿é—®ä»»ä½•æ•°æ®åº“ï¼›</strong></li>
<li>å¢åŠ  Column ç‰¹æ€§ RewriteSql/RereadSqlï¼›</li>
<li>å¢åŠ  ISelect.OrderByRandom() éšæœºæ’åºé€‚é…ï¼›</li>
<li>å¢åŠ  SqlExt.DistinctCount æ‰©å±•æ–¹æ³•ï¼›#674 #533</li>
<li>å¢åŠ  Aop Before/After States å…±äº«çŠ¶æ€ï¼›</li>
<li>ä¼˜åŒ– ManyToMany å¯¼èˆªå±æ€§å­æŸ¥è¯¢æ”¯æŒ ToListï¼›</li>
<li>ä¼˜åŒ– HzyTuple å­æŸ¥è¯¢è§£æï¼›</li>
<li>ä¼˜åŒ– æŒ‡å®š Dto æŸ¥è¯¢å¯¹ c# å­—æ®µçš„æ”¯æŒï¼›</li>
<li>ä¼˜åŒ– GlobalFilter å­æŸ¥è¯¢ä¼ æ’­é‡å¤çš„é—®é¢˜ï¼›#642</li>
<li>ä¼˜åŒ– Console.Write å¹³å°å…¼å®¹é—®é¢˜ï¼›#643</li>
<li>ä¼˜åŒ– DbSet/Repository çº§è”ä¿å­˜æ—¶ï¼Œå¿½ç•¥æœªé…ç½®çš„å¯¼èˆªå±æ€§ï¼›</li>
<li>ä¼˜åŒ– FreeSql.Extensions.Linq Select é€‰å®šå­—æ®µæŸ¥è¯¢æ–¹æ³•ï¼›#674 #533</li>
<li>ä¼˜åŒ– Repository.DataFilter å¯ç¦ç”¨ GlobalFilterï¼›</li>
<li>ä¼˜åŒ– WhereDynamicFilterï¼›</li>
<li>ä¿®å¤ å»¶æ—¶å±æ€§æ—¶çº§è”ä¿å­˜å¤±è´¥çš„ bugï¼›</li>
<li>ä¿®å¤ åˆ†ç»„æŸ¥è¯¢åï¼Œæ— æ³•ä½¿ç”¨å­æŸ¥è¯¢çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ UseGenerateCommandParameterWithLambda + Enum + MapType(string) bugï¼›</li>
<li>ä¿®å¤ ToChunk + IncludeMany äºŒçº§é›†åˆå±æ€§çš„ bugï¼›</li>
<li>ä¿®å¤ JsonMap åºåˆ—åŒ–åˆ¤æ–­ bugï¼›</li>
<li>ä¿®å¤ Sqlite DbFirst è·å–è‡ªå¢çš„ bugï¼›</li>
<li>ä¿®å¤ Oracle DbFirst date ç±»å‹ bugï¼›#627</li>
<li>ä¿®å¤ ISelect2`16 OrderByIf bugï¼›</li>
<li>ä¿®å¤ ç¥é€š Linux not supported é—®é¢˜ï¼›#656</li>
<li>ä¿®å¤ WhereDynamicFilter æ™®é€šå¤šè¡¨æŸ¥è¯¢æ—¶åˆ«ååˆ¤æ–­çš„ bugï¼›</li>
<li>ä¿®å¤ AsTreeCte äº‹åŠ¡ä¼ æ’­ bugï¼›</li>
<li>ä¿®å¤ è¡¨è¾¾å¼æ ‘è§£æ MapType æŠŠå°æ•°ä½è½¬æ¢ä¸¢å¤±çš„ bugï¼›</li>
<li>ä¿®å¤ SqlServer æ”¯æŒ Chinese_PRC_CS_AS åŒºåˆ†å°å¤§å†™ï¼›#684</li>
</ul>
<h2 id="v2-0-105" tabindex="-1"> v2.0.105</h2>
<ul>
<li>ä¿®å¤ Ado.Net æ‰©å±•æ–¹æ³•çš„å¤šè¡¨æŸ¥è¯¢ bugï¼›#592</li>
<li>ä¼˜åŒ– ToSql åˆ«åå¤§å°å†™é—®é¢˜ï¼›#467</li>
<li><strong>ä¼˜åŒ– IUnitOfWork/DbContext/Repository .Orm.Ado å’Œ CRUD éƒ½ä¸è‡ªèº«äº‹åŠ¡ä¿æŒä¸€è‡´ï¼›</strong></li>
<li>å®Œå–„ IDelete WhereIf(bool, sql) æ–¹æ³•ï¼›</li>
</ul>
<h2 id="v2-0-102" tabindex="-1"> v2.0.102</h2>
<ul>
<li>ä¼˜åŒ– DbFirst æ¨¡å¼é•¿å†…å®¹æœªè®¾ç½® StringLength = -1 å†™å…¥é—®é¢˜ï¼›</li>
<li>ä¼˜åŒ– å­æŸ¥è¯¢(å¤šè¡¨)åˆ«åï¼›</li>
<li>ä¼˜åŒ– IUpdate.Set æ”¯æŒä½è¿ç®—è¡¨è¾¾å¼æ ‘è§£æï¼›</li>
<li>ä¼˜åŒ– å•è¡¨æŸ¥è¯¢ ExpressionTree æ€§èƒ½ï¼›</li>
<li>ä¿®å¤ ISelect.InsertInto è®¾ç½®åˆ«åæ—¶æ— æ³•ä½¿ç”¨çš„é”™è¯¯ï¼›#576</li>
</ul>
<h2 id="v2-0" tabindex="-1"> v2.0</h2>
<ul>
<li>å¢åŠ  IncludeByPropertyName æŒ‰å±æ€§åè¿›è¡Œ Include/IncludeMany æ“ä½œï¼›#278</li>
<li>å¢åŠ  ISelect&lt;...&gt; å¤šè¡¨æŸ¥è¯¢ HzyTuple æ–°å§¿åŠ¿ï¼›ï¼ˆæ„Ÿè°¢ HZY è´¡çŒ®ï¼‰</li>
<li>å¢åŠ  ISelect Cancel ç”¨äºå–æ¶ˆæœ¬æ¬¡æŸ¥è¯¢ï¼›</li>
<li>å¢åŠ  IncludeIf/IncludeByPropertyNameIf æ–¹æ³•ï¼›</li>
<li>å¢åŠ  è¡¨è¾¾å¼æ ‘å‡½æ•°è§£æ byte[] Lengthï¼›#505</li>
<li>å¢åŠ  FreeSql Async CancellationToken å‚æ•°ï¼›#537</li>
<li>å¢åŠ  FreeSql.DbContext/Repository Async CancellationToken å‚æ•°ï¼›#537</li>
<li>å¢åŠ  Oracle/è¾¾æ¢¦ BulkCopy æ”¯æŒï¼›</li>
<li>å¢åŠ  IsVersion å¯¹ byte[] çš„æ”¯æŒï¼›#548</li>
<li>å¢åŠ  IN å‚æ•°æ‰©å±• where id in @idsï¼›#560</li>
<li>å¢åŠ  IAdo.QuerySingle æŸ¥è¯¢å•æ¡è®°å½•ï¼›#560</li>
<li>å¢åŠ  pgsql è¡¨è¾¾å¼æ ‘è§£æ hstore[&quot;&quot;]ï¼›</li>
<li>ä¼˜åŒ– varchar/nvarchar çš„ NoneParameter å¤„ç†ï¼›#519</li>
<li>ä¼˜åŒ– è¡¨è¾¾å¼æ ‘ SqlExt.IsNull å¯¹å¸ƒå°”ç±»å‹çš„è§£æï¼›#500</li>
<li>ä¼˜åŒ– MapRead å¯¹ NULL å­—æ®µçš„å¤„ç†ï¼›</li>
<li>ä¼˜åŒ– è¡¨è¾¾å¼æ ‘ä¸‰å…ƒè¡¨è¾¾å¼è§£æï¼Œå½“ Test ä¸ºå˜é‡æ—¶ä¸è§£ææˆ case when endï¼›</li>
<li>ä¼˜åŒ– AsTreeCte å¯¹ MySql 5.6 çš„å…¼å®¹ï¼›#536</li>
<li>ä¼˜åŒ– åˆ†é¡µ Page(..).Count() é¡ºåºé—®é¢˜ï¼›</li>
<li>ä¼˜åŒ– è‡ªåŠ¨ IsIgnore å¤„ç†ï¼›</li>
<li>ç§»é™¤ ISelect&lt;T&gt;/IUpdate&lt;T&gt;/IDelete&lt;T&gt; class çº¦æŸé™åˆ¶ï¼›</li>
<li>ä¿®å¤ çº¿ç¨‹äº‹åŠ¡åµŒå¥—äº‹åŠ¡çš„ bugï¼›#502</li>
<li>ä¿®å¤ #454 ä¼˜åŒ–é—ç•™çš„ bugï¼Œå½±å“ Aop.AuditValue äº‹ä»¶ï¼›#521</li>
<li>ä¿®å¤ å®ä½“ç±»æ‹¥æœ‰æ„é€ å‚æ•°æ—¶ï¼ŒToList&lt;DTO&gt; æ˜ å°„æŸ¥è¯¢æ— æ•ˆçš„ bugï¼›</li>
<li>ä¿®å¤ FreeSql.Generator å¤„ç† SqlServer é»˜è®¤å€¼çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ SqlServer RowNumber åˆ†é¡µæœ‰å¯èƒ½äº§ç”Ÿé¡ºåºä¸å¯¹çš„ bugï¼›</li>
<li>ä¿®å¤ .net5 å•æ–‡æœ¬éƒ¨ç½²è¯»å–æ³¨é‡ŠæŠ¥é”™ï¼›</li>
</ul>
<h2 id="v1-10-1" tabindex="-1"> v1.10.1</h2>
<ul>
<li>å¢åŠ  ISelect.InsertInto å°†æŸ¥è¯¢è½¬æ¢ä¸º INSERT INTO t1 SELECT ... FROM t2 æ‰§è¡Œæ’å…¥ï¼›#469</li>
<li>å¢åŠ  GlobalFilter.ApplyOnly ç»§æ‰¿çš„å®ä½“æ‰ç”Ÿæ•ˆï¼›#495</li>
<li>å¢åŠ  FreeSql.Generator å‚æ•° -readkey 0 çš„è®¾ç½®ï¼›</li>
<li>ä¼˜åŒ– WhereDynamicFilter æ”¯æŒ string æ¯”è¾ƒå¤§å° &gt; &lt; &gt;= &lt;=ï¼›#479</li>
<li>ä¼˜åŒ– IncludeMany ç­›é€‰å­—æ®µä¸­æœªæŒ‡å®šä¸»é”®ï¼Œå¹¶ä¸” then.IncludeMany ç»§ç»­å‘ä¸‹ï¼Œåˆ™è‡ªåŠ¨é™„åŠ æŸ¥è¯¢ä¸»é”®ï¼›</li>
<li>ä¼˜åŒ– WhereDynamic ä¼ å…¥ DynamicFilterInfo ä¹Ÿèƒ½æ‰§è¡Œï¼›</li>
<li>ä¼˜åŒ– WhereDynamic æ”¯æŒæŒ‰å­—æ®µåã€å±æ€§ååŒ¹é…ï¼›</li>
<li>ä¼˜åŒ– å®ä½“ç±»æ³¨é‡Šï¼ŒåŸºç±»åœ¨å…¶ä»– Assembly æ—¶ä¹Ÿèƒ½è¯»å–ï¼›</li>
<li>ä¼˜åŒ– æ”¯æŒå®ä½“ç±»ä½¿ç”¨ new é‡å†™å±æ€§ï¼›</li>
<li>ä¼˜åŒ– ToAggregate æ‰§è¡Œæ—¶å¿½ç•¥å·²è®¾ç½®çš„ OrderByï¼›</li>
<li>ä¼˜åŒ– dto æ˜ å°„æŸ¥è¯¢æ—¶å¿½ç•¥å·²æŒ‡å®šçš„æ˜ å°„ï¼Œé¿å…é‡å¤æŸ¥è¯¢å­—æ®µï¼›#494</li>
<li>ä¼˜åŒ– MySql CodeFirst ç´¢å¼•çš„å»ºç«‹ ï¼›#498</li>
<li>è¡¥å…… å¼‚æ­¥æ–¹æ³• ToListAsync(a =&gt; {}) å¯¹ IncludeMany çš„æ”¯æŒï¼›</li>
<li>ä¿®å¤ AsTreeCte å¼€å¯è‡ªåŠ¨è¿ç§»æ—¶ï¼Œé”™è¯¯çš„åˆ›å»ºäº† as_tree_cte è¡¨ï¼›#476</li>
<li>ä¿®å¤ å†…éƒ¨ decimal é»˜è®¤å€¼åœ¨ core 3.1+ æŠ¥é”™çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ decimal? å¯ç©ºæ•°å­—è®¾ç½® Column Scale æ— æ•ˆçš„é—®é¢˜(decimal æ­£å¸¸)ï¼›</li>
<li>ä¿®å¤ DbContext/UnitOfWork EntityChangeReport å‚æ•° BeforeObject å€¼æ— æ•ˆçš„ bugï¼›</li>
<li>ä¿®å¤ lambda è¡¨è¾¾å¼è§£æå˜é‡è½¬æ¢æ—¶çš„ bugï¼›#490</li>
<li>ä¿®å¤ Firebird Embedded ç‰ˆæœ¬ç³»ç»Ÿè¡¨ isidentity_type å…¼å®¹é—®é¢˜ï¼›</li>
<li>ä¿®å¤ Firebird Embedded 2.5 ä¸æ”¯æŒ boolean çš„ bugï¼›</li>
</ul>
<h2 id="v1-9-0" tabindex="-1"> v1.9.0</h2>
<ul>
<li><strong>å¢åŠ  FreeSql.Provider.Firebird æ•°æ®åº“å®ç° #443ï¼›</strong></li>
<li><strong>å¢åŠ  IncludeMany(a =&gt; a.Childs).ToList(a =&gt; new { a.Childs }) æŒ‡å®šé›†åˆå±æ€§è¿”å›ï¼›</strong></li>
<li>å¢åŠ  ISelect&lt;11..16&gt; 16 ä¸ªè”è¡¨æŸ¥è¯¢ï¼›</li>
<li>å¢åŠ  ISelect Aggregate(lambda, out var result) æ–¹æ³•ï¼›</li>
<li>å¢åŠ  ISelect OrderByIf æ–¹æ³• #446ï¼›</li>
<li>å¢åŠ  ISelect OrderByPropertyName æ–¹æ³• #446 #278 #361 #197ï¼›</li>
<li>å¢åŠ  IUpdate/IDelete WhereIf æ–¹æ³• #446ï¼›</li>
<li><strong>å¢åŠ  ISelect/IInsert/IUpdate/IDelete CommandTimeout æ–¹æ³•è®¾ç½®å‘½ä»¤è¶…æ—¶ï¼›</strong></li>
<li><strong>å¢åŠ  GlobalFilter.ApplyIf åˆ›å»ºåŠ¨æ€è¿‡æ»¤å™¨ï¼›</strong></li>
<li>å¢åŠ  SqlExt.IsNull æ–¹æ³•ï¼›</li>
<li>å¢åŠ  Oracle DbFirst è§†å›¾çš„æ”¯æŒï¼›</li>
<li>å¢åŠ  IAdo.CommandFluent(sql) æ–¹æ³•æ‰§è¡Œ SQL å‘½ä»¤ï¼›</li>
<li>ä¼˜åŒ– string IsNullable = false æ—¶æ’å…¥ null è‡ªåŠ¨è½¬ä¸º &quot;&quot; #445ï¼›</li>
<li>ä¼˜åŒ– GetDbParamtersByObject å‚æ•°ä¸ºå­—å…¸æ—¶ä¿®å‰ª @?: å‰è¾ #456ï¼›</li>
<li>ä¼˜åŒ– SqlExt.Sum/Max/Min/Avg åŒæ—¶æ”¯æŒå¼€çª—æˆ–æ™®é€šèšåˆå‡½æ•°ï¼›</li>
<li>ä¼˜åŒ– ToSql FieldAliasOptions.AsProperty åˆ«åé—®é¢˜ï¼›#467</li>
<li>ä¼˜åŒ– FreeSql.Generator -Match æ”¯æŒç”Ÿæˆä¸€ä¸ªè¡¨ï¼›</li>
<li>è°ƒæ•´ FreeSql.Generator ç§»é™¤ CanInsert = false ç‰¹æ€§ç”Ÿæˆï¼›</li>
<li>è°ƒæ•´ AdoNet CRUD æ‰©å±•æ–¹æ³•åˆ° namespace FreeSqlï¼›</li>
<li>ä¿®æ­£ SqlServer UseConnectionFactory ç±»å‹æ ‡è¯†ï¼›</li>
<li><strong>ä¿®å¤ FreeSql.DbContext å¯¹åŒä¸€å®ä½“é‡å¤ Updateï¼Œç¬¬äºŒæ¬¡æ— æ•ˆçš„ Bug</strong>ï¼›</li>
<li>ä¿®å¤ ISelect Any(lambda) æ¡ä»¶è¢«é™„åŠ çš„é—®é¢˜ï¼Œä¸ä¾¿äºå†æ¬¡ä½¿ç”¨ ISelect å¯¹è±¡ï¼›</li>
<li>ä¿®å¤ ISelect ToDelete/ToUpdate äº‹åŠ¡å¯¹è±¡æœªä¼ æ’­çš„ bugï¼›</li>
<li>ä¿®å¤ ISelect Include å¤šè¡¨å­—æ®µåç›¸åŒï¼ˆä¸åŒºåˆ†å¤§å°æ—¶ï¼‰æ—¶çš„ bugï¼›</li>
<li><strong>ä¿®å¤ IAdo.Query è¿”å›å®ä½“ä¸­å¸¦æœ‰å»¶æ—¶å¯¼èˆªå±æ€§ï¼Œè¯»å–é¡ºåºä¸å¯¹çš„ bug</strong>ï¼›</li>
<li>ä¿®å¤ Ado.Net Crud æ‰©å±•æ–¹æ³•äº‹åŠ¡çš„å‹å¥½å¼‚å¸¸æç¤ºï¼›</li>
<li>ä¿®å¤ ä½¿ç”¨æŸ¥è¯¢å‚æ•°åŒ–åŠŸèƒ½æ—¶ ToList å­æŸ¥è¯¢æœªä¼ æ’­å‚æ•°åˆ—è¡¨çš„ bugï¼›#462</li>
<li><strong>ä¿®å¤ å­æŸ¥è¯¢ Count/Max/Min/Avg/Sum ä½¿ç”¨äº† Limit(1) çš„ bugï¼›#462</strong></li>
<li>ä¿®å¤ IAdo.Query&lt;åŒ¿åç±»&gt;(sql) é”™è¯¯ï¼›</li>
<li>ä¿®å¤ SqlServer SqlBulkCopy IgnoreColumns æ— æ•ˆçš„ bugï¼›</li>
<li>ä¿®å¤ è¾¾æ¢¦ DbFirst è·å–å­—æ®µ IsNullable æ— æ•ˆçš„é—®é¢˜ï¼›#454</li>
<li>è¡¥å…… è¾¾æ¢¦ DbFirst int ç±»å‹è¯†åˆ«ï¼›</li>
</ul>
<h2 id="v1-8-1" tabindex="-1"> v1.8.1</h2>
<ul>
<li><strong>å¢åŠ  äººå¤§é‡‘ä»“ Ado.Net å®ç° FreeSql.Provider.KingbaseES #325ï¼›</strong></li>
<li><strong>å¢åŠ  DbContext/Repository BeginEdit/EndEdit æ‰¹é‡ç¼–è¾‘æ•°æ®çš„æ–¹æ³• #397ï¼›</strong></li>
<li>å¢åŠ  FreeSql.Provider.SqlServerForSystem ä½¿ç”¨ System.Data.SqlClient.dll å…¼å®¹æ›´å¤šè¿è¡Œå¹³å° #401 #398 #395 #392 #391ï¼›</li>
<li><strong>å¢åŠ  lambda è¡¨è¾¾å¼æ ‘è§£æå­æŸ¥è¯¢ ToList + string.Join() äº§ç”Ÿ ç±»ä¼¼ group_concat çš„æ•ˆæœï¼ˆé€‚é…äº† sqlserver/pgsql/oracle/mysql/sqlite/è¾¾æ¢¦/é‡‘ä»“) #405ï¼›</strong></li>
<li>å¢åŠ  IDbFirst.ExistsTable æ–¹æ³•åˆ¤æ–­è¡¨æ˜¯å¦å­˜åœ¨ï¼›</li>
<li>å¢åŠ  IDbFirst.GetTableByName æ–¹æ³•è·å–å•è¡¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬åˆ—è¯¦æƒ…ã€ä¸»é”®ã€å”¯ä¸€é”®ã€ç´¢å¼•ã€å¤‡æ³¨ï¼›</li>
<li>å¢åŠ  ICodeFirst.SyncStructure å¼ºåˆ¶åŒæ­¥å‚æ•° isForceSync #412ï¼›</li>
<li>å¢åŠ  ISelect&lt;2..10&gt; å¤šè¡¨ WithSql æ–¹æ³•ï¼›</li>
<li><strong>å¢åŠ  IDbConnection/IDbTransaction å¯¹è±¡çš„æ‰©å±•æ–¹æ³• Select/Insert/Update/Delete å®ç° CRUD</strong> #267ï¼›</li>
<li>å¢åŠ  IAdo.GetDbParamtersByObject æ–¹æ³•è·å– DbParameter[]ï¼›</li>
<li>å¢åŠ  IAdo.ExecuteConnectTest å¿«é€Ÿåˆ¤æ–­è¿æ¥æ˜¯å¦å¯ç”¨ #113ï¼›</li>
<li>å¢åŠ  Aop.AuditDataReader äº‹ä»¶æ‹¦æˆª DataReader è¯»å–å€¼ #436ï¼›</li>
<li>ä¿®å¤ fsql.InsertOrUpdate åœ¨åŒçº¿ç¨‹äº‹åŠ¡æ¨¡å¼å†…ä½¿ç”¨çš„ bug #402ï¼›</li>
<li>ä¿®å¤ fsql.Ado.ExecuteDataTable å½“è®°å½•ä¸å­˜åœ¨æ—¶ï¼Œæœªè¿”å› Columns è®¾ç½® #403ï¼›</li>
<li>ä¿®å¤ IInsert/IUpdate BatchProgress å¼‚æ­¥æ‰§è¡Œä¸ç”Ÿæ•ˆçš„ bugï¼›</li>
<li>ä¿®å¤ 1.7.1 IsNullable é—ç•™é—®é¢˜ï¼›</li>
<li>ä¿®å¤ Oracle nvarchar2 ä¸»é”®æ‰¹é‡æ›´æ–°çš„é—®é¢˜ï¼›#411</li>
<li>ä¿®å¤ è¾¾æ¢¦ DbFirst æ— æ³•è¯†åˆ«å­—æ®µæ˜¯å¦ä¸ºä¸»é”®çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ SqlExt PartitionBy æ— æ³•ä¼ å…¥å¤šåˆ—çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ WhereDynamicFilter System.Text.Json ååºåŒ–åçš„ç±»å‹è½¬æ¢é—®é¢˜ #371ï¼›</li>
<li>ä¿®å¤ ISelect ToList&lt;T&gt;(&quot;id,title&quot;) å±æ€§å’Œå­—æ®µé¡ºåºä¸åŒæ—¶çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ Dto æ˜ å°„æŸ¥è¯¢å±æ€§åä¸åŒºåˆ†å¤§å°å†™ bug #427ï¼›</li>
<li>ä¿®å¤ å‚æ•°åŒ– Column DbType è®¾ç½®ç‰¹æ®Šå€¼æ—¶çš„ç±»å‹åˆ¤æ–­ï¼›</li>
<li>ä¿®æ­£ UnitOfWorkManager Requierd å‘½åä¸º Requiredï¼›</li>
<li>ä¼˜åŒ– pgsql DbFirst åºåˆ—çš„è¯†åˆ«ï¼Œä»¥åŠ pgsql10 çš„è‡ªå¢è¯†åˆ«ï¼›</li>
<li>ä¼˜åŒ– IsNullable = false æ’å…¥çš„æ•°æ®å€¼ä¸º null åˆ™ä»¥é»˜è®¤å€¼æ’å…¥ï¼ˆé˜²æ­¢ DB æŠ¥é”™ï¼‰ #384ï¼›</li>
<li><strong>ä¼˜åŒ– GroupBy ToList lambda ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ a.Keyï¼›</strong></li>
<li>ä¼˜åŒ– NoneParameter Oracle æ–‡æœ¬è¶…é•¿çš„é—®é¢˜ï¼›</li>
<li>ä¼˜åŒ– lambda ä½¿ç”¨ a == null ? 1 : 0 æ”¯æŒç±»ä¼¼è¿™æ ·ç›´æ¥åˆ¤æ–­å®ä½“çš„æƒ…å†µï¼›</li>
<li>ä¼˜åŒ– IUpdate.SetSource æœºåˆ¶ä¸æ›´æ–°ä¸»é”®å­—æ®µï¼›</li>
<li>ä¼˜åŒ– IUpdate.SetSource æ— ä¸»é”®çš„é”™è¯¯æç¤ºï¼›</li>
<li>ä¼˜åŒ– WhereDynamic ä¼ å…¥é›†åˆå¯¹è±¡æ—¶ï¼Œé€»è¾‘ OR æ¢ä¸º INï¼›</li>
<li>ä¼˜åŒ– æŒ‡å®šå¯¼èˆªå±æ€§æŸ¥è¯¢æ—¶ï¼Œå¦‚æœä¸‹çº§å¯¼èˆªå±æ€§è¢« Include è¿‡ï¼Œåˆ™å°†ä»–ä»¬ä¹ŸæŸ¥è¯¢å‡ºæ¥ï¼›</li>
<li><strong>å®Œå–„ AsTreeCte + ToUpdate/ToDelete å®ç°æ ‘æ‰€æœ‰å­èŠ‚ç‚¹åˆ é™¤æˆ–æ›´æ–°ï¼›</strong></li>
<li>å®Œå–„ DbUpdateVersionException IsVersion è¡Œç‰ˆæœ¬å¼‚å¸¸ï¼›</li>
<li>å®Œå–„ DbContext/UnitOfWork EntityChange æ›´æ–°å¯¹è±¡ä¹‹å‰çš„å€¼ï¼›</li>
<li>å®Œå–„ ToChunk åˆ†å—åŠ è½½æŸ¥è¯¢ï¼Œåº”ç”¨åˆ° ISelect`1..10 ä¸­ï¼›</li>
<li>å®Œå–„ ISelect&lt;T&gt;.WithSql æ–¹æ³•ï¼Œæ”¯æŒä¼ å…¥å‚æ•°åŒ– #413ï¼›</li>
</ul>
<h2 id="v1-7-1-microsoft-data-sqliclient-å…¼å®¹é—®é¢˜" tabindex="-1"> v1.7.1 (Microsoft.Data.SqliClient å…¼å®¹é—®é¢˜)</h2>
<ul>
<li>å¢åŠ  ColumnAttribute Precision/Scale è®¾ç½®ï¼›</li>
<li>å¢åŠ  &quot;x1&quot;.First/FirstOrDefault è¡¨è¾¾å¼å‡½æ•°è§£æï¼›</li>
<li>è°ƒæ•´ ColumnAttribute IsNullable å¯¹ int/long ç­‰å€¼ç±»å‹ä¹Ÿå¯ç”Ÿæ•ˆï¼›#384</li>
<li>ä¿®å¤ $&quot;{a.Code}_{a.Id}&quot; lambda è§£æå½“ {} å¤šäº 3 ä¸ªæ—¶çš„ bugï¼ˆ.net å†…éƒ¨æœºåˆ¶å¾ˆå‘ï¼‰ï¼›
<blockquote>
<ul>
<li>3 ä¸ª {} æ—¶ï¼ŒArguments[1..3] è§£æå‡ºæ¥æ˜¯åˆ†å¼€çš„</li>
<li>4 ä¸ª {} æ—¶ï¼ŒArguments[1] åªèƒ½è§£æè¿™ä¸ªå‡ºæ¥ï¼Œç„¶å [1] é‡Œé¢æ˜¯ NewArray []</li>
</ul>
</blockquote>
</li>
<li>è¡¥å…… fsql.InsertOrUpdate UpdateColumns æ•°æ®å­˜åœ¨æ—¶åªæ›´æ–°æŒ‡å®šçš„å­—æ®µ #394 #330 #115 #17ï¼›</li>
</ul>
<h2 id="v1-7-0" tabindex="-1"> v1.7.0</h2>
<ul>
<li><strong>å¢åŠ  å®ä½“å±æ€§ char ç±»å‹çš„æ˜ å°„ #381 #235</strong>ï¼›</li>
<li>å¢åŠ  $&quot;{a.Code}_{a.Id}&quot; lambda è§£æï¼›</li>
<li>å¢åŠ  IInsert/IUpdate BatchProgress æ–¹æ³•å¤„ç†æ‰¹é‡æ’å…¥/æ›´æ–°æ—¶çš„è¿›åº¦ï¼›</li>
<li>å¢åŠ  ISelect ToChunk åœæ­¢è¯»å–çš„é€»è¾‘æ§åˆ¶ #360ï¼›</li>
<li>å¢åŠ  FreeSql.Provider.PostgreSQL NetTopologySuite ç±»å‹æ˜ å°„ï¼Œä¿ç•™ LegacyPostgis æ˜ å°„ #369ï¼›</li>
<li><strong>ä¿®å¤ DbSet/Repository æ‰¹é‡çº§è”ä¿å­˜(ExecuteInserted)å¤±è´¥çš„é—®é¢˜ #362</strong>ï¼›</li>
<li>ä¿®å¤ å¤šå¯¹å¤šå¯¼èˆªå±æ€§ AsSelect() æ— æ³•ä½¿ç”¨ .Count() çš„é—®é¢˜ #362ï¼›</li>
<li>ä¿®å¤ WhereDynamicFilter å¤šçº§ Logic æœªç”Ÿæ•ˆçš„ bugï¼›</li>
<li>ä¿®å¤ WhereDynamicFilter åœ¨ System.Text.Json ä¸‹çš„é—®é¢˜ #371ï¼›</li>
<li>ä¿®å¤ pgsql dbfirst æœªå¤„ç†æ•°ç»„ç±»å‹ç”Ÿæˆçš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ dm7 dbfirst SQL ä¸­å­˜åœ¨ç‰¹æ®Šå­—ç¬¦çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ æ‰¹é‡æ’å…¥çš„æ—¶å€™æŠ¥é”™ System.DivideByZeroException #365ï¼›</li>
<li>ä¿®å¤ CodeFirst + AsTable + è‡ªåŠ¨è¿ç§»ï¼Œå¯¼è‡´ç´¢å¼•åé‡å¤çš„é—®é¢˜ #366ï¼›</li>
<li>ä¿®å¤ GroupBy(..).Count() å¼€å¯å‚æ•°åŒ–æ— æ•ˆçš„ bug #390ï¼› UseGenerateCommandParameterWithLambda</li>
<li><strong>è¡¥å…… fsql.InsertOrUpdate IfExistsDoNothing æ•°æ®å­˜åœ¨æ—¶ä¸åšä»»ä½•äº‹(ä¸æ›´æ–°)</strong>ï¼›</li>
<li>è¡¥å…… Ado.ExecuteDataTable Columns åŒ…å« DataType ä¿¡æ¯ï¼›</li>
<li>è¡¥å…… EFCore StringLengthAttribute/DatabaseGeneratedAttribute ç‰¹æ€§çš„æ”¯æŒï¼›</li>
<li>è¡¥å…… FreeSql.Extensions.Linq ThenBy/ThenByDescending æ‰©å±•æ–¹æ³• #380ï¼›</li>
<li>ä¼˜åŒ– FreeSql.Generator ç”Ÿæˆå®ä½“ç±»çš„æ—¶å€™å¤„ç†æ•°æ®åº“é»˜è®¤å€¼ï¼›</li>
<li><strong>è°ƒæ•´ FreeSql.Provider.SqlServer å¼•ç”¨ Microsoft.Data.SqlClient #391</strong>ï¼›</li>
</ul>
<h2 id="v1-6-0" tabindex="-1"> v1.6.0</h2>
<ul>
<li><strong>å¢åŠ  äººå¤§é‡‘ä»“ OdbcKingbaseES å®ç°ï¼›#325</strong></li>
<li><strong>å¢åŠ  ç¥èˆŸé€šç”¨ ShenTong å®ç°ï¼›</strong></li>
<li><strong>å¢åŠ  WhereDynamicFilter æ“ä½œç¬¦ Range/DateRange/Any/NotAnyï¼Œå®ç°èŒƒå›´/æ—¥æœŸèŒƒå›´/In æŸ¥è¯¢ï¼›</strong></li>
<li><strong>å¢åŠ  ISelect.AsTreeCte() é€’å½’æŸ¥è¯¢æ ‘è¡¨ï¼ˆå‘ä¸‹æˆ–å‘ä¸Šï¼‰ï¼›</strong></li>
<li>å¢åŠ  IUnitOfWork Orm å±æ€§ç›´æ¥è®¿é—® IFreeSql CRUD äº‹åŠ¡ä¸å·¥ä½œå•å…ƒä¸€è‡´ï¼›</li>
<li><strong>å¢åŠ  SqlExt å¸¸ç”¨å¼€çª—å‡½æ•°çš„è‡ªå®šä¹‰è¡¨è¾¾å¼è§£æï¼›</strong></li>
<li>å¢åŠ  SqlExt.Case().When(..).End() è‡ªå®šä¹‰è¡¨è¾¾å¼è§£æï¼›</li>
<li>å¢åŠ  SqlExt.GroupConcat MySql å‡½æ•°è§£æï¼›</li>
<li>å¢åŠ  StringLength/MaxLength å¯¹ byte[] çš„æ”¯æŒï¼›</li>
<li>ä¿®å¤ IFreeSql.InsertOrUpdate Merge into æœªå¤„ç† CanUpdate çš„é—®é¢˜ï¼›#330</li>
<li>ä¿®å¤ IUpdate Set(è¡¨è¾¾å¼) MapType æœªç”Ÿæ•ˆçš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ è¡¨è¾¾å¼ Not ä½è¿ç®—ç¬¦è§£æé”™è¯¯ï¼›#340</li>
<li>ä¿®å¤ Expression Or/And æ‰©å±•æ–¹æ³•åœ¨å¤šè¡¨ä¸­å¯èƒ½å­˜åœ¨çš„é”™è¯¯ï¼›</li>
<li>ä¿®å¤ IncludeMany åªå¡«å……å­å±æ€§ä¸­åŒå‘å…³ç³»çš„ ManyToOne å¯¹è±¡å€¼ï¼›</li>
<li>ä¿®å¤ Select`2-10 ToOne/First æ²¡æœ‰å¤„ç† Limit(1) çš„ bugï¼›</li>
<li>ä¿®å¤ [JsonMap] å±æ€§åœ¨ lambda è¡¨è¾¾å¼ä¸­è§£æçš„ bugï¼›</li>
<li>ä¿®å¤ sqlserver è§£æ cast(.. as nvarchar) æˆªæ–­é•¿åº¦ 30 çš„é—®é¢˜ï¼›#335</li>
<li>ä¼˜åŒ– mysql StringLength/MaxLength -2 äº§ç”Ÿ LongText æ˜ å°„ï¼›</li>
<li>ä¼˜åŒ– å…¼å®¹ pgsql 9.4 CodeFirst/DbFirstï¼›</li>
<li>ä¼˜åŒ– sqlserver è¡¨ä¸­å¸¦ç‚¹ codefirstï¼›</li>
<li>æµ‹è¯• æ”¯æŒ mysql json ç±»å‹ï¼›</li>
</ul>
<h2 id="v1-5-0-å¥½ä¹…ä¸è§" tabindex="-1"> v1.5.0 (å¥½ä¹…ä¸è§)</h2>
<ul>
<li>ä¿®å¤ non public ctor #291ï¼›</li>
<li>ä¿®å¤ æµ®ç‚¹ç±»å‹ NoneParameter ä¸ä½¿ç”¨ç§‘å­¦å­—ç¬¦ä¸²è¡¨ç¤ºï¼›</li>
<li>ä¿®å¤ IgnoreColumns ç›¸å…³æ–¹æ³•è§£æè¡¨è¾¾å¼ a =&gt; new [] { &quot;Id&quot; .. } æ— æ•ˆçš„ bugï¼›</li>
<li>ä¿®å¤ Column(ServerTime=xxx) MySql ä¸‹æ— æ³•ä¿ç•™ç²¾åº¦çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ ISelect.ToDataTable(lambda) æœªä½¿ç”¨ AsProperty è¿”å›æ•°æ®ï¼›</li>
<li>ä¿®å¤ IUpdate.Set(a =&gt; a.xx = null) è¡¨è¾¾å¼è§£æ bugï¼›#311</li>
<li>ä¿®å¤ Enum ç±»å‹æ— å…ƒç´ æ—¶çš„é”™è¯¯ï¼›</li>
<li><strong>å¢åŠ  IFreeSql.InsertOrUpdate æ–¹æ³•ï¼›</strong></li>
<li><strong>å¢åŠ  ISelect.WhereDynamicFilter æ–¹æ³•å®ç°åŠ¨æ€è¿‡æ»¤æ¡ä»¶ï¼ˆä¸å‰ç«¯äº¤äº’ï¼‰ï¼›</strong></li>
<li><strong>å¢åŠ  è¡¨è¾¾å¼è§£æ yyyyMMdd å¸¸ç”¨ c# æ—¥æœŸæ ¼å¼åŒ–ï¼›</strong></li>
<li>å¢åŠ  WhereCascade/GlobalFilter è¡¨è¾¾å¼å­æŸ¥è¯¢çš„æ”¯æŒï¼›</li>
<li>å¢åŠ  [Description] å…ƒæ•°æ®æ³¨é‡Šï¼Œä¼˜å…ˆçº§ä½äº c# ä»£ç æ³¨é‡Šï¼›</li>
<li>å¢åŠ  IUpdate.SetIf æ–¹æ³•ï¼›</li>
<li><strong>å¢åŠ  IUpdate.SetSourceIgnore æ–¹æ³•ï¼Œå¯å®ç°å¿½ç•¥ null å±æ€§çš„æ›´æ–°ï¼›</strong></li>
<li>å¢åŠ  FreeSqlBuilder.UseExitAutoDisposePool æ–¹æ³•ï¼›</li>
<li>ä¼˜åŒ– Guid GetDefaultValue å¯èƒ½å¯¼è‡´çš„é”™è¯¯ï¼›</li>
<li><strong>ä¼˜åŒ– ç§»é™¤ fsql.Transaction çº¿ç¨‹äº‹åŠ¡è¶…æ—¶æäº¤æœºåˆ¶ï¼›#323</strong></li>
<li>è°ƒæ•´ BaseEntityï¼Œç§»é™¤ BaseTreeEntityã€Tenant ç§Ÿæˆ·ï¼Œæ”¹å˜äº‹åŠ¡ä¹ æƒ¯ï¼›</li>
</ul>
<h2 id="v1-4-0" tabindex="-1"> v1.4.0</h2>
<ul>
<li><strong>å¢åŠ  FreeSql.Provider.Dameng åŸºäº DmProvider Ado.net è®¿é—®è¾¾æ¢¦æ•°æ®åº“ï¼›</strong></li>
<li><strong>å¢åŠ  FreeSql.DbContext OnModelCreating è™šæ–¹æ³•ï¼Œå®ç°åœ¨ DbContext ä½¿ç”¨ FluentApiï¼›</strong></li>
<li>å¢åŠ  FreeSql.DbContext ä¸ EFCore ç›¸ä¼¼çš„ FluentApi å¯¹åŠ¨æ€ç±»å‹çš„å¤„ç†ï¼›#281</li>
<li>ç§»é™¤ FreeSql.Extensions.EfCoreFluentApiï¼ŒåŠŸèƒ½ç§»è‡³ FreeSql.DbContextï¼›</li>
<li><strong>å¢åŠ  FreeSqlBuilder è‡ªåŠ¨è¯†åˆ« EFCore å®ä½“ç‰¹æ€§ Key/Required/NotMapped/Table/Columnï¼›</strong></li>
<li>å¢åŠ  IInsert InsertColumns/IgnoreColumns æ–¹æ³•é‡è½½è¾“å…¥ string[]ï¼›#275</li>
<li>å¢åŠ  DbFirst è·å–å­—æ®µçš„é»˜è®¤å€¼ä¿¡æ¯ï¼›</li>
<li>å¢åŠ  FreeSql.Generator -Match å‚æ•°åªç”ŸæˆåŒ¹é…çš„è¡¨ï¼›</li>
<li>å¢åŠ  FreeSql.Extensions.JsonMap FluentApi æ‰©å±•æ–¹æ³•ï¼›#279</li>
<li>å¢åŠ  DbFirst DbColumnInfo Position å±æ€§ï¼Œå­—æ®µé»˜è®¤ä½ç½®ï¼›</li>
<li><strong>å¢åŠ  UnitOfWorkManager å·¥ä½œå•å…ƒç®¡ç†å™¨ï¼Œå®ç°å¤šç§ä¼ æ’­äº‹åŠ¡ï¼Œç§»é™¤ UnitOfWork.Current é™æ€å±æ€§ï¼›</strong><a href="https://github.com/dotnetcore/FreeSql/issues/289" target="_blank" rel="noopener noreferrer">#289</a></li>
<li>å¢åŠ  DbContextOptions.EnableGlobalFilter è®¾ç½®æ˜¯å¦åœ¨ DbContext/Repository ä¸­å¯ç”¨å…¨å±€è¿‡æ»¤å™¨ï¼ˆé»˜è®¤ trueï¼‰ï¼›</li>
<li>ä¼˜åŒ– ä¸»é”® Guid è‡ªåŠ¨èµ‹å€¼çš„ä¼˜å…ˆçº§ï¼Œä½äº Aop.AuditValue äº‹ä»¶ï¼ˆå®ç°è‡ªå®šä¹‰ Guid å€¼ï¼‰ï¼›</li>
<li>ä¼˜åŒ– WhereDynamic ä¼ å…¥ string çš„æ—¶å€™è‡ªåŠ¨è½¬ä¸ºä¸»é”®çš„ç±»å‹å€¼ï¼›</li>
<li>ä¿®å¤ ISelect.From å†…éƒ¨ WhereIf äºŒæ¬¡è¡¨è¾¾å¼è§£æ bugï¼›
po</li>
<li><strong>å¢åŠ  GroupBy ToDictionary è¿”å›å­—æ®µçš„æŸ¥è¯¢æ–¹æ³•ï¼ŒTKey ä¸º GroupBy é€‰æ‹©çš„å¯¹è±¡ï¼›</strong></li>
<li>è°ƒæ•´ GroupBy æ‰€æœ‰æ–¹æ³•ä¸ä½¿ç”¨ DTO æ˜ å°„è§„åˆ™ï¼›</li>
<li>è°ƒæ•´ IUpdate.SetDto ä¹Ÿæ”¯æŒ IgnoreColumns çš„é€»è¾‘ï¼›</li>
<li>è°ƒæ•´ ISelect linq to sql å’Œ queryable å®ç°ä¾èµ–ç§»è‡³ FreeSql.Extensions.Linqï¼›</li>
</ul>
<h2 id="v1-3-5" tabindex="-1"> v1.3.5</h2>
<ul>
<li>ä¿®å¤ IncludeMany ç¬¬ 3 å±‚æ— æ³•åŠ è½½çš„é—®é¢˜ï¼ŒIncludeMany(a =&gt; a.Parent.Parent.Childs)ï¼›</li>
<li>ä¿®å¤ PostgreSQL CodeFirst/DbFirst ç³»ç»Ÿè¡¨çš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼›</li>
<li>å¢åŠ  EfCoreFluentApi HasData è®¾å®š CodeFirst ç§å­æ•°æ®ï¼›</li>
<li>å¢åŠ  DbContextOptions.NoneParameter è®¾ç½®æ˜¯å¦ä½¿ç”¨å‚æ•°åŒ–æ‰§è¡Œ Insert/Updateï¼›</li>
</ul>
<h2 id="v1-3-4" tabindex="-1"> v1.3.4</h2>
<ul>
<li><strong>è°ƒæ•´ Repository æ¥å£å®šä¹‰ï¼Œåˆå¹¶ä¸ºä¸€ä¸ª IBaseRepositoryï¼›</strong></li>
<li>è°ƒæ•´ ç§»é™¤å¯¹ System.ValueType çš„ä¾èµ–ï¼Œå‡å°‘ç‰ˆæœ¬å†²çªé—®é¢˜ï¼›ï¼ˆç›®å‰ FreeSql.dll æ— ä»»ä½•ä¾èµ–ï¼‰</li>
<li><strong>è°ƒæ•´ Oracle StringLength/MaxLength -1 æ—¶å€™æ˜ å°„ä¸º nclobï¼›</strong></li>
<li>è°ƒæ•´ IInsert/IUpdate NoneParameter æ–¹æ³•ï¼Œå¢åŠ å‚æ•° isNotCommandParameter å¯è®¾ç½®æ˜¯å¦ä½¿ç”¨å‚æ•°åŒ–ï¼›</li>
<li>è°ƒæ•´ FreeSqlBuilderï¼Œå‡†å¤‡ç§»é™¤ UseEntityPropertyNameConvert/UseSyncStructureToLower/UseSyncStructureToUpper æ–¹æ³•ï¼›<a href="https://github.com/2881099/FreeSql/issues/260" target="_blank" rel="noopener noreferrer">#260</a>ï¼›</li>
<li>ç§»é™¤ In å¤šåˆ—è¡¨è¾¾å¼å‡½æ•°è§£æ <a href="https://github.com/2881099/FreeSql/issues/243" target="_blank" rel="noopener noreferrer">#243</a>ï¼›</li>
<li>ä¼˜åŒ– IncludeMany æ‰©å±•æ–¹æ³•å¯¹ T1 ä¸è‡ªåŠ¨è¿ç§»ï¼›</li>
<li>ä¼˜åŒ– BulkCopy å¯¹å¯ç©ºç±»å‹çš„å±æ€§å¤„ç†ï¼› <a href="https://github.com/2881099/FreeSql/issues/227" target="_blank" rel="noopener noreferrer">#227</a></li>
<li>ä¼˜åŒ– IAdo.Query æ–¹æ³•ï¼Œå½“ä¼ å…¥å¸¦ä¸»é”®ç‰¹æ€§çš„å®ä½“æ—¶ï¼Œé˜²æ­¢ä¸»é”®åˆ—ä¸º null æ—¶å¯¼è‡´æ•´è¡Œè®°å½•ä¹Ÿä¸º nullï¼›</li>
<li>ä¼˜åŒ– TableInfo å…ƒæ•°æ®å¯¹ interface å®ç°ç±» IsVirtual é‡å†™çš„åˆ¤æ–­ï¼ˆå¢åŠ  IsFinal == falseï¼‰ï¼›</li>
<li>ä¼˜åŒ– Navigate å±æ€§æœªè®¾ç½® set æ—¶çš„å‹å¥½é”™è¯¯æç¤ºï¼›</li>
<li>ä¼˜åŒ– å»¶æ—¶å±æ€§é‡å†™ç±»å¯¹ protected set çš„æ”¯æŒï¼›</li>
<li><strong>ä¼˜åŒ– ConnectionPool æå‡è¢«åŠ¨è¿æ¥æ–­å¼€çš„ä½“éªŒï¼ˆä¼šå¡çš„å¯ä»¥å‡çº§ï¼‰ï¼›</strong></li>
<li>ä¼˜åŒ– é›†åˆå¯¼èˆªå±æ€§è¡¨è¾¾å¼ä¸­å¿˜è®°ä½¿ç”¨ AsSelect() çš„å‹å¥½é”™è¯¯æç¤ºï¼›</li>
<li><strong>å¢åŠ  FreeSqlBuilder UseNameConvert æ–¹æ³•ï¼Œç±»åã€å±æ€§åéƒ½ç”Ÿæ•ˆï¼›</strong></li>
<li><strong>å¢åŠ  CodeFirst å®ä½“ç±»æ³¨é‡Š -&gt; è¡¨å¤‡æ³¨ï¼Œä¹‹å‰åªèƒ½å±æ€§æ³¨é‡Š -&gt; å­—æ®µå¤‡æ³¨ï¼›</strong></li>
<li>å¢åŠ  FreeSql.Generator Sqlite æ•°æ®åº“ç”Ÿæˆå®ä½“ç±»ï¼›</li>
<li><strong>å¢åŠ  Sqlite DbFirst å®ç°ï¼›</strong></li>
<li>å¢åŠ  Oracle clob/nclob å¤§æ–‡æœ¬ç±»å‹è¯»å†™æ”¯æŒï¼›<a href="https://github.com/2881099/FreeSql/issues/259" target="_blank" rel="noopener noreferrer">#259</a>ï¼›</li>
<li><strong>å¢åŠ  ISelect.ToTreeList æ‰©å±•æ–¹æ³•æŸ¥è¯¢æ•°æ®ï¼ŒåŠ å·¥ä¸ºæ ‘å‹ Listï¼›(æ³¨æ„ï¼šå®ä½“éœ€è¦é…ç½®çˆ¶å­å¯¼èˆªå±æ€§)</strong></li>
<li>å¢åŠ  ISelect`1 ToDictionary æ–¹æ³•æŸ¥è¯¢è¿”å›å­—å…¸ï¼›</li>
<li>å¢åŠ  Pgsql JToken/JObject/JArray ç´¢å¼•è®¿é—®çš„è¡¨è¾¾å¼è§£æï¼›</li>
<li>å¢åŠ  object.Equals è¡¨è¾¾å¼è§£æï¼›</li>
<li>å¢åŠ  ISelect`1 AsQueryable æ–¹æ³•ï¼Œå®ç°å°† ISelect è½¬æ¢ä¸º IQueryable ç±»å‹ï¼›</li>
<li>å¢åŠ  ISelect.RawJoin æ–¹æ³•ä»¥ä¾¿å®ç° Outer Apply æŸ¥è¯¢ï¼›<a href="https://github.com/2881099/FreeSql/issues/200" target="_blank" rel="noopener noreferrer">#200</a>ï¼›</li>
<li>å¢åŠ  IAdo.ConnectionString å±æ€§è¿”å› UseConnectionString ä¼ å…¥çš„å€¼ï¼›</li>
<li>å®Œå–„ è¡¨è¾¾å¼æ‹¼æ¥æ–¹æ³•ï¼Œä» T1-T5ï¼›<a href="https://github.com/2881099/FreeSql/issues/256" target="_blank" rel="noopener noreferrer">#256</a>ï¼›</li>
<li>ä¿®å¤ å› å…¼å®¹ <a href="https://github.com/2881099/FreeSql/issues/184" target="_blank" rel="noopener noreferrer">#184</a> å¯¼è‡´ MySql Enum è¡¨è¾¾å¼è§£æä¸º int çš„ bugï¼›</li>
<li>ä¿®å¤ FreeSql.Provider.MySqlConnector Enum è‡ªå®šä¹‰å…ƒç´ å€¼ï¼Œå¯¼è‡´å€¼è®¡ç®—é”™è¯¯çš„ bugï¼›</li>
<li>ä¿®å¤ SqlServer charindex è¡¨è¾¾å¼å‡½æ•°å‚æ•°ä½ç½®çš„é”™è¯¯ï¼›</li>
<li>ä¿®å¤ MySql locate è¡¨è¾¾å¼å‡½æ•°å‚æ•°ä½ç½®çš„é”™è¯¯ï¼›</li>
<li>ä¿®å¤ UseGenerateCommandParameterWithLambda(true) æ—¶å­è¯­å¥çš„å‚æ•°æ²¡æ•´åˆåˆ°ä¸»è¯­å¥ï¼›<a href="https://github.com/2881099/FreeSql/issues/231" target="_blank" rel="noopener noreferrer">#231</a>ï¼›</li>
<li>ä¿®å¤ æœ¬åœ°åŒºåŸŸåŒ–å ToSql äº§ç”Ÿçš„é”™è¯¯ï¼Œæ¯”å¦‚æ•°å­—å¯èƒ½ç”Ÿæˆ SQL ä¸ºï¼š100,000ï¼›</li>
<li>ä¿®å¤ StringLength/MaxLength å¯¹ Oracle varchar2 ç±»å‹æ— æ•ˆçš„ bugï¼›</li>
<li>ä¿®å¤ CodeFirst IsNullable è¿ç§»è„šæœ¬é‡å¤ NOT NULL è¯­æ³•é”™è¯¯ï¼›</li>
<li><strong>ä¿®å¤ DbFirst Oracle/Dameng åºåˆ—å€¼ä½¿ç”¨å¤æ‚çš„é—®é¢˜ï¼Œç»“åˆ [Column(InsertValueSql = &quot;xxx.nextval&quot;)]ï¼›</strong></li>
</ul>
<h2 id="v1-2-1" tabindex="-1"> v1.2.1</h2>
<ul>
<li>è°ƒæ•´ Aop æ”¹ä¸º event äº‹ä»¶ï¼›</li>
<li>è°ƒæ•´ Ado.AopCommandExecuting/AopCommandExecuted åˆ° Aop.CommandBefore/Afterï¼›</li>
<li>å¢åŠ  Aop.TraceBefore/After äº‹ä»¶ï¼›</li>
<li>ä¿®å¤ ToList çˆ¶å­å¯¼èˆªå¯èƒ½åŒ¹é…ä¸æ­£ç¡®çš„ bugï¼›</li>
<li>ä¿®å¤ è¯»å†™åˆ†ç¦»åˆ›å»º IFreeSql æ—¶å¦‚æœä»åº“ä¸å¯ç”¨å¯¼è‡´ iis é€€å‡ºçš„ bugï¼›</li>
<li>è°ƒæ•´ DbContext/Repository EnableAddOrUpdateNavigateList é»˜è®¤å…³é—­ï¼›</li>
<li>ä¿®å¤ DbContext/Repository SaveMany ä¸€å¯¹å¤šä¿å­˜æ—¶åˆ é™¤æ¡ä»¶ bugï¼›</li>
<li>å¢åŠ  BaseEntity SaveMany æ–¹æ³•ï¼›</li>
<li>ä¿®å¤ LazyLoading ä¾èµ–é¡¹ç›® CSScript.Core å‡çº§çš„ bugï¼›</li>
</ul>
<h2 id="v1-2-0" tabindex="-1"> v1.2.0</h2>
<ul>
<li>ä¿®å¤ ToList(a =&gt; new Dto {}) è¿™ç§æƒ…å†µæŒ‰å­—æ®µååŒ¹é…é—®é¢˜ï¼Œåº”è¯¥æŒ‰å±æ€§åï¼›<a href="https://github.com/2881099/FreeSql/issues/208" target="_blank" rel="noopener noreferrer">#208</a></li>
<li>å¢åŠ  nuget åŒ…å¼ºç­¾åå‘å¸ƒï¼›<a href="https://github.com/2881099/FreeSql/issues/201" target="_blank" rel="noopener noreferrer">#201</a></li>
<li>å®Œå–„ IUpdate.SetSource ç»„åˆä¸»é”®çš„æ•°æ®æ›´æ–°å•å…ƒæµ‹è¯•ï¼›</li>
<li>ä¿®å¤ Oracle å¯¼èˆªå±æ€§ è¡¨åˆ«åè¿‡é•¿çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ DbSet.Where è¡¨è¾¾å¼è§£ææŠ¥é”™çš„é—®é¢˜ï¼›<a href="https://github.com/2881099/FreeSql/issues/216" target="_blank" rel="noopener noreferrer">#216</a></li>
<li>ä¿®å¤ DbContext/Repository Update ä¸æ›´æ–° DbUpdateValue çš„é—®é¢˜ï¼›<a href="https://github.com/2881099/FreeSql/issues/219" target="_blank" rel="noopener noreferrer">#219</a></li>
<li>å¢åŠ  IUpdate.SetDto æ ¹æ® dto æ›´æ–°çš„æ–¹æ³•ï¼›<a href="https://github.com/2881099/FreeSql/issues/218" target="_blank" rel="noopener noreferrer">#218</a></li>
<li>ä¿®å¤ EfFluentApi ä¸€ä¸ªå‚æ•°ç±»å‹é—®é¢˜ï¼›</li>
</ul>
<h2 id="v1-1-0" tabindex="-1"> v1.1.0</h2>
<ul>
<li>ä¿®å¤ BaseRepository.UnitOfWork å»¶è¿Ÿè®¾ç½®ï¼ˆå³äº‹åŠ¡å¼€å¯ä¹‹åå†è®¾ç½®ï¼‰æ— æ•ˆçš„ bugï¼›</li>
<li>ä¼˜åŒ– å‚è€ƒ Chloe è¡¨è¾¾å¼é’ˆå¯¹å˜é‡çš„è§£æï¼Œæå‡äº†ä¸€å€æ€§èƒ½ï¼›</li>
<li>ä¿®å¤ FreeSql.Generator å¤–é”®å¯¼èˆªå±æ€§å¤§å†™å° bugï¼›#177</li>
<li>ä¼˜åŒ– IsVersion å­—æ®µæ›´æ–° version=ifnull(version,0)+1ï¼Œé˜²æ­¢å­—æ®µä¸º null ä¸€ç›´æŠ¥é”™ï¼›</li>
<li>å®Œå–„ [Column(ServerTime = Utc)] ç‰¹æ€§ï¼Œå¯¹ Update æ—¶ä¹Ÿèƒ½ç”Ÿæ•ˆï¼›</li>
<li>å®Œå–„ [Column(MapType = typeof(byte[]))] å¯¹ Guid/string çš„æ˜ å°„æ”¯æŒï¼›#178</li>
<li>å®Œå–„ MapType byte[] å¯¹ Contains/Parse è¡¨è¾¾å¼è§£æçš„å¤„ç†ï¼›</li>
<li>ä¿®å¤ DbConnectionPool.Return åœ¨ Sqlite ä¸‹çš„ bugï¼›#179</li>
<li><strong>å¢åŠ  FreeSql.Provider.MySqlConnector æ‰©å±•æ–¹æ³• ExecuteMySqlBulkCopyï¼›</strong></li>
<li>ä¿®å¤ DbFirst mysql/pgsql/sqlserver è·å–ä¸»é”®å¤±è´¥çš„ bugï¼› 0.10.7 å‘å¸ƒåçš„ bug #182</li>
<li><strong>è§£å†³ è¡¨ååç§°åŒ…å«ç‚¹ï¼Œæ— æ³•è¿›è¡Œ CRUD çš„é—®é¢˜ï¼Œç”±äºæµ‹è¯•çš„å¤æ‚æ€§ï¼Œæ­¤ç±»æƒ…å†µä»…æ”¯æŒ MySql/Sqlite CodeFirst è‡ªåŠ¨è¿ç§»ï¼›</strong>
<blockquote>
<p>æ³¨æ„ï¼šå°½é‡ä¸è¦ä½¿ç”¨å¸¦ç‚¹çš„è¡¨åï¼Œåªæœ‰ MySql/Sqlite å¯¹æ­¤ç±»è¡¨åæ”¯æŒ CodeFirstã€‚ä½†æ˜¯å®ƒä¸å½±å“ CRUD åŠŸèƒ½ï¼Œä½¿ç”¨ [Table(Name = &quot;`sys.config`&quot;)] è§£å†³</p>
</blockquote>
</li>
<li>å¢åŠ  FreeSql.All å…¨å®¶æ¡¶åŒ…ï¼Œæ‡’äººä¸“ç”¨ï¼›</li>
<li>ä¿®å¤ GroupBy ç±»å‹è½¬æ¢é”™è¯¯ï¼›#186</li>
<li>ä¿®å¤ .ToList(a =&gt; new DTO(a.id)) æŠ¥ æœªå°†å¯¹è±¡å¼•ç”¨è®¾ç½®åˆ°å¯¹è±¡çš„å®ä¾‹ é—®é¢˜ï¼› #187</li>
<li>ä¿®å¤ update è¯­å¥ï¼ŒäºŒå…ƒè¿ç®—è§£æå‡ºé”™ï¼› #184</li>
<li>ä¿®å¤ xamarin ios çœŸæœºæ— æ³•ä½¿ç”¨ Sqlite çš„é—®é¢˜ï¼› #183</li>
<li><strong>æ”¯æŒ Sqlite :memory: æ¨¡å¼ï¼› #191</strong></li>
<li>ä¼˜åŒ– IdleTimeout é»˜è®¤å€¼ä¸º 20 ç§’ï¼› #194</li>
<li>ä¿®å¤ çˆ¶å­å…³ç³»å¯¼èˆªå±æ€§ Dto ä¸­ç›´æ¥ä½¿ç”¨ a.Parent æ˜ å°„é”™è¯¯çš„ bugï¼›</li>
</ul>
<h2 id="v1-0-1" tabindex="-1"> v1.0.1</h2>
<ul>
<li>ä¿®å¤ NoneParameter æ— å‚å¯¹ byte[] äºŒè¿›åˆ¶æ‹¼æ¥çš„ bugï¼›#170</li>
<li>è°ƒæ•´ æœ€å¤§è¿æ¥æ± ä¸º +5ï¼ˆå±äºå†…éƒ¨è®¾ç½®ï¼‰ï¼›</li>
<li>å¢åŠ  EfCoreFluentApi æ‰©å±•åŒ…ï¼Œæ¥è¿‘ efcore fluentApi çš„ä½¿ç”¨ä¹ æƒ¯ï¼›</li>
<li>å¢åŠ  ColumnAttribute å±æ€§ InsertValueSqlï¼Œæ’å…¥æ•°æ®çš„æ—¶å€™æŒ‡å®šç”¨ sql å€¼ï¼›</li>
<li><strong>å¢åŠ  ISelect`1.WithSql(&quot;select * from user ...&quot;) åŠŸèƒ½ï¼›</strong></li>
<li>å®Œå–„ PgSql OnConflictDoUpdate åŠŸèƒ½å¢åŠ  DO NOTHING æ“ä½œï¼›#174</li>
<li>ä¿®å¤ IAdo.Query&lt;object&gt; å­—æ®µåé‡å¤çš„ bugï¼›#162</li>
</ul>
<h2 id="v1-0-0" tabindex="-1"> v1.0.0</h2>
<ul>
<li>å¢åŠ  ISelect.ToSql å­—æ®µåˆ«åè®¾ç½®ï¼Œé»˜è®¤ä¸º AsIndexï¼Œå¯æ”¹ä¸º AsPropertyï¼›#158</li>
<li>ä¼˜åŒ– AsTable åˆ†è¡¨æŸ¥è¯¢ Any/Min/Max/Avg/Sum/Count çš„å¤„ç†ï¼›#158</li>
<li>ä¼˜åŒ– BaseEntity Select æŸ¥è¯¢æ•°æ®æ—¶è‡ªåŠ¨ Attachï¼›</li>
<li>ä¼˜åŒ– æ²¡æœ‰ä¸»é”®çš„å®ä½“ï¼Œçº¦å®š id å‘½åçš„å±æ€§ä¸Šè‹¥è®¾ç½®äº† IsPrimary = falseï¼Œåˆ™å…¶ä¸å±äºçº¦å®šä¸»é”®ï¼›</li>
<li>ä¼˜åŒ– ISelect.Count() ä¹‹å‰ä½¿ç”¨äº† OrderBy ä¼šäº§ç”Ÿçš„ SQL è¯­æ³•é—®é¢˜ï¼›</li>
<li>è°ƒæ•´ Avg æ–¹æ³•è¿”å›å€¼ä¸º doubleï¼ŒSum æ–¹æ³•è¿”å›å€¼ä¸º decimalï¼›</li>
<li>å®Œå–„ Select`2-10 å¤šè¡¨æŸ¥è¯¢å¯¹è±¡ï¼Œå¢åŠ  First(select)/ToOne(select)/First&lt;Dto&gt; æ–¹æ³•ï¼›</li>
<li>ä¿®å¤ LazyLoading åœ¨ Net4 ç¯å¢ƒä¸‹çš„é—®é¢˜ï¼›</li>
<li>å¢åŠ  FreeSql.Generator -Filter è®¾ç½®é€‰é¡¹ï¼Œå¯é˜»æ­¢å­˜å‚¨è¿‡ç¨‹+è§†å›¾çš„ç”Ÿæˆï¼›</li>
<li>å¢åŠ  FreeSql.Generator åœ¨ç›®æ ‡ç›®å½•äº§ç”Ÿ __razor.cshtml.txt æ–‡ä»¶ï¼Œä»¥ä¾¿è‡ªå®šä¹‰ä¿®æ”¹æ¨¡æ¿ç”Ÿæˆï¼›</li>
<li><strong>å¢åŠ  IInsert/IUpdate BatchOptions æ–¹æ³•æŒ‡å®šæ‰¹é‡æ’å…¥çš„è®¾ç½®ï¼›</strong></li>
<li>å¢åŠ  IInsert.ToDataTable æ–¹æ³•ï¼Œä¸º BulkCopy æ“ä½œæä¾›æ•°æ®ï¼Œè¯¥æ–¹æ³•å¤„ç†äº†(è¡¨åã€å­—æ®µåã€ç±»å‹ï¼‰æ˜ å°„å’Œå¿½ç•¥åˆ—ï¼›</li>
<li><strong>å¢åŠ  IInsert.ExecuteSqlBulkCopy æ‰©å±•æ–¹æ³•æ‰§è¡Œ SqlBulkCopy æ‰¹é‡æ’å…¥ï¼Œåœ¨ FreeSql.Provider.SqlServer å¯ç”¨ï¼›</strong></li>
<li><strong>å¢åŠ  IInsert.ExecutePgCopy æ‰©å±•æ–¹æ³•æ‰§è¡Œ PostgreSQL Copy æ‰¹é‡å¯¼å…¥ï¼Œåœ¨ FreeSql.Provider.PostgreSQL å¯ç”¨ï¼›</strong></li>
<li>å¢åŠ  ISelectGrouping åˆ†ç»„æŸ¥è¯¢æ€»é‡çš„æ–¹æ³• .Count()ï¼›</li>
<li>å…¼å®¹ Vb.Net æ— æ³•ä½¿ç”¨ IncludeMany çš„é—®é¢˜ï¼›</li>
<li>å…¼å®¹ Vb.Net æ— æ³•ä½¿ç”¨ int? ç±»å‹ = ç­‰å·è¡¨è¾¾å¼è§£æï¼›</li>
<li>ä¼˜åŒ– å®ä½“åŸºç±»çš„å±æ€§ä½ç½®ï¼Œä¼˜å…ˆæ’åœ¨æœ€å‰é¢ï¼›</li>
<li>æ•´ç† å®ä½“ç±» Ctor æœ‰æ„é€ å‡½æ•°çš„æ˜ å°„å¤„ç†ï¼›</li>
<li>ä¼˜åŒ– å®ä½“å±æ€§ï¼Œæ”¯æŒ protected set å±æ€§ï¼›</li>
<li>ä¿®å¤ Ado.Query æŸ¥è¯¢å­—æ®µé‡å¤æ—¶æŠ¥é”™ï¼›#162</li>
<li><strong>å¢åŠ  FreeSql.Provider.MsAccess æ”¯æŒ Access æ•°æ®åº“æ“ä½œï¼Œå·²é€šè¿‡ 2003/2007 ç‰ˆæœ¬æµ‹è¯•ï¼›</strong></li>
</ul>
<h2 id="v0-12-21" tabindex="-1"> v0.12.21</h2>
<ul>
<li>å¢åŠ  Where In è¡¨è¾¾å¼è§£æï¼›</li>
<li><strong>å¢åŠ  FreeSqlBuilder.UseConnectionFactory è‡ªå®šä¹‰æ•°æ®åº“è¿æ¥å¯¹è±¡çš„åˆ›å»ºæ–¹æ³•ï¼›</strong></li>
<li>å…¼å®¹ Vb.Net è¡¨è¾¾å¼è§£æå­—ç¬¦ä¸² = åˆ¤æ–­ï¼›</li>
<li>ä¼˜åŒ– GlobalFilter è¿‡æ»¤å™¨è¡¨è¾¾å¼ bool è§£æï¼›</li>
<li>ä¿®å¤ ISelect.AsTable union all æŸ¥è¯¢å¯¹ count/max/min/avg/sum çš„åˆ«å bugï¼›</li>
</ul>
<h2 id="v0-12-20" tabindex="-1"> v0.12.20</h2>
<ul>
<li><strong>å¢åŠ  ISelect.ForUpdate æ’ä»–æ›´æ–°é”ï¼ˆæ ¹æ®æ•°æ®åº“ç±»å‹çš„è§„åˆ™ï¼Œè§ä»£ç æ³¨é‡Šï¼‰ï¼›</strong></li>
<li><strong>å®Œå–„ SqlServer WithLock åŠŸèƒ½ï¼Œç»„åˆå¤šç§ä½¿ç”¨ | æšä¸¾ç›¸è”ï¼›</strong></li>
<li>è¡¥å…… åŒçº¿ç¨‹æ—¶é—´ fsql.Transaction äº‹åŠ¡ç­‰çº§å‚æ•°çš„ä¼ å…¥ï¼›</li>
<li>è°ƒæ•´ fsql.Transaction(Action, Timeout) å‚æ•°é¡ºåºï¼›</li>
<li>ä¿®å¤ FreeSql.Generator NameOptions å‚æ•°æœªè®¾ç½®æ—¶çš„é”™è¯¯ï¼›</li>
</ul>
<h2 id="v0-12-18" tabindex="-1"> v0.12.18</h2>
<ul>
<li>ä¿®å¤ Oracle Dbfirst å­—æ®µå¯ç©ºã€å’Œä¸»é”®åˆ¤æ–­çš„ bugï¼›</li>
</ul>
<h2 id="v0-12-16-è¾¾æ¢¦æ•°æ®åº“" tabindex="-1"> v0.12.16(è¾¾æ¢¦æ•°æ®åº“)</h2>
<ul>
<li><strong>å¢åŠ  è¾¾æ¢¦æ•°æ®åº“ ODBC é€‚é…ï¼Œå’Œå•å…ƒæµ‹è¯•ï¼Œæ”¯æŒ CodeFirst æ¨¡å¼å¼€å‘ï¼›</strong></li>
<li>å¢åŠ  BaseEntity ç‰©ç†åˆ é™¤æ–¹æ³• Delete(true)ï¼›</li>
<li>ä¿®å¤ ToList((a,b) =&gt; new { a, b }) å½“ b ä¸º null çš„æ—¶å€™ï¼Œåº”è¯¥æ•´ä¸ª b ä¸º nullï¼›(å¯¼èˆªå±æ€§æ²¡è¿™ä¸ªé—®é¢˜)</li>
<li>ä¿®å¤ Sqlite attachs é™„åŠ æ•°æ®åº“åˆ«å bugï¼›</li>
<li>ä¿®å¤ Select&lt;T1, T2&gt; AsTable ææ„å‡½æ•°å¤„ç†å¯èƒ½äº§ç”Ÿ bugï¼›</li>
<li>æ•´ç† è¯»å†™åˆ†ç¦»çš„æŸ¥è¯¢ä»£ç ï¼›</li>
</ul>
<h2 id="v0-12-12" tabindex="-1"> v0.12.12</h2>
<ul>
<li>ä¿®å¤ DbContext TrackList å¯¹åŒ¿åå¯¹è±¡å¤„ç†çš„ bugï¼›<a href="https://github.com/2881099/FreeSql/issues/150" target="_blank" rel="noopener noreferrer">#150</a></li>
</ul>
<h2 id="v0-12-11" tabindex="-1"> v0.12.11</h2>
<ul>
<li>å¢åŠ  RawValueAttribute å®ç°è‡ªå®šä¹‰è¡¨è¾¾å¼æ—¶ï¼Œä½¿ç”¨åŸå§‹å€¼ä¼ å…¥å‚æ•°ï¼›</li>
<li>å¢åŠ  IEnumerable&lt;(T1, T2)&gt;.Contains(col1, col2) æ‰©å±•æ–¹æ³•ï¼Œå®ç°è‡ªå®šä¹‰è¡¨è¾¾å¼è§£æå¤šåˆ—æ— æ³• IN çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ å¤šè¡¨æŸ¥è¯¢ WhereCascadeï¼Œå¦‚æœ Join æ²¡æœ‰ On æ¡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç”Ÿæˆçš„ SQL å¤šäº†ä¸€ä¸ª AND å‡ºé”™ï¼›</li>
<li>ä¿®å¤ SaveMany ç¼“å­˜ä¿å­˜åˆ—åæ‰¾ä¸åˆ°çš„é”™è¯¯æç¤ºï¼›</li>
</ul>
<h2 id="v0-12-9" tabindex="-1"> v0.12.9</h2>
<ul>
<li>å¢åŠ  DateTime æ‰©å±•æ–¹æ³• Between å’Œ BetweenEnd è‡ªå®šä¹‰è¡¨è¾¾å¼ï¼›</li>
<li>ä¿®å¤ Dto æ˜ å°„ï¼Œåœ¨äºŒçº§å³ Dto å±æ€§ä¸Šåˆ new Dto çš„æ—¶å€™ï¼Œé”™è¯¯çš„åˆé‡å¤æ˜ å°„äº†å…¨éƒ¨å­—æ®µï¼›</li>
</ul>
<h2 id="v0-12-8" tabindex="-1"> v0.12.8</h2>
<ul>
<li>ä¼˜åŒ– IncludeMany çº§è”æŸ¥è¯¢æ”¯æŒå¼‚æ­¥é€‚é…ï¼ˆä¹‹å‰æ˜¯åŒæ­¥æ–¹å¼ï¼‰ï¼›</li>
<li>ä¼˜åŒ– MaxLength åŠŸèƒ½ï¼Œå¹¶ä¸”å¢åŠ  [Column(StringLength = 100)] åŒç­‰çš„ç‰¹æ€§åŠŸèƒ½ï¼›</li>
<li>ä¼˜åŒ– GlobalFilter Apply è‡ªåŠ¨é‡å‘½åè¡¨è¾¾å¼å‚æ•°åï¼Œé¿å…å†…å®¹é‡å¤é—®é¢˜ï¼›</li>
<li>ä¿®å¤ è¡¨è¾¾å¼è§£æ Guid.NewGuid() çš„é”™è¯¯ï¼›</li>
<li>è¡¥å…… GetTableByEntity å½“å±æ€§åæˆ–ç‰¹æ€§åé‡å¤æ—¶çš„å‹å¥½é”™è¯¯æç¤ºï¼›</li>
</ul>
<h2 id="v0-12-7" tabindex="-1"> v0.12.7</h2>
<ul>
<li>ç§»é™¤ Lazy å»¶æ—¶åŠ è½½åŠ¨æ€ä»£ç ä¸­çš„ Newtonsoft.Json ä¾èµ–ï¼›</li>
</ul>
<h2 id="v0-12-6" tabindex="-1"> v0.12.6</h2>
<ul>
<li>ä¼˜åŒ– ReadAnonymous æ˜ å°„ç±»å‹ä¸ä¸€è‡´çš„å®¹é”™ï¼›</li>
<li>ä¿®å¤ Oracle/Sqlite IInsert.ExecuteInserted æ–¹æ³•ï¼Œè¿”å›äº†è¢« clear è¿‡åçš„ _sourceï¼Œå…¶å®æœ¬æ¥ä¹Ÿæ²¡æ„ä¹‰ï¼›</li>
<li>ä¿®å¤ DbContext SaveMany å¯¹æ¯”åˆ é™¤çš„ bugï¼›</li>
</ul>
<h2 id="v0-12-5" tabindex="-1"> v0.12.5</h2>
<ul>
<li><strong>å¢åŠ  å®ä½“ç‰¹æ€§ [Column(ServerTime = DateTimeKind.Utc)] ä½¿ç”¨æ•°æ®åº“æ—¶é—´æ‰§è¡Œæ’å…¥æ•°æ®ï¼›</strong></li>
<li>ä¿®å¤ ToList(a =&gt; new Dto { .. }) åœ¨ä½¿ç”¨ GroupBy ä¹‹åæŠ¥é”™çš„ bugï¼›</li>
<li>ä¿®å¤ æ³¨é‡Šè¿ç§»åˆ°æ•°æ®åº“ï¼Œåœ¨ asp.net 4.7 æ— æ•ˆçš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ æ‰¹é‡æ’å…¥ Values æ•°é‡é™åˆ¶è¶…å‡ºçš„åˆ¤æ–­ï¼›</li>
</ul>
<h2 id="v0-12-3" tabindex="-1"> v0.12.3</h2>
<ul>
<li>å¢åŠ  ICodeFirst.IsGenerateCommandParameterWithLambda é€‰é¡¹ï¼Œå¼€å¯è¡¨è¾¾å¼è§£æçš„å‘½ä»¤å‚æ•°åŒ–ï¼›
<blockquote>
<p>FreeSqlBuilder ä¸Šä½¿ç”¨ UseGenerateCommandParameterWithLambda(true) å¼€å¯</p>
</blockquote>
</li>
<li>ä¼˜åŒ– ExpressionCallContext å¯è®¾ç½®ã€é™„åŠ å‚æ•°åŒ–å¯¹è±¡ï¼›</li>
<li>ä¿®å¤ IncludeMany(a =&gt; a.x1.x2.Childs) å½“ x1, x2 ä¸º null çš„æŠ¥ null é”™è¯¯ï¼›</li>
</ul>
<h2 id="v0-11-24" tabindex="-1"> v0.11.24</h2>
<ul>
<li><strong>å¢åŠ  Repository/DbContext SaveMany æ–¹æ³•å®ç°ä¸€å¯¹å¤šï¼Œå­æ•°æ®çš„å®Œæ•´ä¿å­˜ï¼›</strong></li>
<li>è°ƒæ•´ SaveManyToMany æ–¹æ³•åä¸º SaveManyï¼›</li>
<li>å¢åŠ  UnitOfWork é™æ€å±æ€§ DebugBeingUsedï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒç›‘è§†æ­£åœ¨ä½¿ç”¨ä¸­çš„äº‹åŠ¡ï¼›</li>
</ul>
<h2 id="v0-11-23" tabindex="-1"> v0.11.23</h2>
<ul>
<li><strong>å¢åŠ  ExpressionCallAttribute ç‰¹æ€§ï¼Œå®ç°è¡¨è¾¾å¼å‡½æ•°è‡ªå®šä¹‰è§£æï¼›</strong></li>
<li>ä¼˜åŒ– Contains è¡¨è¾¾å¼è§£æä¸º where in è‡ªåŠ¨æ‹†åˆ†ï¼Œé˜²æ­¢å¤§äº 1000 çš„ SQL é”™è¯¯ï¼Œå¦‚ä¸‹ï¼š</li>
</ul>
<div><pre><code><span><span>var</span></span> arr <span>=</span> Enumerable<span>.</span><span>Range</span><span>(</span><span>1</span><span>,</span> <span>1333</span><span>)</span><span>.</span><span>ToArray</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> sql <span>=</span> fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> arr<span>.</span><span>Contains</span><span>(</span>a<span>.</span>Int<span>)</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>//åŸæ¥ï¼šwhere id in (1..1333)</span>
<span>//ç°åœ¨ï¼šwhere id in (1..500) or id in (501..1000) or id in (1001..1333)</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><ul>
<li>ä¿®å¤ IsNulable ç‰¹æ€§ä¸ç”Ÿæ•ˆçš„ bugï¼›</li>
</ul>
<h2 id="v0-11-22" tabindex="-1"> v0.11.22</h2>
<ul>
<li><strong>å…¼å®¹ SqlServer nvarchar/varchar è¡¨è¾¾å¼è§£æï¼Œåˆ†åˆ«è§£æä¸ºï¼šN'' å’Œ ''ï¼Œä¼˜åŒ–ç´¢å¼•æ‰§è¡Œè®¡åˆ’ï¼›</strong></li>
<li><strong>å¢åŠ  MySql ç‰¹æœ‰åŠŸèƒ½ Insert Ignore Intoï¼›</strong></li>
</ul>
<h2 id="v0-11-21" tabindex="-1"> v0.11.21</h2>
<ul>
<li>ä¿®å¤ SqlServer DbFirstã€CodeFirst æŸ¥è¯¢å®ä½“è¡¨çš„åˆ—ä¿¡æ¯é”™è¯¯ï¼Œå½“è®¾ç½®äº†è¡¨/åˆ—å¤šä¸ªæ‰©å±•å±æ€§æ—¶å‘ç”Ÿï¼›</li>
<li>ä¿®å¤ SqlServer2005 CodeFirst è¿ç§»æ—¶ï¼Œä¸æ”¯æŒ SET (LOCK_ESCALATION TABLE) çš„é”™è¯¯ï¼ˆå·²åšé€‚é…ï¼‰ï¼›</li>
<li>ä¿®å¤ SqlServer2005 æ‰¹é‡æ’å…¥ SQL è¯­æ³•é”™è¯¯ï¼Œä¸æ”¯æŒ Values(),()ï¼ˆå·²åšé€‚é…ï¼‰ï¼›</li>
<li>å®Œå–„ SqlServer2005 ç¯å¢ƒè·‘é€šäº†æ‰€æœ‰å•å…ƒæµ‹è¯•ï¼›</li>
<li>ä¿®å¤ ReadAnonymous è¯»å–æ•°æ®è®¾ç½®åªè¯»å±æ€§çš„é”™è¯¯ï¼›#132</li>
</ul>
<h2 id="v0-11-20" tabindex="-1"> v0.11.20</h2>
<ul>
<li>å¢åŠ  IncludeMany è´ªå©ªåŠ è½½çš„æ—¶å€™å¯æŒ‡å®šå­è¡¨çš„å­—æ®µï¼Œé¿å…æŸ¥è¯¢å­è¡¨æ‰€æœ‰å­—æ®µï¼›</li>
<li>è°ƒæ•´ ToList(a =&gt; new å®ä½“ç±» { id = 1, title = a.xx.Title})ï¼Œå¦‚æœ dto ç±»å‹ä¸ºå®ä½“ç±»ï¼Œåˆ™è§„åˆ™ä¸ºåªæŸ¥è¯¢ id, title å­—æ®µï¼›
<blockquote>
<p>è¿™ä¸ªè§„åˆ™ä¸ v0.11.6 æœ‰å·®å¼‚ï¼Œå®ƒæ˜¯å…ˆæ˜ å°„ Dto æ‰€æœ‰å±æ€§ï¼Œå†æ˜ å°„ idã€titleï¼ŒåŒºåˆ«ï¼šä¸€ä¸ªæ˜¯ dto ç±»å‹ï¼Œä¸€ä¸ªæ˜¯æŸ¥è¯¢çš„å®ä½“ç±»å‹</p>
</blockquote>
</li>
<li>ä¿®å¤ Where(a =&gt; bool &amp;&amp; id &gt; 0) bool æœªè§£ææ­£ç¡®çš„ bugï¼›
<blockquote>
<p>ï¼ˆä¹‹å‰å¤§å¤šæ•°ç±»ä¼¼çš„è¡¨è¾¾éƒ½èƒ½è§£æï¼Œè¿™æ¬¡æ˜¯ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼‰</p>
</blockquote>
</li>
</ul>
<h2 id="v0-11-19" tabindex="-1"> v0.11.19</h2>
<ul>
<li>ä¿®å¤ MapType å±æ€§çš„è¡¨è¾¾å¼è§£æ æ•°ç»„.Contains å¾—åˆ°æ˜¯æ˜ å°„ä¹‹å‰çš„å€¼ bugï¼›</li>
<li>ä¿®å¤ MapType å±æ€§ ä¸ IncludeMany å˜å¼‚åŠŸèƒ½æœªæ˜ å°„å¤„ç†çš„ bugï¼›</li>
</ul>
<h2 id="v0-11-18" tabindex="-1"> v0.11.18</h2>
<ul>
<li>å¢åŠ  DbContextã€Repository SaveManyToMany æ–¹æ³•ï¼Œå®ç°æ‰‹å·¥ä¿å­˜ ManyToMany å…³è”æ•°æ®ï¼›</li>
<li>ä¿®å¤ BaseRepository ææ„æ—¶ä¸å·¥ä½œå•å…ƒçš„å›æ»šé€»è¾‘ bugï¼›#131</li>
<li>ä¼˜åŒ– ManyToMany ä¸­é—´è¡¨ä¸éœ€è¦æŒ‡æ˜ [Column(IsPrimary = true)] ç‰¹æ€§ï¼›</li>
</ul>
<h2 id="v0-11-12" tabindex="-1"> v0.11.12</h2>
<ul>
<li>å¢åŠ  AsTable å’Œ Repository åˆ†è¡¨æ—¶çš„è‡ªåŠ¨è¿ç§»åˆ†è¡¨åŠŸèƒ½ï¼›</li>
<li>å¢åŠ  ICodeFirst.SyncStructure(Type entityType, string tableName) æŒ‡å®šè¡¨åæ¥è¿ç§»å®ä½“ï¼›</li>
</ul>
<div><pre><code>fsql<span>.</span>CodeFirst<span>.</span><span>SyncStructure</span><span>(</span><span>typeof</span><span>(</span><span>Log</span><span>)</span><span>,</span> <span>"Log_1"</span><span>)</span><span>;</span> <span>//è¿ç§»åˆ° Log_1 è¡¨</span>
fsql<span>.</span>CodeFirst<span>.</span><span>SyncStructure</span><span>(</span><span>typeof</span><span>(</span><span>Log</span><span>)</span><span>,</span> <span>"Log_2"</span><span>)</span><span>;</span> <span>//è¿ç§»åˆ° Log_2 è¡¨</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><ul>
<li>å¢åŠ  PostgreSQL ç‰¹æœ‰åŠŸèƒ½ On Conflict Do Update åŠŸèƒ½ï¼›</li>
<li>å®Œå–„ æ‰€æœ‰å‚æ•°åŒ– object parms å¯ä½¿ç”¨ IDictionary ç±»å‹ä¼ å…¥ï¼›</li>
</ul>
<h2 id="v0-11-11" tabindex="-1"> v0.11.11</h2>
<ul>
<li>å¢åŠ  MySql ç‰¹æœ‰åŠŸèƒ½ On Duplicate Key Update åŠŸèƒ½ï¼›</li>
<li>ä¼˜åŒ– å®ä½“ç±»é‡å†™å±æ€§ new å¦‚æœç±»å‹ä¸åŸºç±»ä¸ä¸€è‡´ï¼Œæ— æ³•ä½¿ç”¨çš„é—®é¢˜ï¼›</li>
<li>ä¿®å¤ ISelect .From æ–¹æ³•ä¹‹å‰ä½¿ç”¨ .Include æ–¹æ³•ï¼Œå¯¼è‡´ç”Ÿæˆçš„å¤šè¡¨ JOIN ä½ç½®é”™è¯¯çš„ bugï¼›</li>
</ul>
<h2 id="v0-11-9" tabindex="-1"> v0.11.9</h2>
<ul>
<li>å¢åŠ  FreeSql.Provider.Sqlite å¯¹ Xamarin ç¯å¢ƒä¸‹çš„é€‚é…ï¼›</li>
<li>å¢åŠ  SqlServer ISelect.WithLock æ‰©å±•æ–¹æ³•ï¼Œå®ç° with(nolock) æŸ¥è¯¢ï¼›</li>
<li>å¢åŠ  SqlServer IFreeSql.SetGlobalSelectWithLock æ‰©å±•æ–¹æ³•ï¼Œå®ç°å…¨å±€è®¾ç½® with(nolock) æŸ¥è¯¢ï¼›</li>
<li>ä¿®å¤ MySql CodeFirst DateTime åŒæ­¥ç»“æ„æ¡ä»¶åˆ¤æ–­çš„ bugï¼Œå¯¼è‡´æ¯æ¬¡éƒ½æ‰§è¡Œ alterï¼›
<blockquote>
<p>é«˜ç‰ˆæœ¬æ”¯æŒ datetime(3) ç²¾åº¦çš„ã€æˆ–è€…ä¸æŒ‡å®š DbType=&quot;datetime&quot; å°±æ²¡äº‹</p>
</blockquote>
</li>
<li>ç§»é™¤ Aop.ToListï¼›</li>
<li>ç§»é™¤ Aop.Whereï¼›</li>
</ul>
<h2 id="v0-11-6" tabindex="-1"> v0.11.6</h2>
<ul>
<li>è°ƒæ•´ ToList(a =&gt; new Dto { id = 1, title = a.xx.Title})ï¼Œä¹‹å‰åªæ˜ å°„ idã€titleï¼Œç°åœ¨æ˜¯å…ˆæ˜ å°„ Dto æ‰€æœ‰å±æ€§ï¼Œå†æ˜ å°„ idã€titleï¼›
<blockquote>
<p>æé†’ï¼šå¦‚æœä¹‹å‰ä½¿ç”¨æ­¤æ–¹æ³•æ˜ å°„ Dto çš„æŒ‡å®šå±æ€§ï¼Œè¯·æ”¹ä¸ºåŒ¿åç±»æ˜ å°„ï¼Œé¿å…æŸ¥è¯¢äº†ä¸éœ€è¦çš„å­—æ®µå½±å“æ€§èƒ½ã€‚</p>
</blockquote>
</li>
</ul>
<h2 id="v0-11-5" tabindex="-1"> v0.11.5</h2>
<ul>
<li>ä¿®å¤ FreeSql.DbContext ææ„æ–¹æ³•çš„ bugï¼Œé”™è¯¯çš„å›æ»šäº†å¤–éƒ¨ UnitOfWorkï¼›</li>
</ul>
<h2 id="v0-11-4" tabindex="-1"> v0.11.4</h2>
<ul>
<li>å¢åŠ  ISelect ToDelete/ToUpdate æ–¹æ³•ï¼Œå®ç°æ›´å¤æ‚çš„åˆ é™¤/æ›´æ–°æ“ä½œï¼›</li>
<li>ç§»é™¤ IUpdate/IDelete WhereExists æ–¹æ³•ï¼›</li>
</ul>
<h2 id="v0-11-3" tabindex="-1"> v0.11.3</h2>
<ul>
<li>å¢åŠ  FreeSql.DbContext DbSet Remove å¯æ ¹æ® lambda æ¡ä»¶åˆ é™¤æ•°æ®çš„æ–¹æ³•ï¼›</li>
<li>ä¼˜åŒ– Aop.AuditValue å®¡è®¡è¿‡çš„å€¼ï¼ŒIUpdate.UpdateColumns å³ä½¿ä¸æŒ‡å®šè¯¥åˆ—ä¹Ÿä¼šæ›´æ–°ï¼›</li>
</ul>
<h2 id="v0-11-2" tabindex="-1"> v0.11.2</h2>
<ul>
<li>å¢åŠ  IFreeSql.GlobalFilter å…¨å±€è¿‡æ»¤å™¨ï¼›</li>
<li>ç§»é™¤ TableAttribute.SelectFilter åŠŸèƒ½ï¼›</li>
<li>ä¿®å¤ MySql/SqlServer CodeFirst åŒæ­¥ç»“æ„ bugï¼›
<blockquote>
<p>å½“è¡¨å·²å­˜åœ¨åå¢åŠ è‡ªå¢åˆ—æ—¶ï¼Œäº§ç”Ÿçš„è„šæœ¬ä¸åº”è¯¥åŒ…å«é»˜è®¤è®¤è®¾ç½®</p>
</blockquote>
</li>
</ul>
<h2 id="v0-11-1" tabindex="-1"> v0.11.1</h2>
<ul>
<li>ä¼˜åŒ– FreeSql.DbContext æ„é€ æ–¹æ³•ï¼Œæ–¹ä¾¿æ³¨å…¥ä½¿ç”¨ï¼›</li>
</ul>
<h2 id="v0-10-15-net-framework-4-0" tabindex="-1"> v0.10.15 (.Net Framework 4.0)</h2>
<ul>
<li>å¢åŠ  .Net Framework 4.0 çš„æ”¯æŒï¼Œå‡ºäºç¯å¢ƒè€ƒè™‘ .Net Framework 4.0 ä¸æ”¯æŒå¼‚æ­¥æ–¹æ³•ï¼›</li>
<li>å¢åŠ  IFreeSql.Insert&lt;T&gt;(IEnumerable&lt;T1&gt; source) æ–¹æ³•ï¼›</li>
</ul>
<h2 id="v0-10-14" tabindex="-1"> v0.10.14</h2>
<ul>
<li>è°ƒæ•´ DbContext.EntityChangeInfo ç±»åä¸º DbContext.EntityChangeReport.ChangeInfoï¼›</li>
<li>è°ƒæ•´ IUnitOfWork æ¥å£ï¼Œç§»é™¤ OnEntityChange å±æ€§ï¼Œå¢åŠ  EntityChangeReport å±æ€§ï¼›</li>
<li>ä¼˜åŒ– FreeSqlBuilder å¤„ç† MaxLength ç‰¹æ€§çš„å®¹å™¨å¤„ç†ï¼›</li>
</ul>
<h2 id="v0-10-13" tabindex="-1"> v0.10.13</h2>
<ul>
<li>ä¿®å¤ postgresql 12 ç§»é™¤ pg_attrdef.adsrc åˆ—ï¼Œå¯¼è‡´ CodeFirst æ–¹æ³•å¤±è´¥çš„ bugï¼›</li>
<li>å¢åŠ  Aop.ConfigEntity å±æ€§ ModifyIndexResult å®ç° IndexAttribute çš„è®¾ç½®ï¼›</li>
</ul>
<h2 id="v0-10-12" tabindex="-1"> v0.10.12</h2>
<ul>
<li>å¢åŠ  FreeSql.DbContext å®ä½“å¯¹è±¡çš„å˜åŒ–äº‹ä»¶ï¼›
<blockquote>
<p>å¯å‚é˜… <a href="/db-context" target="_blank" rel="noopener noreferrer">DbConetxt</a></p>
</blockquote>
</li>
<li>è¡¥å…… Aop.CurdBefore äº‹ä»¶å‚æ•° Table å®ä½“ç±»å‹çš„å…ƒæ•°æ®ï¼›</li>
</ul>
<h2 id="v0-10-11" tabindex="-1"> v0.10.11</h2>
<ul>
<li>ä¼˜åŒ– æšä¸¾å±æ€§çš„é»˜è®¤å€¼å®¹é”™ï¼Œæšä¸¾ä¸‹æ ‡ä¸å­˜åœ¨ 0 çš„æ—¶å€™ï¼Œmysql è¿ç§»ç»“æ„é»˜è®¤å€¼æŠ¥é”™ï¼›</li>
<li>ä¼˜åŒ– ORACLE Command ç»‘å®šå˜é‡ BindByName = trueï¼›<a href="https://github.com/2881099/FreeSql/issues/107" target="_blank" rel="noopener noreferrer">#107</a></li>
</ul>
<h2 id="v0-10-10" tabindex="-1"> v0.10.10</h2>
<ul>
<li>ä¿®å¤ PostgreSQL DbFirst è·å–å­—æ®µç±»å‹çš„æ—¶å€™ï¼Œæ²¡æœ‰æ‹¼å¾—å­—ç¬¦ä¸²çš„é•¿åº¦(å¦‚ varchar(255))ï¼›</li>
</ul>
<h2 id="v0-10-9" tabindex="-1"> v0.10.9</h2>
<ul>
<li>ä¿®å¤ DbFirst å½“è¡¨æ•°é‡è¿‡å¤§æ—¶(å¦‚ oracle è¡¨æ•°é‡å¤§äº 1000)ï¼Œå¯èƒ½æŠ¥é”™çš„ bugï¼›</li>
</ul>
<h2 id="v0-10-8" tabindex="-1"> v0.10.8</h2>
<ul>
<li>
<p>å¢åŠ  List&lt;T1&gt; æ‰©å±•æ–¹æ³• IncludeManyï¼Œå®ç°ä»å·²çŸ¥çš„å†…å­˜ List æ•°æ®ï¼Œè¿›è¡Œå’Œ ISelect.IncludeMany ç›¸åŒåŠŸèƒ½çš„è´ªå©ªåŠ è½½ï¼›</p>
<blockquote>
<p>ç¤ºä¾‹ï¼šnew List&lt;Song&gt;(new[] { song1, song2, song3 }).IncludeMany(fsql, a =&gt; a.Tags);</p>
</blockquote>
</li>
<li>
<p>ä¿®å¤ FreeSql.DbContext/FreeSql.Repository å½“ä¸»é”®ä¸º Guid? å¯ç©ºç±»å‹æ—¶ï¼Œå‘ç”Ÿå‚æ•°é”™è¯¯ï¼›</p>
<blockquote>
<p>System.ArgumentException:â€œExpression of type 'System.Guid' cannot be used for assignment to type 'System.Nullable`1[System.Guid]'â€</p>
</blockquote>
</li>
</ul>
<h2 id="v0-10-7" tabindex="-1"> v0.10.7</h2>
<ul>
<li>å¢åŠ  IndexAttribute ç‰¹æ€§ï¼Œè‡ªåŠ¨è¿ç§»ç´¢å¼•ï¼Œä»¥åŠå¯¹åº”çš„ FluentApi æ–¹æ³•ï¼›</li>
<li>ç§»é™¤ ColumnAttribute.Unique å±æ€§è®¾ç½®ï¼Œæ”¹ä¸º IndexAttribute ç‰¹æ€§è®¾ç½®å”¯ä¸€é”®ï¼›</li>
<li>è°ƒæ•´ IInsert&lt;T1&gt; Insert&lt;T1&gt;(IEnumerable&lt;T1&gt; source) å‚æ•°ç±»å‹æ”¹æˆäº† Listï¼›</li>
</ul>
<h2 id="v0-10-6" tabindex="-1"> v0.10.6</h2>
<ul>
<li>ä¼˜åŒ– DbContext/Repository ManyToMany è”çº§ä¿å­˜åŠŸèƒ½ï¼Œå½“æ˜¯æ–°å¢æ•°æ®æ—¶ä¸æŸ¥è¯¢ä¸­é—´è¡¨è®°å½•å¯¹æ¯”å·®å¼‚ï¼ˆç›´æ¥æ’å…¥ï¼‰ï¼›</li>
</ul>
<h2 id="v0-10-5" tabindex="-1"> v0.10.5</h2>
<ul>
<li>å¢åŠ  DbContext/Repository ManyToMany è”çº§ä¿å­˜åŠŸèƒ½ï¼ˆä¹‹å‰å·²æ”¯æŒ OneToManyï¼‰ï¼›</li>
</ul>
<h2 id="v0-10-4" tabindex="-1"> v0.10.4</h2>
<ul>
<li>å¢åŠ  ColumnAttribute å¯æ’å…¥(CanInsert)ã€å¯æ›´æ–°(CanUpdate)ï¼›#99</li>
</ul>
<h2 id="v0-10-3" tabindex="-1"> v0.10.3</h2>
<ul>
<li>å¢åŠ  NavigateAttribute ç‰¹æ€§å¯¹åº”çš„ Fluent åŠŸèƒ½ï¼›#96</li>
</ul>
<h2 id="v0-10-2" tabindex="-1"> v0.10.2</h2>
<ul>
<li>ä¿®å¤ Pgsql string[] å±æ€§è¡¨è¾¾å¼ Contains ç¼ºå°‘ç±»å‹è½¬æ¢çš„ SQL è¯­æ³•é”™è¯¯ï¼›</li>
</ul>
<h2 id="v0-10-1" tabindex="-1"> v0.10.1</h2>
<ul>
<li>ä¼˜åŒ– IUpdate.IgnoreColumns/UpdateColumns å¯å¯¹å±æ€§åï¼Œæˆ–å­—æ®µååšè®¾ç½®ï¼›#95</li>
<li>ä¼˜åŒ– å¿½ç•¥ List&lt;T&gt; ä½œä¸º Curd ç±»å‹æ“ä½œï¼›</li>
</ul>
<h2 id="v0-9-18" tabindex="-1"> v0.9.18</h2>
<ul>
<li>å¢åŠ  PostgreSQL çš„ Odbc è®¿é—®æä¾›ï¼Œç›¸æ¯” FreeSql.Provider.PostgreSQL æ”¯æŒçš„ç±»å‹æ›´å°‘ï¼›</li>
<li>å¢åŠ  é€šç”¨çš„ Odbc è®¿é—®æä¾›ï¼Œä¸èƒ½è¿ç§»å®ä½“åˆ°æ•°æ®åº“ï¼Œä¸èƒ½ Skip è¿™æ ·æ¥åˆ†é¡µï¼Œç†è®ºä¸Šèƒ½ crud æ‰€æœ‰ odbc æ•°æ®åº“ï¼›</li>
</ul>
<h2 id="v0-9-17-odbc" tabindex="-1"> v0.9.17(ODBC)</h2>
<ul>
<li>å¢åŠ  FreeSql.Provider.Odbcï¼Œå®ç° Oracle/SqlServer/MySql çš„ Odbc è®¿é—®æä¾›ï¼›</li>
<li>å¢åŠ  FreeSqlBuilder.UseConnectionString å‚æ•° providerTypeï¼Œå¯è§£å†³å› åŒ…ç‰ˆæœ¬å†²çªæ—¶ï¼Œå¯èƒ½æ— æ³•åå°„è·å¾— FreeSql.Provider å¯¹åº”çš„ç±»å‹ï¼Œé€šå¸¸è¿™ä¸ªå‚æ•°ä¸éœ€è¦è®¾ç½®ï¼›</li>
<li>ä¼˜åŒ– MaxLength ç‰¹æ€§ï¼Œå½“æŒ‡å®šä¸º -1 æ—¶ DbType ä¼šåˆ†åˆ«æ˜ å°„ç±»å‹ text/nvarchar(max)/nvarchar2(4000)ï¼›</li>
</ul>
<h2 id="v0-9-16" tabindex="-1"> v0.9.16</h2>
<ul>
<li>å¢åŠ  BaseRepository.AttachOnlyPrimary æ–¹æ³•ï¼Œåªé™„åŠ å®ä½“çš„ä¸»é”®å€¼ï¼›
<blockquote>
<p>åœ¨æ›´æ–°å‰ä½¿ç”¨å¯å®ç°ä¸æŸ¥è¯¢æ•°æ®åº“å†æ›´æ–°ã€ä¹Ÿå¯ä»¥å®ç°æ›´æ–°æ—¶ä¸æ›´æ–°å€¼ä¸º null çš„å­—æ®µ</p>
</blockquote>
</li>
</ul>
<div><pre><code><span>class</span> <span>T</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> other <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span><span>var</span></span> item <span>=</span> <span>new</span> <span>T</span> <span>{</span> id <span>=</span> <span>1</span><span>,</span> name <span>=</span> <span>"xx"</span> <span>}</span><span>;</span>
fsql<span>.</span><span><span>GetRepository</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>AttachOnlyPrimary</span><span>(</span>item<span>)</span><span>.</span><span>Update</span><span>(</span>item<span>)</span><span>;</span> <span>//åªæ›´æ–° name</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><ul>
<li>ä¿®å¤ Lambda è¡¨è¾¾å¼ä¸­ DateTime.Now.ToString(&quot;yyyyMMdd&quot;) ä¸èƒ½ç›´æ¥æ‰§è¡Œçš„ bugï¼›</li>
</ul>
<h2 id="v0-9-15" tabindex="-1"> v0.9.15</h2>
<ul>
<li>å¢åŠ  FreeSql.Extensions.JsonMap æ‰©å±•åŒ…ï¼Œå®ç°å¿«é€Ÿå°†å¯¹è±¡æ˜ å°„ä¸º json å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼›</li>
</ul>
<div><pre><code>fsql<span>.</span><span>UseJsonMap</span><span>(</span><span>)</span><span>;</span> <span>//å¼€å¯åŠŸèƒ½</span>

<span>class</span> <span>TestConfig</span> <span>{</span>
    <span>public</span> <span><span>int</span></span> clicks <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
<span>[</span><span><span>Table</span><span><span>(</span>Name <span>=</span> <span>"sysconfig"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>class</span> <span>S_SysConfig<span>&lt;</span>T<span>></span></span> <span>{</span>
    <span>[</span><span><span>Column</span><span><span>(</span>IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span><span>JsonMap</span></span><span>]</span>
    <span>public</span> <span>T</span> Config <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><ul>
<li>ä¼˜åŒ– è¡¨è¾¾å¼è§£ææœªå®ç°çš„é”™è¯¯æé†’ï¼Œå¦‚ $&quot;&quot;ï¼›</li>
</ul>
<h2 id="v0-9-12" tabindex="-1"> v0.9.12</h2>
<ul>
<li>å¢åŠ  MaxLength ç‰¹æ€§çš„è§£æï¼Œå®ä½“å­—ç¬¦ä¸²é•¿åº¦è®¾ç½®ï¼›</li>
</ul>
<div><pre><code><span>class</span> <span>Topic</span> <span>{</span>
    <span>[</span><span><span>MaxLength</span><span><span>(</span><span>128</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="v0-9-11" tabindex="-1"> v0.9.11</h2>
<ul>
<li>å¢åŠ  ISelect.ToChunk å®ç°åˆ†å—æŸ¥è¯¢æ•°æ®ï¼Œå‡å°‘æ•°æ®è¿‡å¤§æ—¶å†…å­˜å ç”¨ï¼›</li>
</ul>
<h2 id="v0-9-10" tabindex="-1"> v0.9.10</h2>
<ul>
<li>ç§»é™¤ FreeSql.Repository æ‰©å±•æ–¹æ³• FromRepositoryï¼›</li>
<li>è°ƒæ•´ ISelect.AsTable è§„åˆ™ï¼Œæ¯ä¸€æ¬¡ä½¿ç”¨å°†å¢åŠ  UNION ALL æŸ¥è¯¢ï¼›</li>
<li>ä¼˜åŒ– AsTable UseSyncStructureToLower/ToUpper è®¾ç½®ï¼Œå…¼å®¹ AsTable((t,o) =&gt; &quot;(select * from tb)&quot;)ï¼›</li>
</ul>
<h2 id="v0-9-9" tabindex="-1"> v0.9.9</h2>
<ul>
<li>ä¿®å¤ AsTable ä¸å— UseSyncStructureToLower/ToUpper è®¾ç½®çš„ bugï¼›</li>
</ul>
<h2 id="v0-9-8" tabindex="-1"> v0.9.8</h2>
<ul>
<li>å¢åŠ  AsTable å¤šæ¬¡ï¼Œå¯æŸ¥è¯¢åˆ†è¡¨åçš„å¤šä¸ªå­è¡¨è®°å½•ï¼Œä»¥ UNION ALL å½¢å¼æ‰§è¡Œï¼›</li>
<li>å®Œå–„ ExpressionTree DateTime/DateTimeOffset æ•°æ®è½¬æ¢æµ‹è¯•ï¼›</li>
<li>ä¼˜åŒ– ISelect`1.Include ä¹‹å ToList å‚æ•° includeNestedMembers é»˜è®¤ä¸º trueï¼›</li>
<li>ä¿®å¤ å±æ€§æ—  set è‡ªåŠ¨å¿½ç•¥çš„ bugï¼›</li>
</ul>
<h2 id="v0-9-7" tabindex="-1"> v0.9.7</h2>
<ul>
<li>ä¿®å¤ æ‰¹é‡æ›´æ–° bugï¼Œå½“æŸè¡ŒæŸå­—æ®µå€¼ä¸º nullï¼Œå…¶ä»–è¡Œçš„è¯¥å­—æ®µä¹Ÿæ›´æ–°æˆäº† nullï¼›ã€é‡å¤§ bugã€‘</li>
</ul>
<h2 id="v0-9-6" tabindex="-1"> v0.9.6</h2>
<ul>
<li>ä¼˜åŒ– è¡¨è¾¾å¼å¯¹æ•´æ•°é™¤æ³•çš„å¤„ç†ï¼Œè§£æä¸ºæ•´é™¤ï¼›</li>
<li>ä¼˜åŒ– MapType DateTime/DateTimeOffset ç±»å‹è½¬æ¢äº’é€šï¼›</li>
</ul>
<h2 id="v0-9-5" tabindex="-1"> v0.9.5</h2>
<ul>
<li>å¢åŠ  åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­—æ®µä½ç½®ï¼Œå¦‚ï¼š[Column(Position = 1]ï¼Œå¯ä¸ºè´Ÿæ•°å³åæ–¹å‘ä½ç½®ï¼›</li>
</ul>
<h2 id="v0-9-4" tabindex="-1"> v0.9.4</h2>
<ul>
<li>ä¿®å¤ å¯¼èˆªå±æ€§é…ç½®ï¼Œå¾ªç¯å…³ç³»çš„æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´çš„ bugï¼›</li>
</ul>
<h2 id="v0-9-3" tabindex="-1"> v0.9.3</h2>
<ul>
<li>ä¿®å¤ å¯¼èˆªå±æ€§é…ç½®å’Œ Aop å†²çªçš„ bugï¼›</li>
</ul>
<h2 id="v0-9-2" tabindex="-1"> v0.9.2</h2>
<ul>
<li>ä¿®å¤ Aop.AuditValue ä¸ FreeSql.Repository ä¸»é”®çŠ¶æ€ç®¡ç†çš„å†²çªï¼›</li>
</ul>
<h2 id="v0-9-1" tabindex="-1"> v0.9.1</h2>
<ul>
<li>å¢åŠ  <code>ISelect.First&lt;Dto&gt;()</code> æ–¹æ³•ï¼›</li>
<li>ä¿®å¤ MapType è¡¨è¾¾å¼è§£ææ—¶çš„å±‚çº§ bugï¼Œå¯èƒ½å‡ºç° ExpressionTree ç±»å‹é”™è¯¯ï¼›</li>
</ul>
<h2 id="v0-8-11" tabindex="-1"> v0.8.11</h2>
<ul>
<li>å¢åŠ  Aop.AuditValue äº‹ä»¶ï¼Œåœ¨æ’å…¥/æ›´æ–°æ•°æ®æ—¶å®¡è®¡å±æ€§å€¼ï¼›</li>
</ul>
<h2 id="v0-8-10" tabindex="-1"> v0.8.10</h2>
<ul>
<li>ä¿®å¤ Pgsql æ‰¹é‡æ›´æ–°ä½¿ç”¨ NoneParameter åæ—¥æœŸç±»å‹çš„è¯­æ³• bugï¼›</li>
<li>ä¿®å¤ Oracle DbFirst å¤§å°å†™é—®é¢˜æ²¡æ­£ç¡®è·å–åˆ—å¯¹åº” CsType å€¼çš„ bugï¼›</li>
</ul>
<h2 id="v0-8-8" tabindex="-1"> v0.8.8</h2>
<ul>
<li>ä¼˜åŒ– å¯¼èˆªå±æ€§çš„å…³ç³»ï¼Œå‹å¥½æ”¯æŒ int/int? æ˜ å°„ï¼›</li>
<li>ä¿®å¤ IncludeMany å˜å¼‚ Where æŒ‡å®šçš„å±æ€§ç±»å‹ä¸ä¸€è‡´çš„ bugï¼›(å¦‚ int å’Œ int?)</li>
</ul>
<h2 id="v0-8-7" tabindex="-1"> v0.8.7</h2>
<ul>
<li>ä¿®å¤ å¯¼èˆªå…³ç³»å¤šå±æ€§æ—¶çš„é”™åº bugï¼›</li>
<li>ä¿®å¤ å»¶æ—¶å±æ€§çš„ç±»ï¼Œæ²¡æœ‰è®¾ç½® Namespace æ—¶çš„ bugï¼›</li>
</ul>
<h2 id="v0-8-6" tabindex="-1"> v0.8.6</h2>
<ul>
<li>è¡¥å…… ä½¿ç”¨ IsIgnore å¿½ç•¥åï¼Œè¡¨è¾¾å¼å†ä½¿ç”¨æ—¶çš„å‹å¥½é”™è¯¯æç¤ºï¼›</li>
<li>ä¼˜åŒ– DbContext/Repository å±€éƒ¨è°ƒæ•´ï¼›</li>
<li>ä¿®å¤ DbContext.Save åªæŸ¥è¯¢ä¸æ›´æ–°çš„ bugï¼›</li>
</ul>
<h2 id="v0-8-5" tabindex="-1"> v0.8.5</h2>
<ul>
<li>ä¿®å¤ ISelect.WhereCascade å½“å†…éƒ¨ä½¿ç”¨ (a as BaseEntity).TenantId æ—¶æŠ¥é”™çš„ bugï¼›</li>
<li>ä¿®å¤ ISelect Sum/First å­æŸ¥è¯¢æ—¶ï¼Œè‹¥å­æŸ¥è¯¢å®ä½“ç±»ä¸ä¸»æŸ¥è¯¢ä¸€æ ·æ—¶ï¼Œå¯¼è‡´çš„ bugï¼›</li>
</ul>
<h2 id="v0-8-4" tabindex="-1"> v0.8.4</h2>
<ul>
<li>ä¿®å¤ IUpdate.Set è¡¨è¾¾å¼ä¼ å…¥åŒ¿åç±»æ›´æ–°å¤šä¸ªå­—æ®µï¼Œåè¡¨è¾¾å¼æœªåŠ []æˆ–&quot;&quot;çš„ bugï¼›</li>
<li>ä¿®å¤ Aop.ConfigEntityProperty æ“ä½œå¯¼èˆªå±æ€§åï¼Œæ‰§è¡Œ insert è¯­å¥è®¤ä¸ºå®ƒä¹Ÿæ˜¯å­—æ®µçš„ bugï¼›</li>
</ul>
<h2 id="v0-8-3" tabindex="-1"> v0.8.3</h2>
<ul>
<li>å¢åŠ  FreeSql.Provider.Oracle ä¸‹çš„ OraclePrimaryKeyName ç‰¹æ€§ï¼Œæ‰‹å·¥è®¾ç½®ä¸»é”®åé˜²æ­¢é»˜è®¤åè¿‡é•¿é—®é¢˜ï¼›</li>
<li>ä¿®å¤ æŸ¥è¯¢é‡å¤æ•°æ®æ—¶ä½¿ç”¨ IncludeMany å‡ºç°å­—å…¸é‡å¤æ·»åŠ çš„ bugï¼›(å¦‚ä¸€å¯¹å¤šä½¿ç”¨ LeftJoin æŸ¥è¯¢ï¼Œä¸»å®ä½“æŸ¥è¯¢å‡ºäº†é‡å¤çš„æ•°æ®)</li>
<li>è¡¥å…… ISelect`T1...T10 LeftJoin/InnerJoin/RightJoin å¤šå‚æ•°æ–¹æ³•ï¼›</li>
</ul>
<h2 id="v0-8-2" tabindex="-1"> v0.8.2</h2>
<ul>
<li>ä¿®å¤ Oracle è¡¨è¾¾å¼ DateTime.Subtract(DateTime) è§£æ bugï¼›</li>
<li>å¢åŠ  IFreeSql.Select`T1...T10 çš„å¤šè¡¨æŸ¥è¯¢æ‰©å±•æ–¹æ³•ï¼›</li>
<li>å¢åŠ  è¡¨è¾¾å¼å‡½æ•° string.IsNullOrWhiteSpace è§£æï¼›</li>
<li>ä¼˜åŒ– å†…éƒ¨å®ä½“ç®¡ç†çš„é»˜è®¤å€¼ï¼Œé˜²æ­¢å¯¼èˆªå±æ€§ä½¿ç”¨æŠ½è±¡ç±»/æ¥å£æ—¶å‡ºç°é”™è¯¯ï¼›</li>
</ul>
<h2 id="v0-8-1" tabindex="-1"> v0.8.1</h2>
<ul>
<li>ä¼˜åŒ– è¡¨è¾¾å¼ä¸­ä¸èƒ½ä½¿ç”¨ c# å‡½æ•°çš„é—®é¢˜ï¼Œ
<blockquote>
<p>å¦‚ï¼šwhere(a =&gt; HttpContext.Session.GetString(&quot;UserID&quot;) == a.UserId)</p>
</blockquote>
</li>
<li>ä¼˜åŒ– IUpdate.Set è¡¨è¾¾å¼ä¼ å…¥åŒ¿åç±»æ›´æ–°å¤šä¸ªå­—æ®µï¼›</li>
<li>ä¼˜åŒ– IInsert.InsertIdentity å¯æ’å…¥è‡ªå¢å±æ€§ï¼›</li>
<li>ä¿®å¤ Oracle CodeFirst ä½¿ç”¨ OldName è¿ç§»è‡ªå¢å­—æ®µæ—¶ï¼Œæœªåˆ é™¤æ—§çš„è§¦å‘å™¨å’Œåºåˆ—çš„ bugï¼›</li>
</ul>
<h2 id="v0-7-16" tabindex="-1"> v0.7.16</h2>
<ul>
<li>å¢åŠ  UnitOfWork.Current é™æ€å±æ€§ï¼ŒAsyncLocal å®ç° [NETStandard 2.0]ï¼›</li>
<li>ä¿®å¤ CodeFirst è¿ç§»ä»£ç æ³¨é‡Šåˆ°æ•°æ®åº“ï¼Œç»§æ‰¿çš„åŸºç±»æœªç”Ÿæ•ˆçš„ bugï¼›</li>
</ul>
<h2 id="v0-7-15" tabindex="-1"> v0.7.15</h2>
<ul>
<li>ä¼˜åŒ– ExpressionTree ç±»å‹è½¬æ¢çš„å‹å¥½é”™è¯¯æç¤ºï¼›</li>
<li>ä¿®å¤ SqlServer IUpdate.ExecuteUpdated æ‹¼æ¥ SQL bugï¼›</li>
</ul>
<h2 id="v0-7-13" tabindex="-1"> v0.7.13</h2>
<ul>
<li>å¢åŠ  ISelect.WhereCascade å®ç°å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œå‘æ¯ä¸ªè¡¨ä¸­é™„åŠ æ¡ä»¶ï¼›</li>
<li>å¢åŠ  è¡¨è¾¾å¼å¯¹åŸºç±»è½¬æ¢çš„è§£æï¼Œå¦‚ï¼šWhere(a =&gt; (a as BaseEntity).IsDeleted == true)ï¼›</li>
<li>å¢åŠ  Examples é¡¹ç›® base_entityï¼Œåˆ©ç”¨ BaseEntity å®ç°ç®€æ´çš„æ•°æ®åº“æ“ä½œï¼›</li>
</ul>
<h2 id="v0-7-12" tabindex="-1"> v0.7.12</h2>
<ul>
<li>ä¿®å¤ .From å¤šè¡¨æŸ¥è¯¢åˆ«åçš„åŒ¹é… bugï¼›</li>
<li>ä¿®å¤ SqlServer æœªå¤„ç†å­—ç¬¦ä¸²å‰é¢åŠ  N çš„ bugï¼›</li>
<li>å¢åŠ  å­æŸ¥è¯¢åˆ¤æ–­ï¼Œå¦‚æœä½¿ç”¨äº†ç›¸åŒ ISelect ä¼šæ­»å¾ªç¯ï¼›</li>
<li>å¢åŠ  è¿æ¥å­—ç¬¦ä¸²é”™è¯¯æ—¶çš„å‹å¥½æç¤ºï¼›</li>
</ul>
<h2 id="v0-7-9" tabindex="-1"> v0.7.9</h2>
<ul>
<li>è¡¥å…… Navigate(ManyToMany = typeof(ä¸­é—´è¡¨)) å¤šå¯¹å¤šè‡ªå®šä¹‰é…ç½®ï¼›</li>
<li>ä¿®å¤ LambadaExpressionExtensions æ‰©å±•æ–¹æ³• And/Or å½“å­˜åœ¨äºŒçº§ lambada æ—¶æ›¿æ¢é”™è¯¯çš„ bugï¼›
<blockquote>
<p>å¦‚ï¼šwhere.Add(a =&gt; a.Tags.Any(b =&gt; ...))ï¼Œb æ›¿æ¢é”™è¯¯</p>
</blockquote>
</li>
</ul>
<h2 id="v0-7-8" tabindex="-1"> v0.7.8</h2>
<ul>
<li>å¢åŠ  å­æŸ¥è¯¢å‡½æ•° Firstã€Countã€Minã€Maxã€Sumã€Avg çš„æ”¯æŒï¼›</li>
<li>è¡¥å…… Oracle DbFirst raw ç­‰ç±»å‹æ˜ å°„å¤„ç†ï¼Œå…¶ä»–æœªå¤„ç†çš„ç±»å‹å°†æ˜ å°„ä¸º stringï¼›</li>
</ul>
<h2 id="v0-7-6" tabindex="-1"> v0.7.6</h2>
<ul>
<li>ä¼˜åŒ– è¡¨è¾¾å¼ true &amp;&amp; ... è§£æçš„å¤„ç†ï¼›</li>
<li>ä¼˜åŒ– Navigate æŒ‡å®šè”åˆé”®å…³ç³»æ—¶ï¼Œå¯¹å±æ€§é¡ºåºçš„è¦æ±‚ï¼Œå½“ç±»å‹ä¸ä¸€æ ·ã€åç§°ä¸€æ ·æ—¶æ— é¡»æŒ‡æ˜å±æ€§çš„é¡ºåºï¼Œå¦‚ï¼š[Navigate(&quot;MemberId, ShopId&quot;)]ï¼›</li>
</ul>
<h2 id="v0-7-5" tabindex="-1"> v0.7.5</h2>
<ul>
<li>ä¿®å¤ Insert/Update å¤§æ‰¹é‡æ“ä½œåˆ†æ‰¹æ‰§è¡Œæ—¶ï¼Œå¦‚æœå¤–éƒ¨ä½¿ç”¨äº† Ado.Transactionï¼Œæ²¡æœ‰ä½¿ç”¨çº¿ç¨‹äº‹åŠ¡å¯¹è±¡ï¼Œè€Œæ˜¯åˆ›å»ºäº†æ–°äº‹åŠ¡çš„ bugï¼›</li>
</ul>
<h2 id="v0-7-4" tabindex="-1"> v0.7.4</h2>
<ul>
<li>ä¿®å¤ Insert ClearData é‡å¤åˆ©ç”¨çš„ bugï¼ˆä½¿ç”¨ IgnoreColumns è¿›è¡Œå¤§æ‰¹é‡æ’å…¥æ—¶ä¼šå‘ç”Ÿï¼‰ï¼›</li>
</ul>
<h2 id="v0-7-3" tabindex="-1"> v0.7.3</h2>
<ul>
<li>ä¿®å¤ ISelect.From&lt;T2, T2&gt; å½“ä¼ å…¥ç›¸åŒçš„ä¸¤ä¸ªå®ä½“ç±»å‹ï¼Œå¯èƒ½å¯¼è‡´å†…éƒ¨ Join æ— æ³•åŒ¹é…çš„ bugï¼›</li>
<li>å¢åŠ  IGroupSelect ToSql(string) é‡è½½æ–¹æ³•ï¼›</li>
<li>ä¿®å¤ æ ¹æ®ä»£ç æ³¨é‡Šï¼Œè¿ç§»åˆ°æ•°æ®åº“å¤‡æ³¨ï¼Œå½“å®ä½“ç±»å±äº .exe ç¨‹åºé›†æ—¶çš„ bugï¼šSystem.Xml.XmlException:â€œæ ¹çº§åˆ«ä¸Šçš„æ•°æ®æ— æ•ˆã€‚ ç¬¬ 1 è¡Œï¼Œä½ç½® 1ã€‚â€</li>
</ul>
<h2 id="v0-7-1" tabindex="-1"> v0.7.1</h2>
<ul>
<li>ä¿®å¤ <code>.From&lt;T2&gt;.GroupBy</code> Item2 ä»¥ä¸Šå…ƒç»„å‚æ•°æœªæŸ¥æ‰¾åˆ°çš„ bug #63ï¼›</li>
<li>åˆå¹¶ FreeSql.DbContext é¡¹ç›®è‡³ FreeSqlï¼›</li>
</ul>
<h2 id="v0-6-13" tabindex="-1"> v0.6.13</h2>
<ul>
<li>å¢åŠ  è¡¨è¾¾å¼ .HasValue å’Œ !.HasValue çš„è§£ææ”¯æŒï¼›</li>
<li>å¢åŠ  è¡¨è¾¾å¼ DateTime - DateTime å’Œ DateTime - TimeSpan çš„è§£ææ”¯æŒï¼›</li>
<li>ä¿®å¤ 0.6.12 IUpdate.Set è¡¨è¾¾å¼è§£æçš„ bugï¼›</li>
</ul>
<h2 id="v0-6-12" tabindex="-1"> v0.6.12</h2>
<ul>
<li>å¢åŠ  LambdaExpression æ‰©å±•æ–¹æ³• And/Or/Not å¿«é€Ÿæ‹¼æ¥è¡¨è¾¾å¼ï¼›</li>
<li>ä¼˜åŒ– IUpdate.Set æ”¯æŒ Set(a =&gt; new { Clicks = a.Clicks + 1, Time = DateTime.Now }) æŒ‡å®šå¤šä¸ªå­—æ®µæ›´æ–°çš„ç”¨æ³•ï¼›</li>
</ul>
<h2 id="v0-6-11" tabindex="-1"> v0.6.11</h2>
<ul>
<li>å¢åŠ  CodeFirst æ ¹æ®ä»£ç æ³¨é‡Šï¼Œè¿ç§»åˆ°æ•°æ®åº“å¤‡æ³¨ï¼ˆéœ€è¦å®ä½“ç±»æ‰€åœ¨é¡¹ç›®å¼€å¯ xml ç”ŸæˆåŠŸèƒ½ï¼‰ï¼›</li>
</ul>
<h2 id="v0-6-10" tabindex="-1"> v0.6.10</h2>
<ul>
<li>å¢åŠ  TableAttribute ç‰¹æ€§å±æ€§ DisableSyncStructureï¼Œå½“å®ä½“å¯¹åº”çš„æ˜¯è§†å›¾æ—¶ï¼Œå¯ä½¿ç”¨æœ¬åŠŸèƒ½ç¦ç”¨è¿ç§»ï¼›</li>
<li>å¢åŠ  FreeSqlBuilder UseEntityPropertyNameConvert() å…¨å±€è½¬æ¢å®ä½“å±æ€§åæ–¹æ³• <a href="https://github.com/2881099/FreeSql/pull/60" target="_blank" rel="noopener noreferrer">#60</a>ï¼›</li>
</ul>
<h2 id="v0-6-9" tabindex="-1"> v0.6.9</h2>
<ul>
<li>ä¿®å¤ æ‰¹é‡æ’å…¥/æ›´æ–°å¤§é‡æ•°æ®æ—¶ï¼Œæœªä½¿ç”¨ NoneParameterï¼Œä¼šå¯¼è‡´éƒ¨åˆ†æœªæ‰§è¡Œçš„ bugï¼›</li>
</ul>
<h2 id="v0-6-8" tabindex="-1"> v0.6.8</h2>
<ul>
<li>å¤„ç† éæ­£å¸¸ Provider GC å¯èƒ½ä¸º null çš„é”™è¯¯ï¼›</li>
<li>ä¿®å¤ Aop.ParseExpression ä½¿ç”¨ FreeParse æ–¹æ³•æ­»å¾ªç¯çš„ bugï¼›</li>
<li>å¢åŠ  ISelect.OrderBy é‡è½½ï¼Œä¸ WhereIf ç›¸åŒè¡Œä¸ºï¼›</li>
</ul>
<h2 id="v0-6-6" tabindex="-1"> v0.6.6</h2>
<ul>
<li>é€‚é… FreeSql.Provider.MySqlConnectorï¼Œå’Œå®ƒå¯¹åº”çš„ 266 ä¸ªå•å…ƒæµ‹è¯•ï¼›</li>
</ul>
<h2 id="v0-6-5" tabindex="-1"> v0.6.5</h2>
<ul>
<li>å¢åŠ  NavigateAttribute é…ç½®å¯¼èˆªå…³ç³»ï¼›</li>
<li>ä¿®å¤ LinqToSql æ–¹æ³•ï¼Œå¼€å¯è‡ªåŠ¨è¿ç§»æ—¶ï¼Œè¿ç§»äº†æ— å…³ç±»çš„ bugï¼›</li>
<li>ä¿®å¤ Oracle DbFirst date(7) ç±»å‹æœªå¤„ç†çš„ bugï¼›</li>
<li>ä¿®å¤ AsSelect().Any() æœªç»™å…¶ä»–æ¡ä»¶æ—¶ï¼Œäº§ç”Ÿ null bugï¼›</li>
<li>ä¿®å¤ å­æŸ¥è¯¢ä½¿ç”¨éè¡¨è¾¾å¼æ–¹æ³•æ—¶ï¼Œå‚æ•°æ— æ•ˆçš„ bugï¼›</li>
<li>å¢åŠ  FreeSql.Extensions.LazyLoading å¯¹ .net 4.5 çš„æ”¯æŒï¼›</li>
<li>ä¼˜åŒ– MySql CodeFirst å¢åŠ  DateTime è¿ç§»åï¼Œé»˜è®¤å€¼ä¸º 0000-00-00 å¯¼è‡´è¯»å–å¤±è´¥çš„ bugï¼›</li>
<li>ä¼˜åŒ– LazyLoading å‹å¥½é”™è¯¯æç¤ºï¼›</li>
</ul>
<h2 id="v0-6-3" tabindex="-1"> v0.6.3</h2>
<ul>
<li>è¡¥å…… å½“åˆå§‹åŒ– ConnectionString å‚æ•°ä¸ºç©ºæ—¶ï¼Œç»™å‡ºå‹å¥½é”™è¯¯æç¤ºï¼›</li>
<li>ä¿®å¤ IUpdate.IngoreColumns/UpdateColumns è‹¥å®ä½“æŒ‡å®šåˆ«ååï¼Œå¯èƒ½æ— æ•ˆçš„ bugï¼›</li>
</ul>
<h2 id="v0-6-2" tabindex="-1"> v0.6.2</h2>
<ul>
<li>å¢åŠ  FreeSql.Provider.MySqlConnector å®ç°åŒ…ï¼›</li>
<li>ä¿®å¤ mysql CodeFirst enum/set å°å†™æ—¶ï¼Œå¯¹ MySqlConnector ä¸å‹å¥½çš„ bugï¼›</li>
</ul>
<h2 id="v0-6-1-æ‹†è§£-freesql" tabindex="-1"> v0.6.1ï¼ˆæ‹†è§£ FreeSqlï¼‰</h2>
<ul>
<li>å„æ•°æ®åº“å•ç‹¬åŒ…ã€å»¶æ—¶åŠ è½½åŒ…ï¼›</li>
<li>FreeSql.Extensions.LazyLoading</li>
<li>FreeSql.Provider.MySql</li>
<li>FreeSql.Provider.PostgreSQL</li>
<li>FreeSql.Provider.SqlServer</li>
<li>FreeSql.Provider.Sqlite</li>
<li>FreeSql.Provider.Oracle</li>
<li>ç§»é™¤ IFreeSql.Cacheï¼Œä»¥åŠ ISelect.Caching æ–¹æ³•ï¼›</li>
<li>ç§»é™¤ IFreeSql.Logï¼ŒåŒ…æ‹¬å†…éƒ¨åŸæœ‰çš„æ—¥å¿—è¾“å‡ºï¼Œæ”¹ä¸º Trace.WriteLineï¼›</li>
<li>IAdo.Query&lt;dynamic&gt; è¯»å–è¿”å›å˜ä¸º List&lt;Dictionary&lt;string, object&gt;&gt;ï¼›</li>
<li>å®šä¹‰ IFreeSql å’Œä»¥å‰ä¸€æ ·ï¼Œç§»é™¤äº† UseCacheã€UseLogger æ–¹æ³•ï¼›</li>
</ul>
<h2 id="v0-5-23" tabindex="-1"> v0.5.23</h2>
<ul>
<li>è¡¥å…… IUpdate.Set(a =&gt; a.Click == 10)ï¼Œç®€åŒ– Set æ›´æ–°å•ä¸ªå­—æ®µè¡¨è¾¾å¼ï¼›</li>
<li>ä¼˜åŒ– å»¶æ—¶å¯¼èˆªå±æ€§çš„é”™è¯¯æé†’ï¼Œå½“æ— æ³•åŒ¹é…é”™è¯¯ï¼Œè½¬åˆ°é‡å†™ç±» get æ—¶æŠ›å‡ºï¼ˆå®ç°å»¶æ—¶å¯¼èˆªå±æ€§ï¼Œä¸æ™®é€šå¯¼èˆªä¸€èµ·ä½¿ç”¨ï¼‰ï¼›</li>
<li>ä¼˜åŒ– ICodeFirst.SyncStructure é”™è¯¯æç¤ºï¼Œå½“ä½¿ç”¨ä¸å¯è¿ç§»å®ä½“æ—¶ï¼›</li>
<li>ä¼˜åŒ– å®ä½“æ•°æ®å±æ€§ DbDefaultValue å¤„ç†ï¼›</li>
<li>ä¿®å¤ Expression è¡¨è¾¾å¼è§£æ Convert çš„åˆ¤æ–­ bugï¼›</li>
</ul>
<h2 id="v0-5-21" tabindex="-1"> v0.5.21</h2>
<ul>
<li>ä¿®å¤ IncludeMany ManyToManyï¼Œè‹¥ä¸­é—´è¡¨æœªä½¿ç”¨ å»¶æ—¶åŠ è½½ å±æ€§åŠŸèƒ½æ—¶ï¼Œå‡ºç°çš„ bugï¼›</li>
<li>å¢åŠ  IncludeMany Take(5) åŠŸèƒ½ï¼Œå®ç°æ¯ä¸ªå­é›†åˆåªå– 5 æ¡è®°å½•ï¼›</li>
</ul>
<h2 id="v0-5-19" tabindex="-1"> v0.5.19</h2>
<ul>
<li>å¢åŠ  ISelect.Include è´ªå©ªåŠ è½½ç¬¬ä¸€ç‰ˆï¼Œå·²é€šè¿‡é›†åˆçš„å¯¼èˆªæ•°æ®åŠ è½½ï¼ŒåŒ…æ‹¬ OneToMany/ManyToManyï¼›</li>
<li>ä¿®æ”¹ IncludeMany ManyToMany ET ç¼“å­˜çš„ bugï¼›</li>
<li>å®Œå–„ IncludeMany è”åˆé”®å¤„ç†ï¼›</li>
<li>å®Œå–„ Include/IncludeMany å•å…ƒæµ‹è¯•ï¼›</li>
<li>ä¿®å¤ Include å»¶æ—¶åŠ è½½ ManyToOne/OneToOneï¼Œå½“å€¼ä¸º null æ—¶ï¼Œä»ç„¶ä¼šæŸ¥è¯¢ä¸€æ¬¡æ•°æ®ï¼›</li>
<li>ä¿®æ”¹ Query/ToList æ··åˆä½¿ç”¨æ—¶ï¼Œå¯èƒ½å¯¼è‡´çš„ ET ç¼“å­˜ bugï¼›</li>
<li>ä¿®æ”¹ Query æŸ¥è¯¢çš„å®ä½“è®¾ç½®äº† IsIgnore æ—¶ï¼Œå¯èƒ½å‡ºç° ET è¯»å–ä½ç½®åç§» bugï¼›</li>
<li>å¢åŠ  å˜å¼‚çš„ IncludeManyï¼Œå³ä½¿ä¸æ˜¯å¯¼èˆªå±æ€§ï¼Œä¹Ÿå¯ä»¥è´ªå©ªåŠ è½½ï¼›</li>
</ul>
<h2 id="v0-5-12" tabindex="-1"> v0.5.12</h2>
<ul>
<li>ä¼˜åŒ– è¿æ¥é¢„çƒ­ç­–ç•¥ï¼šmin pool size ä¸è®¾ç½®æˆ– &lt;= 0ï¼Œåˆ™é»˜è®¤é¢„çƒ­ 5 ä¸ªï¼›ä¹Ÿå¯ä»¥è®¾ç½® 1ï¼›</li>
<li>å–æ¶ˆ MySql CodeFirst å¯¹è¡¨å­—ç¬¦é›†çš„è®¾ç½®ï¼›</li>
<li>å¢åŠ <code>ToList&lt;Dto&gt;()</code> æ–¹æ³•ï¼Œä½œç”¨ä¸ ToList(a =&gt; new Dto()) ç›¸åŒï¼›</li>
</ul>
<h2 id="v0-5-11" tabindex="-1"> v0.5.11</h2>
<ul>
<li>ä¿®å¤ å¤æ‚çš„è¡¨è¾¾å¼è§£æ OR çš„æ‹¬å· bugï¼›</li>
<li>å¢åŠ  linq to sql çš„æŸ¥è¯¢è¯­æ³•ï¼Œä»¥åŠå•å…ƒæµ‹è¯•ï¼Œ<a href="LinqToSql">wiki</a>ï¼›</li>
<li>è¡¥å…… IFreeSql å¢åŠ ä¸å®ç° IDisposable æ¥å£ï¼ˆä¾ç„¶è¦ä¿æŒå•ä¾‹çš„ä½¿ç”¨ä¹ æƒ¯ï¼‰ï¼›</li>
<li>å¢åŠ  CurdBeforeã€CurdAfter AOP äº‹ä»¶ï¼Œå¯ç›‘æ§æ‰§è¡Œå¢åˆ æŸ¥æ”¹ï¼›</li>
<li>å¢åŠ  SyncStructureBeforeã€SyncStructureAfter AOP äº‹ä»¶ï¼Œå¯ç›‘æ§ CodeFirst è¿ç§»ï¼›</li>
</ul>
<h2 id="v0-5-7" tabindex="-1"> v0.5.7</h2>
<ul>
<li>è¡¥å…… nuget åŒ…å¢åŠ  xmlDoc ç¼–è¯‘ï¼ŒåŸæ¥ä½¿ç”¨è€…ä¹‹å‰ä¸€ç›´æ²¡æœ‰æ³¨é‡Šï¼›</li>
<li>è°ƒæ•´ Column.Unique å®šä¹‰è§„åˆ™ï¼Œè§£å†³åŒä¸€å±æ€§ä¸å¯é…ç½®å¤šæ¬¡çš„é—®é¢˜ï¼›</li>
<li>ä¼˜åŒ– å…¼å®¹ä¸åŒæ•°æ®åº“ bool çš„è¡¨è¾¾å¼è§£æï¼Œå¦‚ï¼šWhere(a =&gt; a.Bool)ã€Where(a =&gt; !a.Bool)ï¼›</li>
</ul>
<h2 id="v0-5-5" tabindex="-1"> v0.5.5</h2>
<ul>
<li>å¢åŠ  Column.MapType ç±»å‹æ˜ å°„ï¼Œå¯å°† enum æ˜ å°„ä¸º int/string ç­‰ï¼›</li>
<li>å¢åŠ  Column.Unique å”¯ä¸€é”®ï¼Œå¤šä¸ªå±æ€§æŒ‡å®šç›¸åŒçš„æ ‡è¯†ï¼Œä»£è¡¨è”åˆé”®ï¼Œ<a href="https://github.com/2881099/FreeSql/issues/42" target="_blank" rel="noopener noreferrer">#42</a>ï¼›</li>
<li>å¢åŠ  Expression string.Concatï¼Œ<a href="https://github.com/2881099/FreeSql/issues/39" target="_blank" rel="noopener noreferrer">#39</a>ï¼›</li>
<li>è¡¥å…… Expression IEnumerable<code>&lt;T&gt;</code>.Contains çš„æ”¯æŒï¼Œä¹‹å‰åªèƒ½æ•°ç»„æˆ– IList<code>&lt;T&gt;</code>ï¼›</li>
<li>è¡¥å…… IDbFirst GetTablesByDatabase è¿”å› uk/fk/index åç§°ï¼Œä»¥ä¾¿è¿ç§»ï¼›</li>
<li>è¡¥å…… MapType/Unique å•å…ƒæµ‹è¯•ï¼›</li>
<li>ä¼˜åŒ– PostgreSQL jsonb ç±»å‹ä½¿ç”¨ä¹ æƒ¯ï¼›</li>
</ul>
<h2 id="v0-5-4-é’å¹´ç‰ˆ" tabindex="-1"> v0.5.4(é’å¹´ç‰ˆ)</h2>
<ul>
<li>ä¿®å¤ Expression OrElse ä¸¤ä¾§æ‹¬å·ä¸¢å¤±çš„ bugï¼›</li>
<li>ä¿®å¤ Expression DateTime ç±»å‹ CompareTo åœ¨ MySql/SqlServer ä¸‹çš„ bugï¼›</li>
<li>ä¿®å¤ ISelect.ToList(true) æ— æ•ˆçš„ bugï¼›</li>
<li>å¢åŠ  IAop.ConfigEntity é…ç½®å®ä½“ç‰¹æ€§ï¼Œå¯å®ç°ä½¿ç”¨å…¶ä»– ORM çš„å®ä½“ç‰¹æ€§ï¼Œ<a href="https://github.com/2881099/FreeSql/issues/36" target="_blank" rel="noopener noreferrer">#36</a>ï¼›</li>
<li>ä¼˜åŒ– ISelect.GroupBy æŸ¥è¯¢ï¼Œå¢åŠ  .Value å®ç°èšåˆæºå­—æ®µæŸ¥è¯¢ï¼ŒToList(a =&gt; a.Sum(a.Value.Score))ï¼Œ<a href="https://github.com/2881099/FreeSql/issues/38" target="_blank" rel="noopener noreferrer">#38</a>ï¼›</li>
</ul>
<h2 id="v0-5-3" tabindex="-1"> v0.5.3</h2>
<ul>
<li>å¢åŠ  ISelect.ToList(true) è´ªå©ªåŠ è½½ LeftJoin/InnerJoin/RightJoin å¯¼èˆªæ•°æ®ï¼›</li>
<li>å¢åŠ  IAdo.Query&lt;T1, T2 ...&gt; å¤šç»“æœé›†æŸ¥è¯¢ï¼›</li>
<li>å¢åŠ  IAdo.ExecuteDataSet å¤šç»“æœé›†æŸ¥è¯¢ï¼›</li>
<li>ä¼˜åŒ– æœªè®¾ç½®å®ä½“å±æ€§ set çš„å°†è¢«è‡ªåŠ¨è¿‡æ»¤ IsIgnoreï¼›</li>
</ul>
<h2 id="v0-5-2" tabindex="-1"> v0.5.2</h2>
<ul>
<li>ä¿®å¤ SqlServer å·¥ä½œå•å…ƒ bugï¼Œéœ€è¦åŒæ—¶è®¾ç½® SqlCommand.Connection + Transactionï¼›</li>
<li>è¡¥å…… æµ‹è¯•ä¸æ”¯æŒè”åˆä¸»é”®çš„è‡ªå¢ï¼›</li>
</ul>
<h2 id="v0-5-1-äº”ä¸€ç‰ˆ" tabindex="-1"> v0.5.1(äº”ä¸€ç‰ˆ)</h2>
<ul>
<li>
<p>å¢åŠ  ISelect/IInsert/IUpdate/IDelete.AsType å®ç°å¼±ç±»å‹ curdï¼Œå¦‚ï¼šSelect&lt;object&gt;().AsType(å®ä½“ç±»å‹)ï¼›</p>
</li>
<li>
<p>è¡¥å…… ISelect.From&lt;T2&gt;ï¼›</p>
</li>
<li>
<p>è¡¥å…… ExpressionTree å•å…ƒæµ‹è¯•ï¼›</p>
</li>
<li>
<p>ä¼˜åŒ– ToList(a =&gt; new Dto())ï¼Œä¼šæŒ‰ä¼˜å…ˆçº§æŸ¥è¯¢ Join å®ä½“å±æ€§ï¼›</p>
</li>
<li>
<p>è¡¥å…… IDelete/ISelect/IUpdate WhereDynamic æ–¹æ³•ï¼Œå®ç° dywhere æ¡ä»¶ï¼›</p>
</li>
<li>
<p>ä¿®å¤ WhereObject å†…éƒ¨æ–¹æ³•ï¼Œå½“å¼€å¯ Lazy å»¶æ—¶å±æ€§æ—¶ï¼Œå¹¶ä¸”ä¼ é€’å®ä½“æŸ¥è¯¢æ—¶æ¡ä»¶æ— æ•ˆï¼›</p>
</li>
<li>
<p>è¡¥å…… å®ç°è¡¨è¾¾å¼è½¬æ¢ç±»å‹çš„è§£æï¼Œå¦‚ï¼šSelect&lt;object&gt;().Where(a =&gt; (a as å®ä½“ç±»å‹).Id == 0)ï¼›</p>
</li>
<li>
<p>å®Œå–„ ExpressionTree åŸºç¡€æ•°æ®ç±»å‹ TryParse ä½¿ç”¨ä¸å•å…ƒæµ‹è¯•ï¼›</p>
</li>
<li>
<p>ä¼˜åŒ– ManyToMany ä¸­é—´å®ä½“æœªé…ç½®ä¸»é”®æ—¶ï¼Œè‡ªåŠ¨é…ç½®è”åˆä¸»é”®ï¼›</p>
</li>
<li>
<p>ä¿®å¤ Expression.And çš„ä½¿ç”¨é—®é¢˜ï¼›</p>
</li>
<li>
<p>ä¿®å¤ IsIgnore è¿‡æ»¤å­—æ®µåï¼ŒæŸ¥è¯¢çš„é”™è¯¯ï¼›</p>
</li>
<li>
<p>ä¿®å¤ ISelect2 ä»¥ä¸Š WhereIf æ¡ä»¶ä½œç”¨åäº† bugï¼›</p>
</li>
</ul>
<h2 id="v0-4-15" tabindex="-1"> v0.4.15</h2>
<ul>
<li>ä¼˜åŒ–å†…éƒ¨ QuoteSqlName æ–¹æ³•ï¼›å½“å‚æ•°å€¼æ˜¯ (xxx)ï¼Œåˆ™ç›´æ¥è¿”å›åŸå½¢ã€‚å¦‚ï¼šxxx =&gt; [xxx]ï¼Œ(max(1)) =&gt; (max(1))ï¼›
<blockquote>
<p>å¯å®ç°åŠŸèƒ½ï¼Œå¦‚ï¼šorm.Select&lt;xxx&gt;().AsTable((a,b) =&gt; &quot;select * from xxx&quot;).Page(1, 20).ToSql()</p>
</blockquote>
</li>
<li>å¢åŠ  Oracle IDbFirst æ¥å£å®ç°ï¼›</li>
<li>è¡¥å…… å¼€æ”¾ IUpdate UpdateColumns æ–¹æ³•åŠŸèƒ½ï¼Œå®ç°æ›´æ–°å®ä½“æ—¶ï¼Œåªæ›´æ–°æŒ‡å®šçš„åˆ—ï¼ˆä¸ IgnoreColumns å¯¹åº”ï¼‰ï¼›</li>
</ul>
<h2 id="v0-4-13" tabindex="-1"> v0.4.13</h2>
<ul>
<li>ä¼˜åŒ– MySql æ—¥æœŸç±»å‹ç²¾ç¡®è‡³æ¯«ç§’ï¼›</li>
<li>å¢åŠ  Distinct æŸ¥è¯¢å‰å»é‡æ•°æ®ï¼›</li>
</ul>
<h2 id="v0-4-12" tabindex="-1"> v0.4.12</h2>
<ul>
<li>å¢åŠ  First/FirstAsync æŒ‡å®šå­—æ®µæŸ¥è¯¢çš„é‡è½½æ–¹æ³•ï¼›</li>
<li>è°ƒæ•´ FreeSql.Repository ç›´æ¥å¼•ç”¨ FreeSql.DbContext å†…çš„ä»“å‚¨å®ç°ï¼›</li>
<li>ç§»åŠ¨ FreeSql.Repository è‡³ FreeSql.DbContextï¼›</li>
<li>è¡¥å…… å•ç‹¬é’ˆå¯¹ MySql æšä¸¾ç±»å‹çš„å•å…ƒæµ‹è¯•ï¼›</li>
</ul>
<h2 id="v0-4-11" tabindex="-1"> v0.4.11</h2>
<ul>
<li>ä¿®å¤ .ToList(a =&gt; a.id) å½“ id æ˜¯ guid ç±»å‹æ—¶ï¼Œä¼šå‡ºç°ç±»å‹è½¬æ¢å¤±è´¥ bugï¼›</li>
</ul>
<h2 id="v0-4-10" tabindex="-1"> v0.4.10</h2>
<ul>
<li>ä¼˜åŒ– è¿æ¥æ± å¯¹è±¡é¢„çƒ­æ•ˆç‡ï¼Œå¼€å¯æ¯ 10 ä¸ªçº¿ç¨‹è¿›è¡Œé¢„çƒ­ï¼Œé¢„çƒ­æ—¶é—´è¶…è¿‡ 3 ç§’åˆ™æ”¾å¼ƒï¼›</li>
<li>ä¿®å¤ MySql æšä¸¾è¡¨è¾¾å¼ == è§£ææˆæ•°å­—çš„ bugï¼›</li>
<li>è¡¥å…… IAdo ç›¸å…³æ–¹æ³•ï¼Œå®ç° FreeSql.Connection.Extensions æ‰©å±•åŒ…ï¼Œåƒ Dapper çš„ä½¿ç”¨ä¹ æƒ¯ï¼›</li>
</ul>
<h2 id="v0-4-9" tabindex="-1"> v0.4.9</h2>
<ul>
<li>ä¿®å¤ pgsql Enum ç±»å‹ formatSql bugï¼›</li>
<li>è¡¥å…… è¡¨è¾¾å¼è§£æ Equals ä¸º = <a href="https://github.com/2881099/FreeSql/issues/28" target="_blank" rel="noopener noreferrer">#28</a> <a href="https://github.com/2881099/FreeSql/issues/29" target="_blank" rel="noopener noreferrer">#29</a>ï¼›</li>
</ul>
<h2 id="v0-4-5-æ¸…æ˜ç‰ˆæœ¬" tabindex="-1"> v0.4.5(æ¸…æ˜ç‰ˆæœ¬)</h2>
<ul>
<li>ä¼˜åŒ– IFreeSql.Transaction å¯åµŒå¥—è¿ç»­ä½¿ç”¨ï¼Œä¹‹å‰ä¼šæ­»é”ï¼›</li>
<li>ä¿®å¤ å¯¼èˆªå±æ€§çš„å…³ç³»ï¼Œè¯¯å°† ManyToOne è®¾ç½®æˆäº† OneToManyï¼›</li>
<li>è¡¥å…… DbFirst GetTablesByDatabase è·å–è¡¨å¤‡æ³¨ï¼›</li>
<li>è¡¥å…… ISelect.ToList(a =&gt; new XxxDto { XxxId = a.Id, ... }) æ”¯æŒï¼Œä¹‹å‰åªèƒ½æ”¯æŒåŒ¿åç±»ï¼›</li>
<li>è¡¥å…… æ‰©å±• IUpdate.Set(a =&gt; a.Title + &quot;111&quot;) æŒ‡å®šå­—æ®µåœ¨åŸåŸºç¡€ä¸Šå¢åŠ å€¼çš„èŒƒå›´ï¼Œä¹‹å‰åªæ”¯æŒæ•°å­—ç±»å‹çš„ç´¯åŠ ï¼›</li>
</ul>
<h2 id="v0-4-1" tabindex="-1"> v0.4.1</h2>
<ul>
<li>æŠ½ç¦» FreeSql.DbContext é¡¹ç›®ç‹¬ç«‹è‡³ https://github.com/2881099/FreeSql.DbContextï¼Œå®ç°é¢å‘å¯¹è±¡ORMï¼›</li>
<li>è¡¥å…… CodeFirst Fluent ä¹‹ IsVersion ä¹è§‚é”é…ç½®ï¼›</li>
</ul>
<h2 id="v0-3-27" tabindex="-1"> v0.3.27</h2>
<ul>
<li>å¢åŠ  ä¹è§‚é”åŠŸèƒ½ï¼Œé€‚ç”¨ä¿®æ”¹å®ä½“ï¼›</li>
<li>å¢åŠ  FreeSql.Repository é»˜è®¤ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼ŒåŒæ—¶ä¿ç•™åŸæœ‰ Autofacï¼›</li>
<li>ä¼˜åŒ– FreeSql.Repository Insert é€»è¾‘ï¼Œå‚è€ƒäº† FreeSql.DbContextï¼›</li>
<li>ä¼˜åŒ– FreeSql.IUpdate å‚ç…§ IInsert å¯¹å¤§æ‰¹é‡æ›´æ–°ï¼Œæ‹†åˆ†æ‰§è¡Œï¼›</li>
<li>ä¿®å¤ FreeSql.IInsert ClearData é‡å¤åˆ©ç”¨çš„ bugï¼ˆä½¿ç”¨ IgnoreColumns è¿›è¡Œå¤§æ‰¹é‡æ’å…¥æ—¶ä¼šå‘ç”Ÿï¼‰ï¼›</li>
</ul>
<h2 id="v0-3-26" tabindex="-1"> v0.3.26</h2>
<ul>
<li>ä¿®å¤ SqlServer CodeFirst è¿ç§»è”åˆä¸»é”®çš„ bug <a href="https://github.com/2881099/FreeSql/issues/23" target="_blank" rel="noopener noreferrer">#23</a>ï¼›</li>
</ul>
<h2 id="v0-3-25" tabindex="-1"> v0.3.25</h2>
<ul>
<li>ä¿®å¤ å…¨å±€è¿‡æ»¤å™¨ä¸€ä¸ªèµ‹å€¼ä½çº§é”™è¯¯ï¼›</li>
<li>å¢åŠ  IFreeSql&lt;TMark&gt; ç©ºæ¥å£ï¼Œå®ç°å¤šä¸ª IFreeSql æ³¨å…¥ä½¿ç”¨ï¼Œä½¿ç”¨æ³›å‹æ ‡è¯†åŒºåˆ†ï¼›</li>
</ul>
<h2 id="v0-3-24" tabindex="-1"> v0.3.24</h2>
<ul>
<li>å¢åŠ  GroupBy åˆ†é¡µæ–¹æ³•ï¼›</li>
<li>ä¿®å¤ Insert å‚æ•°åŒ–å‘½å bugï¼Œå½“å­˜åœ¨ Id Id2 æ—¶å‘ç”Ÿï¼›</li>
<li>ä¼˜åŒ– Insert/Delete/Update å¯¹è±¡æ‰§è¡Œå®Œåæ¸…ç†æ•°æ®ï¼Œä»¥å¤‡å¤šæ¬¡ä½¿ç”¨ï¼›</li>
</ul>
<h2 id="v0-3-23" tabindex="-1"> v0.3.23</h2>
<ul>
<li>ä¿®å¤ å› åŠŸèƒ½å¢åŠ ï¼Œå¯¼è‡´è”è¡¨æŸ¥è¯¢å‡ºç°çš„è¡¨è¾¾å¼å‡½æ•°è§£æ bugï¼›</li>
<li>ä¿®å¤ å› åŠŸèƒ½å¢åŠ ï¼Œå¯¼è‡´æŸ¥è¯¢æ•°æ®æ—¶ï¼ŒExpressionTree bugï¼›</li>
</ul>
<h2 id="v0-3-22" tabindex="-1"> v0.3.22</h2>
<ul>
<li>ä¼˜åŒ– å¯¼èˆªå±æ€§ ManyToOne åç§°æŸ¥æ‰¾è§„åˆ™ï¼›</li>
<li>å¢åŠ  IFreeSql.Aop å±æ€§ï¼Œæœªæ¥æ‰€æœ‰æ‹¦æˆªæ–¹æ³•éƒ½åœ¨è¿™é‡Œï¼Œç¬¬ä¸€æœŸæ”¯æŒå¦‚ä¸‹ï¼š
<ul>
<li>ç›‘æ§ ToList è¿”å›çš„çš„æ•°æ®ï¼Œç”¨äºæ‹¦æˆªé‡æ–°è£…é¥°ï¼›</li>
<li>ç›‘è§† Whereï¼ŒåŒ…æ‹¬ select/update/deleteï¼Œè¿”å›å€¼ true æ—¶å¯ä½¿ä¸Šå±‚ä¸è¢«æ‰§è¡Œï¼›</li>
<li>å¯è‡ªå®šä¹‰è§£æè¡¨è¾¾å¼ï¼›</li>
</ul>
</li>
<li>å¢åŠ  ISelect.TractToListï¼Œç”¨äºå•æ¬¡è·Ÿè¸ªæˆ–å®¡æ ¸å®ä½“ï¼›</li>
<li>ä¼˜åŒ– FreeSql.DbContext SaveChangesï¼›</li>
</ul>
<h2 id="v0-3-21" tabindex="-1"> v0.3.21</h2>
<ul>
<li>å¢åŠ  IUpdate IgnoreColumns é‡è½½æ–¹æ³•ï¼Œæ”¯æŒä¼ å…¥å­—ç¬¦ä¸²æ•°ç»„å¿½ç•¥ä¿®æ”¹ï¼›</li>
<li>å®Œå–„ FreeSql.DbContextï¼Œæ”¯æŒå¯¹è±¡æ“ä½œ + SaveChanges æœ€åä¿å­˜æ“ä½œï¼›</li>
</ul>
<h2 id="v0-3-20" tabindex="-1"> v0.3.20</h2>
<ul>
<li>ä¿®å¤ ToList é€‰æ‹©æŒ‡å®šå¯¹è±¡æ—¶ï¼Œåº”é™„åŠ æ‰€æœ‰å­—æ®µæŸ¥è¯¢è¿”å›ï¼›</li>
<li>ä¿®å¤ Lazy å»¶æ—¶ç±»ä¸å®ä½“å…³ç³»å†²çª bugï¼›</li>
<li>ä¿®å¤ é™„åŠ å¯¹è±¡è¯»å–æ—¶ï¼Œè®°å½•ä¸ºç©ºåº”è¯¥è¿”å› nullï¼Œè€Œä¸æ˜¯è¿”å›é nullï¼ˆå­—æ®µé»˜è®¤å€¼ï¼‰å¯¹è±¡ï¼›</li>
</ul>
<h2 id="v0-3-19" tabindex="-1"> v0.3.19</h2>
<ul>
<li>å…¼å®¹ GetTableByEntity æœ‰å¯èƒ½å› ä¸ºä¼ å…¥æ•°ç»„ç±»å‹çš„é”™è¯¯ï¼›</li>
<li>ä¿®å¤ UnitOfWork äº‹åŠ¡åˆ›å»ºé€»è¾‘ bugï¼›</li>
<li>å¢åŠ  FreeSql.DbContext æ‰©å±•åŒ…ï¼›</li>
<li>è°ƒæ•´ UnitOfWorkã€DbContext ä¸æäº¤æ—¶é»˜è®¤ä¼šå›æ»šï¼›</li>
</ul>
<h2 id="v0-3-18" tabindex="-1"> v0.3.18</h2>
<ul>
<li>å¢åŠ  IInsert å¯¹æ•°ç»„ä¼ å…¥çš„æ”¯æŒï¼Œä¹‹å‰æ˜¯ <code>IEnumerable&lt;T&gt;</code>ï¼›</li>
<li>å¢åŠ  ORM æ€§èƒ½æµ‹è¯•é¡¹ç›® Examples/orm_vsï¼›</li>
</ul>
<h2 id="v0-3-17" tabindex="-1"> v0.3.17</h2>
<ul>
<li>ä¿®å¤ SqlServer DbFirst æ•°æ®åº“åä¼ å…¥å¸¦å°æ•°ç‚¹çš„ bug <a href="https://github.com/2881099/FreeSql/issues/18" target="_blank" rel="noopener noreferrer">#18</a>ï¼›</li>
<li>ä¿®å¤ ILIst.Contains Expression <a href="https://github.com/2881099/FreeSql/issues/16" target="_blank" rel="noopener noreferrer">#16</a>ï¼›</li>
<li>æ•´ç† å»¶æ—¶åŠ è½½/å¯¼èˆªå±æ€§æŸ¥è¯¢çš„å¯¹è±¡å…³ç³»ï¼Œä»ç„¶ä¸ä¾èµ–å¤–é”®ï¼›</li>
<li>å®Œæˆ OneToOne/ManyToOneã€ManyToMany/OneToMany å¯¼èˆªå±æ€§çš„æŸ¥è¯¢ <a href="https://github.com/2881099/FreeSql/issues/15" target="_blank" rel="noopener noreferrer">#15</a>ï¼›</li>
<li>å¢åŠ  IEnumerable<code>&lt;TEntity&gt;</code> æ‰©å±•æ–¹æ³• AsSelectï¼Œè½¬æˆ <code>ISelect&lt;T&gt;</code>ï¼Œä»¥ä¾¿ä½¿ç”¨ FreeSql çš„æŸ¥è¯¢åŠŸèƒ½ï¼›</li>
<li>å¢åŠ  int.Parse Guid.Parse ç³»åˆ—è½¬æ¢ã€Guid.NewGuidã€new Random.NextDouble ç­‰è¡¨è¾¾å¼å‡½æ•°è§£æï¼›</li>
</ul>
<h2 id="v0-3-16" tabindex="-1"> v0.3.16</h2>
<ul>
<li>ä¿®å¤ IInsert/IUpdate.NoneParameter() è®¾æˆäº†åä½œç”¨çš„ bugï¼›</li>
<li>ä¿®å¤ IDbFirst.GetTablesByDatabase é»˜è®¤æ•°æ®åº“ bool åˆ¤æ–­ bugï¼›</li>
<li>å¢åŠ  FreeSql.Repository ä¹‹ IUnitOfWork å®ç°ï¼›</li>
<li>å¢åŠ  FreeSql.Repository ç»§æ‰¿å®ç°çš„ä»“å‚¨æ³¨å…¥ï¼›</li>
</ul>
<div><pre><code>builder<span>.</span><span>RegisterFreeRepository</span><span>(</span>
    filter <span>=></span> filter<span>.</span><span><span>Apply</span><span><span>&lt;</span>Song<span>></span></span></span><span>(</span><span>"test"</span><span>,</span> a <span>=></span> a<span>.</span>Title <span>==</span> DateTime<span>.</span>Now<span>.</span><span>ToString</span><span>(</span><span>)</span> <span>+</span>
        Thread<span>.</span>CurrentThread<span>.</span>ManagedThreadId<span>)</span><span>,</span>
    <span>this</span><span>.</span><span>GetType</span><span>(</span><span>)</span><span>.</span>Assembly
<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="v0-3-15" tabindex="-1"> v0.3.15</h2>
<ul>
<li>å¢åŠ  ISelect.ToDataTable ç³»åˆ—æ–¹æ³•ï¼›</li>
<li>å¢åŠ  æ— å‚æ•°åŒ–å‘½ä»¤æ‰§è¡Œï¼Œå¯é…ç½®å…¨å±€ ICodeFirst.IsNoneCommandParameterã€æˆ–ä¸´æ—¶ IInsert/IUpdate.NoneParameter() ä¾¿äºè°ƒè¯•ï¼›</li>
<li>å…³é—­ è‡ªåŠ¨åŒæ­¥ç»“æ„åŠŸèƒ½ï¼Œé¿å…çº¿ä¸Šç¯å¢ƒè¯¯æ“ä½œï¼›</li>
<li>ä¼˜åŒ– IInsert æ‰¹é‡æ’å…¥å®¹æ˜“å¯¼è‡´ values è¿‡å¤šã€æˆ–å‚æ•°åŒ–è¿‡å¤šçš„é—®é¢˜ï¼Œ5 ä¸ªæ•°æ®åº“å‡å·²ä¼˜åŒ–ï¼›</li>
</ul>
<h2 id="v0-3-14" tabindex="-1"> v0.3.14</h2>
<ul>
<li>è§£å†³ SqlServer æ‰¹é‡æ·»åŠ å®¹æ˜“å¯¼è‡´çš„é”™è¯¯ï¼šä¼ å…¥çš„è¯·æ±‚å…·æœ‰è¿‡å¤šçš„å‚æ•°ã€‚è¯¥æœåŠ¡å™¨æ”¯æŒæœ€å¤š 2100 ä¸ªå‚æ•°ã€‚è¯·å‡å°‘å‚æ•°çš„æ•°ç›®ï¼Œç„¶åé‡æ–°å‘é€è¯¥è¯·æ±‚ã€‚åŸç†ä¸ºæ‹†æˆå¤šä¸ªåŒ…ç”¨äº‹åŠ¡æ‰§è¡Œï¼›</li>
</ul>
<h2 id="v0-3-13" tabindex="-1"> v0.3.13</h2>
<ul>
<li>ä¿®æ”¹ FreeSql.Repository Autofac æ³¨å…¥æ–¹å¼ï¼ŒçœŸæ­£çš„å®ç°å…¨å±€è¿‡æ»¤åŠŸèƒ½ï¼›</li>
<li>å¢åŠ  FreeSql.Repository DataFilter å±æ€§ï¼›</li>
</ul>
<div><pre><code>repos<span>.</span>DataFilter<span>.</span><span>Disable</span><span>(</span><span>"test"</span><span>)</span> ä¸´æ—¶ç¦ç”¨ï¼Œä¸å½±å“å…¨éƒ¨ï¼›
repos<span>.</span>DataFilter<span>.</span><span>DisableAll</span><span>(</span><span>)</span>
repos<span>.</span>DataFilter<span>.</span><span>Enable</span><span>(</span><span>"test"</span><span>)</span>
repos<span>.</span>DataFilter<span>.</span><span>EnableAll</span><span>(</span><span>)</span>
repos<span>.</span>DataFilter<span>.</span><span>Apply</span><span>(</span><span>"name"</span><span>,</span> a <span>=></span> a<span>.</span>Id <span>></span> <span>1</span><span>)</span> é™„åŠ æ–°çš„è¿‡æ»¤å™¨
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ul>
<li>å¢åŠ  using DataFilter.Disableã€Enable ä½¿ç”¨å®Œæˆåæ¢å¤å¯ç”¨çŠ¶æ€ï¼›</li>
</ul>
<h2 id="v0-3-12" tabindex="-1"> v0.3.12</h2>
<ul>
<li>å¢åŠ  ICodeFirst.IsConfigEntityFromDbFirstï¼Œè‹¥æ— é…ç½®å®ä½“ç±»ä¸»é”®ã€è‡ªå¢ï¼Œå¯ä»æ•°æ®åº“å¯¼å…¥ï¼›</li>
</ul>
<h2 id="v0-3-11" tabindex="-1"> v0.3.11</h2>
<ul>
<li>å¢åŠ  ISelectã€IInsertã€IUpdateã€IDelete WithTransaction æ–¹æ³•ï¼Œå°†äº‹åŠ¡å¯¹è±¡æš´éœ²ç»™å¤–éƒ¨ï¼›</li>
<li>å¢åŠ  IAdo ExecuteXxx ç³»åˆ—æ–¹æ³•é‡è½½ï¼Œæ”¯æŒäº‹åŠ¡å¯¹è±¡çš„ä¼ å…¥ï¼›</li>
</ul>
<h2 id="v0-1-14" tabindex="-1"> v0.1.14</h2>
<ul>
<li>å¢åŠ  å»¶æ—¶å±æ€§ç¼–è¯‘çš„é”™è¯¯æç¤ºï¼›</li>
<li>ä¼˜åŒ– FreeSql.Repository Autofac æ³›å‹æ³¨å…¥ï¼›</li>
</ul>
<h2 id="v0-1-13" tabindex="-1"> v0.1.13</h2>
<ul>
<li>ä¿®æ”¹ è¿æ¥æ± å†…éƒ¨ Ping Timeout å€¼æš‚å®š 5 ç§’ï¼›</li>
<li>ä¼˜åŒ– åˆå§‹åŒ–æ—¶è‹¥æ•°æ®åº“è¶…æ—¶ï¼Œåˆ™æ”¾å¼ƒé¢„çƒ­ï¼›</li>
<li>FreeSql.Repository ä¸‹å¢åŠ  ISelect.FromRepository æ‰©å±•æ–¹æ³•ï¼Œå®ç°å¿«é€Ÿåˆå¹¶å¤šä¸ªä»“å‚¨æŸ¥è¯¢ï¼›</li>
<li>å¢åŠ  FreeSql.Repository Autofac æ³›å‹æ³¨å…¥ï¼Œæ”¯æŒå®ç°å…¨å±€è¿‡æ»¤ï¼›</li>
<li>è¡¥å…… GuidRepository æ’å…¥æ•°æ®æ—¶ï¼Œæ ¹æ® filter å‚æ•°è®¾å®šè¿›è¡Œæ•°æ®éªŒè¯ï¼›</li>
</ul>
<h2 id="v0-1-12" tabindex="-1"> v0.1.12</h2>
<ul>
<li>å‡çº§ nuget ä¾èµ–åŒ…ï¼›</li>
<li>å¢åŠ  .netframework 4.6.1 ç¤ºèŒƒé¡¹ç›®ï¼›</li>
<li>PostgreSQL è¿æ¥æ± å¤§å°é»˜è®¤å€¼æ”¹ä¸º 50ï¼›</li>
<li>ISelect å¢åŠ  Any/AnyAsync(Expression)ï¼Œä¸ºçš„å°‘å†™ä¸€ä¸ª Whereï¼›</li>
<li>å…³é—­ CSScriptLib Debug ç¼–è¯‘ï¼Œé˜²æ­¢æƒé™é”™è¯¯ï¼›</li>
</ul>
<h2 id="v0-1-11" tabindex="-1"> v0.1.11</h2>
<ul>
<li>FreeSql ISelect/IUpdate/IInsert/IDelete å¢åŠ  AsTable æ–¹æ³•ï¼Œå®ç°åˆ†è¡¨ï¼›</li>
<li>FreeSql.Repository ä¹‹ GuidRepository å®ç°åˆ†è¡¨æ‰©å±•ï¼ŒåŸå› ç³» Guid é€‚åˆä½œåˆ†å¸ƒå¼å­˜å‚¨ï¼›</li>
</ul>
<h2 id="v0-1-10" tabindex="-1"> v0.1.10</h2>
<ul>
<li>ä¿®å¤ FreeSql.Repository GuidRepository/GetGuidRepository ç¼“å­˜ bugï¼›</li>
<li>ä¿®å¤ Lazy å»¶æ—¶åŠ è½½åœ¨ linux å‘å¸ƒåäº§ç”Ÿ Bad IL Format bugï¼›</li>
</ul>
<h2 id="v0-1-9" tabindex="-1"> v0.1.9</h2>
<ul>
<li>ä¼˜åŒ–æ’å…¥åˆ¤æ–­ä¸»é”®ï¼Œä¸”ä¸º Guid/Guid? ç±»å‹ï¼Œå¹¶ä¸”å€¼ä¸º null/Guid.Empty æ—¶ï¼Œå°†æ’å…¥çš„å€¼å˜ä¸º FreeUtil.NewMongodbId();</li>
</ul>
<h2 id="v0-1-8" tabindex="-1"> v0.1.8</h2>
<ul>
<li>å‡çº§ nuget ä¾èµ–åŒ…ï¼›</li>
</ul>
<h2 id="v0-1-7" tabindex="-1"> v0.1.7</h2>
<ul>
<li>FreeSql.Repository å¢åŠ  filter å‚æ•°ï¼Œå®ç°æ•°æ®è¿‡æ»¤ + éªŒè¯ï¼›
å¦‚ï¼švar postRepos = fsql.GetGuidRepository<code>&lt;Post&gt;</code>(a =&gt; a.TopicId == 1); postRepos CURD æ–¹æ³•éƒ½ä¼šä»¥ lambda æ¡ä»¶ä½œä¸ºæŸ¥è¯¢æˆ–éªŒè¯ï¼ŒUpdate/Insert éªŒè¯é”™è¯¯æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>ISelect å¢åŠ  First/FirstAsyncï¼›</li>
</ul>
<h2 id="v0-1-6" tabindex="-1"> v0.1.6</h2>
<ul>
<li>ä¿®å¤ FluentApiConfigEntity ä¸ å»¶æ—¶åŠ è½½ å†²çªäº§ç”Ÿçš„ bugï¼›</li>
</ul>
<h2 id="v0-1-5" tabindex="-1"> v0.1.5</h2>
<ul>
<li>åˆ é™¤ IsQuoteSqlName å‚æ•°é…ç½®ï¼›</li>
<li>å¢åŠ  IsSyncStructureToUpper å‚æ•°é…ç½®ï¼Œä»¥ä¾¿é€‚åº” Oracle å¤§å°å†™ä½¿ç”¨ä¹ æƒ¯ï¼›</li>
<li>FreeSql.Repository å¢åŠ  GuidRepository ç±»ï¼Œé€‚ç”¨ Insert æ–¹æ³•æ— é¡»è¿”å›æ’å…¥çš„æ•°æ®ï¼›</li>
<li>FreeSql.Repository å¢åŠ  IFreeSql æ‰©å±•æ–¹æ³• GetRepositoryã€GetGuidRepositoryï¼›</li>
</ul>
<h2 id="v0-1-4" tabindex="-1"> v0.1.4</h2>
<ul>
<li>ä¿®å¤ SqlServer CodeFirst è¿ç§»ç»“æ„æ—¶ï¼Œå› æ—¥æœŸé»˜è®¤å€¼çš„è¯­æ³•é”™è¯¯ï¼›</li>
<li>åˆ¤æ–­ SqlServer æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œé€‰æ‹©åˆ†é¡µæ¨¡å¼ row_number æˆ– offset fetch nextï¼›</li>
</ul>
<h2 id="v0-1-3" tabindex="-1"> v0.1.3</h2>
<ul>
<li>FreeSql.Repository Insert æ–¹æ³•åˆ¤æ–­æ•°æ®åº“ç±»å‹ï¼Œç”±äº MySql/Oracle/Sqlite ä¸æ”¯æŒ returning æˆ– output ç±»å‹çš„ç‰¹æ€§ï¼Œå› æ­¤ä¸ä½œå®ç°å®šä¹‰ä¸º virtual äº¤ç»™å¤–éƒ¨ï¼ˆä¸åŒ…æ‹¬ PostgreSQL/SqlServerï¼‰ï¼›</li>
</ul>
<h2 id="v0-1-2" tabindex="-1"> v0.1.2</h2>
<ul>
<li>å¢åŠ  sqlserver2012 offset fetch next çš„åˆ†é¡µæ–¹å¼ï¼›</li>
<li>å¢åŠ  ICodeFirst.GetConfigEntity æ–¹æ³•ï¼›</li>
</ul>
<h2 id="v0-1-1" tabindex="-1"> v0.1.1</h2>
<ul>
<li>å¢åŠ é€‰é¡¹ IsQuoteSqlName æ§åˆ¶æ˜¯å¦ä½¿ç”¨ [] æˆ– &quot;&quot; æˆ– `` åŒ…å«æ•°æ®åº“åç§° <a href="https://github.com/2881099/FreeSql/issues/6" target="_blank" rel="noopener noreferrer">#6</a>ï¼›</li>
</ul>
<h2 id="v0-1-0" tabindex="-1"> v0.1.0</h2>
<ul>
<li>å¢åŠ  FreeSql.Repository æ‰©å±•åº“ï¼Œå®ç°å®ä½“ç±»çš„é»˜è®¤ä»“å‚¨ï¼›</li>
<li>å¢åŠ ä¸»é”®å‘½åçº¦å®šï¼šåœ¨æ²¡æœ‰è®¾ç½®ä¸»é”®çš„æƒ…å†µä¸‹ï¼ŒId æˆ– &lt;type name&gt;Id æˆ– &lt;type name&gt;_Id æˆ– è‡ªå¢åˆ— ä¼šæˆä¸ºä¸»é”®ï¼›</li>
<li>å®ä½“ç‰¹æ€§ Column å¢åŠ  IsIgnore å¿½ç•¥è¾¾åˆ°ä¸æ˜ å°„çš„ç›®çš„ï¼›</li>
<li>å¢åŠ  repository_01 ç¤ºä¾‹é¡¹ç›®ï¼Œæ¼”ç¤º FreeSql.Repositoryï¼›</li>
<li>å¢åŠ  website FreeSql å®˜æ–¹é¡¹ç›®æºç ï¼›</li>
</ul>
<h2 id="v0-0-14" tabindex="-1"> v0.0.14</h2>
<ul>
<li>ICodeFirst.ConfigEntity å¯æ›´æ–°å®ä½“é…ç½®å·²ç¼“å­˜çš„æ•°æ®ï¼›</li>
<li>é˜²æ­¢åŒè¿æ¥å­—ç¬¦ä¸²è¢« IFreeSql ä½¿ç”¨å¤šæ¬¡ï¼Œå‘ç”Ÿè¿æ¥æ± æº¢å‡º bugï¼ˆado.net è¿æ¥æ± åŸç†ï¼Œå‡å°‘è§£é‡Šæˆæœ¬ï¼‰ï¼›</li>
<li>å¢åŠ  efcore_to_freesql ç¤ºä¾‹é¡¹ç›®ï¼Œå®ç°ä¸ EFCore å®ä½“å…±å­˜ï¼›</li>
</ul>
<h2 id="v0-0-13" tabindex="-1"> v0.0.13</h2>
<ul>
<li>ä¿®å¤å’Œä¸°å¯Œ ICodeFirst.ConfigEntity æ–¹æ³•ï¼›</li>
<li>å¢åŠ  FreeSql.Extensions.EFCoreModelBuilder æ‰©å±•åº“ï¼Œå®ç°ä¸ EFCore å®ä½“å…±å­˜ <a href="https://github.com/2881099/FreeSql/issues/4" target="_blank" rel="noopener noreferrer">#4</a>ï¼›</li>
<li>å¢åŠ  restful ç¤ºä¾‹é¡¹ç›®ï¼›</li>
</ul>
<h2 id="v0-0-12" tabindex="-1"> v0.0.12</h2>
<ul>
<li>lazy å»¶æ—¶å±æ€§çˆ¶å­å…³ç³»çš„ 1v å¤šç±»å‹åˆ¤æ–­ä¿®æ­£ï¼Œè§£å†³ int? != int çš„ bugï¼›</li>
<li>ThreadLocal ä¿®æ”¹ä½¿ç”¨æ–¹å¼ï¼›</li>
<li>ä½¿ç”¨ virtual åå®ä½“åºåˆ—åŒ–é—®é¢˜ <a href="https://github.com/2881099/FreeSql/issues/5" target="_blank" rel="noopener noreferrer">#5</a>ï¼Œç§æœ‰åŒ–å±æ€§ï¼›</li>
<li>ç”±äº FreeSql é‡‡ç”¨äºŒæ¬¡å°è£…è¿æ¥æ± ï¼Œå°½é‡é¿å…ä½¿ç”¨é—®é¢˜ï¼ŒçœŸå®çš„ max pool size å€¼ç­‰äºä¼ å…¥å€¼+1ï¼›</li>
</ul>
<h2 id="v0-0-11" tabindex="-1"> v0.0.11</h2>
<ul>
<li>ä¿®å¤ IAdo.Query ç›´æ¥æŸ¥è¯¢ sql çš„ bugï¼›</li>
<li>é‡æ–°æ£€æŸ¥é€šè¿‡æ‰€æœ‰å•å…ƒæµ‹è¯•ï¼›</li>
</ul>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">å¸¸è§é—®é¢˜</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/reference/faq.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/reference/faq.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å¸¸è§é—®é¢˜" tabindex="-1"> å¸¸è§é—®é¢˜</h1>
<h3 id="_1ã€å¦‚ä½•ç›‘è§†-sql" tabindex="-1"> 1ã€å¦‚ä½•ç›‘è§† SQLï¼Ÿ</h3>
<p>æ–¹æ³•ä¸€ï¼šUseMonitorCommand + UseNoneCommandParameter</p>
<div><pre><code><span>static</span> <span>IFreeSql</span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
  <span>.</span><span>UseConnectionString</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>MySql<span>,</span> <span>"..."</span><span>)</span>
  <span>.</span><span>UseMonitorCommand</span><span>(</span>cmd <span>=></span> Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$"çº¿ç¨‹ï¼š</span><span><span>{</span><span>cmd<span>.</span>CommandText</span><span>}</span></span><span>\r\n"</span></span><span>)</span><span>)</span>
  <span>.</span><span>UseNoneCommandParameter</span><span>(</span><span>true</span><span>)</span>
  <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>æ–¹æ³•äºŒï¼šAop.CurdBefore/CurdAfter</p>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>CurdAfter <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span>
<span>{</span>
  <span>if</span> <span>(</span>e<span>.</span>ElapsedMilliseconds <span>></span> <span>200</span><span>)</span>
    Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$"çº¿ç¨‹ï¼š</span><span><span>{</span><span>e<span>.</span>Sql</span><span>}</span></span><span>\r\n"</span></span><span>)</span><span>;</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><hr>
<h3 id="_2ã€mysql-enum-æ˜ å°„" tabindex="-1"> 2ã€MySql Enum æ˜ å°„</h3>
<p>é»˜è®¤æƒ…å†µ c# æšä¸¾ä¼šæ˜ å°„ä¸º MySql Enum ç±»å‹ï¼Œå¦‚æœæƒ³æ˜ å°„ä¸º int åœ¨ FreeSqlBuilder Build ä¹‹åæ‰§è¡Œä»¥ä¸‹ Aop ç»Ÿä¸€å¤„ç†ï¼š</p>
<div><pre><code>fsql<span>.</span>Aop<span>.</span>ConfigEntityProperty <span>+=</span> <span>(</span>s<span>,</span> e<span>)</span> <span>=></span> <span>{</span>
  <span>if</span> <span>(</span>e<span>.</span>Property<span>.</span>PropertyType<span>.</span>IsEnum<span>)</span>
    e<span>.</span>ModifyResult<span>.</span>MapType <span>=</span> <span>typeof</span><span>(</span><span><span>int</span></span><span>)</span><span>;</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><hr>
<h3 id="_3ã€å¤šä¸ª-ifreesql-å®ä¾‹-å¦‚ä½•æ³¨å…¥ä½¿ç”¨" tabindex="-1"> 3ã€å¤šä¸ª IFreeSql å®ä¾‹ï¼Œå¦‚ä½•æ³¨å…¥ä½¿ç”¨ï¼Ÿ</h3>
<p><a href="https://github.com/dotnetcore/FreeSql/issues/44" target="_blank" rel="noopener noreferrer">https://github.com/dotnetcore/FreeSql/issues/44</a></p>
<hr>
<h3 id="_4ã€transactionalattribute-unitofworkmanager-äº‹åŠ¡ä¼ æ’­" tabindex="-1"> 4ã€TransactionalAttribute + UnitOfWorkManager äº‹åŠ¡ä¼ æ’­</h3>
<p><a href="https://github.com/dotnetcore/FreeSql/issues/289" target="_blank" rel="noopener noreferrer">https://github.com/dotnetcore/FreeSql/issues/289</a></p>
<hr>
<h3 id="_5ã€æ€ä¹ˆæ‰§è¡Œ-sql-è¿”å›å®ä½“åˆ—è¡¨" tabindex="-1"> 5ã€æ€ä¹ˆæ‰§è¡Œ SQL è¿”å›å®ä½“åˆ—è¡¨ï¼Ÿ</h3>
<div><pre><code><span>//ç›´æ¥æŸ¥è¯¢</span>
fsql<span>.</span>Ado<span>.</span><span><span>Query</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span>sql<span>)</span><span>;</span>

<span>//åµŒå¥—ä¸€å±‚åšäºŒæ¬¡æŸ¥è¯¢</span>
fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>T<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>WithSql</span><span>(</span>sql<span>)</span><span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><hr>
<h3 id="_6ã€é”™è¯¯-ã€ä¸»åº“ã€‘çŠ¶æ€ä¸å¯ç”¨-ç­‰å¾…åå°æ£€æŸ¥ç¨‹åºæ¢å¤æ–¹å¯ä½¿ç”¨ã€‚xxx" tabindex="-1"> 6ã€é”™è¯¯ï¼šã€ä¸»åº“ã€‘çŠ¶æ€ä¸å¯ç”¨ï¼Œç­‰å¾…åå°æ£€æŸ¥ç¨‹åºæ¢å¤æ–¹å¯ä½¿ç”¨ã€‚xxx</h3>
<p>ä¸€èˆ¬æ˜¯æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œæ‰ä¼šå‡ºç°ï¼Œè¯·æ£€æŸ¥ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´çš„ç½‘ç»œã€‚å…·ä½“æŒ‰ xxx ç»™å‡ºçš„æç¤ºè¿›è¡Œæ’æŸ¥ã€‚</p>
<hr>
<h3 id="_7ã€é”™è¯¯-ã€ä¸»åº“ã€‘å¯¹è±¡æ± å·²é‡Šæ”¾-æ— æ³•è®¿é—®ã€‚" tabindex="-1"> 7ã€é”™è¯¯ï¼šã€ä¸»åº“ã€‘å¯¹è±¡æ± å·²é‡Šæ”¾ï¼Œæ— æ³•è®¿é—®ã€‚</h3>
<p>åŸå› ä¸€ï¼šæ‰‹å·¥è°ƒç”¨äº† fsql.Disposeï¼Œä¹‹åä»ç„¶ä½¿ç”¨å®ƒ</p>
<p>åŸå› äºŒï¼šä½¿ç”¨äº† IdleBus ç®¡ç† IFreeSqlï¼Œé”™è¯¯çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>a) ä¸è¦æ„å»ºäº† IFreeSql å†ä¸¢å»æ³¨å†Œ</li>
</ul>
<div><pre><code><span><span>var</span></span> fsql <span>=</span> <span>new</span> <span>FreeSqlBulder</span><span>(</span><span>)</span><span>..</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
ib<span>.</span><span>Register</span><span>(</span><span>"key01"</span><span>,</span> <span>(</span><span>)</span> <span>=></span> fsql<span>)</span><span>;</span> <span>//é”™äº†ï¼Œé”™äº†ï¼Œé”™äº†</span>

ib<span>.</span><span>Register</span><span>(</span><span>"key01"</span><span>,</span> <span>(</span><span>)</span> <span>=></span> <span>new</span> <span>FreeSqlBulder</span><span>(</span><span>)</span><span>..</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>)</span><span>;</span> <span>//æ­£ç¡®</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><ul>
<li>b) å°½é‡æ¯æ¬¡éƒ½ä½¿ç”¨ ib.Get è·å¾— IFreeSql å¯¹è±¡(é¿å…å­˜å¯¹è±¡å¼•ç”¨)ï¼ŒIdleBus å†…éƒ¨è¶…æ—¶é‡Šæœºåˆ¶ä¸€æ—¶è§¦å‘ï¼Œå†ä½¿ç”¨å¼•ç”¨å¯¹è±¡ï¼Œå°±ä¼šæŠ¥è¿™ä¸ªæŠ¥é”™</li>
</ul>
<p>åŸå› ä¸‰ï¼šæ£€æŸ¥é¡¹ç›®çš„ç³»ç»Ÿäº‹ä»¶ï¼Œæ˜¯å¦åœ¨å¼‚å¸¸ä¹‹å‰è§¦å‘</p>
<div><pre><code>AppDomain<span>.</span>CurrentDomain<span>.</span>ProcessExit <span>+=</span> <span>(</span>s1<span>,</span> e1<span>)</span> <span>=></span>
<span>{</span>
  <span>//è®°å½•æ—¥å¿—</span>
<span>}</span><span>;</span>
Console<span>.</span>CancelKeyPress <span>+=</span> <span>(</span>s1<span>,</span> e1<span>)</span> <span>=></span>
<span>{</span>
  <span>//è®°å½•æ—¥å¿—</span>
<span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>å¦‚æœç¡®å®šé—®é¢˜ï¼Œå¯ä»¥åœ¨ FreeSqlBuilder æ„å»ºå¯¹è±¡çš„æ—¶å€™ UseExitAutoDisposePool(false) å…³é—­è¿™ä¸ªæœºåˆ¶</p>
<hr>
<h3 id="_8ã€é”™è¯¯-objectpool-get-è·å–è¶…æ—¶-10-ç§’-ã€‚" tabindex="-1"> 8ã€é”™è¯¯ï¼šObjectPool.Get è·å–è¶…æ—¶ï¼ˆ10 ç§’ï¼‰ã€‚</h3>
<p>åŸå› ä¸€ï¼šUnitOfWork ä½¿ç”¨æœªé‡Šæ”¾ï¼Œè¯·ä¿è¯ç¨‹åºå†…ä½¿ç”¨ UnitOfWork çš„åœ°æ–¹ä¼šæ‰§è¡Œ Dispose</p>
<p>åŸå› äºŒï¼šMax Pool Size è®¾ç½®è¿‡å°ï¼Œç¨‹åºè®¿é—®é‡è¿‡é«˜</p>
<p>ç›‘è§† fsql.Ado.MasterPool.Statisticsï¼Œå®ƒçš„å€¼ï¼šPool: 5/100, Get wait: 0, GetAsync await: 0</p>
<div><pre><code>5 ä¸ºå¯ç”¨è¿æ¥æ•°ï¼Œå€¼ä¸º0åå¼€å§‹æ’é˜Ÿ
100 ä¸ºå½“å‰æœ€å¤§è¿æ¥æ•°
Get await ä¸ºåŒæ­¥æ–¹æ³•è·å–è¿æ¥çš„æ’é˜Ÿæ•°é‡ï¼ˆè¶…è¿‡10ç§’å°±ä¼šæŠ¥é”™ï¼‰
GetAsync await ä¸ºå¼‚æ­¥æ–¹æ³•è·å–è¿æ¥çš„æ’é˜Ÿæ•°é‡
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>ç›‘è§† FreeSql.UnitOfWork.DebugBeingUsed è¿™ä¸ªé™æ€å­—å…¸ï¼Œå­˜å‚¨æ­£åœ¨ä½¿ç”¨äº‹åŠ¡çš„å·¥ä½œå•å…ƒ</p>
<p>æ³¨æ„ï¼šå°½é‡ä¸è¦ä½¿ç”¨ fsql.Ado.MasterPool.Get() æˆ– GetAsync() æ–¹æ³•ï¼Œå¦åˆ™è¯·æ£€æŸ¥å§¿åŠ¿ã€‚</p>
<hr>
<h3 id="_9ã€å¤šå¹³å°ä»£ç å‚è€ƒ-ä½¿ç”¨è‡ªå®šä¹‰-sqliteprovider-ä¾‹å¦‚-sqlite-ç”¨-microsoft-data-sqlite-æˆ–è€…åå°„-mono-data-sqlite" tabindex="-1"> 9ã€å¤šå¹³å°ä»£ç å‚è€ƒ,ä½¿ç”¨è‡ªå®šä¹‰ SqliteProvider,ä¾‹å¦‚ Sqlite ç”¨ Microsoft.Data.Sqlite æˆ–è€…åå°„ Mono.Data.Sqlite.</h3>
<p><a href="https://github.com/densen2014/FreeSqlDemos/tree/master/ARM_ConsoleApp" target="_blank" rel="noopener noreferrer">arm/æ ‘è“æ´¾</a></p>
<p><strong>æœ‰æ¡ä»¶çš„åŒå­¦ç›´æ¥è¯•è¯• FreeSql.Provider.SqliteCore åŒ…,ä½¿ç”¨çš„å°±æ˜¯ Microsoft.Data.Sqlite é©±åŠ¨.</strong></p>
<p>1.æ·»åŠ åŒ…</p>
<div><pre><code><span><span><span>&lt;</span>PackageReference</span> <span>Include</span><span><span>=</span><span>"</span>FreeSql.Provider.Sqlite<span>"</span></span> <span>Version</span><span><span>=</span><span>"</span>3.0.100<span>"</span></span> <span>/></span></span>
<span><span><span>&lt;</span>PackageReference</span> <span>Include</span> <span><span>=</span> <span>"</span>Microsoft.Data.Sqlite<span>"</span></span> <span>Version</span><span><span>=</span><span>"</span>6.0.3<span>"</span></span> <span>/></span></span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>2.ä»£ç </p>
<div><pre><code><span>Microsoft<span>.</span>Data<span>.</span>Sqlite<span>.</span>SqliteConnection</span> _database <span>=</span> <span>new</span> <span>Microsoft<span>.</span>Data<span>.</span>Sqlite<span>.</span>SqliteConnection</span><span>(</span><span><span>$"Data Source=document.db"</span></span><span>)</span><span>;</span>

<span><span>var</span></span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
        <span>.</span><span>UseConnectionFactory</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>(</span><span>)</span> <span>=></span> _database<span>,</span> <span>typeof</span><span>(</span><span>FreeSql<span>.</span>Sqlite<span>.</span>SqliteProvider<span>&lt;</span><span>></span></span><span>)</span><span>)</span>
        <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span>
        <span>.</span><span>UseNoneCommandParameter</span><span>(</span><span>true</span><span>)</span> <span>//å¿…é¡»å¼€å¯,å› ä¸ºMicrosoft.Data.Sqliteå†…æ’å¤„ç†æœ‰bug</span>
        <span>.</span><span>UseMonitorCommand</span><span>(</span>cmd <span>=></span> Console<span>.</span><span>Write</span><span>(</span>cmd<span>.</span>CommandText<span>)</span><span>)</span>
        <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p><a href="https://github.com/densen2014/FreeSqlDemos/tree/master/UWP1" target="_blank" rel="noopener noreferrer">UWP</a></p>
<div><pre><code><span>using</span> <span>System<span>.</span>Data<span>.</span>SQLite</span><span>;</span>

<span><span>string</span></span> dbpath <span>=</span> Path<span>.</span><span>Combine</span><span>(</span>ApplicationData<span>.</span>Current<span>.</span>LocalFolder<span>.</span>Path<span>,</span> <span>"sqliteSample.db"</span><span>)</span><span>;</span>
<span>SQLiteConnection</span> _database <span>=</span> <span>new</span> <span>SQLiteConnection</span><span>(</span><span><span>$"Data Source=</span><span><span>{</span><span>dbpath</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>
<span><span>var</span></span> fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
           <span>.</span><span>UseConnectionFactory</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>(</span><span>)</span> <span>=></span> _database<span>,</span> <span>typeof</span><span>(</span><span>FreeSql<span>.</span>Sqlite<span>.</span>SqliteProvider<span>&lt;</span><span>></span></span><span>)</span><span>)</span>
           <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p><a href="https://github.com/densen2014/FreeSqlDemos/tree/master/xamarinFormApps" target="_blank" rel="noopener noreferrer">Xamarin Forms,ä»£ç è¾ƒå¤š</a>
ä¸»ç¨‹åº,æ¥å£è·å– rovider,å„ä¸ªå¹³å°è‡ªå·±å®ç°.</p>
<div><pre><code><span>if</span> <span>(</span>Device<span>.</span>RuntimePlatform <span>==</span> Device<span>.</span>iOS <span>||</span> Device<span>.</span>RuntimePlatform <span>==</span> Device<span>.</span>Android<span>)</span>
<span>{</span>
   fsql <span>=</span> <span>new</span> <span>FreeSql<span>.</span>FreeSqlBuilder</span><span>(</span><span>)</span>
          <span>.</span><span>UseConnectionFactory</span><span>(</span>FreeSql<span>.</span>DataType<span>.</span>Sqlite<span>,</span> <span>(</span><span>)</span> <span>=></span> DependencyService<span>.</span><span><span>Get</span><span><span>&lt;</span>ISQLite<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>GetConnectionSqlite</span><span>(</span><span>"document"</span><span>)</span><span>,</span> <span>typeof</span><span>(</span><span>FreeSql<span>.</span>Sqlite<span>.</span>SqliteProvider<span>&lt;</span><span>></span></span><span>)</span><span>)</span>
          <span>.</span><span>UseNoneCommandParameter</span><span>(</span><span>true</span><span>)</span>
          <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p><a href="https://github.com/densen2014/FreeSqlDemos/blob/master/xamarinFormApps/xamarinFormApp.iOS/SQLite_iOS.cs" target="_blank" rel="noopener noreferrer">iOS éƒ¨åˆ†</a></p>
<p><a href="https://github.com/densen2014/FreeSqlDemos/blob/master/xamarinFormApps/xamarinFormApp.Android/SQLite_droid.cs" target="_blank" rel="noopener noreferrer">å®‰å“éƒ¨åˆ†</a></p>
<hr>
<h3 id="_10ã€-2-6-100-å‡çº§åˆ°-3-0-100-åæ— æ³•è¿æ¥-sqlserver-æç¤ºè¯ä¹¦æ— æ•ˆ-æç¤ºè¯ä¹¦é“¾æ˜¯ç”±ä¸å—ä¿¡ä»»çš„é¢å‘æœºæ„é¢å‘çš„" tabindex="-1"> 10ã€ 2.6.100 å‡çº§åˆ° 3.0.100 åæ— æ³•è¿æ¥ sqlserver æç¤ºè¯ä¹¦æ— æ•ˆ, æç¤ºè¯ä¹¦é“¾æ˜¯ç”±ä¸å—ä¿¡ä»»çš„é¢å‘æœºæ„é¢å‘çš„.</h3>
<p>è¯·å°è¯•:</p>
<p>1.è¿æ¥å­—ç¬¦ä¸²é‡ŒåŠ å…¥ &quot;Encrypt=True; TrustServerCertificate=True;&quot;</p>
<p>2.ä½¿ç”¨ FreeSql.Provider.SqlServerForSystem æ›¿æ¢ FreeSql.Provider.SqlServer</p>
<p>æ·±å…¥è®¨è®ºè¯·è½¬åˆ° https://github.com/dotnetcore/FreeSql/issues/992#issuecomment-1005305027</p>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">ä¸ Dapper æ¯”è¾ƒ</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/reference/vs-dapper.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/reference/vs-dapper.html"/>
    <updated>2022-05-31T14:08:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ä¸-dapper-æ¯”è¾ƒ" tabindex="-1"> ä¸ Dapper æ¯”è¾ƒ</h1>
<p>ä¼—æ‰€å‘¨çŸ¥ Dapper æ˜¯ .NET ä¸‹æœ€è½»æœ€å¿«çš„ ORMï¼Œå®ƒæ˜¯å–œæ¬¢å†™ SQL ç å†œçš„ç¦éŸ³ï¼Œç›¸å¯¹äº SqlHelper å®ƒæ›´åŠ æ–¹ä¾¿ï¼Œæ®ç»Ÿè®¡ 10 ä¸ª .NETer æœ‰ 9 ä¸ª ç”¨è¿‡ Dapperã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸ºå‡†å¤‡ä½¿ç”¨ FreeSql çš„æœ‹å‹è§£æƒ‘ï¼Œå¯¹æ¯” Dapper æœ‰ä½•ä¼˜åŠ¿ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨ FreeSqlï¼Ÿå¸Œæœ›æœ¬æ–‡å†…å®¹å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚</p>
<h2 id="å…³äºæ€§èƒ½-è¾“äº†" tabindex="-1"> å…³äºæ€§èƒ½ï¼ˆè¾“äº†ï¼‰</h2>
<p>Dapper + SQL æ˜¯å¤§å®¶ä¸€èˆ¬æ‰€ç”¨çš„æ–¹å¼ï¼Œæ€§èƒ½å¯¹æ¯”ä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<p>1ã€æ‰§è¡Œå‰ï¼Œè¡¨è¾¾å¼æ ‘è§£æï¼Œæ‹¼æ¥ SQL çš„æ¶ˆè€—ï¼š</p>
<ul>
<li>Dapper å‡ ä¹æ²¡æœ‰æ¶ˆè€—ï¼›</li>
<li>FreeSql ä¼šå­˜åœ¨é€’å½’è§£æã€å¯¹è±¡æ‹†ç®±ç­‰æ“ä½œï¼›</li>
</ul>
<p>ä»é¡¹ç›®å·¥ç¨‹å¯ç»´æŠ¤æ€§è§’åº¦çœ‹ï¼Œè¿™ä¸€ç‚¹æ€§èƒ½æŸå¤±æ˜¯èƒ½è¢«å®¹å¿çš„ï¼Œè¯·çœ‹ä¸‹é¢çš„æµ‹è¯•ç»“æœã€‚</p>
<p>2ã€æ‰§è¡Œåï¼Œè¿”å›æ•°æ®è½¬æ¢ä¸º Listï¼š</p>
<ul>
<li>Dapper é‡‡ç”¨ Emit æ„é€ å§”æ‰˜å¹¶ç¼“å­˜ï¼Œæ€§èƒ½æ¥è¿‘åŸç”Ÿä»£ç ï¼›</li>
<li>FreeSql é‡‡ç”¨ ExpressionTree æ„é€ å§”æ‰˜å¹¶ç¼“å­˜ï¼Œä¸ºäº†æ˜ å°„ç±»å‹æ›´åŠ æ˜“ç”¨ä½¿ç”¨äº†ä¸€ç‚¹è£…ç®±æ“ä½œï¼Œæ€§èƒ½æ¯” Dapper ç•¥ä½ï¼›</li>
</ul>
<table>
<thead>
<tr>
<th>Method</th>
<th>size</th>
<th style="text-align:right">Mean</th>
<th style="text-align:right">Error</th>
<th style="text-align:right">StdDev</th>
<th style="text-align:right">Median</th>
<th style="text-align:right">Rank</th>
</tr>
</thead>
<tbody>
<tr>
<td>FreeSqlSelect</td>
<td>1</td>
<td style="text-align:right">512.1 us</td>
<td style="text-align:right">25.99 us</td>
<td style="text-align:right">75.82 us</td>
<td style="text-align:right">519.6 us</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td>SqlSugarSelect</td>
<td>1</td>
<td style="text-align:right">438.6 us</td>
<td style="text-align:right">27.87 us</td>
<td style="text-align:right">81.75 us</td>
<td style="text-align:right">428.1 us</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td>EfCoreSelect</td>
<td>1</td>
<td style="text-align:right">594.3 us</td>
<td style="text-align:right">36.51 us</td>
<td style="text-align:right">107.08 us</td>
<td style="text-align:right">593.9 us</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td>DapperSelete</td>
<td>1</td>
<td style="text-align:right">287.5 us</td>
<td style="text-align:right">22.10 us</td>
<td style="text-align:right">63.77 us</td>
<td style="text-align:right">281.7 us</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td>FreeSqlSelect</td>
<td>500</td>
<td style="text-align:right">1,022.0 us</td>
<td style="text-align:right">72.17 us</td>
<td style="text-align:right">212.79 us</td>
<td style="text-align:right">957.0 us</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td>SqlSugarSelect</td>
<td>500</td>
<td style="text-align:right">1,338.1 us</td>
<td style="text-align:right">90.51 us</td>
<td style="text-align:right">261.15 us</td>
<td style="text-align:right">1,311.5 us</td>
<td style="text-align:right">7</td>
</tr>
<tr>
<td>EfCoreSelect</td>
<td>500</td>
<td style="text-align:right">1,390.0 us</td>
<td style="text-align:right">101.53 us</td>
<td style="text-align:right">296.18 us</td>
<td style="text-align:right">1,319.8 us</td>
<td style="text-align:right">7</td>
</tr>
<tr>
<td>DapperSelete</td>
<td>500</td>
<td style="text-align:right">919.0 us</td>
<td style="text-align:right">48.37 us</td>
<td style="text-align:right">139.55 us</td>
<td style="text-align:right">891.0 us</td>
<td style="text-align:right">5</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å¦‚ä¸Šæµ‹è¯• Top1ã€Top500 å•è¡¨æŸ¥è¯¢æ°´å¹³ç»“æœ</p>
</blockquote>
<blockquote>
<p>æµ‹è¯•æ³¨æ„ IFreeSql æ˜¯å•ä¾‹æ¨¡å¼è®¾è®¡ï¼Œè¯·å‹¿é‡å¤åˆ›å»ºï¼Œæµ‹è¯•å‰è¯·é¢„çƒ­</p>
</blockquote>
<p>æµ‹è¯•ç»“æœæ˜¯ us çº§åˆ«çš„æ…¢ï¼Œèƒ½æ¥å—ï¼Œå› ä¸ºæ•°æ®åº“çš„ä¸Šé™å¹¶å‘ç“¶é¢ˆæ¯”è¾ƒä½ï¼ˆå‡ ä¸‡çš„æ°´å¹³ï¼‰ï¼Œåº”ç”¨ç¨‹åºä¸­çš„è¿™ä¸€ç‚¹æ¶ˆè€—è¿œä¸æ˜¯é—®é¢˜ã€‚</p>
<p>æœ€æ€•æ–¹æ³•æˆ–è®¾è®¡é”™äº†å¯¼è‡´çš„æ…¢ï¼Œé‚£æ…¢å°±æ˜¯ç§’çº§ä»¥ä¸Šçš„æ…¢äº†ï¼Œæ— åŠ›å›å¤©ã€‚</p>
<h2 id="å…³äºåŠŸèƒ½-èµ¢äº†" tabindex="-1"> å…³äºåŠŸèƒ½ï¼ˆèµ¢äº†ï¼‰</h2>
<p>Dapper å‡ ä¹åªæœ‰æ‰§è¡Œ SQL çš„åŠŸèƒ½ï¼Œå¸‚é¢ä¸Šæœ‰ä¸€äº›åŸºäº Dapper åšçš„è½»é‡çº§ ORMï¼Œå¯ä»¥å¯¹å®ä½“å¯¹è±¡è¿›è¡Œ CRUD æ“ä½œï¼Œæ”¯æŒçš„æ•°æ®åº“æœ‰é™ã€‚</p>
<p>Dapper åœ¨åŠŸèƒ½æ–¹é¢å‡ ä¹å®Œè´¥äº FreeSqlï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>CodeFirstï¼šDapper ä¸æ”¯æŒï¼›</li>
<li>ç±»å‹æ˜ å°„ï¼šDapper åœ¨ä¸åŒæ•°æ®åº“ä¹‹é—´çš„ç±»å‹æ˜ å°„å®¹æ˜“æŠ¥é”™ã€‚æ¯”å¦‚å®ä½“ç±»å±æ€§æ˜¯ stringï¼Œä½†æ˜¯æ•°æ®åº“ç±»å‹æ˜¯ intï¼Œéå¸¸å®¹æ˜“æŠ¥é”™ï¼Œè¿™ä¸æ˜¯æ ï¼ŒçœŸå®é¡¹ç›®ä¸­æœ‰å¾ˆå¤šéç­‰æ˜ å°„ç±»å‹å­˜åœ¨ï¼›</li>
<li>è¡¨è¾¾å¼æ ‘ï¼šDapper ä¸æ”¯æŒå¯¼èˆªå±æ€§ã€è‡ªå®šä¹‰è§£æã€ä»¥åŠç‰¹åˆ«çš„è§£æï¼›</li>
<li>å¯¼èˆªå±æ€§ï¼šDapper ä¸æ”¯æŒï¼›</li>
<li>æ‰¹é‡æ’å…¥ï¼šDapper éœ€è¦è‡ªå·±å†™ SQL æˆ–è€…å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…ï¼ŒFreeSql è‡ªå¸¦é›†æˆï¼›</li>
<li>æ‰¹é‡æ›´æ–°ï¼šDapper éœ€è¦è‡ªå·±å†™ SQLï¼ŒFreeSql è‡ªå¸¦é›†æˆï¼›</li>
<li>å·¥ä½œå•å…ƒï¼šDapper éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…ï¼ŒFreeSql è‡ªå¸¦é›†æˆï¼›</li>
<li>è¯»å†™åˆ†ç¦»ï¼šï¼Ÿï¼Ÿ</li>
<li>å…¨å±€è¿‡æ»¤ï¼šï¼Ÿï¼Ÿ</li>
</ul>
<p>ç­‰ç­‰ã€‚ã€‚ã€‚</p>
<p>FreeSql èµ¢åœ¨åŠŸèƒ½ä¸°å¯Œï¼Œç»™ä½¿ç”¨è€…æä¾›æœ€å¤§ä¾¿åˆ©ï¼Œä½ å‡†å¤‡å¥½å…¥å‘äº†å—ï¼Ÿ</p>
<h2 id="å¦‚ä½•æ¥å…¥-è€é¡¹ç›®" tabindex="-1"> å¦‚ä½•æ¥å…¥ï¼ˆè€é¡¹ç›®ï¼‰</h2>
<p>å¦‚æœä½ çš„é¡¹ç›®æ­£åœ¨ä½¿ç”¨ Dapperï¼Œè¯·çœ‹ä»¥ä¸‹æˆæœ¬æœ€ä½çš„æ¥å…¥æ–¹æ³•ã€‚</p>
<p>FreeSql æ”¯æŒè°ƒç”¨ SQL/å­˜å‚¨è¿‡ç¨‹ï¼ŒåŒæ—¶ä¹Ÿä¸º IDbConnection/IDbTransaction æä¾›æ‰©å±•æ–¹æ³• Select/Delete/Insert/Update/InsertOrUpdateã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šä»¥æ•°æ®åº“ SqlServer è®¿é—®ä¸ºä¾‹ï¼Œåªéœ€è¦å®‰è£…å·²ç»åˆ’åˆ†å¥½çš„å°åŒ…ï¼š</p>
<div><pre><code>dotnet <span>add</span> packages FreeSql.Provider.SqlServer
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>or</p>
<div><pre><code>Install-Package FreeSql.Provider.SqlServer
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ç¬¬äºŒæ­¥ï¼šå»ºç«‹å®ä½“ç±»</p>
<div><pre><code><span>class</span> <span>TestConnectionExt</span> <span>{</span>
    <span>public</span> <span>Guid</span> id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span><span>string</span></span> title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>public</span> <span>DateTime</span> createTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>=</span> DateTime<span>.</span>Now<span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>ç¬¬ä¸‰æ­¥ï¼šå¼€å§‹ CRUD</p>
<div><pre><code><span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> <span>new</span> <span>SqlConnection</span><span>(</span>connectString<span>)</span><span>)</span> <span>{</span>
    <span><span>var</span></span> list <span>=</span> conn<span>.</span><span><span>Select</span><span><span>&lt;</span>TestConnectionExt<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>id <span>==</span> item<span>.</span>id<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> <span>new</span> <span>SqlConnection</span><span>(</span>connectString<span>)</span><span>)</span> <span>{</span>
    <span><span>var</span></span> item <span>=</span> <span>new</span> <span>TestConnectionExt</span> <span>{</span> title <span>=</span> <span>"testinsert"</span> <span>}</span><span>;</span>
    <span><span>var</span></span> affrows <span>=</span> conn<span>.</span><span>Insert</span><span>(</span>item<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> <span>new</span> <span>SqlConnection</span><span>(</span>connectString<span>)</span><span>)</span> <span>{</span>
    <span><span>var</span></span> affrows <span>=</span> conn<span>.</span><span><span>Update</span><span><span>&lt;</span>TestConnectionExt<span>></span></span></span><span>(</span><span>)</span>
        <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> xxx<span>)</span>
        <span>.</span><span>Set</span><span>(</span>a <span>=></span> a<span>.</span>title<span>,</span> <span>"testupdated"</span><span>)</span>
        <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> <span>new</span> <span>SqlConnection</span><span>(</span>connectString<span>)</span><span>)</span> <span>{</span>
    <span><span>var</span></span> affrows <span>=</span> conn<span>.</span><span><span>Delete</span><span><span>&lt;</span>TestConnectionExt<span>></span></span></span><span>(</span><span>)</span>
        <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Id <span>==</span> xxx<span>)</span>
        <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><p>æ·»åŠ æˆ–æ›´æ–°ï¼š</p>
<div><pre><code><span>using</span> <span>(</span><span><span>var</span></span> conn <span>=</span> <span>new</span> <span>SqlConnection</span><span>(</span>connectString<span>)</span><span>)</span> <span>{</span>
    <span><span>var</span></span> affrows <span>=</span> conn<span>.</span><span><span>InsertOrUpdate</span><span><span>&lt;</span>TestConnectionExt<span>></span></span></span><span>(</span><span>)</span>
        <span>.</span><span>SetSource</span><span>(</span>item<span>)</span>
        <span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>å¦‚ä¸Šæ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢ï¼Œå·²ç»æ”¯æŒå®ä½“ç±»æ“ä½œï¼Œå¹¶ä¸”æ”¯æŒæ‰¹é‡æ’å…¥ã€æ‰¹é‡æ›´æ–°ã€æ‰¹é‡åˆ é™¤ã€å¤šè¡¨æŸ¥è¯¢ã€å¯¼èˆªå±æ€§æŸ¥è¯¢ã€‚</p>
<p>å¯ä»¥äº«ç”¨ FreeSql å‡ ä¹æ‰€æœ‰åŠŸèƒ½ã€‚</p>
<p>æ€è€ƒï¼šä½¿ç”¨è¿™ç§ API è²Œä¼¼å¯ä»¥å¾ˆè½»æ¾çš„æ¥å…¥åˆ° abp vnext ä¸­ï¼Ÿ</p>
<h2 id="å­¦ä¹ æŒ‡å—" tabindex="-1"> å­¦ä¹ æŒ‡å—</h2>
<p>FreeSql æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆO/RMï¼‰ç»„ä»¶ï¼Œæ”¯æŒ .NET Core 2.1+ã€.NET Framework 4.0+ ä»¥åŠ Xamarinã€‚</p>
<ul>
<li>ğŸ›  æ”¯æŒ CodeFirst æ¨¡å¼ï¼Œå³ä¾¿ä½¿ç”¨ Access æ•°æ®åº“ä¹Ÿæ”¯æŒæ•°æ®è¿ç§»ï¼›</li>
<li>ğŸ’» æ”¯æŒ DbFirst æ¨¡å¼ï¼Œæ”¯æŒä»æ•°æ®åº“å¯¼å…¥å®ä½“ç±»ï¼Œæˆ–ä½¿ç”¨å®ä½“ç±»ç”Ÿæˆå·¥å…·ç”Ÿæˆå®ä½“ç±»ï¼›</li>
<li>â›³ æ”¯æŒ æ·±å…¥çš„ç±»å‹æ˜ å°„ï¼Œæ¯”å¦‚ PgSql çš„æ•°ç»„ç±»å‹ç­‰ï¼›</li>
<li>âœ’ æ”¯æŒ ä¸°å¯Œçš„è¡¨è¾¾å¼å‡½æ•°ï¼Œä»¥åŠçµæ´»çš„è‡ªå®šä¹‰è§£æï¼›</li>
<li>ğŸ æ”¯æŒ å¯¼èˆªå±æ€§ä¸€å¯¹å¤šã€å¤šå¯¹å¤šè´ªå©ªåŠ è½½ï¼Œä»¥åŠå»¶æ—¶åŠ è½½ï¼›</li>
<li>ğŸ“ƒ æ”¯æŒ è¯»å†™åˆ†ç¦»ã€åˆ†è¡¨åˆ†åº“ã€è¿‡æ»¤å™¨ã€ä¹è§‚é”ã€æ‚²è§‚é”ï¼›</li>
<li>ğŸŒ³ æ”¯æŒ MySql/SqlServer/PostgreSQL/Oracle/Sqlite/Firebird/è¾¾æ¢¦/äººå¤§é‡‘ä»“/ç¥èˆŸé€šç”¨/å—å¤§é€šç”¨/ç¿°é«˜/Access ç­‰æ•°æ®åº“ï¼›</li>
</ul>
<h4 id="åŸºç¡€" tabindex="-1"> åŸºç¡€</h4>
<ul>
<li><a href="/guide/insert.html">ã€Šå­¦ä¹  FreeSql ä¹‹ä¸€ï¼šæ·»åŠ æ•°æ®ã€‹</a></li>
<li><a href="/guide/delete.html">ã€Šå­¦ä¹  FreeSql ä¹‹äºŒï¼šåˆ é™¤æ•°æ®ã€‹</a></li>
<li><a href="/guide/update.html">ã€Šå­¦ä¹  FreeSql ä¹‹ä¸‰ï¼šä¿®æ”¹æ•°æ®ã€‹</a></li>
<li><a href="/guide/select.html">ã€Šå­¦ä¹  FreeSql ä¹‹å››ï¼šæŸ¥è¯¢æ•°æ®ã€‹</a></li>
<li><a href="/guide/repository.html">ã€Šä»“å‚¨å±‚ Repositoryã€‹</a></li>
</ul>
<h4 id="è¿›é˜¶" tabindex="-1"> è¿›é˜¶</h4>
<ul>
<li><a href="/guide/code-first.html">ã€ŠCodeFirst æ¨¡å¼å¼€å‘ä»‹ç»ã€‹</a>
<ul>
<li><a href="/guide/entity-attribute.html">ã€ŠCodeFirst æ¨¡å¼ä¹‹ä¸€ï¼šå®ä½“ç‰¹æ€§ã€‹</a></li>
<li><a href="/guide/fluent-api.html">ã€ŠCodeFirst æ¨¡å¼ä¹‹äºŒï¼šFluentApiã€‹</a></li>
<li><a href="/guide/custom-attribute.html">ã€ŠCodeFirst æ¨¡å¼ä¹‹ä¸‰ï¼šè‡ªå®šä¹‰ç‰¹æ€§ã€‹</a></li>
<li><a href="/guide/type-mapping.html">ã€ŠCodeFirst æ¨¡å¼ä¹‹å››ï¼šç±»å‹æ˜ å°„ã€‹</a></li>
<li><a href="/guide/code-first.html#%E8%BF%81%E7%A7%BB%E7%BB%93%E6%9E%84">ã€ŠCodeFirst æ¨¡å¼ä¹‹äº”ï¼šè¿ç§»ç»“æ„ã€‹</a></li>
</ul>
</li>
</ul>
<ul>
<li><a href="/guide/db-first.html">ã€ŠDbFirst æ¨¡å¼å¼€å‘ä»‹ç»ã€‹</a></li>
</ul>
<h4 id="é«˜çº§" tabindex="-1"> é«˜çº§</h4>
<ul>
<li><a href="/guide/transaction.html">ã€Šæ•°æ®åº“äº‹åŠ¡ã€‹</a></li>
<li><a href="/guide/read-write-splitting.html">ã€Šä½¿ç”¨è¯»å†™åˆ†ç¦»ã€‹</a></li>
<li><a href="/guide/sharding.html">ã€Šåˆ†è¡¨åˆ†åº“ã€‹</a></li>
<li><a href="/guide/multi-tenancy.html">ã€Šå¤šç§Ÿæˆ·ã€‹</a></li>
<li><a href="/guide/select-return-data.html">ã€Šè¿”å›æ•°æ®ã€‹</a></li>
<li><a href="/guide/select-lazy-loading.html">ã€Šä¼˜åŒ–ä¹‹ï¼šå»¶æ—¶åŠ è½½ã€‹</a></li>
<li><a href="/guide/select-include.html">ã€Šä¼˜åŒ–ä¹‹ï¼šè´ªå©ªåŠ è½½ã€‹</a></li>
<li><a href="/guide/expression-function.html">ã€ŠExpression è¡¨è¾¾å¼å‡½æ•°ã€‹</a></li>
<li><a href="/guide/aop.html">ã€ŠAOPã€‹</a></li>
</ul>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
  <entry>
    <title type="html">ä¸ EntityFramework æ¯”è¾ƒ</title>
    <id>http://freesql.net/FreeSql.Wiki.VuePress/reference/vs-entity-framework.html</id>
    <link href="http://freesql.net/FreeSql.Wiki.VuePress/reference/vs-entity-framework.html"/>
    <updated>2022-05-16T12:50:28.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ä¸-entityframework-æ¯”è¾ƒ" tabindex="-1"> ä¸ EntityFramework æ¯”è¾ƒ</h1>
<p>ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« ï¼Ÿ</p>
<p>å¸Œæœ›é’ˆå¯¹ SEO ä¼˜åŒ–æœç´¢å¼•æ“ï¼Œè®©æ›´å¤šä¸­å›½äººçŸ¥é“å¹¶ä¸”ä½¿ç”¨ã€‚ç›®å‰ç™¾åº¦æœç´¢ .NET ORM å…¨æ˜¯ sqlsugarï¼Œæˆ‘ä¸ªäººæ˜¯æ— è¯­çš„ï¼Œæ¯æ¯ä¸€ä¸ªäººè¿›ç¾¤ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æ‹¿æ¥æ¯”è¾ƒï¼Œæ¯å¤©è¦é‡å¤å›ç­”ã€é‡å¤è§£ç­”ã€è¯´æœä»–ä»¬ã€‚æƒ³è¯´æœæ ‡ç­¾æ˜¯åæ°”å¤§ã€ä½¿ç”¨è€…å¤šçš„åŒç±»å‹ .NET ORM éå¸¸å›°éš¾ï¼Œæœ€å¤šåªèƒ½è®©ä»–ä»¬å‹‰å¼ºæ¥å—ã€‚</p>
<p>FreeSql ä¸æ„¿åšè‡ªå·±å‘å…‰çš„é‡‘å­ï¼Œå¸Œæœ›åœ¨ 2020 å¹´ å†™ä¸‹è¿™ç¯‡å®Œæ•´ä¸€ç‚¹çš„ .NET ORM æ¯”è¾ƒï¼Œä¸ºå‡†å¤‡ä½¿ç”¨ FreeSql çš„æœ‹å‹è§£æƒ‘ï¼Œèƒ½æ’ä¸Šç™¾åº¦æœç´¢å¼•æ“å½“ç„¶å†å¥½ä¸è¿‡äº†ã€‚</p>
<p>è‚¯è¯·åŠ¨ä¸€åŠ¨æ‰‹æŒ‡å¤šå¤šè½¬å‘è½¬å‘æ–‡ç« ï¼Œå¹¶åŠ ä¸ŠåŸæ–‡é“¾æ¥ï¼Œè°¢è°¢ï¼MarkDownï¼š<a href="https://files.cnblogs.com/files/kellynic/ORM_VS.zip" target="_blank" rel="noopener noreferrer">https://files.cnblogs.com/files/kellynic/ORM_VS.zip</a></p>
<h2 id="åŸºç¡€ä¿¡æ¯æ¯”è¾ƒ" tabindex="-1"> åŸºç¡€ä¿¡æ¯æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>åŠŸèƒ½é¡¹</th>
<th>FreeSql</th>
<th>EFCore</th>
<th>SqlSugar</th>
</tr>
</thead>
<tbody>
<tr>
<td>å‡ºç”Ÿæ—¶é—´</td>
<td>2018 å¹´ 12 æœˆ</td>
<td>2015 å¹´(çº¦)</td>
<td>2014 å¹´(çº¦)</td>
</tr>
<tr>
<td>å¼€æºåè®®</td>
<td>MIT</td>
<td>Apache-2.0</td>
<td>Apache-2.0</td>
</tr>
<tr>
<td>æ‰€å±æœºæ„</td>
<td><a href="https://github.com/dotnetcore" target="_blank" rel="noopener noreferrer">dotnetcore(NCC)</a></td>
<td>dotnet</td>
<td>sunkaixuan(ä¸ªäºº)</td>
</tr>
<tr>
<td>å•å…ƒæµ‹è¯•æ•°é‡</td>
<td>5500+</td>
<td>å¾ˆå¤š</td>
<td>æ— </td>
</tr>
<tr>
<td>github star</td>
<td>2.1k+</td>
<td>9.5k+</td>
<td>3.1k+</td>
</tr>
<tr>
<td>github issues</td>
<td>æ´»è·ƒ</td>
<td>æ´»è·ƒ</td>
<td>ä¸æ´»è·ƒ</td>
</tr>
<tr>
<td>æ”¯æŒå¹³å°</td>
<td>.NET4.0+ã€.NETCore</td>
<td>.NETCore</td>
<td>.NET4.5+ã€.NETCore</td>
</tr>
<tr>
<td>æ”¯æŒæ•°æ®åº“</td>
<td>å¾ˆå¤šï¼Œå¹¶ä¸”è¡Œä¸ºä¸€è‡´</td>
<td>å¾ˆå¤š</td>
<td>SqlServer/MySql/Sqlite/Oracle</td>
</tr>
<tr>
<td>ç”Ÿå‘½å‘¨æœŸ</td>
<td>Singleton</td>
<td>Scoped</td>
<td>Scoped</td>
</tr>
<tr>
<td>ä½¿ç”¨æ–¹å¼</td>
<td>IFreeSqlã€Repository</td>
<td>DbContext</td>
<td>SugarClient</td>
</tr>
</tbody>
</table>
<p>FreeSql .NET ORM æ”¯æŒ MySql/SqlServer/PostgreSQL/Oracle/Sqlite/Firebird/è¾¾æ¢¦/äººå¤§é‡‘ä»“/ç¥èˆŸé€šç”¨/Accessã€‚</p>
<p>.NET ORM å„æœ‰è‡ªå·²çœ‹å®¶æœ¬é¢†ï¼Œæœ¬æ–‡ä¸»è¦æŒ‰ FreeSql æä¾›çš„åŠŸèƒ½è¿›è¡Œåˆ—ä¸¾æ¯”è¾ƒï¼Œå¦‚æœ‰å†’çŠ¯è¯·è§è°…ï¼Œä¹Ÿæ¬¢è¿å‘ FreeSql æå‡ºåŠŸèƒ½å»ºè®®ã€‚</p>
<p>æ¯ä¸ªåŠŸèƒ½å®ç°çš„æ·±åº¦å±‚æ¬¡ä¸ä¸€æ ·ï¼ˆæ¯”å¦‚ EFCore æ”¯æŒ SqlServer 2012ï¼ŒFreeSql æ”¯æŒ SqlServer 2005ï¼‰ï¼Œå¾ˆéš¾å½»åº•æ¯”è¾ƒï¼Œæç¤ºï¼š</p>
<ul>
<li>æœ¬æ–‡æ¯”è¾ƒçš„åŠŸèƒ½ FreeSql æ¯ç§æ•°æ®åº“åŸºæœ¬éƒ½æœ‰æä¾›ï¼Œä¸åƒ EFCore åå‘ SqlServer</li>
<li>æœ¬æ–‡åªæ¯”è¾ƒå®˜æ–¹æä¾›çš„åŠŸèƒ½ï¼ˆä¸åŒ…å«ç¬¬ä¸‰æ–¹æ‰©å±•ï¼‰</li>
</ul>
<p><img src="https://img2020.cnblogs.com/blog/31407/202009/31407-20200914063104631-2088330287.png" alt="" loading="lazy"></p>
<p><img src="https://img2020.cnblogs.com/blog/31407/202009/31407-20200914063148941-1489586974.png" alt="" loading="lazy"></p>
<p><img src="https://img2020.cnblogs.com/blog/31407/202009/31407-20200914063955435-856878176.png" alt="" loading="lazy"></p>
<h2 id="net-orm-æ•´ä½“åŠŸèƒ½æ¯”è¾ƒ" tabindex="-1"> .NET ORM æ•´ä½“åŠŸèƒ½æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>åŠŸèƒ½é¡¹</th>
<th>FreeSql</th>
<th>EFCore</th>
<th>SqlSugar</th>
</tr>
</thead>
<tbody>
<tr>
<td>.NET ORM CodeFirst æ ¹æ®å®ä½“ç±»å‹ï¼Œåˆ›å»ºè¡¨ç»“æ„</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM CodeFirst æ ¹æ®å®ä½“ç±»å‹ï¼Œå¯¹æ¯”è¡¨ç»“æ„</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM CodeFirst æ ¹æ®å®ä½“ç±»å‹æ³¨é‡Šï¼Œè¿ç§»è¡¨ç»“æ„å¤‡æ³¨</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM CodeFirst FluentApi</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM CodeFirst FluentApi è¯­æ³•å…¼å®¹ EFCore</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM CodeFirst å®ä½“ç‰¹æ€§å…¼å®¹ EFCore</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM CodeFirst è‡ªå®šä¹‰å®ä½“ç‰¹æ€§(Aop)</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM CodeFirst ç±»å‹è½¬æ¢æ˜ å°„(MapType)</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM DbFirst æ ¹æ®æ•°æ®åº“ï¼Œç”Ÿæˆå®ä½“ç±»</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM å¯¼èˆªå±æ€§(OneToOne)</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM å¯¼èˆªå±æ€§(ManyToOne)</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM å¯¼èˆªå±æ€§(OneToMany)</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM å¯¼èˆªå±æ€§(ManyToMany)</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM å¯¼èˆªå±æ€§(Parent) <a href="/reference/select-as-tree.html">çˆ¶å­å…³ç³»çš„å®ä½“ç±»</a></td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM å¯¼èˆªå±æ€§å»¶æ—¶åŠ è½½ã€è´ªå©ªåŠ è½½ã€çº§è”ä¿å­˜</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM è‡ªå®šä¹‰è¡¨è¾¾å¼æ ‘è§£æ</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM å…¨å±€è¿‡æ»¤å™¨</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM äº‹åŠ¡</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM è¯»å†™åˆ†ç¦»</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM åˆ†è¡¨åˆ†åº“</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM ä»“å‚¨ Repository</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM å·¥ä½œå•å…ƒ UnitOfWork</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM å·¥ä½œå•å…ƒç®¡ç†å™¨ UnitOfWorkManager</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM DbContext çŠ¶æ€ç®¡ç†</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
</tbody>
</table>
<h2 id="net-orm-crud-åŠŸèƒ½æ¯”è¾ƒ" tabindex="-1"> .NET ORM CRUD åŠŸèƒ½æ¯”è¾ƒ</h2>
<table>
<thead>
<tr>
<th>åŠŸèƒ½é¡¹</th>
<th>FreeSql</th>
<th>EFCore</th>
<th>SqlSugar</th>
</tr>
</thead>
<tbody>
<tr>
<td>.NET ORM CRUD æ—¶ï¼Œæ˜ å°„åŠ¨æ€è¡¨å</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM CRUD æ—¶ï¼Œä½¿ç”¨å‚æ•°åŒ– SQL æ‰§è¡Œ</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM CRUD æ—¶ï¼Œä¸ä½¿ç”¨å‚æ•°åŒ– SQL æ‰§è¡Œ(NoneParameter)</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM CRUD æ—¶ï¼Œè·å–å¯¹åº”çš„ SQL(ToSql)</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM CRUD æ—¶ï¼Œç»Ÿä¸€å®¡è®¡å®ä½“å±æ€§å€¼(Aop.AuditValue)</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>.NET ORM æ’å…¥(å•æ¡)</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ’å…¥æ—¶ï¼Œå¿½ç•¥/æŒ‡å®šåˆ—</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ’å…¥æ—¶ï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ’å…¥æ—¶ï¼Œè¿”å›æ’å…¥åçš„è‡ªå¢å€¼</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ’å…¥æ—¶ï¼Œè¿”å›æ’å…¥åçš„è®°å½•</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ’å…¥æ—¶ï¼ŒInsert Ignore Into</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ’å…¥æ—¶ï¼ŒOn Duplicate Key Update</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ’å…¥æ—¶ï¼ŒOn Conflict Do Update</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ‰¹é‡æ’å…¥ <a href="https://www.cnblogs.com/kellynic/p/10557882.html" target="_blank" rel="noopener noreferrer">æ€§èƒ½æµ‹è¯•ç»“æœå‚è€ƒæ–‡æ¡£</a></td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ‰¹é‡æ’å…¥æ—¶ï¼Œè‡ªåŠ¨åˆ†æ‰¹ <a href="/reference/insert.html">å‚è€ƒæ–‡æ¡£</a></td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ‰¹é‡æ’å…¥æ—¶ï¼Œä½¿ç”¨ BulkCopy</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°(å•æ¡)</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼ŒåŠ¨æ€æ¡ä»¶(WhereDynamic)</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼Œæ ¹æ®å®ä½“å¯¹è±¡æ›´æ–°</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼Œæ ¹æ®çŠ¶æ€ç®¡ç†åªæ›´æ–°æœ‰å˜åŒ–çš„å±æ€§</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼Œå¿½ç•¥/æŒ‡å®šåˆ—</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼ŒåŸå­æ€§ set num=num+1</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼ŒæŒ‡å®šæ¡ä»¶</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼Œè‡ªåŠ¨é™„åŠ å…¨å±€è¿‡æ»¤å™¨æ¡ä»¶</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼Œä¸éœ€è¦å…ˆæŸ¥è¯¢</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼Œä½¿ç”¨ä¹è§‚è¡Œé”</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼Œä½¿ç”¨æ‚²è§‚é”</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ›´æ–°æ—¶ï¼Œè¿”å›æ›´æ–°åçš„è®°å½•</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ‰¹é‡æ›´æ–°</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>.NET ORM åˆ é™¤(å•æ¡)</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM åˆ é™¤æ—¶ï¼ŒåŠ¨æ€æ¡ä»¶(WhereDynamic)</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM åˆ é™¤æ—¶ï¼ŒæŒ‡å®šæ¡ä»¶</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM åˆ é™¤æ—¶ï¼Œè‡ªåŠ¨é™„åŠ å…¨å±€è¿‡æ»¤å™¨æ¡ä»¶</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM åˆ é™¤æ—¶ï¼Œä¸éœ€è¦å…ˆæŸ¥è¯¢</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM åˆ é™¤æ—¶ï¼Œè¿”å›å½±å“çš„è¡Œæ•°</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM åˆ é™¤æ—¶ï¼Œè¿”å›æ’å…¥åçš„è®°å½•</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM çº§è”ä¿å­˜</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ·»åŠ æˆ–æ›´æ–°</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æ·»åŠ æˆ–æ›´æ–°ï¼Œè‡ªåŠ¨é€‚é… merge into <a href="/reference/insert-or-update.html">å‚è€ƒæ–‡æ¡£</a></td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æ‰¹é‡ç¼–è¾‘ä¿å­˜ <a href="/reference/insert-or-update.html">å‚è€ƒæ–‡æ¡£</a></td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢(å•æ¡)</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œåˆ†é¡µ</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œåˆ†é¡µæ”¯æŒ SqlServer2008</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼ŒåŠ¨æ€æ¡ä»¶(WhereDynamic)</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼ŒåŠ¨æ€è¿‡æ»¤æ¡ä»¶(WhereDynamicFilter) <a href="/reference/select.html">å‚è€ƒæ–‡æ¡£</a></td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œè‡ªåŠ¨é™„åŠ å…¨å±€è¿‡æ»¤å™¨æ¡ä»¶</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œå¤šè¡¨æ¡ä»¶ä¼ æ’­(WhereCascade)</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œåœ¨ lambda ä¸­ä½¿ç”¨å¯¼èˆªå±æ€§</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œç”¨ Dto æ˜ å°„åªéœ€è¦æŸ¥è¯¢çš„å­—æ®µ</td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œä¼  Sql ä½œäºŒæ¬¡æŸ¥è¯¢(WithSql)</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œå­æŸ¥è¯¢(Exists)</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œå­æŸ¥è¯¢(In)</td>
<td>âœ”</td>
<td>-</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œå­æŸ¥è¯¢æ‹¼æ¥ç»“æœ(string.Join) <a href="/reference/select-multi-table.html">å‚è€ƒæ–‡æ¡£</a></td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨åˆ†ç»„èšåˆ(GroupBy/Having)</td>
<td>âœ”</td>
<td>âœ”</td>
<td>âœ”</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨ Linq To Sql è¯­æ³•</td>
<td>âœ”</td>
<td>âœ”</td>
<td>-</td>
</tr>
<tr>
<td>.NET ORM æŸ¥è¯¢æ—¶ï¼Œé’ˆå¯¹æ ‘å½¢ç»“æ„è¡¨ <a href="/reference/select-as-tree.html">çˆ¶å­å…³ç³»çš„å®ä½“ç±»</a></td>
<td>âœ”</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2021-02-04T16:03:18.000Z</published>
  </entry>
</feed>